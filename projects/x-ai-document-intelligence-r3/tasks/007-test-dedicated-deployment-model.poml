<task id="007" project="ai-document-intelligence-r3">
  <metadata>
    <title>Test Dedicated Deployment Model</title>
    <phase>1</phase>
    <tags>testing, rag, dedicated-model, integration</tags>
    <estimate>4h</estimate>
    <dependencies>005</dependencies>
    <status>completed</status>
  </metadata>

  <prompt>
    <role>QA Engineer / .NET Developer</role>
    <goal>Test the Dedicated deployment model end-to-end for RAG functionality</goal>
    <context>
      Dedicated deployment model creates a per-customer index for complete isolation.
      Need to verify:
      - Index creation per customer works
      - Documents indexed to correct customer index
      - Hybrid search works within customer index
      - No cross-tenant data leakage possible
    </context>
    <constraints>
      - MUST test per-customer index creation
      - MUST test document indexing to dedicated index
      - MUST test hybrid search retrieval
      - MUST verify complete tenant isolation
      - MUST test CustomerOwned connection string handling
    </constraints>
  </prompt>

  <knowledge>
    <files>
      <file>docs/ai-knowledge/guides/SPAARKE-AI-ARCHITECTURE.md</file>
      <file>projects/ai-document-intelligence-r3/CLAUDE.md</file>
    </files>
  </knowledge>

  <steps>
    <step order="1">Create dedicated index for test customer</step>
    <step order="2">Index documents to dedicated index</step>
    <step order="3">Execute hybrid search queries</step>
    <step order="4">Verify no access to shared index data</step>
    <step order="5">Test CustomerOwned model with mock connection string</step>
    <step order="6">Verify connection string from Key Vault works</step>
    <step order="7">Document test results</step>
  </steps>

  <tools>
    <tool>Bash - Run integration tests</tool>
    <tool>Write - Document test results</tool>
  </tools>

  <outputs>
    <output>Integration test suite for Dedicated model</output>
    <output>Integration test suite for CustomerOwned model</output>
    <output>Test results document</output>
    <output>Security verification report</output>
  </outputs>

  <acceptance-criteria>
    <criterion>Dedicated index created successfully</criterion>
    <criterion>Documents indexed to correct index</criterion>
    <criterion>Complete tenant isolation verified</criterion>
    <criterion>CustomerOwned connection strings work</criterion>
    <criterion>No cross-tenant data access possible</criterion>
    <criterion>Test results documented</criterion>
  </acceptance-criteria>

  <execution>
    <on-complete>Update TASK-INDEX.md status to âœ…</on-complete>
    <next-task>008-document-rag-implementation.poml</next-task>
  </execution>

  <notes>
    <completion-date>2025-12-29</completion-date>
    <summary>Created comprehensive test suite for Dedicated and CustomerOwned RAG deployment models.</summary>
    <findings>
      <finding type="created">tests/integration/Spe.Integration.Tests/RagDedicatedDeploymentTests.cs - 14 integration tests</finding>
      <finding type="created">scripts/Test-RagDedicatedModel.ps1 - PowerShell E2E test script</finding>
      <finding type="created">projects/ai-document-intelligence-r3/notes/task-007-test-results.md - Test documentation</finding>
      <finding type="note">Dedicated model uses sanitized tenant ID for index naming (lowercase, alphanumeric, hyphens)</finding>
      <finding type="note">CustomerOwned model requires SearchEndpoint and ApiKeySecretName for validation</finding>
      <finding type="note">SearchClient instances are cached per tenant for performance</finding>
      <finding type="note">Cross-model isolation tests verify Dedicated cannot see Shared data</finding>
      <finding type="note">Index name format: {sanitizedTenantId}-knowledge</finding>
    </findings>
  </notes>
</task>
