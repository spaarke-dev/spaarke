<task id="050" project="ai-playbook-node-builder-r3">
  <metadata>
    <title>Comprehensive Error Handling Review</title>
    <phase>6</phase>
    <estimate>2-3 hours</estimate>
    <tags>quality, error-handling</tags>
    <dependencies>045</dependencies>
    <status>pending</status>
  </metadata>

  <prompt>
    <goal>Review and enhance error handling across all new code from Phases 1-5.</goal>

    <context>
      Before final testing, ensure all new code has proper error handling with user-friendly messages, appropriate logging, and retry logic where needed.
    </context>

    <constraints>
      - Use ProblemDetails for API errors per ADR-019
      - User-friendly messages in frontend
      - Retry logic for transient failures
      - Correlation IDs for tracing
    </constraints>
  </prompt>

  <knowledge>
    <files>
      <file path=".claude/adr/ADR-019-problemdetails.md" reason="Error handling pattern" />
      <file path=".claude/patterns/api/error-handling.md" reason="Error patterns" />
      <file path=".claude/patterns/pcf/error-handling.md" reason="PCF error patterns" />
    </files>
  </knowledge>

  <steps>
    <step order="1">Review ScopeResolverService CRUD methods for error handling</step>
    <step order="2">Review AiPlaybookBuilderService for AI call failures</step>
    <step order="3">Review test execution for failure scenarios</step>
    <step order="4">Review frontend components for error states</step>
    <step order="5">Add retry logic for transient failures (AI calls, Dataverse)</step>
    <step order="6">Ensure correlation IDs included in all errors</step>
    <step order="7">Test error scenarios manually</step>
  </steps>

  <tools>
    <tool name="Read">Review code</tool>
    <tool name="Edit">Add error handling</tool>
    <tool name="Bash">Test error scenarios</tool>
  </tools>

  <outputs>
    <output type="code">Enhanced error handling across all new code</output>
  </outputs>

  <acceptance-criteria>
    <criterion>All API errors return ProblemDetails</criterion>
    <criterion>Frontend shows user-friendly error messages</criterion>
    <criterion>Transient failures have retry logic</criterion>
    <criterion>Errors include correlation IDs</criterion>
  </acceptance-criteria>
</task>
