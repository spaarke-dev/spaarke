# Unified Playbook and Workflow Orchestration â€“ Design Update

> **Update Date**: January 2026  
> **Purpose**: Extend the Node-Based Playbook Builder to support unified AI and traditional workflow orchestration.

---

## Executive Update

This update formalizes the convergence of **AI analysis playbooks** and **traditional workflow orchestration** into a single, unified execution model.

Key principles:

- A *Playbook* is a workflow container.
- An *Action Node* is a workflow step.
- AI reasoning and deterministic workflow logic differ only by **execution semantics**, not structure.
- All steps are explicitly authored, ordered, governed, and auditable.

---

## Intelligence-Aware Action Nodes

Each Action Node is extended with two required attributes.

### Intelligence Type

Defines how the node executes.

| Type | Description |
|-----|-------------|
| AI_MODEL | LLM or foundation model reasoning |
| RULE_ENGINE | Deterministic business or legal rules |
| CALCULATION | Formula-based computation |
| WORKFLOW | Task, notification, or state change |
| INTEGRATION | External system interaction |
| HUMAN_DECISION | Pause for approval or review |
| SCRIPT | Custom executable logic |

Execution order is always defined by the graph.

---

### Intelligence Source

Defines where the logic comes from.

Examples:
- Azure OpenAI deployment
- Spaarke legal rules library
- Versioned calculation definition
- Power Automate flow
- External API endpoint

This separation ensures vendor neutrality, auditability, and replaceability.

---

## Unified Conceptual Model

```
PLAYBOOK (Workflow Container)
  â”œâ”€ Action Node (AI_MODEL)
  â”‚    â”œâ”€ Skills
  â”‚    â”œâ”€ Tools
  â”‚    â”œâ”€ Knowledge
  â”‚    â””â”€ Output
  â”œâ”€ Action Node (RULE_ENGINE)
  â”œâ”€ Action Node (CALCULATION)
  â””â”€ Action Node (WORKFLOW)
```

---

## Scope Applicability

| Scope | AI | Rules | Calc | Workflow |
|------|----|-------|------|----------|
| Action | âœ“ | âœ“ | âœ“ | âœ“ |
| Skills | âœ“ | â—¦ | â—¦ | âœ— |
| Tools | âœ“ | âœ“ | âœ“ | âœ“ |
| Knowledge | âœ“ | âœ“ | â—¦ | â—¦ |
| Output | âœ“ | âœ“ | âœ“ | âœ“ |

---

## Positioning

This is not an agentic framework.

- No autonomous planning
- No self-directed execution
- No emergent control flow

It is a **human-designed, intelligence-aware workflow system** that makes AI behavior visible, composable, and governable.

---

## Original Design Specification

# AI Node-Based Playbook Builder - Design Specification

> **Status**: Research Draft
> **Created**: January 2026
> **Author**: AI Architecture Team
> **Prerequisite**: R4 Complete (Playbook Scope System), R5 Design (RAG Pipeline)

---

## Table of Contents

1. [Executive Summary](#executive-summary)
2. [Market Context](#market-context)
3. [Architecture Overview](#architecture-overview)
4. [Visual Design Concepts](#visual-design-concepts)
5. [Node Types and Components](#node-types-and-components)
6. [Data Flow and Execution](#data-flow-and-execution)
7. [Canvas UX Design](#canvas-ux-design)
8. [Data Model](#data-model)
9. [Integration with Existing Systems](#integration-with-existing-systems)
10. [Technical Implementation](#technical-implementation)
11. [User Personas and Workflows](#user-personas-and-workflows)
12. [Phased Rollout](#phased-rollout)

---

## Executive Summary

The **AI Node-Based Playbook Builder** transforms Spaarke's current table-driven playbook configuration into an intuitive visual workflow editor. Users construct AI analysis workflows by connecting Action Nodes on a canvas, where each node can be configured with Skills, Tools, Knowledge, and Output specifications.

### Key Benefits

| Benefit | Impact |
|---------|--------|
| **Visual understanding** | See the entire analysis flow at a glance |
| **Rapid prototyping** | Drag-and-drop new workflows in minutes |
| **Governance** | Clear audit trail of AI decision points |
| **Reusability** | Save and share node configurations |
| **Debugging** | Visual execution trace shows where issues occur |

### Core Concept

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           PLAYBOOK CANVAS                                    â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚   â”‚   Extract    â”‚      â”‚   Analyze    â”‚      â”‚    Detect    â”‚              â”‚
â”‚   â”‚   Entities   â”‚â”€â”€â”€â”€â”€â–¶â”‚   Clauses    â”‚â”€â”€â”€â”€â”€â–¶â”‚    Risks     â”‚              â”‚
â”‚   â”‚              â”‚      â”‚              â”‚      â”‚              â”‚              â”‚
â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚      â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚      â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚              â”‚
â”‚   â”‚ â”‚  Skills  â”‚ â”‚      â”‚ â”‚  Skills  â”‚ â”‚      â”‚ â”‚  Skills  â”‚ â”‚              â”‚
â”‚   â”‚ â”‚  Tools   â”‚ â”‚      â”‚ â”‚  Tools   â”‚ â”‚      â”‚ â”‚  Tools   â”‚ â”‚              â”‚
â”‚   â”‚ â”‚Knowledge â”‚ â”‚      â”‚ â”‚Knowledge â”‚ â”‚      â”‚ â”‚Knowledge â”‚ â”‚              â”‚
â”‚   â”‚ â”‚  Output  â”‚ â”‚      â”‚ â”‚  Output  â”‚ â”‚      â”‚ â”‚  Output  â”‚ â”‚              â”‚
â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚      â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚      â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚          â”‚                                            â”‚                      â”‚
â”‚          â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚                      â”‚
â”‚          â”‚              â”‚   Generate   â”‚              â”‚                      â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   Summary    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                         â”‚              â”‚                                     â”‚
â”‚                         â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                                     â”‚
â”‚                         â”‚ â”‚  Output: â”‚ â”‚                                     â”‚
â”‚                         â”‚ â”‚Executive â”‚ â”‚                                     â”‚
â”‚                         â”‚ â”‚ Summary  â”‚ â”‚                                     â”‚
â”‚                         â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                                     â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Market Context

### Competitive Landscape

The node-based visual AI workflow builder market has matured significantly. Key players include:

| Tool | Focus | Strengths | Spaarke Differentiation |
|------|-------|-----------|------------------------|
| [Langflow](https://www.langflow.org/blog/the-complete-guide-to-choosing-an-ai-agent-framework-in-2025) | LLM orchestration | Visual LangChain, agent-first | Legal domain expertise, Dataverse integration |
| [n8n](https://docs.n8n.io/advanced-ai/ai-workflow-builder/) | General automation | 400+ integrations, hybrid code/no-code | Purpose-built for document intelligence |
| [Flowise](https://www.voiceflow.com/blog/flowise-alternative) | Chatbot/RAG apps | Easy deployment, multi-channel | Analysis workflow focus, not conversational |
| [ComfyUI](https://dev.to/worldlinetech/automating-image-generation-with-n8n-and-comfyui-521p) | Image generation | Powerful node system | Text/document focus |

### Design Inspiration

From [market analysis](https://www.bluebash.co/blog/langflow-vs-n8n-ai-workflow-automation/):

1. **Langflow's approach**: Drag components (prompts, chains, memory, agents, tools) and connect them visually
2. **n8n's approach**: Node-based editor with run logs, retries, branches, and scheduling
3. **Best practice**: Combine visual workflow design (Langflow) with orchestration primitives (n8n)

### Spaarke's Unique Position

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     AI WORKFLOW BUILDER SPECTRUM                             â”‚
â”‚                                                                              â”‚
â”‚  General Purpose â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Domain Specific   â”‚
â”‚                                                                              â”‚
â”‚  n8n          Langflow      Flowise       Spaarke Playbook Builder          â”‚
â”‚  (automation) (LLM chains)  (chatbots)    (legal document intelligence)     â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                                              â”‚
â”‚  Code-Heavy â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ No-Code          â”‚
â”‚                                                                              â”‚
â”‚  LangGraph    CrewAI       Langflow       Spaarke (target: low-code)        â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Spaarke's differentiators**:
- Pre-built legal domain Actions (Risk Detection, Clause Analysis, Entity Extraction)
- Integration with Dataverse (Matter, Account, Document entities)
- Output-aware nodes (produce specific sections of work product)
- Embedded RAG with domain-specific embedding model options (R5/R6)

---

## Architecture Overview

### Three-Layer Model

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          PRESENTATION LAYER                                  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                      Visual Canvas (React + Fluent v9)                  â”‚â”‚
â”‚  â”‚  â€¢ Drag-and-drop node placement                                         â”‚â”‚
â”‚  â”‚  â€¢ Connection drawing between nodes                                     â”‚â”‚
â”‚  â”‚  â€¢ Node configuration panels                                            â”‚â”‚
â”‚  â”‚  â€¢ Real-time validation                                                 â”‚â”‚
â”‚  â”‚  â€¢ Execution visualization                                              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ORCHESTRATION LAYER                                 â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                  Playbook Graph Engine (BFF API)                        â”‚â”‚
â”‚  â”‚  â€¢ Graph validation and compilation                                     â”‚â”‚
â”‚  â”‚  â€¢ Execution sequencing                                                 â”‚â”‚
â”‚  â”‚  â€¢ Data flow management                                                 â”‚â”‚
â”‚  â”‚  â€¢ Scope resolution (Skills, Tools, Knowledge)                          â”‚â”‚
â”‚  â”‚  â€¢ Output assembly                                                      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          EXECUTION LAYER                                     â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Tool         â”‚ â”‚  Skill        â”‚ â”‚  Knowledge    â”‚ â”‚  Output       â”‚   â”‚
â”‚  â”‚  Handlers     â”‚ â”‚  Injectors    â”‚ â”‚  Retrievers   â”‚ â”‚  Formatters   â”‚   â”‚
â”‚  â”‚               â”‚ â”‚               â”‚ â”‚               â”‚ â”‚               â”‚   â”‚
â”‚  â”‚ â€¢ Summary     â”‚ â”‚ â€¢ Prompt      â”‚ â”‚ â€¢ RAG Search  â”‚ â”‚ â€¢ Markdown    â”‚   â”‚
â”‚  â”‚ â€¢ RiskDetect  â”‚ â”‚   Enhancement â”‚ â”‚ â€¢ Doc Lookup  â”‚ â”‚ â€¢ Structured  â”‚   â”‚
â”‚  â”‚ â€¢ ClauseComp  â”‚ â”‚ â€¢ Rubrics     â”‚ â”‚ â€¢ Standards   â”‚ â”‚ â€¢ Chart Data  â”‚   â”‚
â”‚  â”‚ â€¢ DateExtract â”‚ â”‚ â€¢ Heuristics  â”‚ â”‚               â”‚ â”‚               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Node-Based Mental Model

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              CONCEPTUAL MODEL                                â”‚
â”‚                                                                              â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚                         â”‚      PLAYBOOK       â”‚                             â”‚
â”‚                         â”‚  (Workflow Container)â”‚                             â”‚
â”‚                         â”‚                     â”‚                             â”‚
â”‚                         â”‚ â€¢ Name              â”‚                             â”‚
â”‚                         â”‚ â€¢ Description       â”‚                             â”‚
â”‚                         â”‚ â€¢ Document Types    â”‚                             â”‚
â”‚                         â”‚ â€¢ Canvas Layout     â”‚                             â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                                    â”‚                                        â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚                    â”‚               â”‚               â”‚                        â”‚
â”‚                    â–¼               â–¼               â–¼                        â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚            â”‚ ACTION NODE â”‚ â”‚ ACTION NODE â”‚ â”‚ ACTION NODE â”‚                  â”‚
â”‚            â”‚             â”‚ â”‚             â”‚ â”‚             â”‚                  â”‚
â”‚            â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                  â”‚
â”‚            â”‚ â”‚ SCOPES  â”‚ â”‚ â”‚ â”‚ SCOPES  â”‚ â”‚ â”‚ â”‚ SCOPES  â”‚ â”‚                  â”‚
â”‚            â”‚ â”‚         â”‚ â”‚ â”‚ â”‚         â”‚ â”‚ â”‚ â”‚         â”‚ â”‚                  â”‚
â”‚            â”‚ â”‚â€¢ Skills â”‚ â”‚ â”‚ â”‚â€¢ Skills â”‚ â”‚ â”‚ â”‚â€¢ Skills â”‚ â”‚                  â”‚
â”‚            â”‚ â”‚â€¢ Tools  â”‚ â”‚ â”‚ â”‚â€¢ Tools  â”‚ â”‚ â”‚ â”‚â€¢ Tools  â”‚ â”‚                  â”‚
â”‚            â”‚ â”‚â€¢ Knowl. â”‚ â”‚ â”‚ â”‚â€¢ Knowl. â”‚ â”‚ â”‚ â”‚â€¢ Knowl. â”‚ â”‚                  â”‚
â”‚            â”‚ â”‚â€¢ Output â”‚ â”‚ â”‚ â”‚â€¢ Output â”‚ â”‚ â”‚ â”‚â€¢ Output â”‚ â”‚                  â”‚
â”‚            â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                  â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                    â”‚               â”‚               â”‚                        â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                    â”‚                                        â”‚
â”‚                                    â–¼                                        â”‚
â”‚                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚                           â”‚ WORK PRODUCT  â”‚                                 â”‚
â”‚                           â”‚ (Assembled    â”‚                                 â”‚
â”‚                           â”‚  Output)      â”‚                                 â”‚
â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Visual Design Concepts

### Main Canvas Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  Playbook: Software License Agreement Analysis            [Save] [Run] â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                â”‚                                            â”‚               â”‚
â”‚  NODE PALETTE  â”‚              CANVAS                        â”‚  PROPERTIES   â”‚
â”‚                â”‚                                            â”‚               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”       â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ + Actions  â”‚ â”‚    â”‚Entityâ”‚â”€â”€â”€â–¶â”‚Clauseâ”‚â”€â”€â”€â–¶â”‚ Risk â”‚       â”‚ â”‚ Detect    â”‚ â”‚
â”‚ â”‚            â”‚ â”‚    â”‚Extractâ”‚   â”‚Analyzeâ”‚   â”‚Detectâ”‚       â”‚ â”‚ Risks     â”‚ â”‚
â”‚ â”‚ â—‹ Extract  â”‚ â”‚    â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”¬â”€â”€â”€â”˜       â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ â—‹ Analyze  â”‚ â”‚                               â”‚           â”‚ â”‚           â”‚ â”‚
â”‚ â”‚ â—‹ Detect   â”‚ â”‚                               â–¼           â”‚ â”‚ SKILLS    â”‚ â”‚
â”‚ â”‚ â—‹ Compare  â”‚ â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”         â”‚ â”‚ [+] Add   â”‚ â”‚
â”‚ â”‚ â—‹ Generate â”‚ â”‚    â”‚Compareâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚Summaryâ”‚        â”‚ â”‚ â˜‘ License â”‚ â”‚
â”‚ â”‚ â—‹ Custom   â”‚ â”‚    â”‚Std   â”‚              â”‚      â”‚         â”‚ â”‚   Risk    â”‚ â”‚
â”‚ â”‚            â”‚ â”‚    â””â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”˜         â”‚ â”‚   Heurist.â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚                                            â”‚ â”‚           â”‚ â”‚
â”‚ â”‚ + Connectorsâ”‚ â”‚                                            â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚            â”‚ â”‚                                            â”‚ â”‚ TOOLS     â”‚ â”‚
â”‚ â”‚ â—‹ Branch   â”‚ â”‚                                            â”‚ â”‚ [+] Add   â”‚ â”‚
â”‚ â”‚ â—‹ Merge    â”‚ â”‚                                            â”‚ â”‚ â˜‘ Risk    â”‚ â”‚
â”‚ â”‚ â—‹ Loop     â”‚ â”‚                                            â”‚ â”‚   Detectorâ”‚ â”‚
â”‚ â”‚            â”‚ â”‚                                            â”‚ â”‚           â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚                                            â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ + Templatesâ”‚ â”‚                                            â”‚ â”‚ KNOWLEDGE â”‚ â”‚
â”‚ â”‚            â”‚ â”‚                                            â”‚ â”‚ [+] Add   â”‚ â”‚
â”‚ â”‚ â—‹ Contract â”‚ â”‚                                            â”‚ â”‚ â˜‘ Risk    â”‚ â”‚
â”‚ â”‚   Analysis â”‚ â”‚                                            â”‚ â”‚   Taxonomyâ”‚ â”‚
â”‚ â”‚ â—‹ Invoice  â”‚ â”‚                                            â”‚ â”‚ â˜‘ Cohere  â”‚ â”‚
â”‚ â”‚   Review   â”‚ â”‚                                            â”‚ â”‚   Legal   â”‚ â”‚
â”‚ â”‚            â”‚ â”‚                                            â”‚ â”‚           â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                                            â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚                â”‚                                            â”‚ â”‚ OUTPUT    â”‚ â”‚
â”‚                â”‚                                            â”‚ â”‚           â”‚ â”‚
â”‚                â”‚                                            â”‚ â”‚ Section:  â”‚ â”‚
â”‚                â”‚                                            â”‚ â”‚ [Risk     â”‚ â”‚
â”‚                â”‚                                            â”‚ â”‚  Assessmentâ”‚ â”‚
â”‚                â”‚                                            â”‚ â”‚  Chart  â–¼]â”‚ â”‚
â”‚                â”‚                                            â”‚ â”‚           â”‚ â”‚
â”‚                â”‚                                            â”‚ â”‚ Format:   â”‚ â”‚
â”‚                â”‚                                            â”‚ â”‚ [Table  â–¼]â”‚ â”‚
â”‚                â”‚                                            â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Action Node Detail

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ACTION NODE ANATOMY                                 â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ â—‹ Input Port                                          Output Port â—‹ â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚  ğŸ”  DETECT RISKS                               [âš™ï¸] [âŒ]      â”‚ â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚    â”‚
â”‚  â”‚  â”‚                                                               â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ ğŸ“š Skills â”‚ â”‚ ğŸ”§ Tools  â”‚ â”‚ ğŸ“– Knowl. â”‚ â”‚ ğŸ“„ Output â”‚        â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚    (2)   â”‚ â”‚    (1)   â”‚ â”‚    (2)   â”‚ â”‚    (1)   â”‚        â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ â”‚    â”‚
â”‚  â”‚  â”‚                                                               â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  Status: Ready                          Est. Time: ~15s      â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  EXPANDED VIEW (on click):                                                  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ğŸ”  DETECT RISKS                                                   â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  SKILLS                                                             â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚ â˜‘ Software License Risk Heuristics                          â”‚   â”‚    â”‚
â”‚  â”‚  â”‚   "Applies SaaS-specific risk identification patterns"      â”‚   â”‚    â”‚
â”‚  â”‚  â”‚                                                              â”‚   â”‚    â”‚
â”‚  â”‚  â”‚ â˜‘ Risk Severity Calibration                                  â”‚   â”‚    â”‚
â”‚  â”‚  â”‚   "Maps findings to High/Medium/Low severity levels"         â”‚   â”‚    â”‚
â”‚  â”‚  â”‚                                                              â”‚   â”‚    â”‚
â”‚  â”‚  â”‚ [+ Add Skill]                                                â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  TOOL                                                               â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚ ğŸ”§ Risk Detector                                             â”‚   â”‚    â”‚
â”‚  â”‚  â”‚    Handler: RiskDetectorHandler                              â”‚   â”‚    â”‚
â”‚  â”‚  â”‚    Input: Clause analysis results                            â”‚   â”‚    â”‚
â”‚  â”‚  â”‚    Output: Risk register with severity                       â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  KNOWLEDGE                                                          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚ ğŸ“– Risk Taxonomy                                             â”‚   â”‚    â”‚
â”‚  â”‚  â”‚    Type: Structured Reference                                â”‚   â”‚    â”‚
â”‚  â”‚  â”‚    Embedding: Cohere-Legal (R6)                              â”‚   â”‚    â”‚
â”‚  â”‚  â”‚                                                              â”‚   â”‚    â”‚
â”‚  â”‚  â”‚ ğŸ“– Standard License Positions                                â”‚   â”‚    â”‚
â”‚  â”‚  â”‚    Type: RAG Index                                           â”‚   â”‚    â”‚
â”‚  â”‚  â”‚    Embedding: text-embedding-3-small                         â”‚   â”‚    â”‚
â”‚  â”‚  â”‚                                                              â”‚   â”‚    â”‚
â”‚  â”‚  â”‚ [+ Add Knowledge Source]                                     â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  OUTPUT                                                             â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚ Section: Risk Assessment                                     â”‚   â”‚    â”‚
â”‚  â”‚  â”‚ Format:  Table with columns: Risk, Clause, Severity, Notes  â”‚   â”‚    â”‚
â”‚  â”‚  â”‚ Order:   3 (after Clause Analysis, before Summary)          â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Execution Visualization

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        EXECUTION STATE VISUALIZATION                         â”‚
â”‚                                                                              â”‚
â”‚  BEFORE EXECUTION:                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚  â”‚ â—‹    â”‚â”€â”€â”€â–¶â”‚ â—‹    â”‚â”€â”€â”€â–¶â”‚ â—‹    â”‚â”€â”€â”€â–¶â”‚ â—‹    â”‚   â—‹ = Pending               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                                                              â”‚
â”‚  DURING EXECUTION:                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚  â”‚ âœ“    â”‚â•â•â•â–¶â”‚ âŸ³    â”‚â”€â”€â”€â–¶â”‚ â—‹    â”‚â”€â”€â”€â–¶â”‚ â—‹    â”‚   âŸ³ = Running (animated)   â”‚
â”‚  â”‚      â”‚    â”‚ 45%  â”‚    â”‚      â”‚    â”‚      â”‚   âœ“ = Complete              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜   â•â•â• = Data flowing        â”‚
â”‚                                                                              â”‚
â”‚  AFTER EXECUTION:                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚  â”‚ âœ“    â”‚â•â•â•â–¶â”‚ âœ“    â”‚â•â•â•â–¶â”‚ âš     â”‚â•â•â•â–¶â”‚ âœ“    â”‚   âš  = Warning (partial)    â”‚
â”‚  â”‚ 2.1s â”‚    â”‚ 8.3s â”‚    â”‚ 4.5s â”‚    â”‚ 3.2s â”‚   âœ— = Error                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                                                              â”‚
â”‚  CLICK ON NODE TO SEE:                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Execution Details: Detect Risks                             â”‚            â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚  â”‚ Status: âš  Completed with warnings                          â”‚            â”‚
â”‚  â”‚ Duration: 4.5s                                              â”‚            â”‚
â”‚  â”‚ Tokens: 2,341 input / 892 output                            â”‚            â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â”‚ Input Data:                                                 â”‚            â”‚
â”‚  â”‚   â””â”€ 15 clauses from previous node                         â”‚            â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â”‚ Output Data:                                                â”‚            â”‚
â”‚  â”‚   â””â”€ 7 risks identified (3 High, 2 Medium, 2 Low)          â”‚            â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â”‚ Warnings:                                                   â”‚            â”‚
â”‚  â”‚   â””â”€ "Indemnification clause ambiguous - manual review"    â”‚            â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â”‚ [View Full Output] [Re-run This Node]                       â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Node Types and Components

### Action Node Types

| Category | Node Type | Description | Tool Handler |
|----------|-----------|-------------|--------------|
| **Extraction** | Extract Entities | Identify parties, dates, amounts, references | `EntityExtractorHandler` |
| **Extraction** | Extract Dates | Find and normalize dates, deadlines, terms | `DateExtractorHandler` |
| **Analysis** | Analyze Clauses | Parse document into clause structure | `ClauseAnalyzerHandler` |
| **Analysis** | Analyze Financial | Extract financial terms, calculate totals | `FinancialCalculatorHandler` |
| **Detection** | Detect Risks | Identify risks against taxonomy | `RiskDetectorHandler` |
| **Detection** | Detect Anomalies | Find unusual patterns or deviations | `AnomalyDetectorHandler` |
| **Comparison** | Compare to Standard | Diff against standard terms | `ClauseComparisonHandler` |
| **Comparison** | Compare Documents | Redline between two versions | `DocumentComparisonHandler` |
| **Generation** | Generate Summary | Create executive summary | `SummaryHandler` |
| **Generation** | Generate Tasks | Create action items | `TaskGeneratorHandler` |
| **Custom** | Custom Action | User-defined prompt + output | `CustomActionHandler` |

### Connector Nodes

| Node Type | Description | Use Case |
|-----------|-------------|----------|
| **Branch** | Conditional routing | "If document type is X, follow path A" |
| **Merge** | Combine multiple inputs | "Collect results from parallel paths" |
| **Loop** | Iterate over collection | "For each clause, run risk detection" |
| **Wait** | Pause for human input | "Review before continuing" |

### Scope Component Details

#### Skills (How AI Reasons)

```typescript
interface Skill {
  id: string;
  name: string;
  category: SkillCategory;
  promptFragment: string;      // Injected into system prompt
  applicableActions: string[]; // Which action types can use this
  parameters?: SkillParameter[];
}

enum SkillCategory {
  Heuristics,      // Domain-specific rules
  Rubrics,         // Scoring/severity criteria
  Interpretation,  // How to read/understand
  Precision,       // Accuracy requirements
}

// Example
const softwareLicenseRiskSkill: Skill = {
  id: "skill-slr-001",
  name: "Software License Risk Heuristics",
  category: SkillCategory.Heuristics,
  promptFragment: `
    When analyzing software license risks:
    - Flag unlimited liability as HIGH severity
    - Flag missing data protection provisions as HIGH
    - Flag auto-renewal without notice as MEDIUM
    - Flag fee escalation > 5% annually as MEDIUM
  `,
  applicableActions: ["detect-risks", "analyze-clauses"],
};
```

#### Tools (How Action Executes)

```typescript
interface Tool {
  id: string;
  name: string;
  handlerClass: string;        // C# class name
  inputSchema: JsonSchema;     // Expected input structure
  outputSchema: JsonSchema;    // Guaranteed output structure
  estimatedDuration: string;   // "~5s", "~30s"
  costCategory: CostCategory;
}

enum CostCategory {
  Low,      // Simple extraction, no LLM
  Medium,   // Single LLM call
  High,     // Multiple LLM calls or large context
}

// Example
const riskDetectorTool: Tool = {
  id: "tool-risk-001",
  name: "Risk Detector",
  handlerClass: "RiskDetectorHandler",
  inputSchema: { /* clause analysis result */ },
  outputSchema: {
    risks: [{
      id: "string",
      description: "string",
      severity: "High | Medium | Low",
      clause: "string",
      recommendation: "string"
    }]
  },
  estimatedDuration: "~15s",
  costCategory: CostCategory.High,
};
```

#### Knowledge (What AI References)

```typescript
interface KnowledgeSource {
  id: string;
  name: string;
  type: KnowledgeType;
  embeddingModel?: EmbeddingModel;  // From R5 design
  ragIndexName?: string;
  retrieverConfig?: RetrieverConfig;
}

enum KnowledgeType {
  RagIndex,           // Vector search retrieval
  StructuredReference, // Tables, taxonomies
  DocumentReference,   // Specific document
  ExternalApi,         // Real-time lookup
}

enum EmbeddingModel {
  AzureOpenAISmall,   // text-embedding-3-small
  AzureOpenAILarge,   // text-embedding-3-large
  CohereEmbed,        // Cohere Embed v3
  LegalBERT,          // Legal-specialized
  Custom,             // Customer-provided
}
```

#### Output (What Section is Produced)

```typescript
interface OutputSpec {
  sectionName: string;         // "Risk Assessment", "Executive Summary"
  format: OutputFormat;
  order: number;               // Position in final document
  template?: string;           // Output template
}

enum OutputFormat {
  Markdown,
  Table,
  Chart,
  StructuredJson,
  BulletList,
  Narrative,
}
```

---

## Data Flow and Execution

### Graph Execution Model

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         EXECUTION PIPELINE                                   â”‚
â”‚                                                                              â”‚
â”‚  1. COMPILATION                                                             â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚     â”‚ Canvas JSON â†’ Validate â†’ Topological Sort â†’ Execution Plan      â”‚     â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                      â”‚                                       â”‚
â”‚                                      â–¼                                       â”‚
â”‚  2. EXECUTION (per node)                                                    â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚     â”‚                                                                 â”‚     â”‚
â”‚     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚     â”‚
â”‚     â”‚  â”‚ Collect      â”‚   â”‚ Resolve      â”‚   â”‚ Build        â”‚        â”‚     â”‚
â”‚     â”‚  â”‚ Input Data   â”‚â”€â”€â–¶â”‚ Scopes       â”‚â”€â”€â–¶â”‚ Prompt       â”‚        â”‚     â”‚
â”‚     â”‚  â”‚ (from edges) â”‚   â”‚ (Skills,     â”‚   â”‚              â”‚        â”‚     â”‚
â”‚     â”‚  â”‚              â”‚   â”‚  Knowledge)  â”‚   â”‚              â”‚        â”‚     â”‚
â”‚     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚     â”‚
â”‚     â”‚         â”‚                  â”‚                  â”‚                 â”‚     â”‚
â”‚     â”‚         â–¼                  â–¼                  â–¼                 â”‚     â”‚
â”‚     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚     â”‚
â”‚     â”‚  â”‚ Execute      â”‚   â”‚ Format       â”‚   â”‚ Store        â”‚        â”‚     â”‚
â”‚     â”‚  â”‚ Tool Handler â”‚â”€â”€â–¶â”‚ Output       â”‚â”€â”€â–¶â”‚ Result       â”‚        â”‚     â”‚
â”‚     â”‚  â”‚              â”‚   â”‚ (section)    â”‚   â”‚              â”‚        â”‚     â”‚
â”‚     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚     â”‚
â”‚     â”‚                                                                 â”‚     â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                      â”‚                                       â”‚
â”‚                                      â–¼                                       â”‚
â”‚  3. ASSEMBLY                                                                â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚     â”‚ Collect all node outputs â†’ Order by OutputSpec â†’ Render Work    â”‚     â”‚
â”‚     â”‚ Product (Markdown/DOCX/PDF)                                     â”‚     â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Data Passing Between Nodes

```typescript
interface NodeExecutionContext {
  nodeId: string;
  playbook: PlaybookDefinition;
  inputData: Record<string, any>;  // From upstream nodes
  documentContext: DocumentContext;
  resolvedScopes: {
    skills: Skill[];
    tool: Tool;
    knowledge: KnowledgeSource[];
    output: OutputSpec;
  };
}

interface NodeExecutionResult {
  nodeId: string;
  status: ExecutionStatus;
  outputData: any;                // Passed to downstream nodes
  formattedSection?: string;      // For final work product
  metrics: {
    durationMs: number;
    tokensIn: number;
    tokensOut: number;
    ragRetrievals: number;
  };
  warnings?: string[];
  error?: string;
}
```

---

## Canvas UX Design

### Interaction Patterns

| Interaction | Behavior |
|-------------|----------|
| **Drag from palette** | Creates new node at drop location |
| **Click node** | Selects node, shows properties panel |
| **Double-click node** | Opens expanded configuration view |
| **Drag from output port** | Creates connection line, snaps to valid inputs |
| **Right-click node** | Context menu (delete, duplicate, disable) |
| **Ctrl+drag** | Multi-select nodes |
| **Scroll wheel** | Zoom canvas |
| **Space+drag** | Pan canvas |
| **Delete key** | Remove selected nodes/connections |
| **Ctrl+Z** | Undo |
| **Ctrl+S** | Save playbook |

### Validation and Feedback

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         REAL-TIME VALIDATION                                 â”‚
â”‚                                                                              â”‚
â”‚  VALID GRAPH:                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚  â”‚ âœ“    â”‚â”€â”€â”€â–¶â”‚ âœ“    â”‚â”€â”€â”€â–¶â”‚ âœ“    â”‚                                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚  "Playbook is ready to run"                                                 â”‚
â”‚                                                                              â”‚
â”‚  MISSING TOOL:                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚  â”‚ âœ“    â”‚â”€â”€â”€â–¶â”‚ âš     â”‚â”€â”€â”€â–¶â”‚ âœ“    â”‚                                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚              â”‚                                                               â”‚
â”‚              â””â”€ "Detect Risks: No tool configured"                          â”‚
â”‚                                                                              â”‚
â”‚  CIRCULAR DEPENDENCY:                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚  â”‚ âœ—    â”‚â—€â”€â”€â–¶â”‚ âœ—    â”‚     (edges highlighted red)                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚  "Error: Circular dependency detected between Node A and Node B"            â”‚
â”‚                                                                              â”‚
â”‚  ORPHAN NODE:                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚  â”‚ âœ“    â”‚â”€â”€â”€â–¶â”‚ âœ“    â”‚    â”‚ âš     â”‚  (no connections)                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚                          â”‚                                                   â”‚
â”‚                          â””â”€ "Warning: Node not connected to workflow"       â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Keyboard Shortcuts

| Shortcut | Action |
|----------|--------|
| `Ctrl+N` | New playbook |
| `Ctrl+S` | Save |
| `Ctrl+Z` | Undo |
| `Ctrl+Y` | Redo |
| `Delete` | Delete selected |
| `Ctrl+D` | Duplicate selected |
| `Ctrl+A` | Select all |
| `Escape` | Deselect all |
| `F5` | Run playbook |
| `Space` | Toggle pan mode |
| `+/-` | Zoom in/out |
| `Ctrl+0` | Fit to screen |

---

## Data Model

### Dataverse Schema Extensions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       EXTENDED DATAVERSE SCHEMA                              â”‚
â”‚                                                                              â”‚
â”‚  sprk_analysisplaybook (existing)                                           â”‚
â”‚  â”œâ”€â”€ sprk_playbookid (PK)                                                   â”‚
â”‚  â”œâ”€â”€ sprk_name                                                              â”‚
â”‚  â”œâ”€â”€ sprk_description                                                       â”‚
â”‚  â”œâ”€â”€ sprk_documenttypes                                                     â”‚
â”‚  â”œâ”€â”€ sprk_canvasjson (NEW - stores graph definition)                        â”‚
â”‚  â”œâ”€â”€ sprk_version (NEW - for versioning)                                    â”‚
â”‚  â””â”€â”€ sprk_isvisualmode (NEW - flag for visual vs legacy)                    â”‚
â”‚                                                                              â”‚
â”‚  sprk_actionnode (NEW)                                                      â”‚
â”‚  â”œâ”€â”€ sprk_actionnodeid (PK)                                                 â”‚
â”‚  â”œâ”€â”€ sprk_playbookid (FK â†’ sprk_analysisplaybook)                           â”‚
â”‚  â”œâ”€â”€ sprk_nodetype (Choice: Extract, Analyze, Detect, Compare, Generate)   â”‚
â”‚  â”œâ”€â”€ sprk_name                                                              â”‚
â”‚  â”œâ”€â”€ sprk_position_x (canvas position)                                      â”‚
â”‚  â”œâ”€â”€ sprk_position_y                                                        â”‚
â”‚  â”œâ”€â”€ sprk_toolid (FK â†’ sprk_analysistools)                                  â”‚
â”‚  â”œâ”€â”€ sprk_outputsection                                                     â”‚
â”‚  â”œâ”€â”€ sprk_outputformat (Choice)                                             â”‚
â”‚  â”œâ”€â”€ sprk_outputorder (int)                                                 â”‚
â”‚  â””â”€â”€ sprk_configjson (tool-specific parameters)                             â”‚
â”‚                                                                              â”‚
â”‚  sprk_actionnode_skill (N:N junction)                                       â”‚
â”‚  â”œâ”€â”€ sprk_actionnodeid (FK)                                                 â”‚
â”‚  â””â”€â”€ sprk_skillid (FK â†’ sprk_analysisskills)                                â”‚
â”‚                                                                              â”‚
â”‚  sprk_actionnode_knowledge (N:N junction)                                   â”‚
â”‚  â”œâ”€â”€ sprk_actionnodeid (FK)                                                 â”‚
â”‚  â””â”€â”€ sprk_knowledgeid (FK â†’ sprk_analysisknowledge)                         â”‚
â”‚                                                                              â”‚
â”‚  sprk_nodeedge (NEW - connections between nodes)                            â”‚
â”‚  â”œâ”€â”€ sprk_edgeid (PK)                                                       â”‚
â”‚  â”œâ”€â”€ sprk_playbookid (FK)                                                   â”‚
â”‚  â”œâ”€â”€ sprk_sourcenodeid (FK â†’ sprk_actionnode)                               â”‚
â”‚  â”œâ”€â”€ sprk_targetnodeid (FK â†’ sprk_actionnode)                               â”‚
â”‚  â””â”€â”€ sprk_edgetype (Choice: DataFlow, Conditional)                          â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Canvas JSON Schema

```typescript
interface PlaybookCanvasDefinition {
  version: "1.0";
  playbook: {
    id: string;
    name: string;
  };
  canvas: {
    zoom: number;
    panX: number;
    panY: number;
  };
  nodes: ActionNodeDefinition[];
  edges: EdgeDefinition[];
}

interface ActionNodeDefinition {
  id: string;
  type: ActionNodeType;
  position: { x: number; y: number };
  config: {
    name: string;
    toolId: string;
    skillIds: string[];
    knowledgeIds: string[];
    output: {
      sectionName: string;
      format: OutputFormat;
      order: number;
    };
    parameters?: Record<string, any>;
  };
}

interface EdgeDefinition {
  id: string;
  source: { nodeId: string; port: string };
  target: { nodeId: string; port: string };
  type: EdgeType;
  condition?: ConditionalExpression;  // For Branch nodes
}
```

---

## Integration with Existing Systems

### R4 Playbook System

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MIGRATION PATH FROM R4                                    â”‚
â”‚                                                                              â”‚
â”‚  R4 (Current): Table-Driven Configuration                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ sprk_analysisplaybook                                               â”‚    â”‚
â”‚  â”‚   â””â”€â”€ N:N â†’ sprk_analysisactions                                    â”‚    â”‚
â”‚  â”‚              â””â”€â”€ N:N â†’ sprk_analysisskills                          â”‚    â”‚
â”‚  â”‚              â””â”€â”€ N:N â†’ sprk_analysistools                           â”‚    â”‚
â”‚  â”‚              â””â”€â”€ N:N â†’ sprk_analysisknowledge                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                      â”‚                                       â”‚
â”‚                              Auto-convert                                    â”‚
â”‚                                      â–¼                                       â”‚
â”‚  R6+ (New): Node-Based Visual                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ sprk_analysisplaybook                                               â”‚    â”‚
â”‚  â”‚   â”œâ”€â”€ sprk_canvasjson (graph)                                       â”‚    â”‚
â”‚  â”‚   â””â”€â”€ sprk_actionnode (per action)                                  â”‚    â”‚
â”‚  â”‚          â””â”€â”€ N:N â†’ sprk_analysisskills                              â”‚    â”‚
â”‚  â”‚          â””â”€â”€ FK â†’ sprk_analysistools                                â”‚    â”‚
â”‚  â”‚          â””â”€â”€ N:N â†’ sprk_analysisknowledge                           â”‚    â”‚
â”‚  â”‚          â””â”€â”€ OutputSpec embedded                                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  COMPATIBILITY:                                                             â”‚
â”‚  â€¢ R4 playbooks continue to work (isVisualMode = false)                     â”‚
â”‚  â€¢ "Convert to Visual" migrates R4 â†’ R6 format                              â”‚
â”‚  â€¢ Both modes use same execution engine                                      â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### R5 RAG Integration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      R5 RAG INTEGRATION                                      â”‚
â”‚                                                                              â”‚
â”‚  From R5 Design:                                                            â”‚
â”‚  â€¢ Knowledge sources have configurable embedding models                      â”‚
â”‚  â€¢ Each Knowledge scope can use different model (Cohere, Legal-BERT, etc.) â”‚
â”‚                                                                              â”‚
â”‚  Visual Builder Shows:                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ KNOWLEDGE                                                            â”‚    â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚ â”‚ ğŸ“– Risk Taxonomy                                                 â”‚ â”‚    â”‚
â”‚  â”‚ â”‚    Type: Structured Reference                                    â”‚ â”‚    â”‚
â”‚  â”‚ â”‚    Embedding: Cohere-Legal                    [Configure RAG]   â”‚ â”‚    â”‚
â”‚  â”‚ â”‚              â†‘                                                   â”‚ â”‚    â”‚
â”‚  â”‚ â”‚    (From R5 sprk_embeddingmodel field)                          â”‚ â”‚    â”‚
â”‚  â”‚ â”‚                                                                  â”‚ â”‚    â”‚
â”‚  â”‚ â”‚ ğŸ“– Standard License Positions                                    â”‚ â”‚    â”‚
â”‚  â”‚ â”‚    Type: RAG Index                                               â”‚ â”‚    â”‚
â”‚  â”‚ â”‚    Embedding: text-embedding-3-small                            â”‚ â”‚    â”‚
â”‚  â”‚ â”‚    Index: contoso-legal-small                                   â”‚ â”‚    â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Technical Implementation

### Technology Stack

| Layer | Technology | Notes |
|-------|------------|-------|
| **Canvas UI** | React + Fluent UI v9 | ADR-021 compliance |
| **Graph Library** | React Flow | Open-source, customizable, TypeScript |
| **State Management** | Zustand or Jotai | Lightweight, works well with React Flow |
| **PCF Wrapper** | Virtual PCF Control | Hosts React canvas in Model-Driven App |
| **API** | .NET 8 Minimal API | Existing BFF pattern |
| **Persistence** | Dataverse + Azure | Canvas JSON in Dataverse, execution in BFF |

### React Flow Integration

```typescript
// Using React Flow for canvas
import ReactFlow, {
  Node,
  Edge,
  Controls,
  Background,
  useNodesState,
  useEdgesState,
} from 'reactflow';

// Custom node component
const ActionNode: React.FC<NodeProps<ActionNodeData>> = ({ data }) => {
  return (
    <div className={styles.actionNode}>
      <Handle type="target" position={Position.Left} />

      <div className={styles.nodeHeader}>
        <Icon iconName={data.icon} />
        <span>{data.name}</span>
      </div>

      <div className={styles.scopeBadges}>
        <Badge>Skills: {data.skillCount}</Badge>
        <Badge>Knowledge: {data.knowledgeCount}</Badge>
      </div>

      <Handle type="source" position={Position.Right} />
    </div>
  );
};

// Node types registration
const nodeTypes = {
  action: ActionNode,
  branch: BranchNode,
  merge: MergeNode,
};
```

### BFF API Endpoints

```csharp
// New endpoints for visual playbook builder

app.MapGet("/api/playbooks/{id}/canvas", GetPlaybookCanvas);
app.MapPut("/api/playbooks/{id}/canvas", SavePlaybookCanvas);
app.MapPost("/api/playbooks/{id}/validate", ValidatePlaybook);
app.MapPost("/api/playbooks/{id}/compile", CompilePlaybook);
app.MapPost("/api/playbooks/{id}/execute", ExecutePlaybook);
app.MapGet("/api/playbooks/{id}/execution/{runId}", GetExecutionStatus);

// Canvas retrieval
async Task<IResult> GetPlaybookCanvas(
    Guid id,
    IPlaybookService playbookService)
{
    var canvas = await playbookService.GetCanvasAsync(id);
    return Results.Ok(canvas);
}

// Playbook compilation (canvas â†’ execution plan)
async Task<IResult> CompilePlaybook(
    Guid id,
    IPlaybookCompiler compiler)
{
    var result = await compiler.CompileAsync(id);
    return result.IsValid
        ? Results.Ok(result.ExecutionPlan)
        : Results.BadRequest(result.Errors);
}
```

---

## User Personas and Workflows

### Persona 1: Legal Operations Analyst

**Profile**:
- Non-developer with legal domain expertise
- Responsible for standardizing legal review processes
- Uses visual builder to create org-specific playbooks

**Workflow**:
1. Start with template (e.g., "Contract Review")
2. Customize actions for organization's needs
3. Add company-specific knowledge sources
4. Test with sample documents
5. Publish for attorney use

### Persona 2: AI Configuration Specialist

**Profile**:
- Technical background, understands AI/ML concepts
- Focuses on optimizing AI behavior
- Creates skills and tunes prompts

**Workflow**:
1. Create new skills with prompt fragments
2. Test skills across different playbooks
3. Monitor execution metrics
4. Tune based on output quality
5. Document best practices

### Persona 3: Knowledge Manager

**Profile**:
- Manages authoritative content
- Curates knowledge bases
- Ensures reference materials are current

**Workflow**:
1. Upload and index reference documents
2. Configure embedding models (R5/R6)
3. Attach knowledge sources to actions
4. Monitor retrieval quality
5. Update content as regulations change

---

## Phased Rollout

### Phase 1: Foundation (MVP)

| Deliverable | Description |
|-------------|-------------|
| Canvas UI | React Flow canvas with pan/zoom |
| Basic nodes | 5 action types (Extract, Analyze, Detect, Compare, Generate) |
| Scope panels | Skills, Tools, Knowledge configuration |
| Save/Load | Persist to Dataverse |
| Validation | Graph validation, error highlighting |

### Phase 2: Execution

| Deliverable | Description |
|-------------|-------------|
| Compile API | Canvas â†’ execution plan |
| Execution engine | Node-by-node execution |
| Streaming UI | Real-time execution visualization |
| Output assembly | Collect sections into work product |

### Phase 3: Advanced Features

| Deliverable | Description |
|-------------|-------------|
| Conditional branches | If/else routing |
| Loops | Iterate over collections |
| Templates | Pre-built playbook templates |
| Version history | Track playbook changes |
| Sharing | Export/import playbooks |

### Phase 4: Intelligence

| Deliverable | Description |
|-------------|-------------|
| AI suggestions | Recommend next node based on context |
| Optimization | Suggest parallel execution paths |
| Quality metrics | Track output quality by node |
| A/B testing | Compare node configurations |

---

## Appendix A: Comparison to Market Tools

| Feature | Langflow | n8n | Flowise | Spaarke Playbook Builder |
|---------|----------|-----|---------|--------------------------|
| Primary use | LLM chains | General automation | Chatbots | Legal doc analysis |
| Node granularity | Fine (prompts, chains) | Medium (app integrations) | Medium | Domain-specific actions |
| Visual execution trace | âœ“ | âœ“ | âœ“ | âœ“ |
| Output assembly | âŒ | âŒ | âŒ | âœ“ (sections â†’ document) |
| Domain knowledge | Generic | Generic | Generic | Legal-optimized |
| Enterprise governance | Limited | Good | Limited | Full (Dataverse audit) |
| Dataverse integration | âŒ | Plugin | âŒ | Native |

---

## Appendix B: Example Playbook JSON

```json
{
  "version": "1.0",
  "playbook": {
    "id": "pb-sla-001",
    "name": "Software License Agreement Analysis"
  },
  "canvas": {
    "zoom": 1.0,
    "panX": 0,
    "panY": 0
  },
  "nodes": [
    {
      "id": "node-001",
      "type": "extract",
      "position": { "x": 100, "y": 200 },
      "config": {
        "name": "Extract Entities",
        "toolId": "tool-entity-001",
        "skillIds": ["skill-legal-precision"],
        "knowledgeIds": [],
        "output": {
          "sectionName": "Key Parties and Terms",
          "format": "table",
          "order": 1
        }
      }
    },
    {
      "id": "node-002",
      "type": "analyze",
      "position": { "x": 350, "y": 200 },
      "config": {
        "name": "Analyze Clauses",
        "toolId": "tool-clause-001",
        "skillIds": ["skill-contract-structure"],
        "knowledgeIds": [],
        "output": {
          "sectionName": "Clause Breakdown",
          "format": "markdown",
          "order": 2
        }
      }
    },
    {
      "id": "node-003",
      "type": "detect",
      "position": { "x": 600, "y": 200 },
      "config": {
        "name": "Detect Risks",
        "toolId": "tool-risk-001",
        "skillIds": ["skill-sw-license-risk", "skill-severity-calibration"],
        "knowledgeIds": ["kb-risk-taxonomy", "kb-standard-positions"],
        "output": {
          "sectionName": "Risk Assessment",
          "format": "table",
          "order": 3
        }
      }
    },
    {
      "id": "node-004",
      "type": "generate",
      "position": { "x": 850, "y": 200 },
      "config": {
        "name": "Executive Summary",
        "toolId": "tool-summary-001",
        "skillIds": [],
        "knowledgeIds": [],
        "output": {
          "sectionName": "Executive Summary",
          "format": "narrative",
          "order": 0
        }
      }
    }
  ],
  "edges": [
    {
      "id": "edge-001",
      "source": { "nodeId": "node-001", "port": "output" },
      "target": { "nodeId": "node-002", "port": "input" },
      "type": "dataflow"
    },
    {
      "id": "edge-002",
      "source": { "nodeId": "node-002", "port": "output" },
      "target": { "nodeId": "node-003", "port": "input" },
      "type": "dataflow"
    },
    {
      "id": "edge-003",
      "source": { "nodeId": "node-003", "port": "output" },
      "target": { "nodeId": "node-004", "port": "input" },
      "type": "dataflow"
    }
  ]
}
```

---

*Document Version: 1.0 | Created: January 2026 | Research Draft*

**Sources**:
- [Langflow AI Agent Framework Guide](https://www.langflow.org/blog/the-complete-guide-to-choosing-an-ai-agent-framework-in-2025)
- [Langflow vs n8n Comparison](https://www.bluebash.co/blog/langflow-vs-n8n-ai-workflow-automation/)
- [n8n AI Workflow Builder](https://docs.n8n.io/advanced-ai/ai-workflow-builder/)
- [Flowise Alternatives Review](https://www.voiceflow.com/blog/flowise-alternative)
- [Top Open-Source AI Low/No-Code Tools](https://htdocs.dev/posts/top-7-open-source-ai-lowno-code-tools-in-2025-a-comprehensive-analysis-of-leading-platforms/)

