<?xml version="1.0" encoding="UTF-8"?>
<task id="005" project="ai-file-entity-metadata-extraction">
  <metadata>
    <title>Create Response Models</title>
    <phase>1a: Structured AI Output + Service Rename</phase>
    <status>completed</status>
    <estimated-hours>2</estimated-hours>
    <dependencies>none</dependencies>
    <blocks>006, 007</blocks>
    <tags>bff-api, models, azure-openai</tags>
  </metadata>

  <prompt>
    Create the DocumentAnalysisResult and ExtractedEntities model classes to represent
    the structured JSON response from Azure OpenAI. Include XML documentation comments
    and ensure the models match the spec.md JSON schema exactly.
  </prompt>

  <role>
    SPAARKE platform developer. Expert in C# model design and JSON serialization.
  </role>

  <goal>
    DocumentAnalysisResult.cs and ExtractedEntities.cs models created in the Models/Ai
    folder, ready for use by the DocumentIntelligenceService for JSON parsing.
  </goal>

  <context>
    <background>
      The AI service will return structured JSON instead of just prose text. These models
      define the contract for parsing that JSON response. They must match the prompt
      template format exactly to enable reliable deserialization.
    </background>
    <relevant-files>
      <file>src/server/api/Sprk.Bff.Api/Models/</file>
      <file>projects/ai-file-entity-metadata-extraction/spec.md (Section 5.1)</file>
    </relevant-files>
  </context>

  <constraints>
    <constraint source="spec">Summary field: 2-3 sentence prose summary</constraint>
    <constraint source="spec">TlDr field: array of 3-7 bullet points</constraint>
    <constraint source="spec">Keywords field: comma-separated search terms</constraint>
    <constraint source="spec">Entities must include: organizations, people, amounts, dates, documentType, references</constraint>
  </constraints>

  <knowledge>
    <files>
      <file>projects/ai-file-entity-metadata-extraction/spec.md</file>
    </files>
    <patterns>
      <pattern name="Model classes" location="src/server/api/Sprk.Bff.Api/Models/">
        Follow existing model class patterns with XML documentation
      </pattern>
    </patterns>
  </knowledge>

  <steps>
    <step order="1">Read spec.md Section 5.1 for exact model definitions</step>
    <step order="2">Create Models/Ai folder if it doesn't exist</step>
    <step order="3">Create ExtractedEntities.cs with all entity arrays</step>
    <step order="4">Create DocumentAnalysisResult.cs with Summary, TlDr, Keywords, Entities</step>
    <step order="5">Add RawResponse and ParsedSuccessfully properties for fallback support</step>
    <step order="6">Add XML documentation comments to all public members</step>
    <step order="7">Verify JSON property names match expected AI output format</step>
    <step order="8">Run dotnet build to verify compilation</step>
    <step order="9">Update TASK-INDEX.md: change this task's status to âœ… completed</step>
  </steps>

  <tools>
    <tool name="dotnet">Build and verify .NET projects</tool>
  </tools>

  <outputs>
    <output type="code">src/server/api/Sprk.Bff.Api/Models/Ai/DocumentAnalysisResult.cs</output>
    <output type="code">src/server/api/Sprk.Bff.Api/Models/Ai/ExtractedEntities.cs</output>
  </outputs>

  <acceptance-criteria>
    <criterion testable="true">DocumentAnalysisResult.cs exists with Summary, TlDr, Keywords, Entities properties.</criterion>
    <criterion testable="true">ExtractedEntities.cs exists with Organizations, People, Amounts, Dates, DocumentType, References properties.</criterion>
    <criterion testable="true">All properties have XML documentation comments.</criterion>
    <criterion testable="true">dotnet build succeeds with no errors.</criterion>
  </acceptance-criteria>

  <notes>
    Use System.Text.Json attributes for property naming if needed (JsonPropertyName).
    The TlDr property should be string[] not List for immutability.
    DocumentType should be a string (not enum) for flexibility in AI responses.
  </notes>
</task>
