<?xml version="1.0" encoding="UTF-8"?>
<task id="R3-051" project="AI Semantic Search UI R3">
  <metadata>
    <title>Migrate RelationshipGrid to Universal DatasetGrid</title>
    <phase>6</phase>
    <phase-name>DocumentRelationshipViewer Migration</phase-name>
    <tags>code-page, shared-library, refactor</tags>
    <estimate>4 hours</estimate>
    <dependencies>050</dependencies>
    <parallel-group>none</parallel-group>
    <parallel-safe>false</parallel-safe>
    <status>pending</status>
  </metadata>

  <prompt>
    <role>
      You are a senior frontend engineer migrating an existing Fluent DataGrid component to the Universal DatasetGrid shared component. You follow the migration analysis from task 050 precisely and preserve all existing behavior while eliminating the inline grid implementation.
    </role>
    <goal>
      Replace the inline Fluent DataGrid in RelationshipGrid.tsx with the Universal DatasetGrid imported from @spaarke/ui-components. Map existing grid data to the Universal DatasetGrid data model. Preserve all current behavior: column sorting, row selection, row click handling, and dark mode. Ensure the migrated grid is visually consistent with the new SemanticSearch code page grid.
    </goal>
    <context>
      The DocumentRelationshipViewer is at:
        src/client/code-pages/DocumentRelationshipViewer/

      The migration analysis from task 050 is at:
        notes/drafts/docrelviewer-grid-migration.md

      The Universal DatasetGrid is imported from @spaarke/ui-components:
        import { UniversalDatasetGrid } from '@spaarke/ui-components';

      The SemanticSearch code page uses Universal DatasetGrid for its SearchResultsGrid — use that
      implementation as a visual and API reference if available.

      Key behaviors to preserve after migration:
      - Column definitions (names, widths, sort enabled per column)
      - Client-side sorting (if that is what the analysis found)
      - Row selection mode (single/multi as currently implemented)
      - Row click callback passing the correct relationship data object
      - Dark mode: no hard-coded colors; use Fluent v9 tokens only
      - Column header rendering must match current appearance

      ADR-021 compliance: All colors MUST use Fluent v9 design tokens (colorNeutralBackground1, etc.).
      No hex values, rgb(), or named CSS color values in any component.
    </context>
    <constraints>
      - Import UniversalDatasetGrid from @spaarke/ui-components — do NOT copy the component source
      - Do NOT change the component's public API (props accepted from parent) unless analysis identified a necessary change
      - Do NOT modify the graph view components — only the RelationshipGrid grid view
      - All colors must use Fluent UI v9 tokens (ADR-021)
      - If Universal DatasetGrid cannot support a required feature natively, implement a wrapper/adapter within RelationshipGrid.tsx — do not patch the shared library
      - Follow the gaps/workarounds documented in the migration analysis
      - The DocumentRelationshipViewer package.json must already include @spaarke/ui-components — do not add new npm dependencies without verifying they are not already present
    </constraints>
  </prompt>

  <knowledge>
    <files>
      <file>notes/drafts/docrelviewer-grid-migration.md</file>
      <file>docs/architecture/universal-dataset-grid-architecture.md</file>
      <file>.claude/adr/ADR-012.md</file>
      <file>.claude/adr/ADR-021.md</file>
      <file>.claude/adr/ADR-022.md</file>
    </files>
  </knowledge>

  <inputs>
    <input>notes/drafts/docrelviewer-grid-migration.md — migration analysis (MUST read first)</input>
    <input>src/client/code-pages/DocumentRelationshipViewer/src/components/RelationshipGrid.tsx</input>
    <input>src/client/code-pages/DocumentRelationshipViewer/src/components/ (parent and sibling components)</input>
    <input>src/client/code-pages/DocumentRelationshipViewer/src/types/</input>
    <input>src/client/shared/Spaarke.UI.Components/src/components/DatasetGrid/ (Universal DatasetGrid source and interfaces)</input>
    <input>src/client/code-pages/SemanticSearch/src/components/SearchResultsGrid.tsx (reference implementation if exists)</input>
  </inputs>

  <steps>
    <step order="1">Read notes/drafts/docrelviewer-grid-migration.md to load the migration analysis</step>
    <step order="2">Read the current RelationshipGrid.tsx in full</step>
    <step order="3">Read the Universal DatasetGrid TypeScript interfaces to understand required props</step>
    <step order="4">Replace the Fluent DataGrid import with UniversalDatasetGrid from @spaarke/ui-components</step>
    <step order="5">Map existing column definitions to Universal DatasetGrid column format (field, label, width, sortable, renderCell if custom)</step>
    <step order="6">Map existing row data to the Universal DatasetGrid data model (items array with required id field)</step>
    <step order="7">Wire sorting state: connect existing sort state (or add sort state) to Universal DatasetGrid onSort callback and sortColumn/sortDirection props</step>
    <step order="8">Wire row selection: map existing selection mode and onSelectionChange to Universal DatasetGrid selection props</step>
    <step order="9">Wire row click: connect existing onRowClick handler to Universal DatasetGrid onRowClick prop</step>
    <step order="10">Remove all hard-coded color values identified in the migration analysis; replace with Fluent v9 tokens via useStyles() / makeStyles()</step>
    <step order="11">Remove any now-unused Fluent DataGrid imports (DataGrid, DataGridBody, DataGridCell, DataGridHeader, DataGridRow, TableColumnDefinition, etc.)</step>
    <step order="12">Build DocumentRelationshipViewer (npm run build) and resolve any TypeScript errors</step>
    <step order="13">Fix any remaining TypeScript compilation errors from the migration</step>
  </steps>

  <tools>
    <tool>Read - Read migration analysis and source files</tool>
    <tool>Edit - Replace grid implementation in RelationshipGrid.tsx</tool>
    <tool>Bash - npm run build inside DocumentRelationshipViewer directory to verify compilation</tool>
    <tool>Grep - Search for remaining hard-coded colors or old Fluent DataGrid imports after edit</tool>
  </tools>

  <outputs>
    <output>src/client/code-pages/DocumentRelationshipViewer/src/components/RelationshipGrid.tsx — migrated to Universal DatasetGrid</output>
    <output>Successful TypeScript compilation of DocumentRelationshipViewer</output>
  </outputs>

  <acceptance-criteria>
    <criterion>RelationshipGrid.tsx imports UniversalDatasetGrid from @spaarke/ui-components (not inline Fluent DataGrid)</criterion>
    <criterion>No Fluent DataGrid-specific imports remain (DataGrid, DataGridBody, DataGridRow, DataGridCell, etc.)</criterion>
    <criterion>All columns from the original grid are preserved in the Universal DatasetGrid column definitions</criterion>
    <criterion>Row sorting works for all previously sortable columns</criterion>
    <criterion>Row selection mode is preserved</criterion>
    <criterion>Row click passes the same data object to the parent callback as before</criterion>
    <criterion>No hard-coded hex colors, rgb(), or CSS named colors in the component</criterion>
    <criterion>npm run build completes without TypeScript errors</criterion>
    <criterion>Dark mode applies correctly via Fluent v9 tokens</criterion>
  </acceptance-criteria>
</task>
