<?xml version="1.0" encoding="utf-8"?>
<task id="AIPL-031" project="AI Platform Foundation Phase 1">
  <metadata>
    <title>Create 10 System Skill Records (sprk_analysisskill SKL-001–010)</title>
    <phase>3 — Workstream B: Scope Library &amp; Seed Data</phase>
    <tags>dataverse, seed-data, scope-library</tags>
    <status>not-started</status>
    <estimated-effort>2 hours</estimated-effort>
    <dependencies>AIPL-004</dependencies>
    <blocks>AIPL-034 (Playbooks)</blocks>
  </metadata>

  <prompt>
    Create 10 system Skill records in the sprk_analysisskill Dataverse entity (collection:
    sprk_analysisskills). Skills are prompt fragments that inject additional capability context
    into an analysis. They are composable additions to an Action's system prompt.

    IMPORTANT ENTITY/FIELD CORRECTIONS (verified from source code 2026-02-23):
    - Entity logical name: sprk_analysisskill (NOT sprk_promptfragment — that is a FIELD)
    - Entity collection: sprk_analysisskills
    - Prompt fragment field: sprk_promptfragment (multiline text field on the entity)
    - Code/alternate key field: sprk_skillcode (NOT sprk_externalid — that field does not exist)
    - SkillLookupService.GetByCodeAsync() resolves by sprk_skillcode alternate key
    - No sprk_isactive, sprk_issystem, or sprk_fragmenttext fields exist on this entity
    - 26 existing skill records exist with NO sprk_skillcode set — create NEW records

    Skills to create (SKL-001 through SKL-010):
    1. Citation Extraction — cite every claim with [Section X, Page Y] format
    2. Risk Flagging — highlight clauses requiring legal review
    3. Summary Generation — generate executive summary in 3-5 bullet points
    4. Date Extraction — extract and normalize all dates to ISO 8601
    5. Party Identification — identify all parties with roles and contact info
    6. Obligation Mapping — list mutual obligations as a structured table
    7. Defined Terms — extract all defined terms and their definitions
    8. Financial Terms — extract all monetary amounts, rates, and payment schedules
    9. Termination Analysis — identify termination triggers, notice periods, consequences
    10. Jurisdiction and Governing Law — identify applicable law and dispute resolution
  </prompt>

  <role>
    Dataverse developer familiar with sprk_analysisskill entity schema and prompt engineering.
  </role>

  <goal>
    10 sprk_analysisskill records exist in spaarkedev1 with sprk_skillcode values SKL-001
    through SKL-010. Each has a production-quality prompt fragment in sprk_promptfragment.
    SkillLookupService.GetByCodeAsync("SKL-001") resolves correctly via alternate key.
  </goal>

  <constraints>
    <constraint source="ADR-002">Records are data only — no AI processing in plugin context</constraint>
    <constraint source="project">sprk_skillcode is the alternate key field (NOT sprk_externalid). Values: "SKL-001" through "SKL-010"</constraint>
    <constraint source="project">Prompt fragment goes in sprk_promptfragment field. Each fragment: 50-150 words.</constraint>
    <constraint source="project">26 existing skill records exist with no sprk_skillcode — create NEW records, do not modify existing</constraint>
    <constraint source="spec">Skills must be additive fragments — no contradiction with Action prompts</constraint>
  </constraints>

  <knowledge>
    <files>
      <file>projects/ai-spaarke-platform-enhancements-r1/spec.md</file>
      <file>docs/guides/HOW-TO-CREATE-AI-PLAYBOOK-SCOPES.md</file>
      <file>projects/ai-spaarke-platform-enhancements-r1/notes/design/scope-library-catalog.md</file>
    </files>
  </knowledge>

  <steps>
    <step order="1" name="Verify no SKL-001-010 records exist">
      Query Dataverse for existing records with sprk_skillcode set.
      GET https://spaarkedev1.crm.dynamics.com/api/data/v9.2/sprk_analysisskills?$select=sprk_name,sprk_skillcode&amp;$filter=sprk_skillcode ne null
      Confirm none of SKL-001 through SKL-010 already exist. (26 existing records have no sprk_skillcode.)
    </step>
    <step order="2" name="Author 10 prompt fragments">
      Write production-quality prompt fragments for each of the 10 Skills.
      Each fragment (50-150 words) must be:
      - Injectable into any Action prompt without conflict
      - Self-contained and specific in its instruction
      - Clear about output format it expects
    </step>
    <step order="3" name="Create 10 records via Dataverse Web API">
      POST to https://spaarkedev1.crm.dynamics.com/api/data/v9.2/sprk_analysisskills
      Required fields per record:
        - sprk_name: skill display name (e.g., "Citation Extraction")
        - sprk_description: brief description of what the skill adds
        - sprk_promptfragment: the prompt fragment text (50-150 words)
        - sprk_skillcode: "SKL-001" through "SKL-010" (this is the alternate key)
      Use az account get-access-token for Bearer token auth.
    </step>
    <step order="4" name="Verify records and alternate key">
      Query sprk_analysisskills?$select=sprk_name,sprk_skillcode&amp;$filter=sprk_skillcode ne null
      Confirm 10 records with SKL-001 through SKL-010.
      Test alternate key lookup: GET sprk_analysisskills(sprk_skillcode='SKL-001')
    </step>
    <step order="5" name="Update scope-library-catalog.md">
      Add Skills section to notes/design/scope-library-catalog.md with catalog of all 10 Skills.
    </step>
  </steps>

  <tools>
    <tool name="az">Azure CLI for Dataverse bearer token</tool>
    <tool name="curl">Dataverse Web API calls</tool>
    <tool name="git">Stage documentation changes</tool>
  </tools>

  <outputs>
    <output type="dataverse">10 sprk_analysisskill records in spaarkedev1 (SKL-001–010 via sprk_skillcode)</output>
    <output type="docs">projects/ai-spaarke-platform-enhancements-r1/notes/design/scope-library-catalog.md (updated)</output>
  </outputs>

  <acceptance-criteria>
    <criterion testable="true">10 sprk_analysisskill records with sprk_skillcode SKL-001 through SKL-010</criterion>
    <criterion testable="true">Alternate key lookup works: GET sprk_analysisskills(sprk_skillcode='SKL-001') returns 200</criterion>
    <criterion testable="true">scope-library-catalog.md documents all 10 Skills</criterion>
  </acceptance-criteria>
</task>
