<?xml version="1.0" encoding="UTF-8"?>
<task id="060" project="ai-spaarke-platform-enhancents-r2">
  <metadata>
    <title>Scaffold AnalysisWorkspace Code Page Project</title>
    <phase>2</phase>
    <package>C: AW Migration</package>
    <tags>code-page, frontend, scaffold</tags>
    <estimate>2-3 hours</estimate>
    <dependencies>010-018, 025-037</dependencies>
    <parallel-group>sprint2-track1</parallel-group>
    <status>completed</status>
  </metadata>

  <prompt>
    <goal>
      Create the AnalysisWorkspace Code Page project scaffold at src/client/code-pages/AnalysisWorkspace/ with webpack config, tsconfig, package.json, entry point, and a placeholder App component wrapped in FluentProvider. This replaces the legacy AnalysisWorkspace PCF with a standalone React 19 Code Page.
    </goal>
    <context>
      The Analysis Workspace is being migrated from a PCF control (React 16, field-bound) to a Code Page
      (React 19, standalone) as specified in Package C of the R2 plan. This is a big-bang migration — no
      incremental iframe transition. The Code Page will be deployed as a single self-contained HTML web
      resource (`sprk_AnalysisWorkspace`) opened via `Xrm.Navigation.navigateTo()` from the Analysis
      Dataverse form.

      Use the SemanticSearch Code Page as the canonical reference implementation:
      - src/client/code-pages/SemanticSearch/index.tsx (entry point with createRoot)
      - src/client/code-pages/SemanticSearch/webpack.config.js (webpack configuration)
      - src/client/code-pages/SemanticSearch/tsconfig.json (TypeScript configuration)
      - src/client/code-pages/SemanticSearch/package.json (dependencies)

      Also reference the SprkChatPane Code Page (task 010) for side pane patterns, but note the
      AnalysisWorkspace opens as a full-page navigateTo dialog, not a side pane.

      The Code Page will receive context parameters (analysisId, documentId, tenantId) via URL query
      string parsed in index.tsx.
    </context>
    <constraints>
      - Follow ADR-006: Code Pages for standalone dialogs/pages (not PCF)
      - Follow ADR-021: Fluent UI v9 exclusively; FluentProvider wrapping mandatory; dark mode support
      - Follow ADR-022: Code Pages bundle React 19 with createRoot(); NOT platform-provided React 16
      - Follow .claude/constraints/pcf.md Code Page section for build pipeline rules
      - React 19 with createRoot() — DO NOT use ReactDOM.render()
      - FluentProvider with theme detection must wrap the entire app
      - Webpack config must produce a single bundle suitable for inlining
      - Must compile and render the placeholder message without errors
    </constraints>
  </prompt>

  <knowledge>
    <files>
      <file>.claude/adr/ADR-006-pcf-over-webresources.md</file>
      <file>.claude/adr/ADR-021-fluent-design-system.md</file>
      <file>.claude/adr/ADR-022-pcf-platform-libraries.md</file>
      <file>.claude/constraints/pcf.md</file>
    </files>
  </knowledge>

  <reference-implementations>
    <reference>src/client/code-pages/SemanticSearch/index.tsx</reference>
    <reference>src/client/code-pages/SemanticSearch/webpack.config.js</reference>
    <reference>src/client/code-pages/SemanticSearch/tsconfig.json</reference>
    <reference>src/client/code-pages/SemanticSearch/package.json</reference>
    <reference>src/client/code-pages/SprkChatPane/index.tsx</reference>
  </reference-implementations>

  <steps>
    <step order="1">
      Read the SemanticSearch Code Page project files to understand the scaffold pattern:
      - index.tsx (React 19 createRoot entry point)
      - webpack.config.js (bundle configuration)
      - tsconfig.json (TypeScript compiler options)
      - package.json (dependencies and scripts)
    </step>
    <step order="2">
      Create src/client/code-pages/AnalysisWorkspace/ directory structure:
      - index.tsx (entry point)
      - App.tsx (root component)
      - webpack.config.js
      - tsconfig.json
      - package.json
    </step>
    <step order="3">
      Create package.json with:
      - React 19 and react-dom 19 as dependencies
      - @fluentui/react-components and @fluentui/react-icons
      - Webpack, ts-loader, and build tooling as devDependencies
      - Scripts: build, build:dev, start
      - Reference to @spaarke/ui-components (workspace link or relative path)
    </step>
    <step order="4">
      Create webpack.config.js following SemanticSearch pattern:
      - Entry: ./index.tsx
      - Output: single bundle in dist/
      - TypeScript loader
      - Production optimization (minification, tree-shaking)
      - Source maps for development
    </step>
    <step order="5">
      Create tsconfig.json:
      - Target ES2020+, module ESNext
      - JSX react-jsx (React 19 automatic runtime)
      - Strict mode enabled
      - Path aliases if needed
    </step>
    <step order="6">
      Create index.tsx entry point:
      - Import createRoot from react-dom/client
      - Parse URL parameters from window.location.search (analysisId, documentId, tenantId)
      - Create root and render App wrapped in FluentProvider
      - Use webLightTheme as default (theme detection wired in task 069)
    </step>
    <step order="7">
      Create App.tsx placeholder component:
      - Render "Analysis Workspace Loading..." message with Fluent UI Spinner
      - Use makeStyles for basic full-viewport layout (100vw x 100vh)
      - Include PLACEHOLDER comment indicating task 061 wires the real 2-panel layout
      - Accept analysisId, documentId, tenantId as props from index.tsx
    </step>
    <step order="8">
      Run npm install and npm run build to verify the scaffold compiles:
      - Fix any TypeScript or webpack errors
      - Confirm dist/ output is produced
    </step>
  </steps>

  <tools>
    <tool>Read - Examine SemanticSearch Code Page reference files</tool>
    <tool>Write - Create new project files</tool>
    <tool>Bash - npm install, npm run build</tool>
  </tools>

  <outputs>
    <output>src/client/code-pages/AnalysisWorkspace/index.tsx — React 19 createRoot entry point</output>
    <output>src/client/code-pages/AnalysisWorkspace/App.tsx — Placeholder component with FluentProvider</output>
    <output>src/client/code-pages/AnalysisWorkspace/webpack.config.js — Webpack bundle configuration</output>
    <output>src/client/code-pages/AnalysisWorkspace/tsconfig.json — TypeScript configuration</output>
    <output>src/client/code-pages/AnalysisWorkspace/package.json — Dependencies and build scripts</output>
    <output>Successful build output in dist/</output>
  </outputs>

  <acceptance-criteria>
    <criterion>AnalysisWorkspace/ directory exists at src/client/code-pages/AnalysisWorkspace/</criterion>
    <criterion>npm install completes without errors</criterion>
    <criterion>npm run build produces a bundle in dist/</criterion>
    <criterion>index.tsx uses React 19 createRoot() — NOT ReactDOM.render()</criterion>
    <criterion>index.tsx parses analysisId, documentId, tenantId from URL query string</criterion>
    <criterion>App.tsx renders inside FluentProvider with Fluent v9 theme</criterion>
    <criterion>App.tsx shows "Analysis Workspace Loading..." placeholder with Spinner</criterion>
    <criterion>No Fluent v8 imports present</criterion>
    <criterion>No React 16 APIs used (no ReactDOM.render, no unmountComponentAtNode)</criterion>
  </acceptance-criteria>

  <placeholders>
    <placeholder id="PH-060-A">
      <location>src/client/code-pages/AnalysisWorkspace/App.tsx</location>
      <type>hardcoded-return</type>
      <description>App.tsx renders FluentProvider + Spinner + "Analysis Workspace Loading..." instead of the real 2-panel layout</description>
      <completed-by>061</completed-by>
      <build-impact>Compiles and renders; no runtime errors</build-impact>
    </placeholder>
    <placeholder id="PH-060-B">
      <location>src/client/code-pages/AnalysisWorkspace/index.tsx</location>
      <type>hardcoded-return</type>
      <description>Theme detection uses webLightTheme only; full 4-level theme resolution added in task 069</description>
      <completed-by>069</completed-by>
      <build-impact>Compiles; renders in light theme only</build-impact>
    </placeholder>
  </placeholders>
</task>
