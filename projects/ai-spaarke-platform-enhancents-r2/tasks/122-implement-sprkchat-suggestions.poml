<?xml version="1.0" encoding="UTF-8"?>
<task id="122" project="ai-spaarke-platform-enhancents-r2">
  <metadata>
    <title>Implement SprkChatSuggestions Component</title>
    <phase>3</phase>
    <package>Package H: Suggestions + Citations</package>
    <tags>frontend, fluent-ui</tags>
    <estimate>3-4 hours</estimate>
    <dependencies>Phase 2 complete</dependencies>
    <parallel-group>sprint3-track3</parallel-group>
    <status>completed</status>
  </metadata>

  <prompt>
    <goal>
      Create the SprkChatSuggestions component that renders 2-3 clickable follow-up suggestion chips
      below the latest assistant message in SprkChat. Clicking a suggestion sends it as the next
      user message.
    </goal>
    <context>
      After the AI completes a response, contextual follow-up suggestions help the user continue
      the conversation productively without needing to compose a new prompt from scratch. The
      SprkChatSuggestions component renders these as small clickable chips below the most recent
      assistant message.

      Examples of suggestions:
      - After an analysis: "Summarize key findings", "Identify risks", "Compare to previous version"
      - After a revision: "Make it more concise", "Add more detail", "Change the tone to formal"
      - After a search: "Show related documents", "Refine search criteria", "Export results"

      The suggestions are generated by the backend (a focused LLM call, ~100 tokens) and delivered
      via a new SSE event type. This task creates the frontend component only — the SSE event
      handling is task 123.

      Use the PlaybookBuilder SuggestionBar.tsx as a reference implementation for chip layout and
      interaction patterns, but create a new component following SprkChat conventions.
    </context>
    <constraints>
      - Follow ADR-012: Component MUST live in @spaarke/ui-components SprkChat directory
      - Follow ADR-021: Fluent UI v9 exclusively; makeStyles + design tokens; dark mode support
      - Use Fluent UI v9 Tag or Badge components for suggestion chips (not custom buttons)
      - Suggestions must be visually distinct from chat message content
      - Maximum 3 suggestions displayed at a time
      - Clicking a suggestion must send it as a user message (not just fill the input)
      - Suggestions clear when a new message is sent (user or assistant)
      - Component must be accessible: keyboard navigable, ARIA labels
    </constraints>
  </prompt>

  <knowledge>
    <files>
      <file>.claude/adr/ADR-012-shared-components.md</file>
      <file>.claude/adr/ADR-021-fluent-design-system.md</file>
    </files>
  </knowledge>

  <reference-implementations>
    <reference>src/client/pcf/PlaybookBuilderHost/control/components/SuggestionBar.tsx</reference>
    <reference>src/client/shared/Spaarke.UI.Components/src/components/SprkChat/SprkChat.tsx</reference>
    <reference>src/client/shared/Spaarke.UI.Components/src/components/SprkChat/SprkChatMessage.tsx</reference>
  </reference-implementations>

  <steps>
    <step order="1">
      Review the PlaybookBuilder SuggestionBar.tsx reference implementation:
      - Layout and chip styling patterns
      - Click handling and interaction model
      - Animations or transitions used
      NOTE: This is reference only — do not modify it
    </step>
    <step order="2">
      Review SprkChat component structure:
      - How messages are rendered (SprkChatMessage)
      - Where suggestions should appear in the layout (below latest assistant message)
      - How user messages are sent (input submission handler)
      - Existing state management patterns
    </step>
    <step order="3">
      Define TypeScript interface for SprkChatSuggestions:
      - SprkChatSuggestionsProps: { suggestions: string[], onSelect: (suggestion: string) => void,
        visible: boolean }
      - suggestions: array of 1-3 suggestion strings
      - onSelect: callback when user clicks a suggestion
      - visible: controls show/hide (animated)
    </step>
    <step order="4">
      Implement SprkChatSuggestions component:
      - Render suggestion chips in a horizontal flex row with gap spacing
      - Each chip: Fluent UI v9 InteractionTag or similar component
      - Chip text should be concise (max ~50 chars) — truncate with ellipsis if needed
      - Show/hide with a fade-in/slide-up animation (200ms transition)
      - Chips should have a subtle hover effect (background color change via design tokens)
    </step>
    <step order="5">
      Implement click handling:
      - On chip click: call onSelect(suggestion) which triggers sending as a user message
      - After click: immediately hide suggestions (they'll be replaced by next response's suggestions)
      - Prevent double-click issues (disable chips briefly after click)
    </step>
    <step order="6">
      Apply Fluent UI v9 styling:
      - Use makeStyles with design tokens
      - Chip background: colorNeutralBackground3 (light mode), colorNeutralBackground3 (dark mode)
      - Chip text: colorNeutralForeground2
      - Chip hover: colorNeutralBackground3Hover
      - Chip border: subtle border using colorNeutralStroke2
      - Dark mode and high-contrast must be visually correct
    </step>
    <step order="7">
      Implement keyboard navigation:
      - Arrow Left/Right to navigate between chips
      - Enter/Space to select focused chip
      - Tab to move focus to/from the suggestion row
      - ARIA role="group" on container, role="button" on each chip
    </step>
    <step order="8">
      Export component:
      - Add to SprkChat barrel exports
      - Do not add to top-level library barrel (internal to SprkChat)
    </step>
    <step order="9">
      Build verification:
      - Run TypeScript compilation for Spaarke.UI.Components
      - Verify no type errors
    </step>
  </steps>

  <tools>
    <tool>Read - Review SuggestionBar.tsx reference and SprkChat component</tool>
    <tool>Write - Create SprkChatSuggestions.tsx</tool>
    <tool>Edit - Update SprkChat barrel exports</tool>
    <tool>Bash - TypeScript compilation</tool>
  </tools>

  <relevant-files>
    <file action="create">src/client/shared/Spaarke.UI.Components/src/components/SprkChat/SprkChatSuggestions.tsx</file>
    <file action="modify">src/client/shared/Spaarke.UI.Components/src/components/SprkChat/index.ts</file>
    <file action="reference">src/client/pcf/PlaybookBuilderHost/control/components/SuggestionBar.tsx</file>
    <file action="reference">src/client/shared/Spaarke.UI.Components/src/components/SprkChat/SprkChat.tsx</file>
  </relevant-files>

  <outputs>
    <output>src/client/shared/Spaarke.UI.Components/src/components/SprkChat/SprkChatSuggestions.tsx - Suggestion chips component</output>
    <output>Updated SprkChat barrel exports</output>
    <output>Successful TypeScript compilation</output>
  </outputs>

  <acceptance-criteria>
    <criterion>SprkChatSuggestions.tsx exists in the SprkChat component directory</criterion>
    <criterion>Component renders 1-3 clickable suggestion chips in a horizontal row</criterion>
    <criterion>Clicking a chip calls onSelect(suggestion) with the suggestion text</criterion>
    <criterion>Chips use Fluent UI v9 components (InteractionTag or similar) — not custom HTML buttons</criterion>
    <criterion>Show/hide animation works (fade-in/slide-up on appear, fade-out on dismiss)</criterion>
    <criterion>All colors use Fluent UI v9 design tokens — no hard-coded hex values</criterion>
    <criterion>Component renders correctly in dark mode</criterion>
    <criterion>Keyboard navigation works: Arrow Left/Right between chips, Enter/Space to select</criterion>
    <criterion>ARIA attributes present: role="group" on container, role="button" on chips</criterion>
    <criterion>Long suggestion text (&gt;50 chars) is truncated with ellipsis</criterion>
    <criterion>TypeScript compilation succeeds with zero errors</criterion>
  </acceptance-criteria>

  <placeholders />
</task>
