/*! For license information please see bundle.js.LICENSE.txt */
var pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad;(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})}};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var t={};e.r(t),e.d(t,{DocumentRelationshipViewer:()=>zb});const n=Reactv16;var r=e.n(n);const o=FluentUIReactv940;var i="undefined"==typeof window?e.g:window,a="@griffel/";function c(e,t){return i[Symbol.for(a+e)]||(i[Symbol.for(a+e)]=t),i[Symbol.for(a+e)]}var s=c("DEFINITION_LOOKUP_TABLE",{}),l="data-make-styles-bucket";function u(e,t){return"___"+function(e){var t=e.length;if(7===t)return e;for(var n=t;n<7;n++)e+="0";return e}(function(e){for(var t,n=0,r=0,o=e.length;o>=4;++r,o-=4)t=1540483477*(65535&(t=255&e.charCodeAt(r)|(255&e.charCodeAt(++r))<<8|(255&e.charCodeAt(++r))<<16|(255&e.charCodeAt(++r))<<24))+(59797*(t>>>16)<<16),n=1540483477*(65535&(t^=t>>>24))+(59797*(t>>>16)<<16)^1540483477*(65535&n)+(59797*(n>>>16)<<16);switch(o){case 3:n^=(255&e.charCodeAt(r+2))<<16;case 2:n^=(255&e.charCodeAt(r+1))<<8;case 1:n=1540483477*(65535&(n^=255&e.charCodeAt(r)))+(59797*(n>>>16)<<16)}return(((n=1540483477*(65535&(n^=n>>>13))+(59797*(n>>>16)<<16))^n>>>15)>>>0).toString(36)}(e+t))}function d(e,t){var n="",r="";for(var o in e){var i=e[o];if(0!==i){var a=Array.isArray(i),c="rtl"===t?(a?i[1]:i)+" ":(a?i[0]:i)+" ";n+=c,r+=c}else r+=o+" "}return[n.slice(0,-1),r.slice(0,-1)]}function h(e,t){var n={};for(var r in e){var[o,i]=d(e[r],t);if(""!==i){var a=u(i,t),c=a+(""===o?"":" "+o);s[a]=[e[r],t],n[r]=c}else n[r]=""}return n}var g={};function f(){for(var e=arguments,t=null,n="",r="",o=new Array(arguments.length),i=function(){var t=e[a];if("string"==typeof t&&""!==t){var i=t.indexOf("___");if(-1===i)n+=t+" ";else{var c=t.substr(i,10);i>0&&(n+=t.slice(0,i)),r+=c,o[a]=c}}},a=0;a<arguments.length;a++)i();if(""===r)return n.slice(0,-1);var c=g[r];if(void 0!==c)return n+c;for(var l=[],h=0;h<arguments.length;h++){var f=o[h];if(f){var p=s[f];p&&(l.push(p[0]),t=p[1])}}var v=Object.assign.apply(Object,[{}].concat(l)),[m,y]=d(v,t),w=u(y,t),b=w+" "+m;return g[r]=b,s[w]=[v,t],n+b}var p=n.createContext(void 0),v={},m=(p.Provider,()=>{var e={};return function(t,n){void 0===e[t.id]&&(t.insertCSSRules(n),e[t.id]=!0)}}),y=n.useInsertionEffect?n.useInsertionEffect:void 0,w=()=>{var e={};return function(t,n){y&&"undefined"!=typeof window&&window.document&&window.document.createElement?y(()=>{t.insertCSSRules(n)},[t,n]):void 0===e[t.id]&&(t.insertCSSRules(n),e[t.id]=!0)}};function b(e){return Array.isArray(e)?e:[e]}var C=["r","d","l","v","w","f","i","h","a","s","k","t","m","c"].reduce((e,t,n)=>(e[t]=n,e),{});function k(e,t,n,r){var o,i,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},c="m"===e,s=null!==(o=a.m)&&void 0!==o?o:"0",u=null!==(i=a.p)&&void 0!==i?i:0,d=function(e,t,n){return("m"===e?e+t:e)+n}(e,s,u);if(!r.stylesheets[d]){var h=t&&t.createElement("style"),g=function(e,t,n,r){var o=[];if(r[l]=t,r["data-priority"]=String(n),e)for(var i in r)e.setAttribute(i,r[i]);return{elementAttributes:r,insertRule:function(t){return(null==e?void 0:e.sheet)?e.sheet.insertRule(t,e.sheet.cssRules.length):o.push(t)},element:e,bucketName:t,cssRules:()=>(null==e?void 0:e.sheet)?Array.from(e.sheet.cssRules).map(e=>e.cssText):o}}(h,e,u,Object.assign({},r.styleElementAttributes,c&&{media:s}));r.stylesheets[d]=g,(null==t?void 0:t.head)&&h&&t.head.insertBefore(h,function(e,t,n,r){var o,i,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},c=C[n],s=null!==(o=a.m)&&void 0!==o?o:"",u=null!==(i=a.p)&&void 0!==i?i:0,d=e=>c-C[e.getAttribute(l)],h=e.head.querySelectorAll("[".concat(l,"]"));if("m"===n){var g=e.head.querySelectorAll("[".concat(l,'="').concat(n,'"]'));g.length&&(h=g,d=e=>r.compareMediaQueries(s,e.media))}for(var f=e=>function(e,t,n){var r,o;return t+(null!==(r=n.m)&&void 0!==r?r:"")===e.getAttribute(l)+(null!==(o=e.media)&&void 0!==o?o:"")}(e,n,a)?u-Number(e.getAttribute("data-priority")):d(e),p=h.length,v=p-1;v>=0;){var m=h.item(v);if(f(m)>0)return m.nextSibling;v--}return p>0?h.item(0):t?t.nextSibling:null}(t,n,e,r,a))}return r.stylesheets[d]}function S(e,t){try{e.insertRule(t)}catch(e){}}":(".concat(["-moz-placeholder","-moz-focus-inner","-moz-focusring","-ms-input-placeholder","-moz-read-write","-moz-read-only"].join("|"),")");var I=0,E=(e,t)=>e<t?-1:e>t?1:0;function _(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"undefined"==typeof document?void 0:document,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{classNameHashSalt:n,unstable_filterCSSRule:r,insertionPoint:o,styleElementAttributes:i,compareMediaQueries:a=E}=t,c={classNameHashSalt:n,insertionCache:{},stylesheets:{},styleElementAttributes:Object.freeze(i),compareMediaQueries:a,id:"d".concat(I++),insertCSSRules(t){for(var n in t)for(var i=t[n],a=0,s=i.length;a<s;a++){var[l,u]=b(i[a]),d=k(n,e,o||null,c,u);c.insertionCache[l]||(c.insertionCache[l]=n,r?r(l)&&S(d,l):S(d,l))}}};return c}var T=n.createContext(_()),O=n.createContext("ltr");function A(e,t){var r=function(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:m)(),r=null,o=null;return function(i){var{dir:a,renderer:c}=i,s="ltr"===a;return s?null===r&&(r=h(e,a)):null===o&&(o=h(e,a)),n(c,t),s?r:o}}(e,t,w);return function(){var e=n.useContext(O),t=n.useContext(T);return r({dir:e,renderer:t})}}var P=A({root:{mc9l5x:"f1w7gpdv",Bg96gwp:"fez10in"},rtl:{Bz10aip:"f13rod7r"}},{d:[".f1w7gpdv{display:inline;}",".fez10in{line-height:0;}",".f13rod7r{transform:scaleX(-1);}"]}),M=["title","primaryFill"];function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach(function(t){R(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function R(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var j=A({root:{B8gzw0y:"f1dd5bof"}},{m:[["@media (forced-colors: active){.f1dd5bof{forced-color-adjust:auto;}}",{m:"(forced-colors: active)"}]]});function D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?D(Object(n),!0).forEach(function(t){H(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function H(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var L=(e,t,r,o)=>{var i="1em"===t?"20":t,a=n.forwardRef((e,a)=>{var c=j(),s=((e,t)=>{var r,{title:o,primaryFill:i="currentColor"}=e,a=N(N({},function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,M)),{},{title:void 0,fill:i}),c=P(),s=null!=(r=n.useContext(p))?r:v;return a.className=f(c.root,(null==t?void 0:t.flipInRtl)&&"rtl"===(null==s?void 0:s.textDirection)&&c.rtl,a.className),o&&(a["aria-label"]=o),a["aria-label"]||a["aria-labelledby"]?a.role="img":a["aria-hidden"]=!0,a})(e,{flipInRtl:null==o?void 0:o.flipInRtl}),l=q(q({},s),{},{className:f(s.className,c.root),ref:a,width:t,height:t,viewBox:"0 0 ".concat(i," ").concat(i),xmlns:"http://www.w3.org/2000/svg"});return"string"==typeof r?n.createElement("svg",q(q({},l),{},{dangerouslySetInnerHTML:{__html:r}})):n.createElement("svg",l,...r.map(e=>n.createElement("path",{d:e,fill:l.fill})))});return a.displayName=e,a},B=L("Document20Regular","20",["M6 2a2 2 0 0 0-2 2v12c0 1.1.9 2 2 2h8a2 2 0 0 0 2-2V7.41c0-.4-.16-.78-.44-1.06l-3.91-3.91A1.5 1.5 0 0 0 10.59 2H6ZM5 4a1 1 0 0 1 1-1h4v3.5c0 .83.67 1.5 1.5 1.5H15v8a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V4Zm9.8 3h-3.3a.5.5 0 0 1-.5-.5V3.2L14.8 7Z"]),U=L("DocumentFlowchart24Regular","24",["M6.5 8.25c0-.41.34-.75.75-.75h2.5c.41 0 .75.34.75.75v2.5c0 .41-.34.75-.75.75h-.5v2.69l1.56 1.56h2.69v-.5c0-.41.34-.75.75-.75h2.5c.41 0 .75.34.75.75v2.5c0 .41-.34.75-.75.75h-2.5a.75.75 0 0 1-.75-.75v-.5h-2.69l-1.78 1.78c-.3.3-.77.3-1.06 0l-2-2a.75.75 0 0 1 0-1.06l1.78-1.78V11.5h-.5a.75.75 0 0 1-.75-.75v-2.5Zm12.91.16L13.6 2.6a.5.5 0 0 0-.05-.04 2.07 2.07 0 0 0-.34-.25l-.05-.03-.05-.03-.16-.09c-.2-.08-.41-.12-.63-.14h-.06a.6.6 0 0 0-.08-.01H6a2 2 0 0 0-2 2v16c0 1.1.9 2 2 2h12a2 2 0 0 0 2-2V9.83a2 2 0 0 0-.59-1.42ZM18.5 20a.5.5 0 0 1-.5.5H6a.5.5 0 0 1-.5-.5V4c0-.27.22-.5.5-.5h6V8c0 1.1.9 2 2 2h4.5v10Zm-5-15.38 3.88 3.88H14a.5.5 0 0 1-.5-.5V4.62Z"]),z=L("DocumentPdf20Regular","20",["M3 12a2 2 0 1 1 0 4H2v1.5a.5.5 0 0 1-1 0v-5c0-.28.22-.5.5-.5H3Zm-1 3h1a1 1 0 1 0 0-2H2v2Zm6-3a2 2 0 0 1 2 2v2a2 2 0 0 1-2 2H6.5a.5.5 0 0 1-.5-.5v-5c0-.28.22-.5.5-.5H8Zm-1 5h1a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1H7v4Zm7.1-4.99a.5.5 0 0 1 0 .98L14 13h-2v1.5h1.5a.5.5 0 0 1 0 1H12v2a.5.5 0 0 1-1 0v-5c0-.28.22-.5.5-.5H14l.1.01ZM10.6 2c.4 0 .78.16 1.06.44l3.91 3.91c.28.28.44.67.44 1.06V16a2 2 0 0 1-2 2h-1.09c.06-.16.09-.32.09-.5V17h1a1 1 0 0 0 1-1v-2.39a1.49 1.49 0 0 0 0-2.23V8h-3.5A1.5 1.5 0 0 1 10 6.5V3H6a1 1 0 0 0-1 1v7.63a2.74 2.74 0 0 0-1-.52V4c0-1.1.9-2 2-2h4.59ZM11 6.5c0 .28.22.5.5.5h3.3L11 3.2v3.3Z"]),K=L("DocumentQuestionMark20Regular","20",["M6 2a2 2 0 0 0-2 2v5.2c.32-.08.66-.15 1-.18V4a1 1 0 0 1 1-1h4v3.5c0 .83.67 1.5 1.5 1.5H15v8a1 1 0 0 1-1 1h-3.6c-.18.36-.4.7-.66 1H14a2 2 0 0 0 2-2V7.41c0-.4-.16-.78-.44-1.06l-3.91-3.91A1.5 1.5 0 0 0 10.59 2H6Zm8.8 5h-3.3a.5.5 0 0 1-.5-.5V3.2L14.8 7ZM10 14.5a4.5 4.5 0 1 0-9 0 4.5 4.5 0 0 0 9 0Zm-4.5 1.88a.62.62 0 1 1 0 1.25.62.62 0 0 1 0-1.25Zm0-4.88c1.03 0 1.85.85 1.85 1.95 0 .59-.21.91-.72 1.32l-.28.22c-.25.19-.33.3-.35.44v.16a.5.5 0 0 1-1-.09c0-.57.21-.88.72-1.29l.27-.21c.3-.23.36-.35.36-.55 0-.55-.38-.95-.85-.95-.5 0-.86.37-.85.95a.5.5 0 1 1-1 0c-.01-1.13.8-1.95 1.85-1.95Z"]),F=L("DocumentText20Regular","20",["M6.5 10a.5.5 0 0 0 0 1h7a.5.5 0 0 0 0-1h-7Zm0 2a.5.5 0 0 0 0 1h7a.5.5 0 0 0 0-1h-7Zm0 2a.5.5 0 0 0 0 1h7a.5.5 0 0 0 0-1h-7ZM4 4c0-1.1.9-2 2-2h4.59c.4 0 .78.16 1.06.44l3.91 3.91c.28.28.44.67.44 1.06V16a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4Zm2-1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V8h-3.5A1.5 1.5 0 0 1 10 6.5V3H6Zm5.5 4h3.3L11 3.2v3.3c0 .28.22.5.5.5Z"]),V=L("Filter20Regular","20",["M7.5 13h5a.5.5 0 0 1 .09 1H7.5a.5.5 0 0 1-.09-1h5.09-5Zm-2-4h9a.5.5 0 0 1 .09 1H5.5a.5.5 0 0 1-.09-1h9.09-9Zm-2-4h13a.5.5 0 0 1 .09 1H3.5a.5.5 0 0 1-.09-1H16.5h-13Z"]);var Y="undefined"==typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent)?n.useEffect:n.useLayoutEffect;function G(e){var t="function"==typeof e?function(e){var t,n=new Set,r=(e,r)=>{var o="function"==typeof e?e(t):e;if(o!==t){var i=t;t=r?o:Object.assign({},t,o),n.forEach(e=>e(t,i))}},o=()=>t,i={setState:r,getState:o,subscribe:(e,r,i)=>r||i?function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object.is;console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");var a=r(t);function c(){var n=r(t);if(!i(a,n)){var o=a;e(a=n,o)}}return n.add(c),()=>n.delete(c)}(e,r,i):(n.add(e),()=>n.delete(e)),destroy:()=>n.clear()};return t=e(r,o,i),i}(e):e,r=function(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.getState,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object.is,[,i]=(0,n.useReducer)(e=>e+1,0),a=t.getState(),c=(0,n.useRef)(a),s=(0,n.useRef)(r),l=(0,n.useRef)(o),u=(0,n.useRef)(!1),d=(0,n.useRef)();void 0===d.current&&(d.current=r(a));var h=!1;(c.current!==a||s.current!==r||l.current!==o||u.current)&&(e=r(a),h=!o(d.current,e)),Y(()=>{h&&(d.current=e),c.current=a,s.current=r,l.current=o,u.current=!1});var g=(0,n.useRef)(a);Y(()=>{var e=()=>{try{var e=t.getState(),n=s.current(e);l.current(d.current,n)||(c.current=e,d.current=n,i())}catch(e){u.current=!0,i()}},n=t.subscribe(e);return t.getState()!==g.current&&e(),n},[]);var f=h?e:d.current;return(0,n.useDebugValue)(f),f};return Object.assign(r,t),r[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");var e=[r,t];return{next(){var t=e.length<=0;return{value:e.shift(),done:t}}}},r}var W={value:()=>{}};function Z(){for(var e,t=0,n=arguments.length,r={};t<n;++t){if(!(e=arguments[t]+"")||e in r||/[\s.]/.test(e))throw new Error("illegal type: "+e);r[e]=[]}return new Q(r)}function Q(e){this._=e}function X(e,t){for(var n,r=0,o=e.length;r<o;++r)if((n=e[r]).name===t)return n.value}function J(e,t,n){for(var r=0,o=e.length;r<o;++r)if(e[r].name===t){e[r]=W,e=e.slice(0,r).concat(e.slice(r+1));break}return null!=n&&e.push({name:t,value:n}),e}Q.prototype=Z.prototype={constructor:Q,on:function(e,t){var n,r,o=this._,i=(r=o,(e+"").trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");if(n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),e&&!r.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:t}})),a=-1,c=i.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++a<c;)if(n=(e=i[a]).type)o[n]=J(o[n],e.name,t);else if(null==t)for(n in o)o[n]=J(o[n],e.name,null);return this}for(;++a<c;)if((n=(e=i[a]).type)&&(n=X(o[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Q(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,r,o=new Array(n),i=0;i<n;++i)o[i]=arguments[i+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(i=0,n=(r=this._[e]).length;i<n;++i)r[i].value.apply(t,o)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],o=0,i=r.length;o<i;++o)r[o].value.apply(t,n)}};const $=Z;function ee(){}function te(e){return null==e?ee:function(){return this.querySelector(e)}}function ne(){return[]}function re(e){return null==e?ne:function(){return this.querySelectorAll(e)}}function oe(e){return function(){return this.matches(e)}}function ie(e){return function(t){return t.matches(e)}}var ae=Array.prototype.find;function ce(){return this.firstElementChild}var se=Array.prototype.filter;function le(){return Array.from(this.children)}function ue(e){return new Array(e.length)}function de(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function he(e,t,n,r,o,i){for(var a,c=0,s=t.length,l=i.length;c<l;++c)(a=t[c])?(a.__data__=i[c],r[c]=a):n[c]=new de(e,i[c]);for(;c<s;++c)(a=t[c])&&(o[c]=a)}function ge(e,t,n,r,o,i,a){var c,s,l,u=new Map,d=t.length,h=i.length,g=new Array(d);for(c=0;c<d;++c)(s=t[c])&&(g[c]=l=a.call(s,s.__data__,c,t)+"",u.has(l)?o[c]=s:u.set(l,s));for(c=0;c<h;++c)l=a.call(e,i[c],c,i)+"",(s=u.get(l))?(r[c]=s,s.__data__=i[c],u.delete(l)):n[c]=new de(e,i[c]);for(c=0;c<d;++c)(s=t[c])&&u.get(g[c])===s&&(o[c]=s)}function fe(e){return e.__data__}function pe(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function ve(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}de.prototype={constructor:de,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};var me="http://www.w3.org/1999/xhtml";const ye={svg:"http://www.w3.org/2000/svg",xhtml:me,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function we(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),ye.hasOwnProperty(t)?{space:ye[t],local:e}:e}function be(e){return function(){this.removeAttribute(e)}}function Ce(e){return function(){this.removeAttributeNS(e.space,e.local)}}function ke(e,t){return function(){this.setAttribute(e,t)}}function Se(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Ie(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function Ee(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function _e(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Te(e){return function(){this.style.removeProperty(e)}}function Oe(e,t,n){return function(){this.style.setProperty(e,t,n)}}function Ae(e,t,n){return function(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function Pe(e,t){return e.style.getPropertyValue(t)||_e(e).getComputedStyle(e,null).getPropertyValue(t)}function Me(e){return function(){delete this[e]}}function xe(e,t){return function(){this[e]=t}}function Ne(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function Re(e){return e.trim().split(/^|\s+/)}function je(e){return e.classList||new De(e)}function De(e){this._node=e,this._names=Re(e.getAttribute("class")||"")}function qe(e,t){for(var n=je(e),r=-1,o=t.length;++r<o;)n.add(t[r])}function He(e,t){for(var n=je(e),r=-1,o=t.length;++r<o;)n.remove(t[r])}function Le(e){return function(){qe(this,e)}}function Be(e){return function(){He(this,e)}}function Ue(e,t){return function(){(t.apply(this,arguments)?qe:He)(this,e)}}function ze(){this.textContent=""}function Ke(e){return function(){this.textContent=e}}function Fe(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function Ve(){this.innerHTML=""}function Ye(e){return function(){this.innerHTML=e}}function Ge(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function We(){this.nextSibling&&this.parentNode.appendChild(this)}function Ze(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Qe(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===me&&t.documentElement.namespaceURI===me?t.createElement(e):t.createElementNS(n,e)}}function Xe(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function Je(e){var t=we(e);return(t.local?Xe:Qe)(t)}function $e(){return null}function et(){var e=this.parentNode;e&&e.removeChild(this)}function tt(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function nt(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function rt(e){return function(){var t=this.__on;if(t){for(var n,r=0,o=-1,i=t.length;r<i;++r)n=t[r],e.type&&n.type!==e.type||n.name!==e.name?t[++o]=n:this.removeEventListener(n.type,n.listener,n.options);++o?t.length=o:delete this.__on}}}function ot(e,t,n){return function(){var r,o=this.__on,i=function(e){return function(t){e.call(this,t,this.__data__)}}(t);if(o)for(var a=0,c=o.length;a<c;++a)if((r=o[a]).type===e.type&&r.name===e.name)return this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=i,r.options=n),void(r.value=t);this.addEventListener(e.type,i,n),r={type:e.type,name:e.name,value:t,listener:i,options:n},o?o.push(r):this.__on=[r]}}function it(e,t,n){var r=_e(e),o=r.CustomEvent;"function"==typeof o?o=new o(t,n):(o=r.document.createEvent("Event"),n?(o.initEvent(t,n.bubbles,n.cancelable),o.detail=n.detail):o.initEvent(t,!1,!1)),e.dispatchEvent(o)}function at(e,t){return function(){return it(this,e,t)}}function ct(e,t){return function(){return it(this,e,t.apply(this,arguments))}}De.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var st=[null];function lt(e,t){this._groups=e,this._parents=t}function ut(){return new lt([[document.documentElement]],st)}lt.prototype=ut.prototype={constructor:lt,select:function(e){"function"!=typeof e&&(e=te(e));for(var t=this._groups,n=t.length,r=new Array(n),o=0;o<n;++o)for(var i,a,c=t[o],s=c.length,l=r[o]=new Array(s),u=0;u<s;++u)(i=c[u])&&(a=e.call(i,i.__data__,u,c))&&("__data__"in i&&(a.__data__=i.__data__),l[u]=a);return new lt(r,this._parents)},selectAll:function(e){e="function"==typeof e?function(e){return function(){return function(e){return null==e?[]:Array.isArray(e)?e:Array.from(e)}(e.apply(this,arguments))}}(e):re(e);for(var t=this._groups,n=t.length,r=[],o=[],i=0;i<n;++i)for(var a,c=t[i],s=c.length,l=0;l<s;++l)(a=c[l])&&(r.push(e.call(a,a.__data__,l,c)),o.push(a));return new lt(r,o)},selectChild:function(e){return this.select(null==e?ce:function(e){return function(){return ae.call(this.children,e)}}("function"==typeof e?e:ie(e)))},selectChildren:function(e){return this.selectAll(null==e?le:function(e){return function(){return se.call(this.children,e)}}("function"==typeof e?e:ie(e)))},filter:function(e){"function"!=typeof e&&(e=oe(e));for(var t=this._groups,n=t.length,r=new Array(n),o=0;o<n;++o)for(var i,a=t[o],c=a.length,s=r[o]=[],l=0;l<c;++l)(i=a[l])&&e.call(i,i.__data__,l,a)&&s.push(i);return new lt(r,this._parents)},data:function(e,t){if(!arguments.length)return Array.from(this,fe);var n=t?ge:he,r=this._parents,o=this._groups;"function"!=typeof e&&(e=function(e){return function(){return e}}(e));for(var i=o.length,a=new Array(i),c=new Array(i),s=new Array(i),l=0;l<i;++l){var u=r[l],d=o[l],h=d.length,g=pe(e.call(u,u&&u.__data__,l,r)),f=g.length,p=c[l]=new Array(f),v=a[l]=new Array(f);n(u,d,p,v,s[l]=new Array(h),g,t);for(var m,y,w=0,b=0;w<f;++w)if(m=p[w]){for(w>=b&&(b=w+1);!(y=v[b])&&++b<f;);m._next=y||null}}return(a=new lt(a,r))._enter=c,a._exit=s,a},enter:function(){return new lt(this._enter||this._groups.map(ue),this._parents)},exit:function(){return new lt(this._exit||this._groups.map(ue),this._parents)},join:function(e,t,n){var r=this.enter(),o=this,i=this.exit();return"function"==typeof e?(r=e(r))&&(r=r.selection()):r=r.append(e+""),null!=t&&(o=t(o))&&(o=o.selection()),null==n?i.remove():n(i),r&&o?r.merge(o).order():o},merge:function(e){for(var t=e.selection?e.selection():e,n=this._groups,r=t._groups,o=n.length,i=r.length,a=Math.min(o,i),c=new Array(o),s=0;s<a;++s)for(var l,u=n[s],d=r[s],h=u.length,g=c[s]=new Array(h),f=0;f<h;++f)(l=u[f]||d[f])&&(g[f]=l);for(;s<o;++s)c[s]=n[s];return new lt(c,this._parents)},selection:function(){return this},order:function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r,o=e[t],i=o.length-1,a=o[i];--i>=0;)(r=o[i])&&(a&&4^r.compareDocumentPosition(a)&&a.parentNode.insertBefore(r,a),a=r);return this},sort:function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=ve);for(var n=this._groups,r=n.length,o=new Array(r),i=0;i<r;++i){for(var a,c=n[i],s=c.length,l=o[i]=new Array(s),u=0;u<s;++u)(a=c[u])&&(l[u]=a);l.sort(t)}return new lt(o,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],o=0,i=r.length;o<i;++o){var a=r[o];if(a)return a}return null},size:function(){var e=0;for(var t of this)++e;return e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var o,i=t[n],a=0,c=i.length;a<c;++a)(o=i[a])&&e.call(o,o.__data__,a,i);return this},attr:function(e,t){var n=we(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==t?n.local?Ce:be:"function"==typeof t?n.local?Ee:Ie:n.local?Se:ke)(n,t))},style:function(e,t,n){return arguments.length>1?this.each((null==t?Te:"function"==typeof t?Ae:Oe)(e,t,null==n?"":n)):Pe(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?Me:"function"==typeof t?Ne:xe)(e,t)):this.node()[e]},classed:function(e,t){var n=Re(e+"");if(arguments.length<2){for(var r=je(this.node()),o=-1,i=n.length;++o<i;)if(!r.contains(n[o]))return!1;return!0}return this.each(("function"==typeof t?Ue:t?Le:Be)(n,t))},text:function(e){return arguments.length?this.each(null==e?ze:("function"==typeof e?Fe:Ke)(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?Ve:("function"==typeof e?Ge:Ye)(e)):this.node().innerHTML},raise:function(){return this.each(We)},lower:function(){return this.each(Ze)},append:function(e){var t="function"==typeof e?e:Je(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})},insert:function(e,t){var n="function"==typeof e?e:Je(e),r=null==t?$e:"function"==typeof t?t:te(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})},remove:function(){return this.each(et)},clone:function(e){return this.select(e?nt:tt)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,n){var r,o,i=function(e){return e.trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}})}(e+""),a=i.length;if(!(arguments.length<2)){for(c=t?ot:rt,r=0;r<a;++r)this.each(c(i[r],t,n));return this}var c=this.node().__on;if(c)for(var s,l=0,u=c.length;l<u;++l)for(r=0,s=c[l];r<a;++r)if((o=i[r]).type===s.type&&o.name===s.name)return s.value},dispatch:function(e,t){return this.each(("function"==typeof t?ct:at)(e,t))},[Symbol.iterator]:function*(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r,o=e[t],i=0,a=o.length;i<a;++i)(r=o[i])&&(yield r)}};const dt=ut;function ht(e){return"string"==typeof e?new lt([[document.querySelector(e)]],[document.documentElement]):new lt([[e]],st)}var gt={passive:!1},ft={capture:!0,passive:!1};function pt(e){e.stopImmediatePropagation()}function vt(e){e.preventDefault(),e.stopImmediatePropagation()}function mt(e){var t=e.document.documentElement,n=ht(e).on("dragstart.drag",vt,ft);"onselectstart"in t?n.on("selectstart.drag",vt,ft):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function yt(e,t){var n=e.document.documentElement,r=ht(e).on("dragstart.drag",null);t&&(r.on("click.drag",vt,ft),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}function wt(e){return((e=Math.exp(e))+1/e)/2}const bt=function e(t,n,r){function o(e,o){var i,a,c=e[0],s=e[1],l=e[2],u=o[0],d=o[1],h=o[2],g=u-c,f=d-s,p=g*g+f*f;if(p<1e-12)a=Math.log(h/l)/t,i=function(e){return[c+e*g,s+e*f,l*Math.exp(t*e*a)]};else{var v=Math.sqrt(p),m=(h*h-l*l+r*p)/(2*l*n*v),y=(h*h-l*l-r*p)/(2*h*n*v),w=Math.log(Math.sqrt(m*m+1)-m),b=Math.log(Math.sqrt(y*y+1)-y);a=(b-w)/t,i=function(e){var r=e*a,o=wt(w),i=l/(n*v)*(o*function(e){return((e=Math.exp(2*e))-1)/(e+1)}(t*r+w)-function(e){return((e=Math.exp(e))-1/e)/2}(w));return[c+i*g,s+i*f,l*o/wt(t*r+w)]}}return i.duration=1e3*a*t/Math.SQRT2,i}return o.rho=function(t){var n=Math.max(.001,+t),r=n*n;return e(n,r,r*r)},o}(Math.SQRT2,2,4);function Ct(e,t){if(e=function(e){for(var t;t=e.sourceEvent;)e=t;return e}(e),void 0===t&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,[(r=r.matrixTransform(t.getScreenCTM().inverse())).x,r.y]}if(t.getBoundingClientRect){var o=t.getBoundingClientRect();return[e.clientX-o.left-t.clientLeft,e.clientY-o.top-t.clientTop]}}return[e.pageX,e.pageY]}var kt,St,It=0,Et=0,_t=0,Tt=0,Ot=0,At=0,Pt="object"==typeof performance&&performance.now?performance:Date,Mt="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function xt(){return Ot||(Mt(Nt),Ot=Pt.now()+At)}function Nt(){Ot=0}function Rt(){this._call=this._time=this._next=null}function jt(e,t,n){var r=new Rt;return r.restart(e,t,n),r}function Dt(){Ot=(Tt=Pt.now())+At,It=Et=0;try{!function(){xt(),++It;for(var e,t=kt;t;)(e=Ot-t._time)>=0&&t._call.call(void 0,e),t=t._next;--It}()}finally{It=0,function(){for(var e,t,n=kt,r=1/0;n;)n._call?(r>n._time&&(r=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:kt=t);St=e,Ht(r)}(),Ot=0}}function qt(){var e=Pt.now(),t=e-Tt;t>1e3&&(At-=t,Tt=e)}function Ht(e){It||(Et&&(Et=clearTimeout(Et)),e-Ot>24?(e<1/0&&(Et=setTimeout(Dt,e-Pt.now()-At)),_t&&(_t=clearInterval(_t))):(_t||(Tt=Pt.now(),_t=setInterval(qt,1e3)),It=1,Mt(Dt)))}function Lt(e,t,n){var r=new Rt;return t=null==t?0:+t,r.restart(n=>{r.stop(),e(n+t)},t,n),r}Rt.prototype=jt.prototype={constructor:Rt,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?xt():+n)+(null==t?0:+t),this._next||St===this||(St?St._next=this:kt=this,St=this),this._call=e,this._time=n,Ht()},stop:function(){this._call&&(this._call=null,this._time=1/0,Ht())}};var Bt=$("start","end","cancel","interrupt"),Ut=[];function zt(e,t,n,r,o,i){var a=e.__transition;if(a){if(n in a)return}else e.__transition={};!function(e,t,n){var r,o=e.__transition;function i(s){var l,u,d,h;if(1!==n.state)return c();for(l in o)if((h=o[l]).name===n.name){if(3===h.state)return Lt(i);4===h.state?(h.state=6,h.timer.stop(),h.on.call("interrupt",e,e.__data__,h.index,h.group),delete o[l]):+l<t&&(h.state=6,h.timer.stop(),h.on.call("cancel",e,e.__data__,h.index,h.group),delete o[l])}if(Lt(function(){3===n.state&&(n.state=4,n.timer.restart(a,n.delay,n.time),a(s))}),n.state=2,n.on.call("start",e,e.__data__,n.index,n.group),2===n.state){for(n.state=3,r=new Array(d=n.tween.length),l=0,u=-1;l<d;++l)(h=n.tween[l].value.call(e,e.__data__,n.index,n.group))&&(r[++u]=h);r.length=u+1}}function a(t){for(var o=t<n.duration?n.ease.call(null,t/n.duration):(n.timer.restart(c),n.state=5,1),i=-1,a=r.length;++i<a;)r[i].call(e,o);5===n.state&&(n.on.call("end",e,e.__data__,n.index,n.group),c())}function c(){for(var r in n.state=6,n.timer.stop(),delete o[t],o)return;delete e.__transition}o[t]=n,n.timer=jt(function(e){n.state=1,n.timer.restart(i,n.delay,n.time),n.delay<=e&&i(e-n.delay)},0,n.time)}(e,n,{name:t,index:r,group:o,on:Bt,tween:Ut,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:0})}function Kt(e,t){var n=Vt(e,t);if(n.state>0)throw new Error("too late; already scheduled");return n}function Ft(e,t){var n=Vt(e,t);if(n.state>3)throw new Error("too late; already running");return n}function Vt(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function Yt(e,t){var n,r,o,i=e.__transition,a=!0;if(i){for(o in t=null==t?null:t+"",i)(n=i[o]).name===t?(r=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(r?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete i[o]):a=!1;a&&delete e.__transition}}function Gt(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var Wt,Zt=180/Math.PI,Qt={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Xt(e,t,n,r,o,i){var a,c,s;return(a=Math.sqrt(e*e+t*t))&&(e/=a,t/=a),(s=e*n+t*r)&&(n-=e*s,r-=t*s),(c=Math.sqrt(n*n+r*r))&&(n/=c,r/=c,s/=c),e*r<t*n&&(e=-e,t=-t,s=-s,a=-a),{translateX:o,translateY:i,rotate:Math.atan2(t,e)*Zt,skewX:Math.atan(s)*Zt,scaleX:a,scaleY:c}}function Jt(e,t,n,r){function o(e){return e.length?e.pop()+" ":""}return function(i,a){var c=[],s=[];return i=e(i),a=e(a),function(e,r,o,i,a,c){if(e!==o||r!==i){var s=a.push("translate(",null,t,null,n);c.push({i:s-4,x:Gt(e,o)},{i:s-2,x:Gt(r,i)})}else(o||i)&&a.push("translate("+o+t+i+n)}(i.translateX,i.translateY,a.translateX,a.translateY,c,s),function(e,t,n,i){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),i.push({i:n.push(o(n)+"rotate(",null,r)-2,x:Gt(e,t)})):t&&n.push(o(n)+"rotate("+t+r)}(i.rotate,a.rotate,c,s),function(e,t,n,i){e!==t?i.push({i:n.push(o(n)+"skewX(",null,r)-2,x:Gt(e,t)}):t&&n.push(o(n)+"skewX("+t+r)}(i.skewX,a.skewX,c,s),function(e,t,n,r,i,a){if(e!==n||t!==r){var c=i.push(o(i)+"scale(",null,",",null,")");a.push({i:c-4,x:Gt(e,n)},{i:c-2,x:Gt(t,r)})}else 1===n&&1===r||i.push(o(i)+"scale("+n+","+r+")")}(i.scaleX,i.scaleY,a.scaleX,a.scaleY,c,s),i=a=null,function(e){for(var t,n=-1,r=s.length;++n<r;)c[(t=s[n]).i]=t.x(e);return c.join("")}}}var $t=Jt(function(e){var t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?Qt:Xt(t.a,t.b,t.c,t.d,t.e,t.f)},"px, ","px)","deg)"),en=Jt(function(e){return null==e?Qt:(Wt||(Wt=document.createElementNS("http://www.w3.org/2000/svg","g")),Wt.setAttribute("transform",e),(e=Wt.transform.baseVal.consolidate())?Xt((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):Qt)},", ",")",")");function tn(e,t){var n,r;return function(){var o=Ft(this,e),i=o.tween;if(i!==n)for(var a=0,c=(r=n=i).length;a<c;++a)if(r[a].name===t){(r=r.slice()).splice(a,1);break}o.tween=r}}function nn(e,t,n){var r,o;if("function"!=typeof n)throw new Error;return function(){var i=Ft(this,e),a=i.tween;if(a!==r){o=(r=a).slice();for(var c={name:t,value:n},s=0,l=o.length;s<l;++s)if(o[s].name===t){o[s]=c;break}s===l&&o.push(c)}i.tween=o}}function rn(e,t,n){var r=e._id;return e.each(function(){var e=Ft(this,r);(e.value||(e.value={}))[t]=n.apply(this,arguments)}),function(e){return Vt(e,r).value[t]}}function on(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function an(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function cn(){}var sn=.7,ln=1/sn,un="\\s*([+-]?\\d+)\\s*",dn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",hn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",gn=/^#([0-9a-f]{3,8})$/,fn=new RegExp("^rgb\\(".concat(un,",").concat(un,",").concat(un,"\\)$")),pn=new RegExp("^rgb\\(".concat(hn,",").concat(hn,",").concat(hn,"\\)$")),vn=new RegExp("^rgba\\(".concat(un,",").concat(un,",").concat(un,",").concat(dn,"\\)$")),mn=new RegExp("^rgba\\(".concat(hn,",").concat(hn,",").concat(hn,",").concat(dn,"\\)$")),yn=new RegExp("^hsl\\(".concat(dn,",").concat(hn,",").concat(hn,"\\)$")),wn=new RegExp("^hsla\\(".concat(dn,",").concat(hn,",").concat(hn,",").concat(dn,"\\)$")),bn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Cn(){return this.rgb().formatHex()}function kn(){return this.rgb().formatRgb()}function Sn(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=gn.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?In(t):3===n?new Tn(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?En(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?En(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=fn.exec(e))?new Tn(t[1],t[2],t[3],1):(t=pn.exec(e))?new Tn(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=vn.exec(e))?En(t[1],t[2],t[3],t[4]):(t=mn.exec(e))?En(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=yn.exec(e))?Nn(t[1],t[2]/100,t[3]/100,1):(t=wn.exec(e))?Nn(t[1],t[2]/100,t[3]/100,t[4]):bn.hasOwnProperty(e)?In(bn[e]):"transparent"===e?new Tn(NaN,NaN,NaN,0):null}function In(e){return new Tn(e>>16&255,e>>8&255,255&e,1)}function En(e,t,n,r){return r<=0&&(e=t=n=NaN),new Tn(e,t,n,r)}function _n(e,t,n,r){return 1===arguments.length?((o=e)instanceof cn||(o=Sn(o)),o?new Tn((o=o.rgb()).r,o.g,o.b,o.opacity):new Tn):new Tn(e,t,n,null==r?1:r);var o}function Tn(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function On(){return"#".concat(xn(this.r)).concat(xn(this.g)).concat(xn(this.b))}function An(){var e=Pn(this.opacity);return"".concat(1===e?"rgb(":"rgba(").concat(Mn(this.r),", ").concat(Mn(this.g),", ").concat(Mn(this.b)).concat(1===e?")":", ".concat(e,")"))}function Pn(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Mn(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function xn(e){return((e=Mn(e))<16?"0":"")+e.toString(16)}function Nn(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new jn(e,t,n,r)}function Rn(e){if(e instanceof jn)return new jn(e.h,e.s,e.l,e.opacity);if(e instanceof cn||(e=Sn(e)),!e)return new jn;if(e instanceof jn)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,o=Math.min(t,n,r),i=Math.max(t,n,r),a=NaN,c=i-o,s=(i+o)/2;return c?(a=t===i?(n-r)/c+6*(n<r):n===i?(r-t)/c+2:(t-n)/c+4,c/=s<.5?i+o:2-i-o,a*=60):c=s>0&&s<1?0:a,new jn(a,c,s,e.opacity)}function jn(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function Dn(e){return(e=(e||0)%360)<0?e+360:e}function qn(e){return Math.max(0,Math.min(1,e||0))}function Hn(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function Ln(e,t,n,r,o){var i=e*e,a=i*e;return((1-3*e+3*i-a)*t+(4-6*i+3*a)*n+(1+3*e+3*i-3*a)*r+a*o)/6}on(cn,Sn,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Cn,formatHex:Cn,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return Rn(this).formatHsl()},formatRgb:kn,toString:kn}),on(Tn,_n,an(cn,{brighter(e){return e=null==e?ln:Math.pow(ln,e),new Tn(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?sn:Math.pow(sn,e),new Tn(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Tn(Mn(this.r),Mn(this.g),Mn(this.b),Pn(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:On,formatHex:On,formatHex8:function(){return"#".concat(xn(this.r)).concat(xn(this.g)).concat(xn(this.b)).concat(xn(255*(isNaN(this.opacity)?1:this.opacity)))},formatRgb:An,toString:An})),on(jn,function(e,t,n,r){return 1===arguments.length?Rn(e):new jn(e,t,n,null==r?1:r)},an(cn,{brighter(e){return e=null==e?ln:Math.pow(ln,e),new jn(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?sn:Math.pow(sn,e),new jn(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,o=2*n-r;return new Tn(Hn(e>=240?e-240:e+120,o,r),Hn(e,o,r),Hn(e<120?e+240:e-120,o,r),this.opacity)},clamp(){return new jn(Dn(this.h),qn(this.s),qn(this.l),Pn(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){var e=Pn(this.opacity);return"".concat(1===e?"hsl(":"hsla(").concat(Dn(this.h),", ").concat(100*qn(this.s),"%, ").concat(100*qn(this.l),"%").concat(1===e?")":", ".concat(e,")"))}}));const Bn=e=>()=>e;function Un(e,t){var n=t-e;return n?function(e,t){return function(n){return e+n*t}}(e,n):Bn(isNaN(e)?t:e)}const zn=function e(t){var n=function(e){return 1===(e=+e)?Un:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):Bn(isNaN(t)?n:t)}}(t);function r(e,t){var r=n((e=_n(e)).r,(t=_n(t)).r),o=n(e.g,t.g),i=n(e.b,t.b),a=Un(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=o(t),e.b=i(t),e.opacity=a(t),e+""}}return r.gamma=e,r}(1);function Kn(e){return function(t){var n,r,o=t.length,i=new Array(o),a=new Array(o),c=new Array(o);for(n=0;n<o;++n)r=_n(t[n]),i[n]=r.r||0,a[n]=r.g||0,c[n]=r.b||0;return i=e(i),a=e(a),c=e(c),r.opacity=1,function(e){return r.r=i(e),r.g=a(e),r.b=c(e),r+""}}}Kn(function(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),o=e[r],i=e[r+1],a=r>0?e[r-1]:2*o-i,c=r<t-1?e[r+2]:2*i-o;return Ln((n-r/t)*t,a,o,i,c)}}),Kn(function(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),o=e[(r+t-1)%t],i=e[r%t],a=e[(r+1)%t],c=e[(r+2)%t];return Ln((n-r/t)*t,o,i,a,c)}});var Fn=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Vn=new RegExp(Fn.source,"g");function Yn(e,t){var n,r,o,i=Fn.lastIndex=Vn.lastIndex=0,a=-1,c=[],s=[];for(e+="",t+="";(n=Fn.exec(e))&&(r=Vn.exec(t));)(o=r.index)>i&&(o=t.slice(i,o),c[a]?c[a]+=o:c[++a]=o),(n=n[0])===(r=r[0])?c[a]?c[a]+=r:c[++a]=r:(c[++a]=null,s.push({i:a,x:Gt(n,r)})),i=Vn.lastIndex;return i<t.length&&(o=t.slice(i),c[a]?c[a]+=o:c[++a]=o),c.length<2?s[0]?function(e){return function(t){return e(t)+""}}(s[0].x):function(e){return function(){return e}}(t):(t=s.length,function(e){for(var n,r=0;r<t;++r)c[(n=s[r]).i]=n.x(e);return c.join("")})}function Gn(e,t){var n;return("number"==typeof t?Gt:t instanceof Sn?zn:(n=Sn(t))?(t=n,zn):Yn)(e,t)}function Wn(e){return function(){this.removeAttribute(e)}}function Zn(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Qn(e,t,n){var r,o,i=n+"";return function(){var a=this.getAttribute(e);return a===i?null:a===r?o:o=t(r=a,n)}}function Xn(e,t,n){var r,o,i=n+"";return function(){var a=this.getAttributeNS(e.space,e.local);return a===i?null:a===r?o:o=t(r=a,n)}}function Jn(e,t,n){var r,o,i;return function(){var a,c,s=n(this);if(null!=s)return(a=this.getAttribute(e))===(c=s+"")?null:a===r&&c===o?i:(o=c,i=t(r=a,s));this.removeAttribute(e)}}function $n(e,t,n){var r,o,i;return function(){var a,c,s=n(this);if(null!=s)return(a=this.getAttributeNS(e.space,e.local))===(c=s+"")?null:a===r&&c===o?i:(o=c,i=t(r=a,s));this.removeAttributeNS(e.space,e.local)}}function er(e,t){var n,r;function o(){var o=t.apply(this,arguments);return o!==r&&(n=(r=o)&&function(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}(e,o)),n}return o._value=t,o}function tr(e,t){var n,r;function o(){var o=t.apply(this,arguments);return o!==r&&(n=(r=o)&&function(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}(e,o)),n}return o._value=t,o}function nr(e,t){return function(){Kt(this,e).delay=+t.apply(this,arguments)}}function rr(e,t){return t=+t,function(){Kt(this,e).delay=t}}function or(e,t){return function(){Ft(this,e).duration=+t.apply(this,arguments)}}function ir(e,t){return t=+t,function(){Ft(this,e).duration=t}}var ar=dt.prototype.constructor;function cr(e){return function(){this.style.removeProperty(e)}}var sr=0;function lr(e,t,n,r){this._groups=e,this._parents=t,this._name=n,this._id=r}function ur(){return++sr}var dr=dt.prototype;lr.prototype=function(e){return dt().transition(e)}.prototype={constructor:lr,select:function(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=te(e));for(var r=this._groups,o=r.length,i=new Array(o),a=0;a<o;++a)for(var c,s,l=r[a],u=l.length,d=i[a]=new Array(u),h=0;h<u;++h)(c=l[h])&&(s=e.call(c,c.__data__,h,l))&&("__data__"in c&&(s.__data__=c.__data__),d[h]=s,zt(d[h],t,n,h,d,Vt(c,n)));return new lr(i,this._parents,t,n)},selectAll:function(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=re(e));for(var r=this._groups,o=r.length,i=[],a=[],c=0;c<o;++c)for(var s,l=r[c],u=l.length,d=0;d<u;++d)if(s=l[d]){for(var h,g=e.call(s,s.__data__,d,l),f=Vt(s,n),p=0,v=g.length;p<v;++p)(h=g[p])&&zt(h,t,n,p,g,f);i.push(g),a.push(s)}return new lr(i,a,t,n)},selectChild:dr.selectChild,selectChildren:dr.selectChildren,filter:function(e){"function"!=typeof e&&(e=oe(e));for(var t=this._groups,n=t.length,r=new Array(n),o=0;o<n;++o)for(var i,a=t[o],c=a.length,s=r[o]=[],l=0;l<c;++l)(i=a[l])&&e.call(i,i.__data__,l,a)&&s.push(i);return new lr(r,this._parents,this._name,this._id)},merge:function(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,r=t.length,o=n.length,i=Math.min(r,o),a=new Array(r),c=0;c<i;++c)for(var s,l=t[c],u=n[c],d=l.length,h=a[c]=new Array(d),g=0;g<d;++g)(s=l[g]||u[g])&&(h[g]=s);for(;c<r;++c)a[c]=t[c];return new lr(a,this._parents,this._name,this._id)},selection:function(){return new ar(this._groups,this._parents)},transition:function(){for(var e=this._name,t=this._id,n=ur(),r=this._groups,o=r.length,i=0;i<o;++i)for(var a,c=r[i],s=c.length,l=0;l<s;++l)if(a=c[l]){var u=Vt(a,t);zt(a,e,n,l,c,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new lr(r,this._parents,e,n)},call:dr.call,nodes:dr.nodes,node:dr.node,size:dr.size,empty:dr.empty,each:dr.each,on:function(e,t){var n=this._id;return arguments.length<2?Vt(this.node(),n).on.on(e):this.each(function(e,t,n){var r,o,i=function(e){return(e+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||"start"===e})}(t)?Kt:Ft;return function(){var a=i(this,e),c=a.on;c!==r&&(o=(r=c).copy()).on(t,n),a.on=o}}(n,e,t))},attr:function(e,t){var n=we(e),r="transform"===n?en:Gn;return this.attrTween(e,"function"==typeof t?(n.local?$n:Jn)(n,r,rn(this,"attr."+e,t)):null==t?(n.local?Zn:Wn)(n):(n.local?Xn:Qn)(n,r,t))},attrTween:function(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==t)return this.tween(n,null);if("function"!=typeof t)throw new Error;var r=we(e);return this.tween(n,(r.local?er:tr)(r,t))},style:function(e,t,n){var r="transform"==(e+="")?$t:Gn;return null==t?this.styleTween(e,function(e,t){var n,r,o;return function(){var i=Pe(this,e),a=(this.style.removeProperty(e),Pe(this,e));return i===a?null:i===n&&a===r?o:o=t(n=i,r=a)}}(e,r)).on("end.style."+e,cr(e)):"function"==typeof t?this.styleTween(e,function(e,t,n){var r,o,i;return function(){var a=Pe(this,e),c=n(this),s=c+"";return null==c&&(this.style.removeProperty(e),s=c=Pe(this,e)),a===s?null:a===r&&s===o?i:(o=s,i=t(r=a,c))}}(e,r,rn(this,"style."+e,t))).each(function(e,t){var n,r,o,i,a="style."+t,c="end."+a;return function(){var s=Ft(this,e),l=s.on,u=null==s.value[a]?i||(i=cr(t)):void 0;l===n&&o===u||(r=(n=l).copy()).on(c,o=u),s.on=r}}(this._id,e)):this.styleTween(e,function(e,t,n){var r,o,i=n+"";return function(){var a=Pe(this,e);return a===i?null:a===r?o:o=t(r=a,n)}}(e,r,t),n).on("end.style."+e,null)},styleTween:function(e,t,n){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==t)return this.tween(r,null);if("function"!=typeof t)throw new Error;return this.tween(r,function(e,t,n){var r,o;function i(){var i=t.apply(this,arguments);return i!==o&&(r=(o=i)&&function(e,t,n){return function(r){this.style.setProperty(e,t.call(this,r),n)}}(e,i,n)),r}return i._value=t,i}(e,t,null==n?"":n))},text:function(e){return this.tween("text","function"==typeof e?function(e){return function(){var t=e(this);this.textContent=null==t?"":t}}(rn(this,"text",e)):function(e){return function(){this.textContent=e}}(null==e?"":e+""))},textTween:function(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(null==e)return this.tween(t,null);if("function"!=typeof e)throw new Error;return this.tween(t,function(e){var t,n;function r(){var r=e.apply(this,arguments);return r!==n&&(t=(n=r)&&function(e){return function(t){this.textContent=e.call(this,t)}}(r)),t}return r._value=e,r}(e))},remove:function(){return this.on("end.remove",function(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}(this._id))},tween:function(e,t){var n=this._id;if(e+="",arguments.length<2){for(var r,o=Vt(this.node(),n).tween,i=0,a=o.length;i<a;++i)if((r=o[i]).name===e)return r.value;return null}return this.each((null==t?tn:nn)(n,e,t))},delay:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?nr:rr)(t,e)):Vt(this.node(),t).delay},duration:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?or:ir)(t,e)):Vt(this.node(),t).duration},ease:function(e){var t=this._id;return arguments.length?this.each(function(e,t){if("function"!=typeof t)throw new Error;return function(){Ft(this,e).ease=t}}(t,e)):Vt(this.node(),t).ease},easeVarying:function(e){if("function"!=typeof e)throw new Error;return this.each(function(e,t){return function(){var n=t.apply(this,arguments);if("function"!=typeof n)throw new Error;Ft(this,e).ease=n}}(this._id,e))},end:function(){var e,t,n=this,r=n._id,o=n.size();return new Promise(function(i,a){var c={value:a},s={value:function(){0===--o&&i()}};n.each(function(){var n=Ft(this,r),o=n.on;o!==e&&((t=(e=o).copy())._.cancel.push(c),t._.interrupt.push(c),t._.end.push(s)),n.on=t}),0===o&&i()})},[Symbol.iterator]:dr[Symbol.iterator]};var hr={time:null,delay:0,duration:250,ease:function(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}};function gr(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error("transition ".concat(t," not found"));return n}dt.prototype.interrupt=function(e){return this.each(function(){Yt(this,e)})},dt.prototype.transition=function(e){var t,n;e instanceof lr?(t=e._id,e=e._name):(t=ur(),(n=hr).time=xt(),e=null==e?null:e+"");for(var r=this._groups,o=r.length,i=0;i<o;++i)for(var a,c=r[i],s=c.length,l=0;l<s;++l)(a=c[l])&&zt(a,e,t,l,c,n||gr(a,t));return new lr(r,this._parents,e,t)};const fr=e=>()=>e;function pr(e,t){var{sourceEvent:n,target:r,transform:o,dispatch:i}=t;Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},transform:{value:o,enumerable:!0,configurable:!0},_:{value:i}})}function vr(e,t,n){this.k=e,this.x=t,this.y=n}vr.prototype={constructor:vr,scale:function(e){return 1===e?this:new vr(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new vr(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var mr,yr,wr,br,Cr,kr,Sr=new vr(1,0,0);function Ir(e){e.stopImmediatePropagation()}function Er(e){e.preventDefault(),e.stopImmediatePropagation()}function _r(e){return!(e.ctrlKey&&"wheel"!==e.type||e.button)}function Tr(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e).hasAttribute("viewBox")?[[(e=e.viewBox.baseVal).x,e.y],[e.x+e.width,e.y+e.height]]:[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]:[[0,0],[e.clientWidth,e.clientHeight]]}function Or(){return this.__zoom||Sr}function Ar(e){return-e.deltaY*(1===e.deltaMode?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function Pr(){return navigator.maxTouchPoints||"ontouchstart"in this}function Mr(e,t,n){var r=e.invertX(t[0][0])-n[0][0],o=e.invertX(t[1][0])-n[1][0],i=e.invertY(t[0][1])-n[0][1],a=e.invertY(t[1][1])-n[1][1];return e.translate(o>r?(r+o)/2:Math.min(0,r)||Math.max(0,o),a>i?(i+a)/2:Math.min(0,i)||Math.max(0,a))}function xr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Nr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Rr(e,t){if(e){if("string"==typeof e)return Nr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Nr(e,t):void 0}}function jr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(e,t)||Rr(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}vr.prototype,function(e){e.Strict="strict",e.Loose="loose"}(mr||(mr={})),function(e){e.Lines="lines",e.Dots="dots"}(yr||(yr={})),function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"}(wr||(wr={})),function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"}(br||(br={})),function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"}(Cr||(Cr={})),function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"}(kr||(kr={}));var Dr=function(e){return{width:e.offsetWidth,height:e.offsetHeight}},qr=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(Math.max(e,t),n)},Hr=function(e,t){return{x:qr(e.x,t[0][0],t[1][0]),y:qr(e.y,t[0][1],t[1][1])}},Lr=function(e){var t,n;return(null===(t=e.getRootNode)||void 0===t?void 0:t.call(e))||(null===(n=window)||void 0===n?void 0:n.document)},Br=function(e,t){return{x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}},Ur=function(e){var t=e.x,n=e.y;return{x:t,y:n,x2:t+e.width,y2:n+e.height}},zr=function(e){var t=e.x,n=e.y;return{x:t,y:n,width:e.x2-t,height:e.y2-n}},Kr=function(e){return!isNaN(e)&&isFinite(e)},Fr=Symbol("internals");function Vr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Yr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Vr(Object(n),!0).forEach(function(t){xr(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Vr(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Gr(e,t){var n=e.find(function(e){return e.id===t.parentNode});if(n){var r=t.position.x+t.width-n.width,o=t.position.y+t.height-n.height;if(r>0||o>0||t.position.x<0||t.position.y<0){var i,a;if(n.style=Yr({},n.style)||{},n.style.width=null!==(i=n.style.width)&&void 0!==i?i:n.width,n.style.height=null!==(a=n.style.height)&&void 0!==a?a:n.height,r>0&&(n.style.width+=r),o>0&&(n.style.height+=o),t.position.x<0){var c=Math.abs(t.position.x);n.position.x=n.position.x-c,n.style.width+=c,t.position.x=0}if(t.position.y<0){var s=Math.abs(t.position.y);n.position.y=n.position.y-s,n.style.height+=s,t.position.y=0}n.width=n.style.width,n.height=n.style.height}}}function Wr(e,t){if(e.some(function(e){return"reset"===e.type}))return e.filter(function(e){return"reset"===e.type}).map(function(e){return e.item});var n=e.filter(function(e){return"add"===e.type}).map(function(e){return e.item});return t.reduce(function(t,n){var r=e.find(function(e){return e.id===n.id});if(r)switch(r.type){case"select":return t.push(Yr(Yr({},n),{},{selected:r.selected})),t;case"position":var o=Yr({},n);return void 0!==r.position&&(o.position=r.position),void 0!==r.positionAbsolute&&(o.positionAbsolute=r.positionAbsolute),void 0!==r.dragging&&(o.dragging=r.dragging),o.expandParent&&Gr(t,o),t.push(o),t;case"dimensions":var i=Yr({},n);return void 0!==r.dimensions&&(i.width=r.dimensions.width,i.height=r.dimensions.height),i.expandParent&&Gr(t,i),t.push(i),t;case"remove":return t}return t.push(n),t},n)}function Zr(e,t){return Wr(e,t)}var Qr=function(e,t){return{id:e,type:"select",selected:t}};function Xr(e,t){return e.reduce(function(e,n){var r=t.includes(n.id);return!n.selected&&r?(n.selected=!0,e.push(Qr(n.id,!0))):n.selected&&!r&&(n.selected=!1,e.push(Qr(n.id,!1))),e},[])}function Jr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function $r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Jr(Object(n),!0).forEach(function(t){xr(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Jr(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var eo=function(e,t,n){var r=t.querySelectorAll(e);if(!r||!r.length)return null;var o=Array.from(r),i=t.getBoundingClientRect();return o.map(function(e){var t=e.getBoundingClientRect();return $r({id:e.getAttribute("data-handleid"),position:e.getAttribute("data-handlepos"),x:(t.left-i.left)/n,y:(t.top-i.top)/n},Dr(e))})};function to(e,t,n){return void 0===n?n:function(r){var o=t().nodeInternals.get(e);n(r,$r({},o))}}function no(e){var t=e.id,n=e.store,r=n.getState(),o=r.addSelectedNodes,i=r.unselectNodesAndEdges,a=r.multiSelectionActive,c=r.nodeInternals.get(t);n.setState({nodesSelectionActive:!1}),c.selected?c.selected&&a&&i({nodes:[c]}):o([t])}function ro(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function oo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ro(Object(n),!0).forEach(function(t){xr(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ro(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var io=function(e,t){if(void 0===e)return"";if("string"==typeof e)return e;var n=t?"".concat(t,"__"):"";return"".concat(n).concat(Object.keys(e).sort().map(function(t){return"".concat(t,"=").concat(e[t])}).join("&"))},ao=function(e,t){return e.source&&e.target?function(e,t){return t.some(function(t){return!(t.source!==e.source||t.target!==e.target||t.sourceHandle!==e.sourceHandle&&(t.sourceHandle||e.sourceHandle)||t.targetHandle!==e.targetHandle&&(t.targetHandle||e.targetHandle))})}(c="id"in(s=e)&&"source"in s&&"target"in s?oo({},e):oo(oo({},e),{},{id:(n=e,r=n.source,o=n.sourceHandle,i=n.target,a=n.targetHandle,"reactflow__edge-".concat(r).concat(o||"","-").concat(i).concat(a||""))}),t)?t:t.concat(c):t;var n,r,o,i,a,c,s},co=function(e,t,n,r){var o=e.x,i=e.y,a=jr(t,3),c=a[0],s=a[1],l=a[2],u=jr(r,2),d=u[0],h=u[1],g={x:(o-c)/l,y:(i-s)/l};return n?{x:d*Math.round(g.x/d),y:h*Math.round(g.y/h)}:g},so=function(e){if(0===e.length)return{x:0,y:0,width:0,height:0};var t=e.reduce(function(e,t){var n=t.positionAbsolute,r=t.position,o=t.width,i=t.height;return Br(e,Ur({x:n?n.x:r.x,y:n?n.y:r.y,width:o||0,height:i||0}))},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return zr(t)},lo=function(e,t){var n=jr(arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,1],3),r=n[0],o=n[1],i=n[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=Ur({x:(t.x-r)/i,y:(t.y-o)/i,width:t.width/i,height:t.height/i}),l=[];return e.forEach(function(e){var t=e.positionAbsolute,n=e.width,r=e.height,o=e.selectable;if(c&&void 0!==o&&!o)return!1;var i=Ur(oo(oo({},t),{},{width:n||0,height:r||0})),u=Math.max(0,Math.min(s.x2,i.x2)-Math.max(s.x,i.x)),d=Math.max(0,Math.min(s.y2,i.y2)-Math.max(s.y,i.y)),h=Math.ceil(u*d);(void 0===n||void 0===r||null===n||null===r||a&&h>0||h>=(n||0)*(r||0))&&l.push(e)}),l},uo=function(e,t){var n=e.map(function(e){return e.id});return t.filter(function(e){return n.includes(e.source)||n.includes(e.target)})},ho=function(e,t,n,r,o){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.1,a=t/(e.width*(1+i)),c=n/(e.height*(1+i)),s=Math.min(a,c),l=qr(s,r,o);return[t/2-(e.x+e.width/2)*l,n/2-(e.y+e.height/2)*l,l]},go=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.transition().duration(t)};function fo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function po(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fo(Object(n),!0).forEach(function(t){xr(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fo(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function vo(e,t,n,r){var o,i,a,c,s,l,u,d,h,g,f,p;if(!e.parentNode)return r;var v=t.get(e.parentNode);return vo(v,t,n,{x:(null!==(o=r.x)&&void 0!==o?o:0)+(null!==(i=null===(a=v.position)||void 0===a?void 0:a.x)&&void 0!==i?i:0),y:(null!==(c=r.y)&&void 0!==c?c:0)+(null!==(s=null===(l=v.position)||void 0===l?void 0:l.y)&&void 0!==s?s:0),z:(null!==(u=null===(d=v[Fr])||void 0===d?void 0:d.z)&&void 0!==u?u:0)>(null!==(h=r.z)&&void 0!==h?h:0)?null!==(g=null===(f=v[Fr])||void 0===f?void 0:f.z)&&void 0!==g?g:0:null!==(p=r.z)&&void 0!==p?p:0})}function mo(e,t){var n=new Map,r={};return e.forEach(function(e){var o,i=Kr(e.zIndex)?e.zIndex:e.selected?1e3:0,a=t.get(e.id),c=po(po({width:null==a?void 0:a.width,height:null==a?void 0:a.height},e),{},{positionAbsolute:{x:e.position.x,y:e.position.y}});e.parentNode&&(c.parentNode=e.parentNode,r[e.parentNode]=!0),Object.defineProperty(c,Fr,{enumerable:!1,value:{handleBounds:null==a||null===(o=a[Fr])||void 0===o?void 0:o.handleBounds,z:i}}),n.set(e.id,c)}),n.forEach(function(e){if(e.parentNode&&!n.has(e.parentNode))throw new Error("Parent node ".concat(e.parentNode," not found"));if(e.parentNode||r[e.id]){var t,o,i=vo(e,n,r,po(po({},e.position),{},{z:null!==(t=null===(o=e[Fr])||void 0===o?void 0:o.z)&&void 0!==t?t:0})),a=i.x,c=i.y,s=i.z;e.positionAbsolute={x:a,y:c},e[Fr].z=s,r[e.id]&&(e[Fr].isParent=!0)}}),n}function yo(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e(),r=n.nodeInternals,o=n.width,i=n.height,a=n.minZoom,c=n.maxZoom,s=n.d3Zoom,l=n.d3Selection,u=n.fitViewOnInitDone,d=n.fitViewOnInit;if((t.initial&&!u&&d||!t.initial)&&s&&l){var h=Array.from(r.values()).filter(function(e){return t.includeHiddenNodes?e.width&&e.height:!e.hidden}),g=h.every(function(e){return e.width&&e.height});if(h.length>0&&g){var f,p,v,m=so(h),y=jr(ho(m,o,i,null!==(f=t.minZoom)&&void 0!==f?f:a,null!==(p=t.maxZoom)&&void 0!==p?p:c,null!==(v=t.padding)&&void 0!==v?v:.1),3),w=y[0],b=y[1],C=y[2],k=Sr.translate(w,b).scale(C);return"number"==typeof t.duration&&t.duration>0?s.transform(go(l,t.duration),k):s.transform(l,k),!0}}return!1}function wo(e,t){return e.forEach(function(e){var n,r=t.get(e.id);r&&t.set(r.id,po(po({},r),{},(xr(n={},Fr,r[Fr]),xr(n,"selected",e.selected),n)))}),new Map(t)}function bo(e,t){return t.map(function(t){var n=e.find(function(e){return e.id===t.id});return n&&(t.selected=n.selected),t})}function Co(e){var t=e.changedNodes,n=e.changedEdges,r=e.get,o=e.set,i=r(),a=i.nodeInternals,c=i.edges,s=i.onNodesChange,l=i.onEdgesChange,u=i.hasDefaultNodes,d=i.hasDefaultEdges;null!=t&&t.length&&(u&&o({nodeInternals:wo(t,a)}),null==s||s(t)),null!=n&&n.length&&(d&&o({edges:bo(n,c)}),null==l||l(n))}var ko=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],So={width:0,height:0,transform:[0,0,1],nodeInternals:new Map,edges:[],onNodesChange:null,onEdgesChange:null,hasDefaultNodes:!1,hasDefaultEdges:!1,d3Zoom:null,d3Selection:null,d3ZoomHandler:void 0,minZoom:.5,maxZoom:2,translateExtent:ko,nodeExtent:ko,nodesSelectionActive:!1,userSelectionActive:!1,connectionNodeId:null,connectionHandleId:null,connectionHandleType:"source",connectionPosition:{x:0,y:0},connectionMode:mr.Strict,domNode:null,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,elementsSelectable:!0,fitViewOnInit:!1,fitViewOnInitDone:!1,fitViewOnInitOptions:void 0,multiSelectionActive:!1,reactFlowVersion:"10.3.17",connectionStartHandle:null,connectOnClick:!0};function Io(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Eo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Io(Object(n),!0).forEach(function(t){xr(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Io(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var _o,To=(_o=(0,n.createContext)(void 0),{Provider:e=>{var{initialStore:t,createStore:r,children:o}=e,i=(0,n.useRef)();return i.current||(t&&(console.warn("Provider initialStore is deprecated and will be removed in the next version."),r||(r=()=>t)),i.current=r()),(0,n.createElement)(_o.Provider,{value:i.current},o)},useStore:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object.is,r=(0,n.useContext)(_o);if(!r)throw new Error("Seems like you have not used zustand provider as an ancestor.");return r(e,t)},useStoreApi:()=>{var e=(0,n.useContext)(_o);if(!e)throw new Error("Seems like you have not used zustand provider as an ancestor.");return(0,n.useMemo)(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe,destroy:e.destroy}),[e])}}),Oo=To.Provider,Ao=To.useStore,Po=To.useStoreApi,Mo=function(){return G(function(e,t){return Eo(Eo({},So),{},{setNodes:function(n){e({nodeInternals:mo(n,t().nodeInternals)})},setEdges:function(n){var r=t().defaultEdgeOptions,o=void 0===r?{}:r;e({edges:n.map(function(e){return Eo(Eo({},o),e)})})},setDefaultNodesAndEdges:function(t,n){var r=void 0!==t,o=void 0!==n,i=r?mo(t,new Map):new Map;e({nodeInternals:i,edges:o?n:[],hasDefaultNodes:r,hasDefaultEdges:o})},updateNodeDimensions:function(n){var r=t(),o=r.onNodesChange,i=r.nodeInternals,a=r.fitViewOnInit,c=r.fitViewOnInitDone,s=r.fitViewOnInitOptions,l=r.domNode,u=null==l?void 0:l.querySelector(".react-flow__viewport");if(u){var d=window.getComputedStyle(u),h=new window.DOMMatrixReadOnly(d.transform).m22,g=n.reduce(function(e,t){var n=i.get(t.id);if(n){var r=Dr(t.nodeElement);r.width&&r.height&&(n.width!==r.width||n.height!==r.height||t.forceUpdate)&&(i.set(n.id,Eo(Eo({},n),{},xr({},Fr,Eo(Eo({},n[Fr]),{},{handleBounds:{source:eo(".source",t.nodeElement,h),target:eo(".target",t.nodeElement,h)}})),r)),e.push({id:n.id,type:"dimensions",dimensions:r}))}return e},[]),f=c||a&&!c&&yo(t,Eo({initial:!0},s));e({nodeInternals:new Map(i),fitViewOnInitDone:f}),(null==g?void 0:g.length)>0&&(null==o||o(g))}},updateNodePositions:function(n){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=t(),a=i.onNodesChange,c=i.nodeInternals,s=i.hasDefaultNodes;if(s||a){var l=n.map(function(e){var t={id:e.id,type:"position",dragging:o};return r&&(t.positionAbsolute=e.positionAbsolute,t.position=e.position),t});if(null!=l&&l.length){if(s){var u=mo(Zr(l,Array.from(c.values())),c);e({nodeInternals:u})}null==a||a(l)}}},addSelectedNodes:function(n){var r,o=t(),i=o.multiSelectionActive,a=o.nodeInternals,c=o.edges,s=null;i?r=n.map(function(e){return Qr(e,!0)}):(r=Xr(Array.from(a.values()),n),s=Xr(c,[])),Co({changedNodes:r,changedEdges:s,get:t,set:e})},addSelectedEdges:function(n){var r,o=t(),i=o.multiSelectionActive,a=o.edges,c=o.nodeInternals,s=null;i?r=n.map(function(e){return Qr(e,!0)}):(r=Xr(a,n),s=Xr(Array.from(c.values()),[])),Co({changedNodes:s,changedEdges:r,get:t,set:e})},unselectNodesAndEdges:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.nodes,o=n.edges,i=t(),a=i.nodeInternals,c=i.edges,s=o||c;Co({changedNodes:(r||Array.from(a.values())).map(function(e){return e.selected=!1,Qr(e.id,!1)}),changedEdges:s.map(function(e){return Qr(e.id,!1)}),get:t,set:e})},setMinZoom:function(n){var r=t(),o=r.d3Zoom,i=r.maxZoom;null==o||o.scaleExtent([n,i]),e({minZoom:n})},setMaxZoom:function(n){var r=t(),o=r.d3Zoom,i=r.minZoom;null==o||o.scaleExtent([i,n]),e({maxZoom:n})},setTranslateExtent:function(n){var r=t().d3Zoom;null==r||r.translateExtent(n),e({translateExtent:n})},resetSelectedElements:function(){var n=t(),r=n.nodeInternals,o=n.edges;Co({changedNodes:Array.from(r.values()).filter(function(e){return e.selected}).map(function(e){return Qr(e.id,!1)}),changedEdges:o.filter(function(e){return e.selected}).map(function(e){return Qr(e.id,!1)}),get:t,set:e})},setNodeExtent:function(n){var r=t().nodeInternals;r.forEach(function(e){e.positionAbsolute=Hr(e.position,n)}),e({nodeExtent:n,nodeInternals:new Map(r)})},reset:function(){return e(Eo({},So))}})})};function xo(e){if("string"==typeof e||"number"==typeof e)return""+e;var t="";if(Array.isArray(e))for(var n,r=0;r<e.length;r++)""!==(n=xo(e[r]))&&(t+=(t&&" ")+n);else for(var o in e)e[o]&&(t+=(t&&" ")+o);return t}function No(e,t){if(Object.is(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(var r=0;r<n.length;r++)if(!Object.prototype.hasOwnProperty.call(t,n[r])||!Object.is(e[n[r]],t[n[r]]))return!1;return!0}function Ro(e){return function(e){if(Array.isArray(e))return Nr(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Rr(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var jo={zoomIn:function(){},zoomOut:function(){},zoomTo:function(e){},getZoom:function(){return 1},setViewport:function(e){},getViewport:function(){return{x:0,y:0,zoom:1}},fitView:function(){},setCenter:function(e,t){},fitBounds:function(e){},project:function(e){return e},viewportInitialized:!1},Do=function(e){return{d3Zoom:e.d3Zoom,d3Selection:e.d3Selection}};function qo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Ho(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qo(Object(n),!0).forEach(function(t){xr(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qo(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Lo(){var e=function(){var e=Po(),t=Ao(Do,No),r=t.d3Zoom,o=t.d3Selection,i=(0,n.useMemo)(function(){return o&&r?{zoomIn:function(e){return r.scaleBy(go(o,null==e?void 0:e.duration),1.2)},zoomOut:function(e){return r.scaleBy(go(o,null==e?void 0:e.duration),1/1.2)},zoomTo:function(e,t){return r.scaleTo(go(o,null==t?void 0:t.duration),e)},getZoom:function(){return e.getState().transform[2]},setViewport:function(t,n){var i,a,c,s=jr(e.getState().transform,3),l=s[0],u=s[1],d=s[2],h=Sr.translate(null!==(i=t.x)&&void 0!==i?i:l,null!==(a=t.y)&&void 0!==a?a:u).scale(null!==(c=t.zoom)&&void 0!==c?c:d);r.transform(go(o,null==n?void 0:n.duration),h)},getViewport:function(){var t=jr(e.getState().transform,3);return{x:t[0],y:t[1],zoom:t[2]}},fitView:function(t){return yo(e.getState,t)},setCenter:function(t,n,i){var a=e.getState(),c=a.width,s=a.height,l=a.maxZoom,u=void 0!==(null==i?void 0:i.zoom)?i.zoom:l,d=c/2-t*u,h=s/2-n*u,g=Sr.translate(d,h).scale(u);r.transform(go(o,null==i?void 0:i.duration),g)},fitBounds:function(t,n){var i,a=e.getState(),c=a.width,s=a.height,l=a.minZoom,u=a.maxZoom,d=jr(ho(t,c,s,l,u,null!==(i=null==n?void 0:n.padding)&&void 0!==i?i:.1),3),h=d[0],g=d[1],f=d[2],p=Sr.translate(h,g).scale(f);r.transform(go(o,null==n?void 0:n.duration),p)},project:function(t){var n=e.getState(),r=n.transform,o=n.snapToGrid,i=n.snapGrid;return co(t,r,o,i)},viewportInitialized:!0}:jo},[r,o]);return i}(),t=Po(),r=(0,n.useCallback)(function(){var e=t.getState().nodeInternals;return Array.from(e.values()).map(function(e){return Ho({},e)})},[]),o=(0,n.useCallback)(function(e){return t.getState().nodeInternals.get(e)},[]),i=(0,n.useCallback)(function(){var e=t.getState().edges;return(void 0===e?[]:e).map(function(e){return Ho({},e)})},[]),a=(0,n.useCallback)(function(e){var n=t.getState().edges;return(void 0===n?[]:n).find(function(t){return t.id===e})},[]),c=(0,n.useCallback)(function(e){var n=t.getState(),r=n.nodeInternals,o=n.setNodes,i=n.hasDefaultNodes,a=n.onNodesChange,c=Array.from(r.values()),s="function"==typeof e?e(c):e;if(i)o(s);else if(a){a(0===s.length?c.map(function(e){return{type:"remove",id:e.id}}):s.map(function(e){return{item:e,type:"reset"}}))}},[]),s=(0,n.useCallback)(function(e){var n=t.getState(),r=n.edges,o=void 0===r?[]:r,i=n.setEdges,a=n.hasDefaultEdges,c=n.onEdgesChange,s="function"==typeof e?e(o):e;a?i(s):c&&c(0===s.length?o.map(function(e){return{type:"remove",id:e.id}}):s.map(function(e){return{item:e,type:"reset"}}))},[]),l=(0,n.useCallback)(function(e){var n=Array.isArray(e)?e:[e],r=t.getState(),o=r.nodeInternals,i=r.setNodes,a=r.hasDefaultNodes,c=r.onNodesChange;if(a){var s=Array.from(o.values());i([].concat(s,Ro(n)))}else if(c){c(n.map(function(e){return{item:e,type:"add"}}))}},[]),u=(0,n.useCallback)(function(e){var n=Array.isArray(e)?e:[e],r=t.getState(),o=r.edges,i=void 0===o?[]:o,a=r.setEdges,c=r.hasDefaultEdges,s=r.onEdgesChange;c?a([].concat(Ro(i),Ro(n))):s&&s(n.map(function(e){return{item:e,type:"add"}}))},[]),d=(0,n.useCallback)(function(){var e=t.getState(),n=e.nodeInternals,r=e.edges,o=void 0===r?[]:r,i=e.transform,a=Array.from(n.values()),c=jr(i,3),s=c[0],l=c[1],u=c[2];return{nodes:a.map(function(e){return Ho({},e)}),edges:o.map(function(e){return Ho({},e)}),viewport:{x:s,y:l,zoom:u}}},[]);return(0,n.useMemo)(function(){return Ho(Ho({},e),{},{getNodes:r,getNode:o,getEdges:i,getEdge:a,setNodes:c,setEdges:s,addNodes:l,addEdges:u,toObject:d})},[e,r,o,i,a,c,s,l,u,d])}function Bo(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function Uo(){return r().createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},r().createElement("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"}))}function zo(){return r().createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},r().createElement("path",{d:"M0 0h32v4.2H0z"}))}function Ko(){return r().createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},r().createElement("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"}))}function Fo(){return r().createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},r().createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"}))}function Vo(){return r().createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},r().createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"}))}var Yo=["children","className"];function Go(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var Wo=function(e){var t=e.children,n=e.className,o=Bo(e,Yo);return r().createElement("button",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Go(Object(n),!0).forEach(function(t){xr(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Go(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({type:"button",className:xo(["react-flow__controls-button",n])},o),t)},Zo=function(e){return e.nodesDraggable&&e.nodesConnectable&&e.elementsSelectable},Qo=function(e){var t=e.style,o=e.showZoom,i=void 0===o||o,a=e.showFitView,c=void 0===a||a,s=e.showInteractive,l=void 0===s||s,u=e.fitViewOptions,d=e.onZoomIn,h=e.onZoomOut,g=e.onFitView,f=e.onInteractiveChange,p=e.className,v=e.children,m=Po(),y=jr((0,n.useState)(!1),2),w=y[0],b=y[1],C=Ao(Zo),k=Lo(),S=k.zoomIn,I=k.zoomOut,E=k.fitView;return(0,n.useEffect)(function(){b(!0)},[]),w?r().createElement("div",{className:xo(["react-flow__controls",p]),style:t},i&&r().createElement(r().Fragment,null,r().createElement(Wo,{onClick:function(){null==S||S(),null==d||d()},className:"react-flow__controls-zoomin",title:"zoom in","aria-label":"zoom in"},r().createElement(Uo,null)),r().createElement(Wo,{onClick:function(){null==I||I(),null==h||h()},className:"react-flow__controls-zoomout",title:"zoom out","aria-label":"zoom out"},r().createElement(zo,null))),c&&r().createElement(Wo,{className:"react-flow__controls-fitview",onClick:function(){null==E||E(u),null==g||g()},title:"fit view","aria-label":"fit view"},r().createElement(Ko,null)),l&&r().createElement(Wo,{className:"react-flow__controls-interactive",onClick:function(){m.setState({nodesDraggable:!C,nodesConnectable:!C,elementsSelectable:!C}),null==f||f(!C)},title:"toggle interactivity","aria-label":"toggle interactivity"},C?r().createElement(Vo,null):r().createElement(Fo,null)),v):null};Qo.displayName="Controls";var Xo=(0,n.memo)(Qo);const Jo=e=>()=>e;function $o(e,t){var{sourceEvent:n,subject:r,target:o,identifier:i,active:a,x:c,y:s,dx:l,dy:u,dispatch:d}=t;Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:n,enumerable:!0,configurable:!0},subject:{value:r,enumerable:!0,configurable:!0},target:{value:o,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:a,enumerable:!0,configurable:!0},x:{value:c,enumerable:!0,configurable:!0},y:{value:s,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:u,enumerable:!0,configurable:!0},_:{value:d}})}function ei(e){return!e.ctrlKey&&!e.button}function ti(){return this.parentNode}function ni(e,t){return null==t?{x:e.x,y:e.y}:t}function ri(){return navigator.maxTouchPoints||"ontouchstart"in this}$o.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};var oi=["paid-pro","paid-sponsor","paid-enterprise","paid-custom"];function ii(e){var t=e.proOptions,n=e.position,o=void 0===n?"bottom-right":n;if(null!=t&&t.account&&oi.includes(null==t?void 0:t.account)&&null!=t&&t.hideAttribution)return null;var i="".concat(o).split("-");return r().createElement("div",{className:xo(["react-flow__attribution"].concat(Ro(i))),"data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev/pricing"},r().createElement("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer"},"React Flow"))}var ai=["x","y","label","labelStyle","labelShowBg","labelBgStyle","labelBgPadding","labelBgBorderRadius","children","className"];function ci(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var si=function(e){var t=e.x,o=e.y,i=e.label,a=e.labelStyle,c=void 0===a?{}:a,s=e.labelShowBg,l=void 0===s||s,u=e.labelBgStyle,d=void 0===u?{}:u,h=e.labelBgPadding,g=void 0===h?[2,4]:h,f=e.labelBgBorderRadius,p=void 0===f?2:f,v=e.children,m=e.className,y=Bo(e,ai),w=(0,n.useRef)(null),b=jr((0,n.useState)({x:0,y:0,width:0,height:0}),2),C=b[0],k=b[1],S=xo(["react-flow__edge-textwrapper",m]);return(0,n.useEffect)(function(){if(w.current){var e=w.current.getBBox();k({x:e.x,y:e.y,width:e.width,height:e.height})}},[i]),void 0!==i&&i?r().createElement("g",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ci(Object(n),!0).forEach(function(t){xr(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ci(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({transform:"translate(".concat(t-C.width/2," ").concat(o-C.height/2,")"),className:S},y),l&&r().createElement("rect",{width:C.width+2*g[0],x:-g[0],y:-g[1],height:C.height+2*g[1],className:"react-flow__edge-textbg",style:d,rx:p,ry:p}),r().createElement("text",{className:"react-flow__edge-text",y:C.height/2,dy:"0.3em",ref:w,style:c},i),v):null},li=(0,n.memo)(si),ui=function(e){var t=e.path,n=e.centerX,o=e.centerY,i=e.label,a=e.labelStyle,c=e.labelShowBg,s=e.labelBgStyle,l=e.labelBgPadding,u=e.labelBgBorderRadius,d=e.style,h=e.markerEnd,g=e.markerStart,f=i?r().createElement(li,{x:n,y:o,label:i,labelStyle:a,labelShowBg:c,labelBgStyle:s,labelBgPadding:l,labelBgBorderRadius:u}):null;return r().createElement(r().Fragment,null,r().createElement("path",{style:d,d:t,className:"react-flow__edge-path",markerEnd:h,markerStart:g}),f)};function di(e){var t,n,r=e.pos,o=e.x1,i=e.y1,a=e.x2,c=e.y2;switch(r){case kr.Left:case kr.Right:t=.5*(o+a),n=i;break;case kr.Top:case kr.Bottom:t=o,n=.5*(i+c)}return[t,n]}function hi(e){var t=e.sourceX,n=e.sourceY,r=e.sourcePosition,o=void 0===r?kr.Bottom:r,i=e.targetX,a=e.targetY,c=e.targetPosition,s=void 0===c?kr.Top:c,l=jr(di({pos:o,x1:t,y1:n,x2:i,y2:a}),2),u=l[0],d=l[1],h=jr(di({pos:s,x1:i,y1:a,x2:t,y2:n}),2),g=h[0],f=h[1];return"M".concat(t,",").concat(n," C").concat(u,",").concat(d," ").concat(g,",").concat(f," ").concat(i,",").concat(a)}var gi=(0,n.memo)(function(e){var t=e.sourceX,n=e.sourceY,o=e.targetX,i=e.targetY,a=e.sourcePosition,c=void 0===a?kr.Bottom:a,s=e.targetPosition,l=void 0===s?kr.Top:s,u=e.label,d=e.labelStyle,h=e.labelShowBg,g=e.labelBgStyle,f=e.labelBgPadding,p=e.labelBgBorderRadius,v=e.style,m=e.markerEnd,y=e.markerStart,w={sourceX:t,sourceY:n,sourcePosition:c,targetX:o,targetY:i,targetPosition:l},b=hi(w),C=function(e){var t=e.sourceX,n=e.sourceY,r=e.sourcePosition,o=void 0===r?kr.Bottom:r,i=e.targetX,a=e.targetY,c=e.targetPosition,s=void 0===c?kr.Top:c,l=jr(di({pos:o,x1:t,y1:n,x2:i,y2:a}),2),u=l[0],d=l[1],h=jr(di({pos:s,x1:i,y1:a,x2:t,y2:n}),2),g=.125*t+.375*u+.375*h[0]+.125*i,f=.125*n+.375*d+.375*h[1]+.125*a;return[g,f,Math.abs(g-t),Math.abs(f-n)]}(w),k=jr(C,2),S=k[0],I=k[1];return r().createElement(ui,{path:b,centerX:S,centerY:I,label:u,labelStyle:d,labelShowBg:h,labelBgStyle:g,labelBgPadding:f,labelBgBorderRadius:p,style:v,markerEnd:m,markerStart:y})});function fi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var pi=[kr.Left,kr.Right],vi=function(e){var t=e.sourceX,n=e.sourceY,r=e.targetX,o=e.targetY,i=e.sourcePosition,a=void 0===i?kr.Bottom:i,c=e.targetPosition,s=void 0===c?kr.Top:c,l=pi.includes(a),u=pi.includes(s);if(l&&!u||u&&!l){var d=l?Math.abs(r-t):0,h=t>r?t-d:t+d,g=l?0:Math.abs(o-n);return[h,n<o?n+g:n-g,d,g]}var f=Math.abs(r-t)/2,p=r<t?r+f:r-f,v=Math.abs(o-n)/2;return[p,o<n?o+v:o-v,f,v]};function mi(e,t,n){return void 0===n?n:function(r){var o=t().edges.find(function(t){return t.id===e});n(r,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fi(Object(n),!0).forEach(function(t){xr(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fi(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},o))}}var yi=function(e,t,n){return"L ".concat(e,",").concat(t-n,"Q ").concat(e,",").concat(t," ").concat(e+n,",").concat(t)},wi=function(e,t,n){return"L ".concat(e+n,",").concat(t,"Q ").concat(e,",").concat(t," ").concat(e,",").concat(t-n)},bi=function(e,t,n){return"L ".concat(e,",").concat(t-n,"Q ").concat(e,",").concat(t," ").concat(e-n,",").concat(t)},Ci=function(e,t,n){return"L ".concat(e-n,",").concat(t,"Q ").concat(e,",").concat(t," ").concat(e,",").concat(t-n)},ki=function(e,t,n){return"L ".concat(e+n,",").concat(t,"Q ").concat(e,",").concat(t," ").concat(e,",").concat(t+n)},Si=function(e,t,n){return"L ".concat(e,",").concat(t+n,"Q ").concat(e,",").concat(t," ").concat(e+n,",").concat(t)},Ii=function(e,t,n){return"L ".concat(e,",").concat(t+n,"Q ").concat(e,",").concat(t," ").concat(e-n,",").concat(t)},Ei=function(e,t,n){return"L ".concat(e-n,",").concat(t,"Q ").concat(e,",").concat(t," ").concat(e,",").concat(t+n)};function _i(e){var t=e.sourceX,n=e.sourceY,r=e.sourcePosition,o=void 0===r?kr.Bottom:r,i=e.targetX,a=e.targetY,c=e.targetPosition,s=void 0===c?kr.Top:c,l=e.borderRadius,u=void 0===l?5:l,d=e.centerX,h=e.centerY,g=jr(vi({sourceX:t,sourceY:n,targetX:i,targetY:a}),4),f=g[0],p=g[1],v=g[2],m=g[3],y=Math.min(u,Math.abs(i-t)),w=Math.min(u,Math.abs(a-n)),b=Math.min(y,w,v,m),C=[kr.Left,kr.Right],k=void 0!==d?d:f,S=void 0!==h?h:p,I=null,E=null;return t<=i?(I=n<=a?yi(t,S,b):Si(t,S,b),E=n<=a?Ei(i,S,b):Ci(i,S,b)):(I=n<a?bi(t,S,b):Ii(t,S,b),E=n<a?ki(i,S,b):wi(i,S,b)),C.includes(o)&&C.includes(s)?t<=i?(I=n<=a?Ei(k,n,b):Ci(k,n,b),E=n<=a?yi(k,a,b):Si(k,a,b)):(o===kr.Right&&s===kr.Left||o===kr.Left&&s===kr.Right||o===kr.Left&&s===kr.Left)&&(I=n<=a?ki(k,n,b):wi(k,n,b),E=n<=a?bi(k,a,b):Ii(k,a,b)):C.includes(o)&&!C.includes(s)?(I=t<=i?n<=a?Ei(i,n,b):Ci(i,n,b):n<=a?ki(i,n,b):wi(i,n,b),E=""):!C.includes(o)&&C.includes(s)&&(I=t<=i?n<=a?yi(t,a,b):Si(t,a,b):n<=a?bi(t,a,b):Ii(t,a,b),E=""),"M ".concat(t,",").concat(n).concat(I).concat(E,"L ").concat(i,",").concat(a)}var Ti=(0,n.memo)(function(e){var t=e.sourceX,n=e.sourceY,o=e.targetX,i=e.targetY,a=e.label,c=e.labelStyle,s=e.labelShowBg,l=e.labelBgStyle,u=e.labelBgPadding,d=e.labelBgBorderRadius,h=e.style,g=e.sourcePosition,f=void 0===g?kr.Bottom:g,p=e.targetPosition,v=void 0===p?kr.Top:p,m=e.markerEnd,y=e.markerStart,w=e.borderRadius,b=void 0===w?5:w,C=jr(vi({sourceX:t,sourceY:n,targetX:o,targetY:i,sourcePosition:f,targetPosition:v}),2),k=C[0],S=C[1],I=_i({sourceX:t,sourceY:n,sourcePosition:f,targetX:o,targetY:i,targetPosition:v,borderRadius:b});return r().createElement(ui,{path:I,centerX:k,centerY:S,label:a,labelStyle:c,labelShowBg:s,labelBgStyle:l,labelBgPadding:u,labelBgBorderRadius:d,style:h,markerEnd:m,markerStart:y})});function Oi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Ai(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Oi(Object(n),!0).forEach(function(t){xr(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Oi(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Pi=(0,n.memo)(function(e){return r().createElement(Ti,Ai(Ai({},e),{},{borderRadius:0}))}),Mi=(0,n.memo)(function(e){var t=e.sourceX,n=e.sourceY,o=e.targetX,i=e.targetY,a=e.label,c=e.labelStyle,s=e.labelShowBg,l=e.labelBgStyle,u=e.labelBgPadding,d=e.labelBgBorderRadius,h=e.style,g=e.markerEnd,f=e.markerStart,p=Math.abs(i-n)/2,v=i<n?i+p:i-p,m=Math.abs(o-t)/2,y=o<t?o+m:o-m,w="M ".concat(t,",").concat(n,"L ").concat(o,",").concat(i);return r().createElement(ui,{path:w,centerX:y,centerY:v,label:a,labelStyle:c,labelShowBg:s,labelBgStyle:l,labelBgPadding:u,labelBgBorderRadius:d,style:h,markerEnd:g,markerStart:f})});function xi(e,t){return e>=0?.5*e:25*t*Math.sqrt(-e)}function Ni(e){var t,n,r=e.pos,o=e.x1,i=e.y1,a=e.x2,c=e.y2,s=e.c;switch(r){case kr.Left:t=o-xi(o-a,s),n=i;break;case kr.Right:t=o+xi(a-o,s),n=i;break;case kr.Top:t=o,n=i-xi(i-c,s);break;case kr.Bottom:t=o,n=i+xi(c-i,s)}return[t,n]}function Ri(e){var t=e.sourceX,n=e.sourceY,r=e.sourcePosition,o=void 0===r?kr.Bottom:r,i=e.targetX,a=e.targetY,c=e.targetPosition,s=void 0===c?kr.Top:c,l=e.curvature,u=void 0===l?.25:l,d=jr(Ni({pos:o,x1:t,y1:n,x2:i,y2:a,c:u}),2),h=d[0],g=d[1],f=jr(Ni({pos:s,x1:i,y1:a,x2:t,y2:n,c:u}),2),p=f[0],v=f[1];return"M".concat(t,",").concat(n," C").concat(h,",").concat(g," ").concat(p,",").concat(v," ").concat(i,",").concat(a)}var ji=(0,n.memo)(function(e){var t=e.sourceX,n=e.sourceY,o=e.targetX,i=e.targetY,a=e.sourcePosition,c=void 0===a?kr.Bottom:a,s=e.targetPosition,l=void 0===s?kr.Top:s,u=e.label,d=e.labelStyle,h=e.labelShowBg,g=e.labelBgStyle,f=e.labelBgPadding,p=e.labelBgBorderRadius,v=e.style,m=e.markerEnd,y=e.markerStart,w={sourceX:t,sourceY:n,sourcePosition:c,targetX:o,targetY:i,targetPosition:l,curvature:e.curvature},b=Ri(w),C=function(e){var t=e.sourceX,n=e.sourceY,r=e.sourcePosition,o=void 0===r?kr.Bottom:r,i=e.targetX,a=e.targetY,c=e.targetPosition,s=void 0===c?kr.Top:c,l=e.curvature,u=void 0===l?.25:l,d=jr(Ni({pos:o,x1:t,y1:n,x2:i,y2:a,c:u}),2),h=d[0],g=d[1],f=jr(Ni({pos:s,x1:i,y1:a,x2:t,y2:n,c:u}),2),p=.125*t+.375*h+.375*f[0]+.125*i,v=.125*n+.375*g+.375*f[1]+.125*a;return[p,v,Math.abs(p-t),Math.abs(v-n)]}(w),k=jr(C,2),S=k[0],I=k[1];return r().createElement(ui,{path:b,centerX:S,centerY:I,label:u,labelStyle:d,labelShowBg:h,labelBgStyle:g,labelBgPadding:f,labelBgBorderRadius:p,style:v,markerEnd:m,markerStart:y})}),Di=(0,n.createContext)(null),qi=Di.Provider;function Hi(e,t,n,r,o,i,a){var c=a.elementFromPoint(e.clientX,e.clientY),s=(null==c?void 0:c.classList.contains("target"))||!1,l=(null==c?void 0:c.classList.contains("source"))||!1,u={elementBelow:c,isValid:!1,connection:{source:null,target:null,sourceHandle:null,targetHandle:null},isHoveringHandle:!1};if(c&&(s||l)){u.isHoveringHandle=!0;var d=c.getAttribute("data-nodeid"),h=c.getAttribute("data-handleid"),g=n?{source:d,sourceHandle:h,target:r,targetHandle:o}:{source:r,sourceHandle:o,target:d,targetHandle:h};u.connection=g,(t!==mr.Strict||n&&l||!n&&s)&&(u.isValid=i(g))}return u}function Li(e){null==e||e.classList.remove("react-flow__handle-valid"),null==e||e.classList.remove("react-flow__handle-connecting")}function Bi(e){var t=e.event,n=e.handleId,r=e.nodeId,o=e.onConnect,i=e.isTarget,a=e.getState,c=e.setState,s=e.isValidConnection,l=e.elementEdgeUpdaterType,u=e.onEdgeUpdateEnd,d=t.target.closest(".react-flow"),h=Lr(t.target);if(h){var g=h.elementFromPoint(t.clientX,t.clientY),f=null==g?void 0:g.classList.contains("target"),p=null==g?void 0:g.classList.contains("source");if(d&&(f||p||l)){var v,m=a(),y=m.onConnectStart,w=m.connectionMode,b=l||(f?"target":"source"),C=d.getBoundingClientRect();c({connectionPosition:{x:t.clientX-C.left,y:t.clientY-C.top},connectionNodeId:r,connectionHandleId:n,connectionHandleType:b}),null==y||y(t,{nodeId:r,handleId:n,handleType:b}),h.addEventListener("mousemove",k),h.addEventListener("mouseup",function e(t){var d=a(),g=d.onConnectStop,f=d.onConnectEnd,p=Hi(t,w,i,r,n,s,h),m=p.connection,y=p.isValid;null==g||g(t),y&&(null==o||o(m)),null==f||f(t),l&&u&&u(t),Li(v),c({connectionNodeId:null,connectionHandleId:null,connectionHandleType:null}),h.removeEventListener("mousemove",k),h.removeEventListener("mouseup",e)})}}function k(e){c({connectionPosition:{x:e.clientX-C.left,y:e.clientY-C.top}});var t=Hi(e,w,i,r,n,s,h),o=t.connection,a=t.elementBelow,l=t.isValid;if(!t.isHoveringHandle)return Li(v);o.source!==o.target&&a&&(Li(v),v=a,a.classList.add("react-flow__handle-connecting"),a.classList.toggle("react-flow__handle-valid",l))}}Di.Consumer;var Ui=["type","position","isValidConnection","isConnectable","id","onConnect","children","className","onMouseDown"];function zi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Ki(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?zi(Object(n),!0).forEach(function(t){xr(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zi(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Fi=function(){return!0},Vi=function(e){return{connectionStartHandle:e.connectionStartHandle,connectOnClick:e.connectOnClick}},Yi=(0,n.forwardRef)(function(e,t){var o=e.type,i=void 0===o?"source":o,a=e.position,c=void 0===a?kr.Top:a,s=e.isValidConnection,l=void 0===s?Fi:s,u=e.isConnectable,d=void 0===u||u,h=e.id,g=e.onConnect,f=e.children,p=e.className,v=e.onMouseDown,m=Bo(e,Ui),y=Po(),w=(0,n.useContext)(Di),b=Ao(Vi,No),C=b.connectionStartHandle,k=b.connectOnClick,S=h||null,I="target"===i,E=function(e){var t=y.getState(),n=t.defaultEdgeOptions,r=t.onConnect,o=t.hasDefaultEdges,i=Ki(Ki({},n),e);if(o){var a=y.getState().edges;y.setState({edges:ao(i,a)})}null==r||r(i),null==g||g(i)};return r().createElement("div",Ki({"data-handleid":S,"data-nodeid":w,"data-handlepos":c,className:xo(["react-flow__handle","react-flow__handle-".concat(c),"nodrag",p,{source:!I,target:I,connectable:d,connecting:(null==C?void 0:C.nodeId)===w&&(null==C?void 0:C.handleId)===S&&(null==C?void 0:C.type)===i}]),onMouseDown:function(e){0===e.button&&Bi({event:e,handleId:S,nodeId:w,onConnect:E,isTarget:I,getState:y.getState,setState:y.setState,isValidConnection:l}),null==v||v(e)},onClick:k?function(e){var t=y.getState(),n=t.onClickConnectStart,r=t.onClickConnectStop,o=t.onClickConnectEnd,a=t.connectionMode;if(!C)return null==n||n(e,{nodeId:w,handleId:S,handleType:i}),void y.setState({connectionStartHandle:{nodeId:w,type:i,handleId:S}});var c=Lr(e.target),s=Hi(e,a,"target"===C.type,C.nodeId,C.handleId||null,l,c),u=s.connection,d=s.isValid;null==r||r(e),d&&E(u),null==o||o(e),y.setState({connectionStartHandle:null})}:void 0,ref:t},m),f)});Yi.displayName="Handle";var Gi=(0,n.memo)(Yi),Wi=function(e){var t=e.data,n=e.isConnectable,o=e.targetPosition,i=void 0===o?kr.Top:o,a=e.sourcePosition,c=void 0===a?kr.Bottom:a;return r().createElement(r().Fragment,null,r().createElement(Gi,{type:"target",position:i,isConnectable:n}),null==t?void 0:t.label,r().createElement(Gi,{type:"source",position:c,isConnectable:n}))};Wi.displayName="DefaultNode";var Zi=(0,n.memo)(Wi),Qi=function(e){var t=e.data,n=e.isConnectable,o=e.sourcePosition,i=void 0===o?kr.Bottom:o;return r().createElement(r().Fragment,null,null==t?void 0:t.label,r().createElement(Gi,{type:"source",position:i,isConnectable:n}))};Qi.displayName="InputNode";var Xi=(0,n.memo)(Qi),Ji=function(e){var t=e.data,n=e.isConnectable,o=e.targetPosition,i=void 0===o?kr.Top:o;return r().createElement(r().Fragment,null,r().createElement(Gi,{type:"target",position:i,isConnectable:n}),null==t?void 0:t.label)};Ji.displayName="OutputNode";var $i=(0,n.memo)(Ji),ea=function(e){return{selectedNodes:Array.from(e.nodeInternals.values()).filter(function(e){return e.selected}),selectedEdges:e.edges.filter(function(e){return e.selected})}},ta=function(e,t){var n=e.selectedNodes.map(function(e){return e.id}),r=t.selectedNodes.map(function(e){return e.id}),o=e.selectedEdges.map(function(e){return e.id}),i=t.selectedEdges.map(function(e){return e.id});return No(n,r)&&No(o,i)};function na(e){var t=e.onSelectionChange,r=Ao(ea,ta),o=r.selectedNodes,i=r.selectedEdges;return(0,n.useEffect)(function(){t({nodes:o,edges:i})},[o,i]),null}var ra=(0,n.memo)(na),oa=function(e){return{setNodes:e.setNodes,setEdges:e.setEdges,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset}};function ia(e,t){(0,n.useEffect)(function(){void 0!==e&&t(e)},[e])}function aa(e,t,r){(0,n.useEffect)(function(){void 0!==t&&r(xr({},e,t))},[t])}var ca=function(e){var t=e.nodes,r=e.edges,o=e.defaultNodes,i=e.defaultEdges,a=e.onConnect,c=e.onConnectStart,s=e.onConnectStop,l=e.onConnectEnd,u=e.onClickConnectStart,d=e.onClickConnectStop,h=e.onClickConnectEnd,g=e.nodesDraggable,f=e.nodesConnectable,p=e.minZoom,v=e.maxZoom,m=e.nodeExtent,y=e.onNodesChange,w=e.onEdgesChange,b=e.elementsSelectable,C=e.connectionMode,k=e.snapGrid,S=e.snapToGrid,I=e.translateExtent,E=e.connectOnClick,_=e.defaultEdgeOptions,T=e.fitView,O=e.fitViewOptions,A=e.onNodesDelete,P=e.onEdgesDelete,M=e.onNodeDrag,x=e.onNodeDragStart,N=e.onNodeDragStop,R=e.onSelectionDrag,j=e.onSelectionDragStart,D=e.onSelectionDragStop,q=Ao(oa,No),H=q.setNodes,L=q.setEdges,B=q.setDefaultNodesAndEdges,U=q.setMinZoom,z=q.setMaxZoom,K=q.setTranslateExtent,F=q.setNodeExtent,V=q.reset,Y=Po();return(0,n.useEffect)(function(){return B(o,i),function(){V()}},[]),aa("defaultEdgeOptions",_,Y.setState),aa("connectionMode",C,Y.setState),aa("onConnect",a,Y.setState),aa("onConnectStart",c,Y.setState),aa("onConnectStop",s,Y.setState),aa("onConnectEnd",l,Y.setState),aa("onClickConnectStart",u,Y.setState),aa("onClickConnectStop",d,Y.setState),aa("onClickConnectEnd",h,Y.setState),aa("nodesDraggable",g,Y.setState),aa("nodesConnectable",f,Y.setState),aa("elementsSelectable",b,Y.setState),aa("snapToGrid",S,Y.setState),aa("snapGrid",k,Y.setState),aa("onNodesChange",y,Y.setState),aa("onEdgesChange",w,Y.setState),aa("connectOnClick",E,Y.setState),aa("fitViewOnInit",T,Y.setState),aa("fitViewOnInitOptions",O,Y.setState),aa("onNodesDelete",A,Y.setState),aa("onEdgesDelete",P,Y.setState),aa("onNodeDrag",M,Y.setState),aa("onNodeDragStart",x,Y.setState),aa("onNodeDragStop",N,Y.setState),aa("onSelectionDrag",R,Y.setState),aa("onSelectionDragStart",j,Y.setState),aa("onSelectionDragStop",D,Y.setState),ia(t,H),ia(r,L),ia(o,H),ia(i,L),ia(p,U),ia(v,z),ia(I,K),ia(m,F),null},sa=function(e,t,n){return n===kr.Left?e-t:n===kr.Right?e+t:e},la=function(e,t,n){return n===kr.Top?e-t:n===kr.Bottom?e+t:e},ua=function(e){var t=e.className,n=e.position,o=e.centerX,i=e.centerY,a=e.radius,c=void 0===a?10:a;return r().createElement("circle",{className:xo(["react-flow__edgeupdater",t]),cx:sa(o,c,n),cy:la(i,c,n),r:c,stroke:"transparent",fill:"transparent"})},da=function(e){var t=function(t){var o=t.id,i=t.className,a=t.type,c=t.data,s=t.onClick,l=t.onEdgeDoubleClick,u=t.selected,d=t.animated,h=t.label,g=t.labelStyle,f=t.labelShowBg,p=t.labelBgStyle,v=t.labelBgPadding,m=t.labelBgBorderRadius,y=t.style,w=t.source,b=t.target,C=t.sourceX,k=t.sourceY,S=t.targetX,I=t.targetY,E=t.sourcePosition,_=t.targetPosition,T=t.elementsSelectable,O=t.hidden,A=t.sourceHandleId,P=t.targetHandleId,M=t.onContextMenu,x=t.onMouseEnter,N=t.onMouseMove,R=t.onMouseLeave,j=t.edgeUpdaterRadius,D=t.onEdgeUpdate,q=t.onEdgeUpdateStart,H=t.onEdgeUpdateEnd,L=t.markerEnd,B=t.markerStart,U=t.rfId,z=jr((0,n.useState)(!1),2),K=z[0],F=z[1],V=Po(),Y=mi(o,V.getState,l),G=mi(o,V.getState,M),W=mi(o,V.getState,x),Z=mi(o,V.getState,N),Q=mi(o,V.getState,R),X=function(e,t){var n=t?b:w,r=(t?P:A)||null,i=t?"target":"source",a=t,c=V.getState().edges.find(function(e){return e.id===o});null==q||q(e,c,i);var s=H?function(e){return H(e,c,i)}:void 0;Bi({event:e,handleId:r,nodeId:n,onConnect:function(e){return null==D?void 0:D(c,e)},isTarget:a,getState:V.getState,setState:V.setState,isValidConnection:function(){return!0},elementEdgeUpdaterType:i,onEdgeUpdateEnd:s})},J=function(){return F(!0)},$=function(){return F(!1)},ee=(0,n.useMemo)(function(){return"url(#".concat(io(B,U),")")},[B,U]),te=(0,n.useMemo)(function(){return"url(#".concat(io(L,U),")")},[L,U]);if(O)return null;var ne=!T&&!s,re=void 0!==D,oe=xo(["react-flow__edge","react-flow__edge-".concat(a),i,{selected:u,animated:d,inactive:ne,updating:K}]);return r().createElement("g",{className:oe,onClick:function(e){var t=V.getState(),n=t.edges,r=t.addSelectedEdges,i=n.find(function(e){return e.id===o});T&&(V.setState({nodesSelectionActive:!1}),r([o])),null==s||s(e,i)},onDoubleClick:Y,onContextMenu:G,onMouseEnter:W,onMouseMove:Z,onMouseLeave:Q},r().createElement(e,{id:o,source:w,target:b,selected:u,animated:d,label:h,labelStyle:g,labelShowBg:f,labelBgStyle:p,labelBgPadding:v,labelBgBorderRadius:m,data:c,style:y,sourceX:C,sourceY:k,targetX:S,targetY:I,sourcePosition:E,targetPosition:_,sourceHandleId:A,targetHandleId:P,markerStart:ee,markerEnd:te,"data-testid":"rf__edge-".concat(o)}),re&&r().createElement("g",{onMouseDown:function(e){return X(e,!0)},onMouseEnter:J,onMouseOut:$},r().createElement(ua,{position:E,centerX:C,centerY:k,radius:j})),re&&r().createElement("g",{onMouseDown:function(e){return X(e,!1)},onMouseEnter:J,onMouseOut:$},r().createElement(ua,{position:_,centerX:S,centerY:I,radius:j})))};return t.displayName="EdgeWrapper",(0,n.memo)(t)};function ha(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ga(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ha(Object(n),!0).forEach(function(t){xr(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ha(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function fa(e){var t={default:da(e.default||ji),straight:da(e.bezier||Mi),step:da(e.step||Pi),smoothstep:da(e.step||Ti),simplebezier:da(e.simplebezier||gi)},n=Object.keys(e).filter(function(e){return!["default","bezier"].includes(e)}).reduce(function(t,n){return t[n]=da(e[n]||ji),t},{});return ga(ga({},t),n)}function pa(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=((null==n?void 0:n.x)||0)+t.x,o=((null==n?void 0:n.y)||0)+t.y,i=(null==n?void 0:n.width)||t.width,a=(null==n?void 0:n.height)||t.height;switch(e){case kr.Top:return{x:r+i/2,y:o};case kr.Right:return{x:r+i,y:o+a/2};case kr.Bottom:return{x:r+i/2,y:o+a};case kr.Left:return{x:r,y:o+a/2}}}function va(e,t){if(!e)return null;var n=null;return 1!==e.length&&t?t&&(n=e.find(function(e){return e.id===t})):n=e[0],void 0===n?null:n}function ma(e,t){var n,r,o,i,a,c=e.get(t),s=(null==c||null===(n=c[Fr])||void 0===n?void 0:n.handleBounds)||null,l=!(c&&s&&c.width&&c.height&&void 0!==(null===(r=c.positionAbsolute)||void 0===r?void 0:r.x)&&void 0!==(null===(o=c.positionAbsolute)||void 0===o?void 0:o.y));return[{x:(null==c||null===(i=c.positionAbsolute)||void 0===i?void 0:i.x)||0,y:(null==c||null===(a=c.positionAbsolute)||void 0===a?void 0:a.y)||0,width:(null==c?void 0:c.width)||0,height:(null==c?void 0:c.height)||0},s,!l]}var ya="undefined"!=typeof document?document:null,wa=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{target:ya},r=jr((0,n.useState)(!1),2),o=r[0],i=r[1],a=(0,n.useRef)(new Set([])),c=jr((0,n.useMemo)(function(){if(null!==e){var t=(Array.isArray(e)?e:[e]).filter(function(e){return"string"==typeof e}).map(function(e){return e.split("+")}),n=t.reduce(function(e,t){return e.concat.apply(e,Ro(t))},[]);return[t,n]}return[[],[]]},[e]),2),s=c[0],l=c[1];return(0,n.useEffect)(function(){if(null!==e){var n,r,o=function(e){if(ka(e))return!1;var t=Ca(e.code,l);a.current.add(e[t]),ba(s,a.current,!1)&&(e.preventDefault(),i(!0))},c=function(e){if(ka(e))return!1;var t=Ca(e.code,l);ba(s,a.current,!0)?(i(!1),a.current.clear()):a.current.delete(e[t])},u=function(){a.current.clear(),i(!1)};return null==t||null===(n=t.target)||void 0===n||n.addEventListener("keydown",o),null==t||null===(r=t.target)||void 0===r||r.addEventListener("keyup",c),window.addEventListener("blur",u),function(){var e,n;null==t||null===(e=t.target)||void 0===e||e.removeEventListener("keydown",o),null==t||null===(n=t.target)||void 0===n||n.removeEventListener("keyup",c),window.removeEventListener("blur",u)}}},[e,i]),o};function ba(e,t,n){return e.filter(function(e){return n||e.length===t.size}).some(function(e){return e.every(function(e){return t.has(e)})})}function Ca(e,t){return t.includes(e)?"code":"key"}function ka(e){var t,n=(null===(t=e.composedPath)||void 0===t?void 0:t.call(e)[0])||e.target;return["INPUT","SELECT","TEXTAREA"].includes(null==n?void 0:n.nodeName)||(null==n?void 0:n.hasAttribute("contenteditable"))}var Sa=function(e){return{onNodesChange:e.onNodesChange,onEdgesChange:e.onEdgesChange}},Ia=function(e){return{x:e.x,y:e.y,zoom:e.k}},Ea=function(e,t){return e.target.closest(".".concat(t))},_a=function(e){return{d3Zoom:e.d3Zoom,d3Selection:e.d3Selection,d3ZoomHandler:e.d3ZoomHandler}},Ta=function(e){var t=e.onMove,o=e.onMoveStart,i=e.onMoveEnd,a=e.zoomOnScroll,c=void 0===a||a,s=e.zoomOnPinch,l=void 0===s||s,u=e.panOnScroll,d=void 0!==u&&u,h=e.panOnScrollSpeed,g=void 0===h?.5:h,f=e.panOnScrollMode,p=void 0===f?wr.Free:f,v=e.zoomOnDoubleClick,m=void 0===v||v,y=e.selectionKeyPressed,w=e.elementsSelectable,b=e.panOnDrag,C=void 0===b||b,k=e.translateExtent,S=e.minZoom,I=e.maxZoom,E=e.defaultZoom,_=void 0===E?1:E,T=e.defaultPosition,O=void 0===T?[0,0]:T,A=e.zoomActivationKeyCode,P=e.preventScrolling,M=void 0===P||P,x=e.children,N=e.noWheelClassName,R=e.noPanClassName,j=Po(),D=(0,n.useRef)(!1),q=(0,n.useRef)(null),H=(0,n.useRef)({x:0,y:0,zoom:0}),L=Ao(_a,No),B=L.d3Zoom,U=L.d3Selection,z=L.d3ZoomHandler,K=wa(A);return function(e){var t=Po();(0,n.useEffect)(function(){var n,r=function(){if(e.current){var n=Dr(e.current);t.setState({width:n.width||500,height:n.height||500})}};return r(),window.onresize=r,e.current&&(n=new ResizeObserver(function(){return r()})).observe(e.current),function(){window.onresize=null,n&&e.current&&n.unobserve(e.current)}},[])}(q),(0,n.useEffect)(function(){if(q.current){var e,t=function(){var e,t,n,r=_r,o=Tr,i=Mr,a=Ar,c=Pr,s=[0,1/0],l=[[-1/0,-1/0],[1/0,1/0]],u=250,d=bt,h=$("start","zoom","end"),g=0,f=10;function p(e){e.property("__zoom",Or).on("wheel.zoom",k,{passive:!1}).on("mousedown.zoom",S).on("dblclick.zoom",I).filter(c).on("touchstart.zoom",E).on("touchmove.zoom",_).on("touchend.zoom touchcancel.zoom",T).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function v(e,t){return(t=Math.max(s[0],Math.min(s[1],t)))===e.k?e:new vr(t,e.x,e.y)}function m(e,t,n){var r=t[0]-n[0]*e.k,o=t[1]-n[1]*e.k;return r===e.x&&o===e.y?e:new vr(e.k,r,o)}function y(e){return[(+e[0][0]+ +e[1][0])/2,(+e[0][1]+ +e[1][1])/2]}function w(e,t,n,r){e.on("start.zoom",function(){b(this,arguments).event(r).start()}).on("interrupt.zoom end.zoom",function(){b(this,arguments).event(r).end()}).tween("zoom",function(){var e=this,i=arguments,a=b(e,i).event(r),c=o.apply(e,i),s=null==n?y(c):"function"==typeof n?n.apply(e,i):n,l=Math.max(c[1][0]-c[0][0],c[1][1]-c[0][1]),u=e.__zoom,h="function"==typeof t?t.apply(e,i):t,g=d(u.invert(s).concat(l/u.k),h.invert(s).concat(l/h.k));return function(e){if(1===e)e=h;else{var t=g(e),n=l/t[2];e=new vr(n,s[0]-t[0]*n,s[1]-t[1]*n)}a.zoom(null,e)}})}function b(e,t,n){return!n&&e.__zooming||new C(e,t)}function C(e,t){this.that=e,this.args=t,this.active=0,this.sourceEvent=null,this.extent=o.apply(e,t),this.taps=0}function k(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];if(r.apply(this,arguments)){var c=b(this,n).event(e),u=this.__zoom,d=Math.max(s[0],Math.min(s[1],u.k*Math.pow(2,a.apply(this,arguments)))),h=Ct(e);if(c.wheel)c.mouse[0][0]===h[0]&&c.mouse[0][1]===h[1]||(c.mouse[1]=u.invert(c.mouse[0]=h)),clearTimeout(c.wheel);else{if(u.k===d)return;c.mouse=[h,u.invert(h)],Yt(this),c.start()}Er(e),c.wheel=setTimeout(function(){c.wheel=null,c.end()},150),c.zoom("mouse",i(m(v(u,d),c.mouse[0],c.mouse[1]),c.extent,l))}}function S(e){for(var t=arguments.length,o=new Array(t>1?t-1:0),a=1;a<t;a++)o[a-1]=arguments[a];if(!n&&r.apply(this,arguments)){var c=e.currentTarget,s=b(this,o,!0).event(e),u=ht(e.view).on("mousemove.zoom",function(e){if(Er(e),!s.moved){var t=e.clientX-h,n=e.clientY-f;s.moved=t*t+n*n>g}s.event(e).zoom("mouse",i(m(s.that.__zoom,s.mouse[0]=Ct(e,c),s.mouse[1]),s.extent,l))},!0).on("mouseup.zoom",function(e){u.on("mousemove.zoom mouseup.zoom",null),yt(e.view,s.moved),Er(e),s.event(e).end()},!0),d=Ct(e,c),h=e.clientX,f=e.clientY;mt(e.view),Ir(e),s.mouse=[d,this.__zoom.invert(d)],Yt(this),s.start()}}function I(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];if(r.apply(this,arguments)){var c=this.__zoom,s=Ct(e.changedTouches?e.changedTouches[0]:e,this),d=c.invert(s),h=c.k*(e.shiftKey?.5:2),g=i(m(v(c,h),s,d),o.apply(this,n),l);Er(e),u>0?ht(this).transition().duration(u).call(w,g,s,e):ht(this).call(p.transform,g,s,e)}}function E(n){for(var o=arguments.length,i=new Array(o>1?o-1:0),a=1;a<o;a++)i[a-1]=arguments[a];if(r.apply(this,arguments)){var c,s,l,u,d=n.touches,h=d.length,g=b(this,i,n.changedTouches.length===h).event(n);for(Ir(n),s=0;s<h;++s)u=[u=Ct(l=d[s],this),this.__zoom.invert(u),l.identifier],g.touch0?g.touch1||g.touch0[2]===u[2]||(g.touch1=u,g.taps=0):(g.touch0=u,c=!0,g.taps=1+!!e);e&&(e=clearTimeout(e)),c&&(g.taps<2&&(t=u[0],e=setTimeout(function(){e=null},500)),Yt(this),g.start())}}function _(e){if(this.__zooming){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var o,a,c,s,u=b(this,n).event(e),d=e.changedTouches,h=d.length;for(Er(e),o=0;o<h;++o)c=Ct(a=d[o],this),u.touch0&&u.touch0[2]===a.identifier?u.touch0[0]=c:u.touch1&&u.touch1[2]===a.identifier&&(u.touch1[0]=c);if(a=u.that.__zoom,u.touch1){var g=u.touch0[0],f=u.touch0[1],p=u.touch1[0],y=u.touch1[1],w=(w=p[0]-g[0])*w+(w=p[1]-g[1])*w,C=(C=y[0]-f[0])*C+(C=y[1]-f[1])*C;a=v(a,Math.sqrt(w/C)),c=[(g[0]+p[0])/2,(g[1]+p[1])/2],s=[(f[0]+y[0])/2,(f[1]+y[1])/2]}else{if(!u.touch0)return;c=u.touch0[0],s=u.touch0[1]}u.zoom("touch",i(m(a,c,s),u.extent,l))}}function T(e){for(var r=arguments.length,o=new Array(r>1?r-1:0),i=1;i<r;i++)o[i-1]=arguments[i];if(this.__zooming){var a,c,s=b(this,o).event(e),l=e.changedTouches,u=l.length;for(Ir(e),n&&clearTimeout(n),n=setTimeout(function(){n=null},500),a=0;a<u;++a)c=l[a],s.touch0&&s.touch0[2]===c.identifier?delete s.touch0:s.touch1&&s.touch1[2]===c.identifier&&delete s.touch1;if(s.touch1&&!s.touch0&&(s.touch0=s.touch1,delete s.touch1),s.touch0)s.touch0[1]=this.__zoom.invert(s.touch0[0]);else if(s.end(),2===s.taps&&(c=Ct(c,this),Math.hypot(t[0]-c[0],t[1]-c[1])<f)){var d=ht(this).on("dblclick.zoom");d&&d.apply(this,arguments)}}}return p.transform=function(e,t,n,r){var o=e.selection?e.selection():e;o.property("__zoom",Or),e!==o?w(e,t,n,r):o.interrupt().each(function(){b(this,arguments).event(r).start().zoom(null,"function"==typeof t?t.apply(this,arguments):t).end()})},p.scaleBy=function(e,t,n,r){p.scaleTo(e,function(){return this.__zoom.k*("function"==typeof t?t.apply(this,arguments):t)},n,r)},p.scaleTo=function(e,t,n,r){p.transform(e,function(){var e=o.apply(this,arguments),r=this.__zoom,a=null==n?y(e):"function"==typeof n?n.apply(this,arguments):n,c=r.invert(a),s="function"==typeof t?t.apply(this,arguments):t;return i(m(v(r,s),a,c),e,l)},n,r)},p.translateBy=function(e,t,n,r){p.transform(e,function(){return i(this.__zoom.translate("function"==typeof t?t.apply(this,arguments):t,"function"==typeof n?n.apply(this,arguments):n),o.apply(this,arguments),l)},null,r)},p.translateTo=function(e,t,n,r,a){p.transform(e,function(){var e=o.apply(this,arguments),a=this.__zoom,c=null==r?y(e):"function"==typeof r?r.apply(this,arguments):r;return i(Sr.translate(c[0],c[1]).scale(a.k).translate("function"==typeof t?-t.apply(this,arguments):-t,"function"==typeof n?-n.apply(this,arguments):-n),e,l)},r,a)},C.prototype={event:function(e){return e&&(this.sourceEvent=e),this},start:function(){return 1===++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(e,t){return this.mouse&&"mouse"!==e&&(this.mouse[1]=t.invert(this.mouse[0])),this.touch0&&"touch"!==e&&(this.touch0[1]=t.invert(this.touch0[0])),this.touch1&&"touch"!==e&&(this.touch1[1]=t.invert(this.touch1[0])),this.that.__zoom=t,this.emit("zoom"),this},end:function(){return 0===--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(e){var t=ht(this.that).datum();h.call(e,this.that,new pr(e,{sourceEvent:this.sourceEvent,target:p,type:e,transform:this.that.__zoom,dispatch:h}),t)}},p.wheelDelta=function(e){return arguments.length?(a="function"==typeof e?e:fr(+e),p):a},p.filter=function(e){return arguments.length?(r="function"==typeof e?e:fr(!!e),p):r},p.touchable=function(e){return arguments.length?(c="function"==typeof e?e:fr(!!e),p):c},p.extent=function(e){return arguments.length?(o="function"==typeof e?e:fr([[+e[0][0],+e[0][1]],[+e[1][0],+e[1][1]]]),p):o},p.scaleExtent=function(e){return arguments.length?(s[0]=+e[0],s[1]=+e[1],p):[s[0],s[1]]},p.translateExtent=function(e){return arguments.length?(l[0][0]=+e[0][0],l[1][0]=+e[1][0],l[0][1]=+e[0][1],l[1][1]=+e[1][1],p):[[l[0][0],l[0][1]],[l[1][0],l[1][1]]]},p.constrain=function(e){return arguments.length?(i=e,p):i},p.duration=function(e){return arguments.length?(u=+e,p):u},p.interpolate=function(e){return arguments.length?(d=e,p):d},p.on=function(){var e=h.on.apply(h,arguments);return e===h?p:e},p.clickDistance=function(e){return arguments.length?(g=(e=+e)*e,p):Math.sqrt(g)},p.tapDistance=function(e){return arguments.length?(f=+e,p):f},p}().scaleExtent([S,I]).translateExtent(k),n=ht(q.current).call(t),r=qr(O[0],k[0][0],k[1][0]),o=qr(O[1],k[0][1],k[1][1]),i=qr(_,S,I),a=Sr.translate(r,o).scale(i);t.transform(n,a),j.setState({d3Zoom:t,d3Selection:n,d3ZoomHandler:n.on("wheel.zoom"),transform:[r,o,i],domNode:null===(e=n.node())||void 0===e?void 0:e.closest(".react-flow")})}},[]),(0,n.useEffect)(function(){U&&B&&(d&&!K?U.on("wheel",function(e){if(Ea(e,N))return!1;e.preventDefault(),e.stopImmediatePropagation();var t=U.property("__zoom").k||1;if(e.ctrlKey&&l){var n=Ct(e),r=-e.deltaY*(1===e.deltaMode?.05:e.deltaMode?1:.002)*10,o=t*Math.pow(2,r);B.scaleTo(U,o,n)}else{var i=1===e.deltaMode?20:1,a=p===wr.Vertical?0:e.deltaX*i,c=p===wr.Horizontal?0:e.deltaY*i;B.translateBy(U,-a/t*g,-c/t*g)}}).on("wheel.zoom",null):void 0!==z&&U.on("wheel",function(e){if(!M||Ea(e,N))return null;e.preventDefault()}).on("wheel.zoom",z))},[d,p,U,B,z,K,l,M,N]),(0,n.useEffect)(function(){B&&(y&&!D.current?B.on("zoom",null):y||B.on("zoom",function(e){if(j.setState({transform:[e.transform.x,e.transform.y,e.transform.k]}),t){var n=Ia(e.transform);t(e.sourceEvent,n)}}))},[y,B,t]),(0,n.useEffect)(function(){B&&B.on("start",function(e){if(D.current=!0,o){var t=Ia(e.transform);H.current=t,o(e.sourceEvent,t)}})},[B,o]),(0,n.useEffect)(function(){B&&B.on("end",function(e){if(D.current=!1,i&&(n=H.current,r=e.transform,n.x!==r.x||n.y!==r.y||n.zoom!==r.k)){var t=Ia(e.transform);H.current=t,i(e.sourceEvent,t)}var n,r})},[B,i]),(0,n.useEffect)(function(){B&&B.filter(function(e){var t=K||c,n=l&&e.ctrlKey;return!(!(C||t||d||m||l)||y||!m&&"dblclick"===e.type||Ea(e,N)&&"wheel"===e.type||Ea(e,R)&&"wheel"!==e.type||!l&&e.ctrlKey&&"wheel"===e.type||!(t||d||n||"wheel"!==e.type)||!(C||"mousedown"!==e.type&&"touchstart"!==e.type)||e.ctrlKey&&"wheel"!==e.type||e.button)})},[B,c,l,d,m,C,y,w,K]),r().createElement("div",{className:"react-flow__renderer react-flow__container",ref:q},x)};function Oa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Aa(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Oa(Object(n),!0).forEach(function(t){xr(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Oa(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Pa(e,t){return{x:e.clientX-t.left,y:e.clientY-t.top}}var Ma=function(e){return{userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable}},xa={startX:0,startY:0,x:0,y:0,width:0,height:0,draw:!1},Na=(0,n.memo)(function(e){var t=e.selectionKeyPressed,o=Po(),i=(0,n.useRef)(0),a=(0,n.useRef)(0),c=(0,n.useRef)(),s=jr((0,n.useState)(xa),2),l=s[0],u=s[1],d=Ao(Ma,No),h=d.userSelectionActive;if(!d.elementsSelectable||!h&&!t)return null;var g=function(){u(xa),o.setState({userSelectionActive:!1}),i.current=0,a.current=0};return r().createElement("div",{className:"react-flow__selectionpane react-flow__container",onMouseDown:function(e){var t=e.target.closest(".react-flow");c.current=t.getBoundingClientRect();var n=Pa(e,c.current);u({width:0,height:0,startX:n.x,startY:n.y,x:n.x,y:n.y,draw:!0}),o.setState({userSelectionActive:!0,nodesSelectionActive:!1})},onMouseMove:function(e){var n,r;if(t&&l.draw&&c.current){var s=Pa(e,c.current),d=null!==(n=l.startX)&&void 0!==n?n:0,h=null!==(r=l.startY)&&void 0!==r?r:0,g=Aa(Aa({},l),{},{x:s.x<d?s.x:d,y:s.y<h?s.y:h,width:Math.abs(s.x-d),height:Math.abs(s.y-h)}),f=o.getState(),p=f.nodeInternals,v=f.edges,m=f.transform,y=f.onNodesChange,w=f.onEdgesChange,b=Array.from(p.values()),C=lo(p,g,m,!1,!0),k=uo(C,v).map(function(e){return e.id}),S=C.map(function(e){return e.id});if(i.current!==S.length){i.current=S.length;var I=Xr(b,S);I.length&&(null==y||y(I))}if(a.current!==k.length){a.current=k.length;var E=Xr(v,k);E.length&&(null==w||w(E))}u(g)}},onMouseUp:function(){o.setState({nodesSelectionActive:i.current>0}),g()},onMouseLeave:function(){o.setState({nodesSelectionActive:!1}),g()}},l.draw&&r().createElement("div",{className:"react-flow__selection react-flow__container",style:{width:l.width,height:l.height,transform:"translate(".concat(l.x,"px, ").concat(l.y,"px)")}}))});function Ra(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ja(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ra(Object(n),!0).forEach(function(t){xr(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ra(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Da(e,t){if(!e.parentNode)return!1;var n=t.get(e.parentNode);return!!n&&(!!n.selected||Da(n,t))}function qa(e,t,n){var r=e;do{var o;if(null!==(o=r)&&void 0!==o&&o.matches(t))return!0;if(r===n.current)return!1;r=r.parentElement}while(r);return!1}function Ha(e,t,n){return Array.from(e.values()).filter(function(t){return(t.selected||t.id===n)&&(!t.parentNode||!Da(t,e))}).map(function(e){var n,r,o,i;return{id:e.id,position:e.position||{x:0,y:0},positionAbsolute:e.positionAbsolute||{x:0,y:0},distance:{x:t.x-(null!==(n=null===(r=e.positionAbsolute)||void 0===r?void 0:r.x)&&void 0!==n?n:0),y:t.y-(null!==(o=null===(i=e.positionAbsolute)||void 0===i?void 0:i.y)&&void 0!==o?o:0)},delta:{x:0,y:0},extent:e.extent,parentNode:e.parentNode,width:e.width,height:e.height}})}function La(e){var t=e.nodeId,n=e.dragItems,r=e.nodeInternals,o=n.map(function(e){return ja(ja({},r.get(e.id)),{},{position:e.position,positionAbsolute:e.positionAbsolute})});return[t?o.find(function(e){return e.id===t}):o[0],o]}function Ba(e){return function(t,n,r){return null==e?void 0:e(t,r)}}function Ua(e){var t=e.nodeRef,r=e.disabled,o=void 0!==r&&r,i=e.noDragClassName,a=e.handleSelector,c=e.nodeId,s=e.isSelectable,l=e.selectNodesOnDrag,u=jr((0,n.useState)(!1),2),d=u[0],h=u[1],g=Po(),f=(0,n.useRef)(),p=(0,n.useRef)({x:null,y:null}),v=(0,n.useCallback)(function(e){var t=e.sourceEvent,n=g.getState(),r=n.transform,o=n.snapGrid,i=n.snapToGrid,a=t.touches?t.touches[0].clientX:t.clientX,c=t.touches?t.touches[0].clientY:t.clientY;return co({x:a,y:c},r,i,o)},[]);return(0,n.useEffect)(function(){if(null!=t&&t.current){var e=ht(t.current);if(!o){var n=function(){var e,t,n,r,o=ei,i=ti,a=ni,c=ri,s={},l=$("start","drag","end"),u=0,d=0;function h(e){e.on("mousedown.drag",g).filter(c).on("touchstart.drag",v).on("touchmove.drag",m,gt).on("touchend.drag touchcancel.drag",y).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function g(a,c){if(!r&&o.call(this,a,c)){var s=w(this,i.call(this,a,c),a,c,"mouse");s&&(ht(a.view).on("mousemove.drag",f,ft).on("mouseup.drag",p,ft),mt(a.view),pt(a),n=!1,e=a.clientX,t=a.clientY,s("start",a))}}function f(r){if(vt(r),!n){var o=r.clientX-e,i=r.clientY-t;n=o*o+i*i>d}s.mouse("drag",r)}function p(e){ht(e.view).on("mousemove.drag mouseup.drag",null),yt(e.view,n),vt(e),s.mouse("end",e)}function v(e,t){if(o.call(this,e,t)){var n,r,a=e.changedTouches,c=i.call(this,e,t),s=a.length;for(n=0;n<s;++n)(r=w(this,c,e,t,a[n].identifier,a[n]))&&(pt(e),r("start",e,a[n]))}}function m(e){var t,n,r=e.changedTouches,o=r.length;for(t=0;t<o;++t)(n=s[r[t].identifier])&&(vt(e),n("drag",e,r[t]))}function y(e){var t,n,o=e.changedTouches,i=o.length;for(r&&clearTimeout(r),r=setTimeout(function(){r=null},500),t=0;t<i;++t)(n=s[o[t].identifier])&&(pt(e),n("end",e,o[t]))}function w(e,t,n,r,o,i){var c,d,g,f=l.copy(),p=Ct(i||n,t);if(null!=(g=a.call(e,new $o("beforestart",{sourceEvent:n,target:h,identifier:o,active:u,x:p[0],y:p[1],dx:0,dy:0,dispatch:f}),r)))return c=g.x-p[0]||0,d=g.y-p[1]||0,function n(i,a,l){var v,m=p;switch(i){case"start":s[o]=n,v=u++;break;case"end":delete s[o],--u;case"drag":p=Ct(l||a,t),v=u}f.call(i,e,new $o(i,{sourceEvent:a,subject:g,target:h,identifier:o,active:v,x:p[0]+c,y:p[1]+d,dx:p[0]-m[0],dy:p[1]-m[1],dispatch:f}),r)}}return h.filter=function(e){return arguments.length?(o="function"==typeof e?e:Jo(!!e),h):o},h.container=function(e){return arguments.length?(i="function"==typeof e?e:Jo(e),h):i},h.subject=function(e){return arguments.length?(a="function"==typeof e?e:Jo(e),h):a},h.touchable=function(e){return arguments.length?(c="function"==typeof e?e:Jo(!!e),h):c},h.on=function(){var e=l.on.apply(l,arguments);return e===l?h:e},h.clickDistance=function(e){return arguments.length?(d=(e=+e)*e,h):Math.sqrt(d)},h}().on("start",function(e){var t,n=g.getState(),r=n.nodeInternals,o=n.multiSelectionActive,i=n.unselectNodesAndEdges,a=n.onNodeDragStart,u=n.onSelectionDragStart,d=c?a:Ba(u);l||o||!c||null!==(t=r.get(c))&&void 0!==t&&t.selected||i(),c&&s&&l&&no({id:c,store:g});var h=v(e);if(p.current=h,f.current=Ha(r,h,c),d&&f.current){var m=jr(La({nodeId:c,dragItems:f.current,nodeInternals:r}),2),y=m[0],w=m[1];d(e.sourceEvent,y,w)}}).on("drag",function(e){var t=g.getState(),n=t.updateNodePositions,r=t.snapToGrid,o=t.snapGrid,i=t.nodeInternals,a=t.nodeExtent,s=t.onNodeDrag,l=t.onSelectionDrag,u=v(e);if((p.current.x!==u.x||p.current.y!==u.y)&&f.current){p.current=u,f.current=f.current.map(function(e){return function(e,t,n,r,o,i){var a=jr(r,2),c=a[0],s=a[1],l=e.extent||i,u={x:t.x-e.distance.x,y:t.y-e.distance.y};if(n&&(u.x=c*Math.round(u.x/c),u.y=s*Math.round(u.y/s)),"parent"===e.extent)if(e.parentNode&&e.width&&e.height){var d=o.get(e.parentNode);l=null!=d&&d.positionAbsolute&&null!=d&&d.width&&null!=d&&d.height?[[d.positionAbsolute.x,d.positionAbsolute.y],[d.positionAbsolute.x+d.width-e.width,d.positionAbsolute.y+d.height-e.height]]:l}else l=i;else if(e.extent&&e.parentNode){var h,g,f,p,v=o.get(e.parentNode),m=null!==(h=null==v||null===(g=v.positionAbsolute)||void 0===g?void 0:g.x)&&void 0!==h?h:0,y=null!==(f=null==v||null===(p=v.positionAbsolute)||void 0===p?void 0:p.y)&&void 0!==f?f:0;l=[[e.extent[0][0]+m,e.extent[0][1]+y],[e.extent[1][0]+m,e.extent[1][1]+y]]}var w={x:0,y:0};if(e.parentNode){var b,C,k,S,I=o.get(e.parentNode);w={x:null!==(b=null==I||null===(C=I.positionAbsolute)||void 0===C?void 0:C.x)&&void 0!==b?b:0,y:null!==(k=null==I||null===(S=I.positionAbsolute)||void 0===S?void 0:S.y)&&void 0!==k?k:0}}return e.positionAbsolute=l?Hr(u,l):u,e.position={x:e.positionAbsolute.x-w.x,y:e.positionAbsolute.y-w.y},e}(e,u,r,o,i,a)});var d=c?s:Ba(l);if(n(f.current,!0,!0),h(!0),d){var m=jr(La({nodeId:c,dragItems:f.current,nodeInternals:i}),2),y=m[0],w=m[1];d(e.sourceEvent,y,w)}}e.on("end",function(e){if(h(!1),f.current){var t=g.getState(),n=t.updateNodePositions,r=t.nodeInternals,o=t.onNodeDragStop,i=t.onSelectionDragStop,a=c?o:Ba(i);if(n(f.current,!1,!1),a){var s=jr(La({nodeId:c,dragItems:f.current,nodeInternals:r}),2),l=s[0],u=s[1];a(e.sourceEvent,l,u)}}})}).filter(function(e){var n=e.target;return!e.button&&(!i||!qa(n,".".concat(i),t))&&(!a||qa(n,a,t))});return e.call(n),function(){e.on(".drag",null)}}e.on(".drag",null)}},[t,o,i,a,s,g,c,l,v]),d}function za(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var Ka=function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?za(Object(n),!0).forEach(function(t){xr(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):za(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({transformString:"translate(".concat(e.transform[0],"px,").concat(e.transform[1],"px) scale(").concat(e.transform[2],")"),userSelectionActive:e.userSelectionActive},so(Array.from(e.nodeInternals.values()).filter(function(e){return e.selected})))},Fa=function(e){var t=Array.from(e.nodeInternals.values()).filter(function(e){return e.selected});return so(t)};function Va(e){var t=e.onSelectionContextMenu,o=e.noPanClassName,i=Po(),a=Ao(Ka,No),c=a.transformString,s=a.userSelectionActive,l=Ao(Fa,No),u=l.width,d=l.height,h=l.x,g=l.y,f=(0,n.useRef)(null);if(Ua({nodeRef:f}),s||!u||!d)return null;var p=t?function(e){var n=Array.from(i.getState().nodeInternals.values()).filter(function(e){return e.selected});t(e,n)}:void 0;return r().createElement("div",{className:xo(["react-flow__nodesselection","react-flow__container",o]),style:{transform:c}},r().createElement("div",{ref:f,className:"react-flow__nodesselection-rect",onContextMenu:p,style:{width:u,height:d,top:g,left:h}}))}var Ya=(0,n.memo)(Va),Ga=function(e){return e.nodesSelectionActive},Wa=function(e){var t=e.children,o=e.onPaneClick,i=e.onPaneContextMenu,a=e.onPaneScroll,c=e.deleteKeyCode,s=e.onMove,l=e.onMoveStart,u=e.onMoveEnd,d=e.selectionKeyCode,h=e.multiSelectionKeyCode,g=e.zoomActivationKeyCode,f=e.elementsSelectable,p=e.zoomOnScroll,v=e.zoomOnPinch,m=e.panOnScroll,y=e.panOnScrollSpeed,w=e.panOnScrollMode,b=e.zoomOnDoubleClick,C=e.panOnDrag,k=e.translateExtent,S=e.minZoom,I=e.maxZoom,E=e.defaultZoom,_=e.defaultPosition,T=e.preventScrolling,O=e.onSelectionContextMenu,A=e.noWheelClassName,P=e.noPanClassName,M=Po(),x=Ao(Ga),N=wa(d);!function(e){var t=e.deleteKeyCode,r=e.multiSelectionKeyCode,o=Po(),i=Ao(Sa,No),a=i.onNodesChange,c=i.onEdgesChange,s=wa(t),l=wa(r);(0,n.useEffect)(function(){var e=o.getState(),t=e.nodeInternals,n=e.edges,r=e.hasDefaultNodes,i=e.hasDefaultEdges,l=e.onNodesDelete,u=e.onEdgesDelete,d=Array.from(t.values()).reduce(function(e,t){return(!t.selected&&t.parentNode&&e.find(function(e){return e.id===t.parentNode})||t.selected)&&e.push(t),e},[]),h=n.filter(function(e){return e.selected});if(s&&(d||h)){var g=uo(d,n),f=[].concat(Ro(h),Ro(g)),p=f.reduce(function(e,t){return e.includes(t.id)||e.push(t.id),e},[]);if((i||r)&&(i&&o.setState({edges:n.filter(function(e){return!p.includes(e.id)})}),r&&(d.forEach(function(e){t.delete(e.id)}),o.setState({nodeInternals:new Map(t)}))),p.length>0&&(null==u||u(f),c)){var v=p.map(function(e){return{id:e,type:"remove"}});c(v)}if(d.length>0&&(null==l||l(d),a)){var m=d.map(function(e){return{id:e.id,type:"remove"}});a(m)}o.setState({nodesSelectionActive:!1})}},[s,a,c]),(0,n.useEffect)(function(){o.setState({multiSelectionActive:l})},[l])}({deleteKeyCode:c,multiSelectionKeyCode:h});var R=i?function(e){return i(e)}:void 0,j=a?function(e){return a(e)}:void 0;return r().createElement(Ta,{onMove:s,onMoveStart:l,onMoveEnd:u,selectionKeyPressed:N,elementsSelectable:f,zoomOnScroll:p,zoomOnPinch:v,panOnScroll:m,panOnScrollSpeed:y,panOnScrollMode:w,zoomOnDoubleClick:b,panOnDrag:C,translateExtent:k,minZoom:S,maxZoom:I,defaultZoom:E,defaultPosition:_,zoomActivationKeyCode:g,preventScrolling:T,noWheelClassName:A,noPanClassName:P},t,r().createElement(Na,{selectionKeyPressed:N}),x&&r().createElement(Ya,{onSelectionContextMenu:O,noPanClassName:P}),r().createElement("div",{className:"react-flow__pane react-flow__container",onClick:function(e){null==o||o(e),M.getState().resetSelectedElements(),M.setState({nodesSelectionActive:!1})},onContextMenu:R,onWheel:j}))};Wa.displayName="FlowRenderer";var Za=(0,n.memo)(Wa),Qa=function(e){return{nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,elementsSelectable:e.elementsSelectable,updateNodeDimensions:e.updateNodeDimensions}},Xa=function(e){var t,o=Ao(Qa,No),i=o.nodesDraggable,a=o.nodesConnectable,c=o.elementsSelectable,s=o.updateNodeDimensions,l=(t=e.onlyRenderVisibleElements,Ao((0,n.useCallback)(function(e){return t?lo(e.nodeInternals,{x:0,y:0,width:e.width,height:e.height},e.transform,!0):Array.from(e.nodeInternals.values())},[t]))),u=(0,n.useRef)(),d=(0,n.useMemo)(function(){if("undefined"==typeof ResizeObserver)return null;var e=new ResizeObserver(function(e){var t=e.map(function(e){return{id:e.target.getAttribute("data-id"),nodeElement:e.target,forceUpdate:!0}});s(t)});return u.current=e,e},[]);return(0,n.useEffect)(function(){return function(){var e;null==u||null===(e=u.current)||void 0===e||e.disconnect()}},[]),r().createElement("div",{className:"react-flow__nodes react-flow__container"},l.map(function(t){var n,o,s,l,u,h,g,f=t.type||"default";e.nodeTypes[f]||(f="default");var p=e.nodeTypes[f]||e.nodeTypes.default,v=!!(t.draggable||i&&void 0===t.draggable),m=!!(t.selectable||c&&void 0===t.selectable),y=!!(t.connectable||a&&void 0===t.connectable);return r().createElement(p,{key:t.id,id:t.id,className:t.className,style:t.style,type:f,data:t.data,sourcePosition:t.sourcePosition||kr.Bottom,targetPosition:t.targetPosition||kr.Top,hidden:t.hidden,xPos:null!==(n=null===(o=t.positionAbsolute)||void 0===o?void 0:o.x)&&void 0!==n?n:0,yPos:null!==(s=null===(l=t.positionAbsolute)||void 0===l?void 0:l.y)&&void 0!==s?s:0,selectNodesOnDrag:e.selectNodesOnDrag,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,selected:!!t.selected,isDraggable:v,isSelectable:m,isConnectable:y,resizeObserver:d,dragHandle:t.dragHandle,zIndex:null!==(u=null===(h=t[Fr])||void 0===h?void 0:h.z)&&void 0!==u?u:0,isParent:!(null===(g=t[Fr])||void 0===g||!g.isParent),noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,initialized:!!t.width&&!!t.height})}))};Xa.displayName="NodeRenderer";var Ja,$a=(0,n.memo)(Xa);function ec(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function tc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ec(Object(n),!0).forEach(function(t){xr(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ec(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var nc,rc=(xr(Ja={},kr.Left,kr.Right),xr(Ja,kr.Right,kr.Left),xr(Ja,kr.Top,kr.Bottom),xr(Ja,kr.Bottom,kr.Top),Ja),oc=function(e){var t,o,i,a,c,s=e.connectionNodeId,l=e.connectionHandleType,u=e.connectionLineStyle,d=e.connectionLineType,h=void 0===d?br.Bezier:d,g=e.isConnectable,f=e.CustomConnectionLineComponent,p=Ao((0,n.useCallback)(function(e){return{fromNode:e.nodeInternals.get(s),handleId:e.connectionHandleId,toX:(e.connectionPosition.x-e.transform[0])/e.transform[2],toY:(e.connectionPosition.y-e.transform[1])/e.transform[2]}},[s]),No),v=p.fromNode,m=p.handleId,y=p.toX,w=p.toY,b=null==v||null===(t=v[Fr])||void 0===t?void 0:t.handleBounds;if(!v||!g||null==b||!b[l])return null;var C=b[l],k=m?C.find(function(e){return e.id===m}):C[0],S=k?k.x+k.width/2:(null!==(o=null==v?void 0:v.width)&&void 0!==o?o:0)/2,I=k?k.y+k.height/2:null!==(i=null==v?void 0:v.height)&&void 0!==i?i:0,E=((null==v||null===(a=v.positionAbsolute)||void 0===a?void 0:a.x)||0)+S,_=((null==v||null===(c=v.positionAbsolute)||void 0===c?void 0:c.y)||0)+I,T=null==k?void 0:k.position;if(!T)return null;var O,A,P,M,x,N,R=rc[T];switch(l){case"source":O=E,A=_,P=T,M=y,x=w,N=R;break;case"target":O=y,A=w,P=R,M=E,x=_,N=T}if(f)return r().createElement("g",{className:"react-flow__connection"},r().createElement(f,{connectionLineType:h,connectionLineStyle:u,fromNode:v,fromHandle:k,fromX:E,fromY:_,toX:y,toY:w,fromPosition:T,toPosition:R,sourcePosition:P,targetPosition:N,sourceNode:v,sourceHandle:k,targetX:M,targetY:x,sourceX:O,sourceY:A}));var j,D={sourceX:O,sourceY:A,sourcePosition:P,targetX:M,targetY:x,targetPosition:N};return j=h===br.Bezier?Ri(D):h===br.Step?_i(tc(tc({},D),{},{borderRadius:0})):h===br.SmoothStep?_i(D):h===br.SimpleBezier?hi(D):"M".concat(O,",").concat(A," ").concat(M,",").concat(x),r().createElement("g",{className:"react-flow__connection"},r().createElement("path",{d:j,className:"react-flow__connection-path",style:u}))};function ic(e){return ic="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ic(e)}var ac=(xr(nc={},Cr.Arrow,function(e){var t=e.color,n=void 0===t?"none":t,o=e.strokeWidth,i=void 0===o?1:o;return r().createElement("polyline",{stroke:n,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:i,fill:"none",points:"-5,-4 0,0 -5,4"})}),xr(nc,Cr.ArrowClosed,function(e){var t=e.color,n=void 0===t?"none":t,o=e.strokeWidth,i=void 0===o?1:o;return r().createElement("polyline",{stroke:n,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:i,fill:n,points:"-5,-4 0,0 -5,4 -5,-4"})}),nc);function cc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var sc=function(e){var t=e.id,o=e.type,i=e.color,a=e.width,c=void 0===a?12.5:a,s=e.height,l=void 0===s?12.5:s,u=e.markerUnits,d=void 0===u?"strokeWidth":u,h=e.strokeWidth,g=e.orient,f=void 0===g?"auto":g,p=function(e){return(0,n.useMemo)(function(){return ac.hasOwnProperty(e)?ac[e]:function(){return null}},[e])}(o);return r().createElement("marker",{className:"react-flow__arrowhead",id:t,markerWidth:"".concat(c),markerHeight:"".concat(l),viewBox:"-10 -10 20 20",markerUnits:d,orient:f,refX:"0",refY:"0"},r().createElement(p,{color:i,strokeWidth:h}))},lc=function(e){var t=e.defaultColor,o=e.rfId,i=Ao((0,n.useCallback)(function(e){var t=e.defaultColor,n=e.rfId;return function(e){var r=[];return e.edges.reduce(function(e,o){return[o.markerStart,o.markerEnd].forEach(function(o){if(o&&"object"===ic(o)){var i=io(o,n);r.includes(i)||(e.push(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?cc(Object(n),!0).forEach(function(t){xr(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cc(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({id:i,color:o.color||t},o)),r.push(i))}}),e},[]).sort(function(e,t){return e.id.localeCompare(t.id)})}}({defaultColor:t,rfId:o}),[t,o]),function(e,t){return!(e.length!==t.length||e.some(function(e,n){return e.id!==t[n].id}))});return r().createElement("defs",null,i.map(function(e){return r().createElement(sc,{id:e.id,key:e.id,type:e.type,color:e.color,width:e.width,height:e.height,markerUnits:e.markerUnits,strokeWidth:e.strokeWidth,orient:e.orient})}))};lc.displayName="MarkerDefinitions";var uc=(0,n.memo)(lc),dc=[{level:0,isMaxLevel:!0,edges:[]}];var hc=function(e){return{connectionNodeId:e.connectionNodeId,connectionHandleType:e.connectionHandleType,nodesConnectable:e.nodesConnectable,elementsSelectable:e.elementsSelectable,width:e.width,height:e.height,connectionMode:e.connectionMode,nodeInternals:e.nodeInternals}},gc=function(e){var t=Ao(hc,No),o=t.connectionNodeId,i=t.connectionHandleType,a=t.nodesConnectable,c=t.elementsSelectable,s=t.width,l=t.height,u=t.connectionMode,d=t.nodeInternals,h=function(e,t,r){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=-1,o=e.reduce(function(e,o){var i,a,c,s,l=Kr(o.zIndex),u=l?o.zIndex:0;return n&&(u=l?o.zIndex:Math.max((null===(i=t.get(o.source))||void 0===i||null===(a=i[Fr])||void 0===a?void 0:a.z)||0,(null===(c=t.get(o.target))||void 0===c||null===(s=c[Fr])||void 0===s?void 0:s.z)||0)),e[u]?e[u].push(o):e[u]=[o],r=u>r?u:r,e},{}),i=Object.entries(o).map(function(e){var t=jr(e,2),n=+t[0];return{edges:t[1],level:n,isMaxLevel:n===r}});return 0===i.length?dc:i}(Ao((0,n.useCallback)(function(n){return e?n.edges.filter(function(e){var r=t.get(e.source),o=t.get(e.target);return(null==r?void 0:r.width)&&(null==r?void 0:r.height)&&(null==o?void 0:o.width)&&(null==o?void 0:o.height)&&function(e){var t=e.sourcePos,n=e.targetPos,r=e.sourceWidth,o=e.sourceHeight,i=e.targetWidth,a=e.targetHeight,c=e.width,s=e.height,l=e.transform,u={x:Math.min(t.x,n.x),y:Math.min(t.y,n.y),x2:Math.max(t.x+r,n.x+i),y2:Math.max(t.y+o,n.y+a)};u.x===u.x2&&(u.x2+=1),u.y===u.y2&&(u.y2+=1);var d=Ur({x:(0-l[0])/l[2],y:(0-l[1])/l[2],width:c/l[2],height:s/l[2]}),h=Math.max(0,Math.min(d.x2,u.x2)-Math.max(d.x,u.x)),g=Math.max(0,Math.min(d.y2,u.y2)-Math.max(d.y,u.y));return Math.ceil(h*g)>0}({sourcePos:r.positionAbsolute||{x:0,y:0},targetPos:o.positionAbsolute||{x:0,y:0},sourceWidth:r.width,sourceHeight:r.height,targetWidth:o.width,targetHeight:o.height,width:n.width,height:n.height,transform:n.transform})}):n.edges},[e,t])),t,r)}(e.onlyRenderVisibleElements,d,e.elevateEdgesOnSelect);if(!s)return null;var g=e.connectionLineType,f=e.defaultMarkerColor,p=e.connectionLineStyle,v=e.connectionLineComponent,m=e.connectionLineContainerStyle,y=o&&i;return r().createElement(r().Fragment,null,h.map(function(t){var n=t.level,o=t.edges,i=t.isMaxLevel;return r().createElement("svg",{key:n,style:{zIndex:n},width:s,height:l,className:"react-flow__edges react-flow__container"},i&&r().createElement(uc,{defaultColor:f,rfId:e.rfId}),r().createElement("g",null,o.map(function(t){var n=jr(ma(d,t.source),3),o=n[0],i=n[1],a=n[2],s=jr(ma(d,t.target),3),l=s[0],h=s[1],g=s[2];if(!a||!g)return null;var f=t.type||"default";e.edgeTypes[f]||(console.warn('[React Flow]: Edge type "'.concat(f,'" not found. Using fallback type "default". Help: https://reactflow.dev/error#300')),f="default");var p=e.edgeTypes[f]||e.edgeTypes.default,v=u===mr.Strict?h.target:h.target||h.source,m=va(i.source,t.sourceHandle||null),y=va(v,t.targetHandle||null),w=(null==m?void 0:m.position)||kr.Bottom,b=(null==y?void 0:y.position)||kr.Top;if(!m)return null;if(!y)return null;var C=function(e,t,n,r,o,i){var a=pa(n,e,t),c=pa(i,r,o);return{sourceX:a.x,sourceY:a.y,targetX:c.x,targetY:c.y}}(o,m,w,l,y,b),k=C.sourceX,S=C.sourceY,I=C.targetX,E=C.targetY;return r().createElement(p,{key:t.id,id:t.id,className:xo([t.className,e.noPanClassName]),type:f,data:t.data,selected:!!t.selected,animated:!!t.animated,hidden:!!t.hidden,label:t.label,labelStyle:t.labelStyle,labelShowBg:t.labelShowBg,labelBgStyle:t.labelBgStyle,labelBgPadding:t.labelBgPadding,labelBgBorderRadius:t.labelBgBorderRadius,style:t.style,source:t.source,target:t.target,sourceHandleId:t.sourceHandle,targetHandleId:t.targetHandle,markerEnd:t.markerEnd,markerStart:t.markerStart,sourceX:k,sourceY:S,targetX:I,targetY:E,sourcePosition:w,targetPosition:b,elementsSelectable:c,onEdgeUpdate:e.onEdgeUpdate,onContextMenu:e.onEdgeContextMenu,onMouseEnter:e.onEdgeMouseEnter,onMouseMove:e.onEdgeMouseMove,onMouseLeave:e.onEdgeMouseLeave,onClick:e.onEdgeClick,edgeUpdaterRadius:e.edgeUpdaterRadius,onEdgeDoubleClick:e.onEdgeDoubleClick,onEdgeUpdateStart:e.onEdgeUpdateStart,onEdgeUpdateEnd:e.onEdgeUpdateEnd,rfId:e.rfId})})))}),y&&r().createElement("svg",{style:m,width:s,height:l,className:"react-flow__edges react-flow__connectionline react-flow__container"},r().createElement(oc,{connectionNodeId:o,connectionHandleType:i,connectionLineStyle:p,connectionLineType:g,isConnectable:a,CustomConnectionLineComponent:v})))};gc.displayName="EdgeRenderer";var fc=(0,n.memo)(gc),pc=function(e){return"translate(".concat(e.transform[0],"px,").concat(e.transform[1],"px) scale(").concat(e.transform[2],")")};function vc(e){var t=e.children,n=Ao(pc);return r().createElement("div",{className:"react-flow__viewport react-flow__container",style:{transform:n}},t)}var mc=function(e){var t=e.nodeTypes,o=e.edgeTypes,i=e.onMove,a=e.onMoveStart,c=e.onMoveEnd,s=e.onInit,l=e.onNodeClick,u=e.onEdgeClick,d=e.onNodeDoubleClick,h=e.onEdgeDoubleClick,g=e.onNodeMouseEnter,f=e.onNodeMouseMove,p=e.onNodeMouseLeave,v=e.onNodeContextMenu,m=e.onSelectionContextMenu,y=e.connectionLineType,w=e.connectionLineStyle,b=e.connectionLineComponent,C=e.connectionLineContainerStyle,k=e.selectionKeyCode,S=e.multiSelectionKeyCode,I=e.zoomActivationKeyCode,E=e.deleteKeyCode,_=e.onlyRenderVisibleElements,T=e.elementsSelectable,O=e.selectNodesOnDrag,A=e.translateExtent,P=e.minZoom,M=e.maxZoom,x=e.defaultZoom,N=e.defaultPosition,R=e.preventScrolling,j=e.defaultMarkerColor,D=e.zoomOnScroll,q=e.zoomOnPinch,H=e.panOnScroll,L=e.panOnScrollSpeed,B=e.panOnScrollMode,U=e.zoomOnDoubleClick,z=e.panOnDrag,K=e.onPaneClick,F=e.onPaneScroll,V=e.onPaneContextMenu,Y=e.onEdgeUpdate,G=e.onEdgeContextMenu,W=e.onEdgeMouseEnter,Z=e.onEdgeMouseMove,Q=e.onEdgeMouseLeave,X=e.edgeUpdaterRadius,J=e.onEdgeUpdateStart,$=e.onEdgeUpdateEnd,ee=e.noDragClassName,te=e.noWheelClassName,ne=e.noPanClassName,re=e.elevateEdgesOnSelect,oe=e.id;return function(e){var t=Lo(),r=(0,n.useRef)(!1);(0,n.useEffect)(function(){!r.current&&t.viewportInitialized&&e&&(setTimeout(function(){return e(t)},1),r.current=!0)},[e,t.viewportInitialized])}(s),r().createElement(Za,{onPaneClick:K,onPaneContextMenu:V,onPaneScroll:F,deleteKeyCode:E,selectionKeyCode:k,multiSelectionKeyCode:S,zoomActivationKeyCode:I,elementsSelectable:T,onMove:i,onMoveStart:a,onMoveEnd:c,zoomOnScroll:D,zoomOnPinch:q,zoomOnDoubleClick:U,panOnScroll:H,panOnScrollSpeed:L,panOnScrollMode:B,panOnDrag:z,translateExtent:A,minZoom:P,maxZoom:M,defaultZoom:x,defaultPosition:N,onSelectionContextMenu:m,preventScrolling:R,noDragClassName:ee,noWheelClassName:te,noPanClassName:ne},r().createElement(vc,null,r().createElement(fc,{edgeTypes:o,onEdgeClick:u,onEdgeDoubleClick:h,connectionLineType:y,connectionLineStyle:w,connectionLineComponent:b,connectionLineContainerStyle:C,onEdgeUpdate:Y,onlyRenderVisibleElements:_,onEdgeContextMenu:G,onEdgeMouseEnter:W,onEdgeMouseMove:Z,onEdgeMouseLeave:Q,onEdgeUpdateStart:J,onEdgeUpdateEnd:$,edgeUpdaterRadius:X,defaultMarkerColor:j,noPanClassName:ne,elevateEdgesOnSelect:!!re,rfId:oe}),r().createElement($a,{nodeTypes:t,onNodeClick:l,onNodeDoubleClick:d,onNodeMouseEnter:g,onNodeMouseMove:f,onNodeMouseLeave:p,onNodeContextMenu:v,selectNodesOnDrag:O,onlyRenderVisibleElements:_,noPanClassName:ne,noDragClassName:ee})))};mc.displayName="GraphView";var yc=(0,n.memo)(mc),wc=function(){return null};function bc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Cc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bc(Object(n),!0).forEach(function(t){xr(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bc(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}wc.displayName="GroupNode";var kc=function(e){var t=function(t){var o=t.id,i=t.type,a=t.data,c=t.xPos,s=t.yPos,l=t.selected,u=t.onClick,d=t.onMouseEnter,h=t.onMouseMove,g=t.onMouseLeave,f=t.onContextMenu,p=t.onDoubleClick,v=t.style,m=t.className,y=t.isDraggable,w=t.isSelectable,b=t.isConnectable,C=t.selectNodesOnDrag,k=t.sourcePosition,S=t.targetPosition,I=t.hidden,E=t.resizeObserver,_=t.dragHandle,T=t.zIndex,O=t.isParent,A=t.noPanClassName,P=t.noDragClassName,M=t.initialized,x=Po(),N=(0,n.useRef)(null),R=(0,n.useRef)(k),j=(0,n.useRef)(S),D=(0,n.useRef)(i),q=w||y||u||d||h||g,H=to(o,x.getState,d),L=to(o,x.getState,h),B=to(o,x.getState,g),U=to(o,x.getState,f),z=to(o,x.getState,p);(0,n.useEffect)(function(){if(N.current&&!I){var e=N.current;return null==E||E.observe(e),function(){return null==E?void 0:E.unobserve(e)}}},[I]),(0,n.useEffect)(function(){var e=D.current!==i,t=R.current!==k,n=j.current!==S;N.current&&(e||t||n)&&(e&&(D.current=i),t&&(R.current=k),n&&(j.current=S),x.getState().updateNodeDimensions([{id:o,nodeElement:N.current,forceUpdate:!0}]))},[o,i,k,S]);var K=Ua({nodeRef:N,disabled:I||!y,noDragClassName:P,handleSelector:_,nodeId:o,isSelectable:w,selectNodesOnDrag:C});return I?null:r().createElement("div",{className:xo(["react-flow__node","react-flow__node-".concat(i),A,m,{selected:l,selectable:w,parent:O}]),ref:N,style:Cc({zIndex:T,transform:"translate(".concat(c,"px,").concat(s,"px)"),pointerEvents:q?"all":"none",visibility:M?"visible":"hidden"},v),onMouseEnter:H,onMouseMove:L,onMouseLeave:B,onContextMenu:U,onClick:function(e){if(!w||C&&y||no({id:o,store:x}),u){var t=x.getState().nodeInternals.get(o);u(e,Cc({},t))}},onDoubleClick:z,"data-testid":"rf__node-".concat(o),"data-id":o},r().createElement(qi,{value:o},r().createElement(e,{id:o,data:a,type:i,xPos:c,yPos:s,selected:l,isConnectable:b,sourcePosition:k,targetPosition:S,dragging:K,dragHandle:_,zIndex:T})))};return t.displayName="NodeWrapper",(0,n.memo)(t)};function Sc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Ic(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Sc(Object(n),!0).forEach(function(t){xr(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Sc(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Ec(e){var t={input:kc(e.input||Xi),default:kc(e.default||Zi),output:kc(e.output||$i),group:kc(e.group||wc)},n=Object.keys(e).filter(function(e){return!["input","default","output","group"].includes(e)}).reduce(function(t,n){return t[n]=kc(e[n]||Zi),t},{});return Ic(Ic({},t),n)}function _c(e,t){return(0,n.useRef)(null),(0,n.useMemo)(function(){return t(e)},[e])}function Tc(e){if(e&&"undefined"!=typeof document){var t=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");t.appendChild(n),n.appendChild(document.createTextNode(e))}}var Oc=function(e){var t=e.children,n=!0;try{Po()}catch(e){n=!1}return n?r().createElement(r().Fragment,null,t):r().createElement(Oo,{createStore:Mo},t)};Oc.displayName="ReactFlowWrapper";var Ac=["nodes","edges","defaultNodes","defaultEdges","className","nodeTypes","edgeTypes","onNodeClick","onEdgeClick","onInit","onMove","onMoveStart","onMoveEnd","onConnect","onConnectStart","onConnectStop","onConnectEnd","onClickConnectStart","onClickConnectStop","onClickConnectEnd","onNodeMouseEnter","onNodeMouseMove","onNodeMouseLeave","onNodeContextMenu","onNodeDoubleClick","onNodeDragStart","onNodeDrag","onNodeDragStop","onNodesDelete","onEdgesDelete","onSelectionChange","onSelectionDragStart","onSelectionDrag","onSelectionDragStop","onSelectionContextMenu","connectionMode","connectionLineType","connectionLineStyle","connectionLineComponent","connectionLineContainerStyle","deleteKeyCode","selectionKeyCode","multiSelectionKeyCode","zoomActivationKeyCode","snapToGrid","snapGrid","onlyRenderVisibleElements","selectNodesOnDrag","nodesDraggable","nodesConnectable","elementsSelectable","minZoom","maxZoom","defaultZoom","defaultPosition","translateExtent","preventScrolling","nodeExtent","defaultMarkerColor","zoomOnScroll","zoomOnPinch","panOnScroll","panOnScrollSpeed","panOnScrollMode","zoomOnDoubleClick","panOnDrag","onPaneClick","onPaneScroll","onPaneContextMenu","children","onEdgeUpdate","onEdgeContextMenu","onEdgeDoubleClick","onEdgeMouseEnter","onEdgeMouseMove","onEdgeMouseLeave","onEdgeUpdateStart","onEdgeUpdateEnd","edgeUpdaterRadius","onNodesChange","onEdgesChange","noDragClassName","noWheelClassName","noPanClassName","fitView","fitViewOptions","connectOnClick","attributionPosition","proOptions","defaultEdgeOptions","elevateEdgesOnSelect"];function Pc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Mc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Pc(Object(n),!0).forEach(function(t){xr(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Pc(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}Tc(".react-flow{height:100%;overflow:hidden;position:relative;width:100%}.react-flow__container{height:100%;left:0;position:absolute;top:0;width:100%}.react-flow__pane{z-index:1}.react-flow__viewport{pointer-events:none;transform-origin:0 0;z-index:2}.react-flow__renderer{z-index:4}.react-flow__selectionpane{z-index:5}.react-flow .react-flow__edges{overflow:visible;pointer-events:none}.react-flow .react-flow__connectionline{z-index:1001}.react-flow__edge{pointer-events:visibleStroke}.react-flow__edge.inactive{pointer-events:none}@-webkit-keyframes dashdraw{0%{stroke-dashoffset:10}}@keyframes dashdraw{0%{stroke-dashoffset:10}}.react-flow__edge-path{fill:none}.react-flow__edge-textwrapper{pointer-events:all}.react-flow__edge-text{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.react-flow__connection{pointer-events:none}.react-flow__connection .animated{stroke-dasharray:5;-webkit-animation:dashdraw .5s linear infinite;animation:dashdraw .5s linear infinite}.react-flow__connection-path{fill:none}.react-flow__nodes{pointer-events:none;transform-origin:0 0}.react-flow__node{box-sizing:border-box;pointer-events:all;position:absolute;transform-origin:0 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.react-flow__nodesselection{pointer-events:none;transform-origin:left top;z-index:3}.react-flow__nodesselection-rect{cursor:-webkit-grab;cursor:grab;pointer-events:all;position:absolute}.react-flow__handle{pointer-events:none;position:absolute}.react-flow__handle.connectable{pointer-events:all}.react-flow__handle-bottom{bottom:-4px;left:50%;top:auto;transform:translate(-50%)}.react-flow__handle-top{left:50%;top:-4px;transform:translate(-50%)}.react-flow__handle-left{left:-4px;top:50%;transform:translateY(-50%)}.react-flow__handle-right{right:-4px;top:50%;transform:translateY(-50%)}.react-flow__edgeupdater{cursor:move;pointer-events:all}.react-flow__controls{bottom:20px;left:15px;position:absolute;z-index:5}.react-flow__controls-button{border:none;height:24px;width:24px}.react-flow__controls-button svg{width:100%}.react-flow__minimap{bottom:20px;position:absolute;right:15px;z-index:5}.react-flow__attribution{background:hsla(0,0%,100%,.5);color:#999;font-size:10px;padding:2px 3px;position:absolute;z-index:1000}.react-flow__attribution a{color:#555;text-decoration:none}.react-flow__attribution.top{top:0}.react-flow__attribution.bottom{bottom:0}.react-flow__attribution.left{left:0}.react-flow__attribution.right{right:0}.react-flow__attribution.center{left:50%;transform:translateX(-50%)}"),Tc(".react-flow__edge.selected .react-flow__edge-path{stroke:#555}.react-flow__edge.animated path{stroke-dasharray:5;-webkit-animation:dashdraw .5s linear infinite;animation:dashdraw .5s linear infinite}.react-flow__edge.updating .react-flow__edge-path{stroke:#777}.react-flow__edge-path{stroke:#b1b1b7;stroke-width:1}.react-flow__edge-text{font-size:10px}.react-flow__edge-textbg{fill:#fff}.react-flow__connection-path{stroke:#b1b1b7;stroke-width:1}.react-flow__node{cursor:-webkit-grab;cursor:grab}.react-flow__node-default,.react-flow__node-group,.react-flow__node-input,.react-flow__node-output{background:#fff;border:1px solid #1a192b;border-radius:3px;color:#222;font-size:12px;padding:10px;text-align:center;width:150px}.react-flow__node-default.selected,.react-flow__node-group.selected,.react-flow__node-input.selected,.react-flow__node-output.selected{box-shadow:0 0 0 .5px #1a192b}.react-flow__node-default .react-flow__handle,.react-flow__node-group .react-flow__handle,.react-flow__node-input .react-flow__handle,.react-flow__node-output .react-flow__handle{background:#1a192b}.react-flow__node-default.selectable:hover,.react-flow__node-group.selectable:hover,.react-flow__node-input.selectable:hover,.react-flow__node-output.selectable:hover{box-shadow:0 1px 4px 1px rgba(0,0,0,.08)}.react-flow__node-default.selectable.selected,.react-flow__node-group.selectable.selected,.react-flow__node-input.selectable.selected,.react-flow__node-output.selectable.selected{box-shadow:0 0 0 .5px #1a192b}.react-flow__node-group{background:hsla(0,0%,94%,.25);border-color:#1a192b}.react-flow__nodesselection-rect,.react-flow__selection{background:rgba(0,89,220,.08);border:1px dotted rgba(0,89,220,.8)}.react-flow__handle{background:#555;border:1px solid #fff;border-radius:100%;height:6px;width:6px}.react-flow__handle.connectable{cursor:crosshair}.react-flow__minimap{background-color:#fff}.react-flow__controls{box-shadow:0 0 2px 1px rgba(0,0,0,.08)}.react-flow__controls-button{align-items:center;background:#fefefe;border-bottom:1px solid #eee;box-sizing:content-box;cursor:pointer;display:flex;height:16px;justify-content:center;padding:5px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:16px}.react-flow__controls-button svg{max-height:12px;max-width:12px}.react-flow__controls-button:hover{background:#f4f4f4}");var xc={input:Xi,default:Zi,output:$i},Nc={default:ji,straight:Mi,step:Pi,smoothstep:Ti,simplebezier:gi},Rc=[15,15],jc=[0,0],Dc=(0,n.forwardRef)(function(e,t){var n=e.nodes,o=e.edges,i=e.defaultNodes,a=e.defaultEdges,c=e.className,s=e.nodeTypes,l=void 0===s?xc:s,u=e.edgeTypes,d=void 0===u?Nc:u,h=e.onNodeClick,g=e.onEdgeClick,f=e.onInit,p=e.onMove,v=e.onMoveStart,m=e.onMoveEnd,y=e.onConnect,w=e.onConnectStart,b=e.onConnectStop,C=e.onConnectEnd,k=e.onClickConnectStart,S=e.onClickConnectStop,I=e.onClickConnectEnd,E=e.onNodeMouseEnter,_=e.onNodeMouseMove,T=e.onNodeMouseLeave,O=e.onNodeContextMenu,A=e.onNodeDoubleClick,P=e.onNodeDragStart,M=e.onNodeDrag,x=e.onNodeDragStop,N=e.onNodesDelete,R=e.onEdgesDelete,j=e.onSelectionChange,D=e.onSelectionDragStart,q=e.onSelectionDrag,H=e.onSelectionDragStop,L=e.onSelectionContextMenu,B=e.connectionMode,U=void 0===B?mr.Strict:B,z=e.connectionLineType,K=void 0===z?br.Bezier:z,F=e.connectionLineStyle,V=e.connectionLineComponent,Y=e.connectionLineContainerStyle,G=e.deleteKeyCode,W=void 0===G?"Backspace":G,Z=e.selectionKeyCode,Q=void 0===Z?"Shift":Z,X=e.multiSelectionKeyCode,J=void 0===X?"Meta":X,$=e.zoomActivationKeyCode,ee=void 0===$?"Meta":$,te=e.snapToGrid,ne=void 0!==te&&te,re=e.snapGrid,oe=void 0===re?Rc:re,ie=e.onlyRenderVisibleElements,ae=void 0!==ie&&ie,ce=e.selectNodesOnDrag,se=void 0===ce||ce,le=e.nodesDraggable,ue=e.nodesConnectable,de=e.elementsSelectable,he=e.minZoom,ge=void 0===he?.5:he,fe=e.maxZoom,pe=void 0===fe?2:fe,ve=e.defaultZoom,me=void 0===ve?1:ve,ye=e.defaultPosition,we=void 0===ye?jc:ye,be=e.translateExtent,Ce=void 0===be?ko:be,ke=e.preventScrolling,Se=void 0===ke||ke,Ie=e.nodeExtent,Ee=e.defaultMarkerColor,_e=void 0===Ee?"#b1b1b7":Ee,Te=e.zoomOnScroll,Oe=void 0===Te||Te,Ae=e.zoomOnPinch,Pe=void 0===Ae||Ae,Me=e.panOnScroll,xe=void 0!==Me&&Me,Ne=e.panOnScrollSpeed,Re=void 0===Ne?.5:Ne,je=e.panOnScrollMode,De=void 0===je?wr.Free:je,qe=e.zoomOnDoubleClick,He=void 0===qe||qe,Le=e.panOnDrag,Be=void 0===Le||Le,Ue=e.onPaneClick,ze=e.onPaneScroll,Ke=e.onPaneContextMenu,Fe=e.children,Ve=e.onEdgeUpdate,Ye=e.onEdgeContextMenu,Ge=e.onEdgeDoubleClick,We=e.onEdgeMouseEnter,Ze=e.onEdgeMouseMove,Qe=e.onEdgeMouseLeave,Xe=e.onEdgeUpdateStart,Je=e.onEdgeUpdateEnd,$e=e.edgeUpdaterRadius,et=void 0===$e?10:$e,tt=e.onNodesChange,nt=e.onEdgesChange,rt=e.noDragClassName,ot=void 0===rt?"nodrag":rt,it=e.noWheelClassName,at=void 0===it?"nowheel":it,ct=e.noPanClassName,st=void 0===ct?"nopan":ct,lt=e.fitView,ut=void 0!==lt&&lt,dt=e.fitViewOptions,ht=e.connectOnClick,gt=void 0===ht||ht,ft=e.attributionPosition,pt=e.proOptions,vt=e.defaultEdgeOptions,mt=e.elevateEdgesOnSelect,yt=void 0!==mt&&mt,wt=Bo(e,Ac),bt=_c(l,Ec),Ct=_c(d,fa);return r().createElement("div",Mc(Mc({},wt),{},{ref:t,className:xo(["react-flow",c])}),r().createElement(Oc,null,r().createElement(yc,{onInit:f,onMove:p,onMoveStart:v,onMoveEnd:m,onNodeClick:h,onEdgeClick:g,onNodeMouseEnter:E,onNodeMouseMove:_,onNodeMouseLeave:T,onNodeContextMenu:O,onNodeDoubleClick:A,nodeTypes:bt,edgeTypes:Ct,connectionLineType:K,connectionLineStyle:F,connectionLineComponent:V,connectionLineContainerStyle:Y,selectionKeyCode:Q,deleteKeyCode:W,multiSelectionKeyCode:J,zoomActivationKeyCode:ee,onlyRenderVisibleElements:ae,selectNodesOnDrag:se,translateExtent:Ce,minZoom:ge,maxZoom:pe,defaultZoom:me,defaultPosition:we,preventScrolling:Se,zoomOnScroll:Oe,zoomOnPinch:Pe,zoomOnDoubleClick:He,panOnScroll:xe,panOnScrollSpeed:Re,panOnScrollMode:De,panOnDrag:Be,onPaneClick:Ue,onPaneScroll:ze,onPaneContextMenu:Ke,onSelectionContextMenu:L,onEdgeUpdate:Ve,onEdgeContextMenu:Ye,onEdgeDoubleClick:Ge,onEdgeMouseEnter:We,onEdgeMouseMove:Ze,onEdgeMouseLeave:Qe,onEdgeUpdateStart:Xe,onEdgeUpdateEnd:Je,edgeUpdaterRadius:et,defaultMarkerColor:_e,noDragClassName:ot,noWheelClassName:at,noPanClassName:st,elevateEdgesOnSelect:yt,id:null==wt?void 0:wt.id}),r().createElement(ca,{nodes:n,edges:o,defaultNodes:i,defaultEdges:a,onConnect:y,onConnectStart:w,onConnectStop:b,onConnectEnd:C,onClickConnectStart:k,onClickConnectStop:S,onClickConnectEnd:I,nodesDraggable:le,nodesConnectable:ue,elementsSelectable:de,minZoom:ge,maxZoom:pe,nodeExtent:Ie,onNodesChange:tt,onEdgesChange:nt,snapToGrid:ne,snapGrid:oe,connectionMode:U,translateExtent:Ce,connectOnClick:gt,defaultEdgeOptions:vt,fitView:ut,fitViewOptions:dt,onNodesDelete:N,onEdgesDelete:R,onNodeDragStart:P,onNodeDrag:M,onNodeDragStop:x,onSelectionDrag:q,onSelectionDragStart:D,onSelectionDragStop:H}),j&&r().createElement(ra,{onSelectionChange:j}),Fe,r().createElement(ii,{proOptions:pt,position:ft})))});function qc(e){return function(t){var r=jr((0,n.useState)(t),2),o=r[0],i=r[1],a=(0,n.useCallback)(function(t){return i(function(n){return e(t,n)})},[]);return[o,i,a]}}Dc.displayName="ReactFlow";var Hc,Lc=qc(Zr),Bc=qc(function(e,t){return Wr(e,t)});function Uc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function zc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Uc(Object(n),!0).forEach(function(t){xr(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Uc(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Kc=(xr(Hc={},yr.Dots,"#81818a"),xr(Hc,yr.Lines,"#eee"),Hc),Fc=function(e){return e.transform},Vc=function(e){var t=e.variant,o=void 0===t?yr.Dots:t,i=e.gap,a=void 0===i?15:i,c=e.size,s=void 0===c?.4:c,l=e.color,u=e.style,d=e.className,h=(0,n.useRef)(null),g=jr((0,n.useState)(null),2),f=g[0],p=g[1],v=jr(Ao(Fc),3),m=v[0],y=v[1],w=v[2];(0,n.useEffect)(function(){var e=document.querySelectorAll(".react-flow__background"),t=Array.from(e).findIndex(function(e){return e===h.current});p("pattern-".concat(t))},[]);var b=a*w||1,C=m%b,k=y%b,S=o===yr.Lines,I=l||Kc[o],E=S?function(e,t,n){return r().createElement("path",{stroke:n,strokeWidth:t,d:"M".concat(e/2," 0 V").concat(e," M0 ").concat(e/2," H").concat(e)})}(b,s,I):function(e,t){return r().createElement("circle",{cx:e,cy:e,r:e,fill:t})}(s*w,I);return r().createElement("svg",{className:xo(["react-flow__background","react-flow__container",d]),style:zc(zc({},u),{},{width:"100%",height:"100%"}),ref:h},f&&r().createElement(r().Fragment,null,r().createElement("pattern",{id:f,x:C,y:k,width:b,height:b,patternUnits:"userSpaceOnUse"},E),r().createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#".concat(f,")")})))};Vc.displayName="Background";var Yc=(0,n.memo)(Vc),Gc=function(e){var t=e.x,n=e.y,o=e.width,i=e.height,a=e.style,c=e.color,s=e.strokeColor,l=e.strokeWidth,u=e.className,d=e.borderRadius,h=e.shapeRendering,g=a||{},f=g.background,p=g.backgroundColor,v=c||f||p;return r().createElement("rect",{className:xo(["react-flow__minimap-node",u]),x:t,y:n,rx:d,ry:d,width:o,height:i,fill:v,stroke:s,strokeWidth:l,shapeRendering:h})};Gc.displayName="MiniMapNode";var Wc=(0,n.memo)(Gc),Zc=function(e){return{viewBBox:{x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]},nodes:Array.from(e.nodeInternals.values())}},Qc=function(e){return e instanceof Function?e:function(){return e}},Xc=function(e){var t,n,o,i,a=e.style,c=e.className,s=e.nodeStrokeColor,l=void 0===s?"#555":s,u=e.nodeColor,d=void 0===u?"#fff":u,h=e.nodeClassName,g=void 0===h?"":h,f=e.nodeBorderRadius,p=void 0===f?5:f,v=e.nodeStrokeWidth,m=void 0===v?2:v,y=e.maskColor,w=void 0===y?"rgb(240, 242, 243, 0.7)":y,b=Ao(Zc,No),C=b.viewBBox,k=b.nodes,S=null!==(t=null==a?void 0:a.width)&&void 0!==t?t:200,I=null!==(n=null==a?void 0:a.height)&&void 0!==n?n:150,E=Qc(d),_=Qc(l),T=Qc(g),O=k.length>0?(o=so(k),i=C,zr(Br(Ur(o),Ur(i)))):C,A=O.width/S,P=O.height/I,M=Math.max(A,P),x=M*S,N=M*I,R=5*M,j=O.x-(x-O.width)/2-R,D=O.y-(N-O.height)/2-R,q=x+2*R,H=N+2*R,L="undefined"==typeof window||window.chrome?"crispEdges":"geometricPrecision";return r().createElement("svg",{width:S,height:I,viewBox:"".concat(j," ").concat(D," ").concat(q," ").concat(H),style:a,className:xo(["react-flow__minimap",c])},k.filter(function(e){return!e.hidden&&e.width&&e.height}).map(function(e){var t,n,o,i;return r().createElement(Wc,{key:e.id,x:null!==(t=null===(n=e.positionAbsolute)||void 0===n?void 0:n.x)&&void 0!==t?t:0,y:null!==(o=null===(i=e.positionAbsolute)||void 0===i?void 0:i.y)&&void 0!==o?o:0,width:e.width,height:e.height,style:e.style,className:T(e),color:E(e),borderRadius:p,strokeColor:_(e),strokeWidth:m,shapeRendering:L})}),r().createElement("path",{className:"react-flow__minimap-mask",d:"M".concat(j-R,",").concat(D-R,"h").concat(q+2*R,"v").concat(H+2*R,"h").concat(-q-2*R,"z\n        M").concat(C.x,",").concat(C.y,"h").concat(C.width,"v").concat(C.height,"h").concat(-C.width,"z"),fill:w,fillRule:"evenodd"}))};Xc.displayName="MiniMap";var Jc=(0,n.memo)(Xc),$c=4294967296;function es(e){return e.x}function ts(e){return e.y}var ns=Math.PI*(3-Math.sqrt(5));function rs(e){return function(){return e}}function os(e){return 1e-6*(e()-.5)}function is(e){return e.index}function as(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}function cs(e,t,n,r){if(isNaN(t)||isNaN(n))return e;var o,i,a,c,s,l,u,d,h,g=e._root,f={data:r},p=e._x0,v=e._y0,m=e._x1,y=e._y1;if(!g)return e._root=f,e;for(;g.length;)if((l=t>=(i=(p+m)/2))?p=i:m=i,(u=n>=(a=(v+y)/2))?v=a:y=a,o=g,!(g=g[d=u<<1|l]))return o[d]=f,e;if(c=+e._x.call(null,g.data),s=+e._y.call(null,g.data),t===c&&n===s)return f.next=g,o?o[d]=f:e._root=f,e;do{o=o?o[d]=new Array(4):e._root=new Array(4),(l=t>=(i=(p+m)/2))?p=i:m=i,(u=n>=(a=(v+y)/2))?v=a:y=a}while((d=u<<1|l)==(h=(s>=a)<<1|c>=i));return o[h]=g,o[d]=f,e}function ss(e,t,n,r,o){this.node=e,this.x0=t,this.y0=n,this.x1=r,this.y1=o}function ls(e){return e[0]}function us(e){return e[1]}function ds(e,t,n){var r=new hs(null==t?ls:t,null==n?us:n,NaN,NaN,NaN,NaN);return null==e?r:r.addAll(e)}function hs(e,t,n,r,o,i){this._x=e,this._y=t,this._x0=n,this._y0=r,this._x1=o,this._y1=i,this._root=void 0}function gs(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var fs=ds.prototype=hs.prototype;function ps(e){return e.x+e.vx}function vs(e){return e.y+e.vy}fs.copy=function(){var e,t,n=new hs(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=gs(r),n;for(e=[{source:r,target:n._root=new Array(4)}];r=e.pop();)for(var o=0;o<4;++o)(t=r.source[o])&&(t.length?e.push({source:t,target:r.target[o]=new Array(4)}):r.target[o]=gs(t));return n},fs.add=function(e){var t=+this._x.call(null,e),n=+this._y.call(null,e);return cs(this.cover(t,n),t,n,e)},fs.addAll=function(e){var t,n,r,o,i=e.length,a=new Array(i),c=new Array(i),s=1/0,l=1/0,u=-1/0,d=-1/0;for(n=0;n<i;++n)isNaN(r=+this._x.call(null,t=e[n]))||isNaN(o=+this._y.call(null,t))||(a[n]=r,c[n]=o,r<s&&(s=r),r>u&&(u=r),o<l&&(l=o),o>d&&(d=o));if(s>u||l>d)return this;for(this.cover(s,l).cover(u,d),n=0;n<i;++n)cs(this,a[n],c[n],e[n]);return this},fs.cover=function(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,r=this._y0,o=this._x1,i=this._y1;if(isNaN(n))o=(n=Math.floor(e))+1,i=(r=Math.floor(t))+1;else{for(var a,c,s=o-n||1,l=this._root;n>e||e>=o||r>t||t>=i;)switch(c=(t<r)<<1|e<n,(a=new Array(4))[c]=l,l=a,s*=2,c){case 0:o=n+s,i=r+s;break;case 1:n=o-s,i=r+s;break;case 2:o=n+s,r=i-s;break;case 3:n=o-s,r=i-s}this._root&&this._root.length&&(this._root=l)}return this._x0=n,this._y0=r,this._x1=o,this._y1=i,this},fs.data=function(){var e=[];return this.visit(function(t){if(!t.length)do{e.push(t.data)}while(t=t.next)}),e},fs.extent=function(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},fs.find=function(e,t,n){var r,o,i,a,c,s,l,u=this._x0,d=this._y0,h=this._x1,g=this._y1,f=[],p=this._root;for(p&&f.push(new ss(p,u,d,h,g)),null==n?n=1/0:(u=e-n,d=t-n,h=e+n,g=t+n,n*=n);s=f.pop();)if(!(!(p=s.node)||(o=s.x0)>h||(i=s.y0)>g||(a=s.x1)<u||(c=s.y1)<d))if(p.length){var v=(o+a)/2,m=(i+c)/2;f.push(new ss(p[3],v,m,a,c),new ss(p[2],o,m,v,c),new ss(p[1],v,i,a,m),new ss(p[0],o,i,v,m)),(l=(t>=m)<<1|e>=v)&&(s=f[f.length-1],f[f.length-1]=f[f.length-1-l],f[f.length-1-l]=s)}else{var y=e-+this._x.call(null,p.data),w=t-+this._y.call(null,p.data),b=y*y+w*w;if(b<n){var C=Math.sqrt(n=b);u=e-C,d=t-C,h=e+C,g=t+C,r=p.data}}return r},fs.remove=function(e){if(isNaN(i=+this._x.call(null,e))||isNaN(a=+this._y.call(null,e)))return this;var t,n,r,o,i,a,c,s,l,u,d,h,g=this._root,f=this._x0,p=this._y0,v=this._x1,m=this._y1;if(!g)return this;if(g.length)for(;;){if((l=i>=(c=(f+v)/2))?f=c:v=c,(u=a>=(s=(p+m)/2))?p=s:m=s,t=g,!(g=g[d=u<<1|l]))return this;if(!g.length)break;(t[d+1&3]||t[d+2&3]||t[d+3&3])&&(n=t,h=d)}for(;g.data!==e;)if(r=g,!(g=g.next))return this;return(o=g.next)&&delete g.next,r?(o?r.next=o:delete r.next,this):t?(o?t[d]=o:delete t[d],(g=t[0]||t[1]||t[2]||t[3])&&g===(t[3]||t[2]||t[1]||t[0])&&!g.length&&(n?n[h]=g:this._root=g),this):(this._root=o,this)},fs.removeAll=function(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this},fs.root=function(){return this._root},fs.size=function(){var e=0;return this.visit(function(t){if(!t.length)do{++e}while(t=t.next)}),e},fs.visit=function(e){var t,n,r,o,i,a,c=[],s=this._root;for(s&&c.push(new ss(s,this._x0,this._y0,this._x1,this._y1));t=c.pop();)if(!e(s=t.node,r=t.x0,o=t.y0,i=t.x1,a=t.y1)&&s.length){var l=(r+i)/2,u=(o+a)/2;(n=s[3])&&c.push(new ss(n,l,u,i,a)),(n=s[2])&&c.push(new ss(n,r,u,l,a)),(n=s[1])&&c.push(new ss(n,l,o,i,u)),(n=s[0])&&c.push(new ss(n,r,o,l,u))}return this},fs.visitAfter=function(e){var t,n=[],r=[];for(this._root&&n.push(new ss(this._root,this._x0,this._y0,this._x1,this._y1));t=n.pop();){var o=t.node;if(o.length){var i,a=t.x0,c=t.y0,s=t.x1,l=t.y1,u=(a+s)/2,d=(c+l)/2;(i=o[0])&&n.push(new ss(i,a,c,u,d)),(i=o[1])&&n.push(new ss(i,u,c,s,d)),(i=o[2])&&n.push(new ss(i,a,d,u,l)),(i=o[3])&&n.push(new ss(i,u,d,s,l))}r.push(t)}for(;t=r.pop();)e(t.node,t.x0,t.y0,t.x1,t.y1);return this},fs.x=function(e){return arguments.length?(this._x=e,this):this._x},fs.y=function(e){return arguments.length?(this._y=e,this):this._y};var ms={distanceMultiplier:400,collisionRadius:100,centerX:0,centerY:0,chargeStrength:-1e3};function ys(e,t,r){var o=Object.assign(Object.assign({},ms),r),[i,a]=n.useState(e),[c,s]=n.useState(!1),l=n.useRef(null),u=n.useCallback(()=>{if(0!==e.length){s(!0);var n=e.filter(e=>!e.data.isSource),r=n.length,i=e.map((e,t)=>{if(e.data.isSource)return{id:e.id,isSource:!0,x:o.centerX,y:o.centerY,fx:o.centerX,fy:o.centerY};var i=n.findIndex(t=>t.id===e.id),a=2*Math.PI*i/r-Math.PI/2;return{id:e.id,isSource:!1,x:o.centerX+150*Math.cos(a),y:o.centerY+150*Math.sin(a),fx:null,fy:null}}),c=t.map(e=>{var t,n;return{source:e.source,target:e.target,similarity:null!==(n=null===(t=e.data)||void 0===t?void 0:t.similarity)&&void 0!==n?n:.5}});l.current&&l.current.stop();var u=function(e){var t,n,r=1,o=.001,i=1-Math.pow(o,1/300),a=0,c=.6,s=new Map,l=jt(h),u=$("tick","end"),d=(n=1,()=>(n=(1664525*n+1013904223)%$c)/$c);function h(){g(),u.call("tick",t),r<o&&(l.stop(),u.call("end",t))}function g(n){var o,l,u=e.length;void 0===n&&(n=1);for(var d=0;d<n;++d)for(r+=(a-r)*i,s.forEach(function(e){e(r)}),o=0;o<u;++o)null==(l=e[o]).fx?l.x+=l.vx*=c:(l.x=l.fx,l.vx=0),null==l.fy?l.y+=l.vy*=c:(l.y=l.fy,l.vy=0);return t}function f(){for(var t,n=0,r=e.length;n<r;++n){if((t=e[n]).index=n,null!=t.fx&&(t.x=t.fx),null!=t.fy&&(t.y=t.fy),isNaN(t.x)||isNaN(t.y)){var o=10*Math.sqrt(.5+n),i=n*ns;t.x=o*Math.cos(i),t.y=o*Math.sin(i)}(isNaN(t.vx)||isNaN(t.vy))&&(t.vx=t.vy=0)}}function p(t){return t.initialize&&t.initialize(e,d),t}return null==e&&(e=[]),f(),t={tick:g,restart:function(){return l.restart(h),t},stop:function(){return l.stop(),t},nodes:function(n){return arguments.length?(e=n,f(),s.forEach(p),t):e},alpha:function(e){return arguments.length?(r=+e,t):r},alphaMin:function(e){return arguments.length?(o=+e,t):o},alphaDecay:function(e){return arguments.length?(i=+e,t):+i},alphaTarget:function(e){return arguments.length?(a=+e,t):a},velocityDecay:function(e){return arguments.length?(c=1-e,t):1-c},randomSource:function(e){return arguments.length?(d=e,s.forEach(p),t):d},force:function(e,n){return arguments.length>1?(null==n?s.delete(e):s.set(e,p(n)),t):s.get(e)},find:function(t,n,r){var o,i,a,c,s,l=0,u=e.length;for(null==r?r=1/0:r*=r,l=0;l<u;++l)(a=(o=t-(c=e[l]).x)*o+(i=n-c.y)*i)<r&&(s=c,r=a);return s},on:function(e,n){return arguments.length>1?(u.on(e,n),t):u.on(e)}}}(i).force("link",function(e){var t,n,r,o,i,a,c=is,s=function(e){return 1/Math.min(o[e.source.index],o[e.target.index])},l=rs(30),u=1;function d(r){for(var o=0,c=e.length;o<u;++o)for(var s,l,d,h,g,f,p,v=0;v<c;++v)l=(s=e[v]).source,h=(d=s.target).x+d.vx-l.x-l.vx||os(a),g=d.y+d.vy-l.y-l.vy||os(a),h*=f=((f=Math.sqrt(h*h+g*g))-n[v])/f*r*t[v],g*=f,d.vx-=h*(p=i[v]),d.vy-=g*p,l.vx+=h*(p=1-p),l.vy+=g*p}function h(){if(r){var a,s,l=r.length,u=e.length,d=new Map(r.map((e,t)=>[c(e,t,r),e]));for(a=0,o=new Array(l);a<u;++a)(s=e[a]).index=a,"object"!=typeof s.source&&(s.source=as(d,s.source)),"object"!=typeof s.target&&(s.target=as(d,s.target)),o[s.source.index]=(o[s.source.index]||0)+1,o[s.target.index]=(o[s.target.index]||0)+1;for(a=0,i=new Array(u);a<u;++a)s=e[a],i[a]=o[s.source.index]/(o[s.source.index]+o[s.target.index]);t=new Array(u),g(),n=new Array(u),f()}}function g(){if(r)for(var n=0,o=e.length;n<o;++n)t[n]=+s(e[n],n,e)}function f(){if(r)for(var t=0,o=e.length;t<o;++t)n[t]=+l(e[t],t,e)}return null==e&&(e=[]),d.initialize=function(e,t){r=e,a=t,h()},d.links=function(t){return arguments.length?(e=t,h(),d):e},d.id=function(e){return arguments.length?(c=e,d):c},d.iterations=function(e){return arguments.length?(u=+e,d):u},d.strength=function(e){return arguments.length?(s="function"==typeof e?e:rs(+e),g(),d):s},d.distance=function(e){return arguments.length?(l="function"==typeof e?e:rs(+e),f(),d):l},d}(c).id(e=>e.id).distance(e=>o.distanceMultiplier*(1-e.similarity)).strength(.5)).force("charge",function(){var e,t,n,r,o,i=rs(-30),a=1,c=1/0,s=.81;function l(n){var o,i=e.length,a=ds(e,es,ts).visitAfter(d);for(r=n,o=0;o<i;++o)t=e[o],a.visit(h)}function u(){if(e){var t,n,r=e.length;for(o=new Array(r),t=0;t<r;++t)n=e[t],o[n.index]=+i(n,t,e)}}function d(e){var t,n,r,i,a,c=0,s=0;if(e.length){for(r=i=a=0;a<4;++a)(t=e[a])&&(n=Math.abs(t.value))&&(c+=t.value,s+=n,r+=n*t.x,i+=n*t.y);e.x=r/s,e.y=i/s}else{(t=e).x=t.data.x,t.y=t.data.y;do{c+=o[t.data.index]}while(t=t.next)}e.value=c}function h(e,i,l,u){if(!e.value)return!0;var d=e.x-t.x,h=e.y-t.y,g=u-i,f=d*d+h*h;if(g*g/s<f)return f<c&&(0===d&&(f+=(d=os(n))*d),0===h&&(f+=(h=os(n))*h),f<a&&(f=Math.sqrt(a*f)),t.vx+=d*e.value*r/f,t.vy+=h*e.value*r/f),!0;if(!(e.length||f>=c)){(e.data!==t||e.next)&&(0===d&&(f+=(d=os(n))*d),0===h&&(f+=(h=os(n))*h),f<a&&(f=Math.sqrt(a*f)));do{e.data!==t&&(g=o[e.data.index]*r/f,t.vx+=d*g,t.vy+=h*g)}while(e=e.next)}}return l.initialize=function(t,r){e=t,n=r,u()},l.strength=function(e){return arguments.length?(i="function"==typeof e?e:rs(+e),u(),l):i},l.distanceMin=function(e){return arguments.length?(a=e*e,l):Math.sqrt(a)},l.distanceMax=function(e){return arguments.length?(c=e*e,l):Math.sqrt(c)},l.theta=function(e){return arguments.length?(s=e*e,l):Math.sqrt(s)},l}().strength(o.chargeStrength)).force("center",function(e,t){var n,r=1;function o(){var o,i,a=n.length,c=0,s=0;for(o=0;o<a;++o)c+=(i=n[o]).x,s+=i.y;for(c=(c/a-e)*r,s=(s/a-t)*r,o=0;o<a;++o)(i=n[o]).x-=c,i.y-=s}return null==e&&(e=0),null==t&&(t=0),o.initialize=function(e){n=e},o.x=function(t){return arguments.length?(e=+t,o):e},o.y=function(e){return arguments.length?(t=+e,o):t},o.strength=function(e){return arguments.length?(r=+e,o):r},o}(o.centerX,o.centerY)).force("collide",function(e){var t,n,r,o=1,i=1;function a(){for(var e,a,s,l,u,d,h,g=t.length,f=0;f<i;++f)for(a=ds(t,ps,vs).visitAfter(c),e=0;e<g;++e)s=t[e],d=n[s.index],h=d*d,l=s.x+s.vx,u=s.y+s.vy,a.visit(p);function p(e,t,n,i,a){var c=e.data,g=e.r,f=d+g;if(!c)return t>l+f||i<l-f||n>u+f||a<u-f;if(c.index>s.index){var p=l-c.x-c.vx,v=u-c.y-c.vy,m=p*p+v*v;m<f*f&&(0===p&&(m+=(p=os(r))*p),0===v&&(m+=(v=os(r))*v),m=(f-(m=Math.sqrt(m)))/m*o,s.vx+=(p*=m)*(f=(g*=g)/(h+g)),s.vy+=(v*=m)*f,c.vx-=p*(f=1-f),c.vy-=v*f)}}}function c(e){if(e.data)return e.r=n[e.data.index];for(var t=e.r=0;t<4;++t)e[t]&&e[t].r>e.r&&(e.r=e[t].r)}function s(){if(t){var r,o,i=t.length;for(n=new Array(i),r=0;r<i;++r)o=t[r],n[o.index]=+e(o,r,t)}}return"function"!=typeof e&&(e=rs(null==e?1:+e)),a.initialize=function(e,n){t=e,r=n,s()},a.iterations=function(e){return arguments.length?(i=+e,a):i},a.strength=function(e){return arguments.length?(o=+e,a):o},a.radius=function(t){return arguments.length?(e="function"==typeof t?t:rs(+t),s(),a):e},a}().radius(o.collisionRadius).strength(.7)).alphaDecay(.05).velocityDecay(.3);l.current=u,u.on("tick",()=>{var t=e.map(e=>{var t,n,r=i.find(t=>t.id===e.id);return Object.assign(Object.assign({},e),{position:{x:null!==(t=null==r?void 0:r.x)&&void 0!==t?t:0,y:null!==(n=null==r?void 0:r.y)&&void 0!==n?n:0}})});a(t)}),u.on("end",()=>{s(!1)}),u.alpha(1).restart()}else a([])},[e,t,o.distanceMultiplier,o.collisionRadius,o.centerX,o.centerY,o.chargeStrength]);return n.useEffect(()=>(u(),()=>{l.current&&l.current.stop()}),[u]),{layoutNodes:i,layoutEdges:t,isSimulating:c,recalculate:u}}var ws=L("Mail20Regular","20",["M15.5 4A2.5 2.5 0 0 1 18 6.5v8a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 2 14.5v-8A2.5 2.5 0 0 1 4.5 4h11ZM17 7.96l-6.75 3.97a.5.5 0 0 1-.42.04l-.08-.04L3 7.96v6.54c0 .83.67 1.5 1.5 1.5h11c.83 0 1.5-.67 1.5-1.5V7.96ZM15.5 5h-11C3.67 5 3 5.67 3 6.5v.3l7 4.12 7-4.12v-.3c0-.83-.67-1.5-1.5-1.5Z"]),bs=L("MailInbox24Regular","24",["M6.25 3h11.5a3.25 3.25 0 0 1 3.24 3.07l.01.18v11.5a3.25 3.25 0 0 1-3.07 3.24l-.18.01H6.25a3.25 3.25 0 0 1-3.24-3.07L3 17.75V6.25a3.25 3.25 0 0 1 3.07-3.24L6.25 3h11.5-11.5ZM4.5 14.5v3.25c0 .92.7 1.67 1.6 1.74l.15.01h11.5c.92 0 1.67-.7 1.74-1.6l.01-.15V14.5h-3.82a3.75 3.75 0 0 1-3.48 3H12a3.75 3.75 0 0 1-3.63-2.81l-.04-.19H4.5v3.25-3.25Zm13.25-10H6.25c-.92 0-1.67.7-1.74 1.6l-.01.15V13H9c.38 0 .7.28.74.65l.01.1a2.25 2.25 0 0 0 4.5.15v-.15c0-.38.28-.7.65-.74L15 13h4.5V6.25c0-.92-.7-1.67-1.6-1.74l-.15-.01Z"]),Cs=L("Table20Regular","20",["M17 5.5A2.5 2.5 0 0 0 14.5 3h-9A2.5 2.5 0 0 0 3 5.5v9A2.5 2.5 0 0 0 5.5 17h9a2.5 2.5 0 0 0 2.5-2.5v-9Zm-13 9V13h3v3H5.36A1.5 1.5 0 0 1 4 14.5Zm8-1.5v3H8v-3h4Zm2.5 3H13v-3h3V14.64A1.5 1.5 0 0 1 14.5 16ZM12 8v4H8V8h4Zm1 0h3v4h-3V8Zm-1-4v3H8V4h4Zm1 0H14.64A1.5 1.5 0 0 1 16 5.5V7h-3V4ZM7 4v3H4V5.36A1.5 1.5 0 0 1 5.5 4H7Zm0 4v4H4V8h3Z"]),ks=L("SlideText20Regular","20",["M5.5 7a.5.5 0 0 0 0 1h4a.5.5 0 0 0 0-1h-4Zm0 2.5a.5.5 0 0 0 0 1h7a.5.5 0 0 0 0-1h-7Zm-.5 3c0-.28.22-.5.5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5ZM4.5 4A2.5 2.5 0 0 0 2 6.5v7A2.5 2.5 0 0 0 4.5 16h11a2.5 2.5 0 0 0 2.5-2.5v-7A2.5 2.5 0 0 0 15.5 4h-11ZM3 6.5C3 5.67 3.67 5 4.5 5h11c.83 0 1.5.67 1.5 1.5v7c0 .83-.67 1.5-1.5 1.5h-11A1.5 1.5 0 0 1 3 13.5v-7Z"],{flipInRtl:!0}),Ss=L("Image20Regular","20",["M14 7.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Zm-1 0a.5.5 0 1 0-1 0 .5.5 0 0 0 1 0ZM3 6a3 3 0 0 1 3-3h8a3 3 0 0 1 3 3v8a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V6Zm3-2a2 2 0 0 0-2 2v8c0 .37.1.72.28 1.02l4.67-4.59a1.5 1.5 0 0 1 2.1 0l4.67 4.59c.18-.3.28-.65.28-1.02V6a2 2 0 0 0-2-2H6Zm0 12h8a2 2 0 0 0 1.01-.27l-4.66-4.58a.5.5 0 0 0-.7 0l-4.66 4.58A2 2 0 0 0 6 16Z"]),Is=L("Code20Regular","20",["M12.97 3.68a.5.5 0 0 0-.94-.36l-5 13a.5.5 0 1 0 .94.36l5-13ZM5.83 6.12c.2.18.23.5.05.7L3.16 10l2.72 3.17a.5.5 0 0 1-.76.66l-3-3.5a.5.5 0 0 1 0-.66l3-3.5a.5.5 0 0 1 .7-.05Zm8.34 8.26a.5.5 0 0 1-.05-.7l2.72-3.18-2.72-3.17a.5.5 0 1 1 .76-.66l3 3.5a.5.5 0 0 1 0 .66l-3 3.5a.5.5 0 0 1-.7.05Z"]),Es=L("Folder20Regular","20",["M4.5 3A2.5 2.5 0 0 0 2 5.5v9A2.5 2.5 0 0 0 4.5 17h11a2.5 2.5 0 0 0 2.5-2.5v-7A2.5 2.5 0 0 0 15.5 5H9.7L8.23 3.51A1.75 1.75 0 0 0 6.98 3H4.5ZM3 5.5C3 4.67 3.67 4 4.5 4h2.48c.2 0 .4.08.53.22L8.8 5.5 7.44 6.85a.5.5 0 0 1-.35.15H3V5.5ZM3 8h4.09c.4 0 .78-.16 1.06-.44L9.7 6h5.79c.83 0 1.5.67 1.5 1.5v7c0 .83-.67 1.5-1.5 1.5h-11A1.5 1.5 0 0 1 3 14.5V8Z"]),_s=L("FolderZip20Regular","20",["M6.98 3c.47 0 .91.18 1.24.51L9.71 5h5.79A2.5 2.5 0 0 1 18 7.5v7a2.5 2.5 0 0 1-2.5 2.5H15v.54c0 .25-.2.46-.46.46h-3.08l-.1-.01a.46.46 0 0 1-.36-.45V17H4.5A2.5 2.5 0 0 1 2 14.5v-9A2.5 2.5 0 0 1 4.5 3h2.48ZM13 13a1 1 0 0 0-1 1v3h2v-3a1 1 0 0 0-1-1ZM8.15 7.56A1.5 1.5 0 0 1 7.09 8H3v6.5c0 .83.67 1.5 1.5 1.5H11v-2a2 2 0 1 1 4 0v2h.5c.83 0 1.5-.67 1.5-1.5v-7c0-.83-.67-1.5-1.5-1.5H9.7L8.16 7.56ZM13 12h-1.5a.5.5 0 0 1 0-1H13v1Zm1.5-2a.5.5 0 0 1 0 1H13v-1h1.5ZM13 10h-1.5a.5.5 0 0 1 0-1H13v1Zm1.5-2a.5.5 0 0 1 0 1H13V8h1.5ZM13 8h-1.5a.5.5 0 0 1 0-1H13v1ZM4.5 4C3.67 4 3 4.67 3 5.5V7h4.09a.5.5 0 0 0 .35-.15L8.79 5.5 7.51 4.22A.75.75 0 0 0 6.98 4H4.5Z"]),Ts=L("Video20Regular","20",["M5 4a3 3 0 0 0-3 3v6a3 3 0 0 0 3 3h5a3 3 0 0 0 3-3v-.32l3.04 2.1c.83.57 1.96-.03 1.96-1.03v-7.5c0-1-1.13-1.6-1.96-1.03L13 7.32V7a3 3 0 0 0-3-3H5Zm8 4.54 3.6-2.5c.17-.1.4.01.4.21v7.5c0 .2-.23.32-.4.2L13 11.46V8.54ZM3 7c0-1.1.9-2 2-2h5a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7Z"]),Os=L("Briefcase24Regular","24",["M13.75 2C14.99 2 16 3 16 4.25V6h2.75C20.55 6 22 7.46 22 9.25v8.5c0 1.8-1.46 3.25-3.25 3.25H5.25A3.25 3.25 0 0 1 2 17.75v-8.5C2 7.45 3.46 6 5.25 6H8V4.25C8 3.01 9 2 10.25 2h3.5Zm6.75 11.49c-.5.32-1.1.51-1.75.51H14a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1H5.25c-.64 0-1.24-.19-1.75-.51v4.26c0 .97.78 1.75 1.75 1.75h13.5c.97 0 1.75-.78 1.75-1.75v-4.26ZM5.25 7.5c-.97 0-1.75.78-1.75 1.75v1.5c0 .97.78 1.75 1.75 1.75H10V12a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v.5h4.75c.97 0 1.75-.78 1.75-1.75v-1.5c0-.97-.78-1.75-1.75-1.75H5.25Zm5-4a.75.75 0 0 0-.75.75V6h5V4.25a.75.75 0 0 0-.75-.75h-3.5Z"]),As=L("Building24Regular","24",["M6.25 3.5a.75.75 0 0 0-.75.75V20.5h2v-2.75c0-.69.56-1.25 1.25-1.25h6.5c.69 0 1.25.56 1.25 1.25v2.75h2v-8.75a.75.75 0 0 0-.75-.75h-2a.75.75 0 0 1-.75-.75v-6a.75.75 0 0 0-.75-.75h-8ZM9 18v2.5h2.25V18H9Zm3.75 0v2.5H15V18h-2.25Zm6.5 4H4.75a.75.75 0 0 1-.75-.75v-17C4 3.01 5 2 6.25 2h8c1.24 0 2.25 1 2.25 2.25V9.5h1.25c1.24 0 2.25 1 2.25 2.25v9.5c0 .41-.34.75-.75.75ZM7.5 6.5a1 1 0 1 1 2 0 1 1 0 0 1-2 0Zm1 6a1 1 0 1 0 0 2 1 1 0 0 0 0-2Zm0-3.5a1 1 0 1 0 0 2 1 1 0 0 0 0-2ZM12 5.5a1 1 0 1 0 0 2 1 1 0 0 0 0-2Zm0 7a1 1 0 1 0 0 2 1 1 0 0 0 0-2Zm3.5 0a1 1 0 1 0 0 2 1 1 0 0 0 0-2ZM12 9a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z"]),Ps=L("Receipt24Regular","24",["M3 5.25C3 4.01 4 3 5.25 3h9.5C15.99 3 17 4 17 5.25V14h4v3.75c0 1.8-1.46 3.25-3.25 3.25H6.25A3.25 3.25 0 0 1 3 17.75V5.25ZM17 19.5h.75c.97 0 1.75-.78 1.75-1.75V15.5H17v4ZM5.25 4.5a.75.75 0 0 0-.75.75v12.5c0 .97.78 1.75 1.75 1.75h9.25V5.25a.75.75 0 0 0-.75-.75h-9.5Zm2 2.5a.75.75 0 0 0 0 1.5h5.5a.75.75 0 0 0 0-1.5h-5.5Zm-.75 4.75c0-.41.34-.75.75-.75h5.5a.75.75 0 0 1 0 1.5h-5.5a.75.75 0 0 1-.75-.75ZM7.25 15a.75.75 0 0 0 0 1.5h3a.75.75 0 0 0 0-1.5h-3Z"]),Ms=L("Info16Regular","16",["M8.5 7.5a.5.5 0 1 0-1 0v3a.5.5 0 0 0 1 0v-3Zm.25-2a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1ZM2 8a6 6 0 1 1 12 0A6 6 0 0 1 2 8Z"]),xs=L("Open16Regular","16",["M4.5 3C3.67 3 3 3.67 3 4.5v7c0 .83.67 1.5 1.5 1.5h7c.83 0 1.5-.67 1.5-1.5V9.27a.5.5 0 0 1 1 0v2.23a2.5 2.5 0 0 1-2.5 2.5h-7A2.5 2.5 0 0 1 2 11.5v-7A2.5 2.5 0 0 1 4.5 2h2.23a.5.5 0 0 1 0 1H4.5Zm4.27-.5c0-.28.22-.5.5-.5h4.23c.28 0 .5.22.5.5v4.23a.5.5 0 0 1-1 0V3.71L9.62 7.08a.5.5 0 1 1-.7-.7L12.29 3H9.27a.5.5 0 0 1-.5-.5Z"]),Ns={same_email:"Attachment",same_thread:"Email thread",same_matter:"Same matter",same_project:"Same project",same_invoice:"Same invoice",semantic:"Semantic"};function Rs(e,t){var n,r;return null!==(r=null!==(n=Ns[e])&&void 0!==n?n:t)&&void 0!==r?r:"Related"}var js=e=>{switch(e.toLowerCase()){case"pdf":return n.createElement(z,null);case"docx":case"doc":case"txt":case"rtf":return n.createElement(F,null);case"xlsx":case"xls":case"csv":return n.createElement(Cs,null);case"pptx":case"ppt":return n.createElement(ks,null);case"msg":case"eml":return n.createElement(ws,null);case"jpg":case"jpeg":case"png":case"gif":case"svg":case"bmp":case"tiff":return n.createElement(Ss,null);case"html":case"htm":case"xml":case"json":return n.createElement(Is,null);case"zip":case"rar":case"7z":case"tar":case"gz":return n.createElement(_s,null);case"mp4":case"avi":case"mov":case"wmv":case"mkv":return n.createElement(Ts,null);case"folder":return n.createElement(Es,null);case"file":case"unknown":return n.createElement(K,null);default:return n.createElement(B,null)}},Ds=e=>{switch(e){case"matter":return n.createElement(Os,null);case"project":return n.createElement(As,null);case"invoice":return n.createElement(Ps,null);case"email":return n.createElement(bs,null);default:return n.createElement(B,null)}},qs=e=>{switch(e){case"matter":return"Matter";case"project":return"Project";case"invoice":return"Invoice";case"email":return"Email";default:return"Parent"}},Hs=(0,o.makeStyles)({nodeContainer:{minWidth:"120px",maxWidth:"160px"},sourceCard:{backgroundColor:o.tokens.colorBrandBackground,border:"2px solid ".concat(o.tokens.colorBrandStroke1),boxShadow:o.tokens.shadow8,"& *":{color:o.tokens.colorNeutralForegroundOnBrand}},relatedCard:{backgroundColor:o.tokens.colorNeutralBackground1,border:"1px solid ".concat(o.tokens.colorNeutralStroke1),boxShadow:o.tokens.shadow4},orphanCard:{backgroundColor:o.tokens.colorNeutralBackground2,border:"2px dashed ".concat(o.tokens.colorNeutralStroke2),boxShadow:o.tokens.shadow2,opacity:.9},parentHubCard:{backgroundColor:o.tokens.colorPaletteGreenBackground2,border:"2px solid ".concat(o.tokens.colorPaletteGreenBorder2),boxShadow:o.tokens.shadow8,minWidth:"120px",maxWidth:"150px"},parentHubIcon:{display:"flex",alignItems:"center",justifyContent:"center",width:"28px",height:"28px",borderRadius:"50%",backgroundColor:o.tokens.colorPaletteGreenBackground3,color:o.tokens.colorPaletteGreenForeground1},compactParentHubIcon:{backgroundColor:o.tokens.colorPaletteGreenBackground2,border:"2px solid ".concat(o.tokens.colorPaletteGreenBorder2),color:o.tokens.colorPaletteGreenForeground1,width:"48px",height:"48px"},compactContainer:{display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},compactIcon:{display:"flex",alignItems:"center",justifyContent:"center",width:"40px",height:"40px",borderRadius:"50%",boxShadow:o.tokens.shadow4},compactSourceIcon:{backgroundColor:o.tokens.colorBrandBackground,border:"2px solid ".concat(o.tokens.colorBrandStroke1),color:o.tokens.colorNeutralForegroundOnBrand},compactRelatedIcon:{backgroundColor:o.tokens.colorNeutralBackground1,border:"1px solid ".concat(o.tokens.colorNeutralStroke1),color:o.tokens.colorNeutralForeground1},compactOrphanIcon:{backgroundColor:o.tokens.colorNeutralBackground2,border:"2px dashed ".concat(o.tokens.colorNeutralStroke2),color:o.tokens.colorNeutralForeground3,opacity:.9},cardHeader:{paddingBottom:o.tokens.spacingVerticalXS},icon:{display:"flex",alignItems:"center",justifyContent:"center",width:"20px",height:"20px",borderRadius:o.tokens.borderRadiusSmall,backgroundColor:o.tokens.colorNeutralBackground3},sourceIcon:{backgroundColor:o.tokens.colorBrandBackgroundPressed},headerContent:{display:"flex",flexDirection:"column",gap:o.tokens.spacingVerticalXXS,overflow:"hidden"},documentName:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100px",fontSize:o.tokens.fontSizeBase100},caption:{display:"flex",alignItems:"center",gap:o.tokens.spacingHorizontalXS,color:o.tokens.colorNeutralForeground3},sourceCaption:{color:o.tokens.colorNeutralForegroundOnBrand,opacity:.8},footer:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingTop:o.tokens.spacingVerticalXS,borderTop:"1px solid ".concat(o.tokens.colorNeutralStroke2)},sourceFooter:{borderTop:"1px solid ".concat(o.tokens.colorBrandStroke2)},similarityBadge:{marginLeft:"auto"},orphanBadge:{fontSize:o.tokens.fontSizeBase100},openLink:{display:"flex",alignItems:"center",gap:o.tokens.spacingHorizontalXXS,fontSize:o.tokens.fontSizeBase100,textDecoration:"none",color:o.tokens.colorBrandForegroundLink,cursor:"pointer",marginLeft:"auto","&:hover":{textDecoration:"underline"}},sourceOpenLink:{color:o.tokens.colorNeutralForegroundOnBrand,opacity:.9},footerRow:{display:"flex",alignItems:"center",gap:o.tokens.spacingHorizontalXS,width:"100%"},infoIcon:{display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",padding:"2px",borderRadius:o.tokens.borderRadiusSmall,color:o.tokens.colorNeutralForeground3,"&:hover":{backgroundColor:o.tokens.colorNeutralBackground3,color:o.tokens.colorNeutralForeground1}},sourceInfoIcon:{color:o.tokens.colorNeutralForegroundOnBrand,opacity:.7,"&:hover":{backgroundColor:o.tokens.colorBrandBackgroundPressed,opacity:1}},tooltipContent:{display:"flex",flexDirection:"column",gap:o.tokens.spacingVerticalXXS,maxWidth:"250px"},tooltipTitle:{fontWeight:600,fontSize:o.tokens.fontSizeBase200,wordBreak:"break-word"},tooltipRow:{display:"flex",fontSize:o.tokens.fontSizeBase100,gap:o.tokens.spacingHorizontalXS},tooltipLabel:{color:o.tokens.colorNeutralForeground3,minWidth:"60px"},tooltipValue:{color:o.tokens.colorNeutralForeground1,wordBreak:"break-word"}}),Ls=e=>{if(!e)return null;try{return new Date(e).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}catch(e){return null}},Bs=e=>{var t={fontSize:"10px",fontWeight:500,padding:"2px 6px",borderRadius:"4px",pointerEvents:"all"};return e>=.9?Object.assign(Object.assign({},t),{backgroundColor:o.tokens.colorStatusSuccessBackground1,color:o.tokens.colorStatusSuccessForeground1}):e>=.75?Object.assign(Object.assign({},t),{backgroundColor:o.tokens.colorBrandBackground2,color:o.tokens.colorBrandForeground1}):e>=.65?Object.assign(Object.assign({},t),{backgroundColor:o.tokens.colorStatusWarningBackground1,color:o.tokens.colorStatusWarningForeground1}):Object.assign(Object.assign({},t),{backgroundColor:o.tokens.colorNeutralBackground3,color:o.tokens.colorNeutralForeground3})},Us=(0,o.makeStyles)({container:{width:"100%",height:"100%",minHeight:"300px",position:"relative"},loadingOverlay:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",backgroundColor:o.tokens.colorNeutralBackground1,opacity:.9,zIndex:10},emptyState:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",color:o.tokens.colorNeutralForeground3,gap:o.tokens.spacingVerticalM}}),zs={document:e=>{var t,r,i,a,c,s,l,{data:u,selected:d}=e,h=Hs(),g=null!==(t=u.isSource)&&void 0!==t&&t,f=null!==(r=u.isOrphanFile)&&void 0!==r&&r,p=null!==(i=u.similarity)&&void 0!==i?i:0,v=null!==(a=u.fileType)&&void 0!==a?a:"unknown",m=null!==(c=u.compactMode)&&void 0!==c&&c,y=null!==(s=u.nodeType)&&void 0!==s?s:g?"source":f?"orphan":"related",w="matter"===(l=y)||"project"===l||"invoice"===l||"email"===l,b=u.relationshipLabel,C=u.recordUrl,k=((e,t)=>{var r,o,i,a,c,s=null!==(r=e.similarity)&&void 0!==r?r:0,l=Math.round(100*s);return n.createElement("div",{className:t.tooltipContent},n.createElement("div",{className:t.tooltipTitle},e.name),e.documentType&&n.createElement("div",{className:t.tooltipRow},n.createElement("span",{className:t.tooltipLabel},"Doc Type:"),n.createElement("span",{className:t.tooltipValue},e.documentType)),e.fileType&&n.createElement("div",{className:t.tooltipRow},n.createElement("span",{className:t.tooltipLabel},"Format:"),n.createElement("span",{className:t.tooltipValue},e.fileType.toUpperCase())),null!=e.size&&e.size>0&&n.createElement("div",{className:t.tooltipRow},n.createElement("span",{className:t.tooltipLabel},"Size:"),n.createElement("span",{className:t.tooltipValue},(c=e.size)<1024?"".concat(c," B"):c<1048576?"".concat((c/1024).toFixed(1)," KB"):"".concat((c/1048576).toFixed(1)," MB"))),!e.isSource&&s>0&&n.createElement("div",{className:t.tooltipRow},n.createElement("span",{className:t.tooltipLabel},"Similarity:"),n.createElement("span",{className:t.tooltipValue},l,"%")),e.relationshipLabel&&n.createElement("div",{className:t.tooltipRow},n.createElement("span",{className:t.tooltipLabel},"Relation:"),n.createElement("span",{className:t.tooltipValue},e.relationshipLabel)),e.parentEntityName&&n.createElement("div",{className:t.tooltipRow},n.createElement("span",{className:t.tooltipLabel},"Parent:"),n.createElement("span",{className:t.tooltipValue},e.parentEntityName)),Ls(e.createdOn)&&n.createElement("div",{className:t.tooltipRow},n.createElement("span",{className:t.tooltipLabel},"Created:"),n.createElement("span",{className:t.tooltipValue},Ls(e.createdOn))),Ls(e.modifiedOn)&&n.createElement("div",{className:t.tooltipRow},n.createElement("span",{className:t.tooltipLabel},"Modified:"),n.createElement("span",{className:t.tooltipValue},Ls(e.modifiedOn))),(null!==(o=e.documentId)&&void 0!==o?o:e.speFileId)&&n.createElement("div",{className:t.tooltipRow},n.createElement("span",{className:t.tooltipLabel},"ID:"),n.createElement("span",{className:t.tooltipValue,style:{fontSize:"9px"}},null===(a=null!==(i=e.documentId)&&void 0!==i?i:e.speFileId)||void 0===a?void 0:a.substring(0,8),"...")),e.sharedKeywords&&e.sharedKeywords.length>0&&n.createElement("div",{className:t.tooltipRow},n.createElement("span",{className:t.tooltipLabel},"Keywords:"),n.createElement("span",{className:t.tooltipValue},e.sharedKeywords.slice(0,3).join(", "),e.sharedKeywords.length>3&&"...")))})(u,h),S=e=>{e.stopPropagation(),C&&window.open(C,"_blank","noopener,noreferrer")};return m?n.createElement(n.Fragment,null,n.createElement(Gi,{type:"target",position:kr.Top,style:{width:"6px",height:"6px",background:w?o.tokens.colorPaletteGreenBorder2:o.tokens.colorBrandBackground,border:"1px solid ".concat(o.tokens.colorNeutralBackground1)}}),n.createElement("div",{className:(0,o.mergeClasses)(h.compactContainer,h.compactIcon,w?h.compactParentHubIcon:g?h.compactSourceIcon:f?h.compactOrphanIcon:h.compactRelatedIcon),title:w?"".concat(qs(y),": ").concat(u.name):"".concat(u.name).concat(b?"  ".concat(b):"").concat(f?" (File only)":"").concat(p>0?" (".concat(Math.round(100*p),"%)"):"")},w?Ds(y):js(v)),n.createElement(Gi,{type:"source",position:kr.Bottom,style:{width:"6px",height:"6px",background:w?o.tokens.colorPaletteGreenBorder2:o.tokens.colorBrandBackground,border:"1px solid ".concat(o.tokens.colorNeutralBackground1)}})):w?n.createElement(n.Fragment,null,n.createElement(o.Card,{className:(0,o.mergeClasses)(h.nodeContainer,h.parentHubCard),selected:d,size:"small"},n.createElement(o.CardHeader,{className:h.cardHeader,image:n.createElement("div",{className:h.parentHubIcon},Ds(y)),header:n.createElement("div",{className:h.headerContent},n.createElement(o.Body1Strong,{className:h.documentName},u.name),n.createElement(o.Caption1,{className:h.caption},qs(y)))}),n.createElement("div",{className:h.footer},n.createElement("div",{className:h.footerRow},n.createElement(o.Badge,{appearance:"tint",color:"success",size:"small"},qs(y)),n.createElement(o.Tooltip,{content:k,relationship:"description",positioning:"above",withArrow:!0},n.createElement("div",{className:h.infoIcon},n.createElement(Ms,null)))))),n.createElement(Gi,{type:"target",position:kr.Right,style:{width:"8px",height:"8px",background:o.tokens.colorPaletteGreenBorder2,border:"1px solid ".concat(o.tokens.colorNeutralBackground1)}})):n.createElement(n.Fragment,null,n.createElement(Gi,{type:"source",position:kr.Left,style:{width:"6px",height:"6px",background:o.tokens.colorBrandBackground,border:"1px solid ".concat(o.tokens.colorNeutralBackground1)}}),n.createElement(o.Card,{className:(0,o.mergeClasses)(h.nodeContainer,g?h.sourceCard:f?h.orphanCard:h.relatedCard),selected:d,size:"small"},n.createElement(o.CardHeader,{className:h.cardHeader,image:n.createElement("div",{className:(0,o.mergeClasses)(h.icon,g&&h.sourceIcon)},js(v)),header:n.createElement("div",{className:h.headerContent},n.createElement(o.Body1Strong,{className:h.documentName},u.name),g&&n.createElement(o.Caption1,{className:(0,o.mergeClasses)(h.caption,h.sourceCaption)},"Source"))}),!g&&n.createElement("div",{className:h.footer},n.createElement("div",{className:h.footerRow},b?n.createElement(o.Badge,{appearance:"outline",color:"informative",size:"small"},b):f?n.createElement(o.Badge,{className:h.orphanBadge,appearance:"outline",color:"warning",size:"small"},"File only"):n.createElement("span",null),n.createElement(o.Tooltip,{content:k,relationship:"description",positioning:"above",withArrow:!0},n.createElement("div",{className:h.infoIcon},n.createElement(Ms,null))),C&&n.createElement(o.Link,{className:h.openLink,onClick:S,title:"Open in Dataverse"},n.createElement(xs,null)))),g&&n.createElement("div",{className:(0,o.mergeClasses)(h.footer,h.sourceFooter)},n.createElement("div",{className:h.footerRow},n.createElement(o.Badge,{appearance:"filled",color:"brand",size:"small"},"Source"),n.createElement(o.Tooltip,{content:k,relationship:"description",positioning:"above",withArrow:!0},n.createElement("div",{className:(0,o.mergeClasses)(h.infoIcon,h.sourceInfoIcon)},n.createElement(Ms,null))),C&&n.createElement(o.Link,{className:(0,o.mergeClasses)(h.openLink,h.sourceOpenLink),onClick:S,title:"Open in Dataverse"},n.createElement(xs,null))))),n.createElement(Gi,{type:"target",position:kr.Right,style:{width:"6px",height:"6px",background:o.tokens.colorBrandBackground,border:"1px solid ".concat(o.tokens.colorNeutralBackground1)}}))}},Ks={similarity:e=>{var t,{id:r,sourceX:i,sourceY:a,targetX:c,targetY:s,sourcePosition:l,targetPosition:u,data:d,style:h,markerEnd:g,selected:f}=e,p=null!==(t=null==d?void 0:d.similarity)&&void 0!==t?t:.5,v=(e=>e>=.9?{strokeWidth:4,stroke:o.tokens.colorStatusSuccessBorder1,opacity:.9}:e>=.75?{strokeWidth:3,stroke:o.tokens.colorBrandStroke1,opacity:.8}:e>=.65?{strokeWidth:2,stroke:o.tokens.colorStatusWarningBorder1,opacity:.7}:{strokeWidth:1.5,stroke:o.tokens.colorNeutralStroke1,strokeDasharray:"5,5",opacity:.5})(p),m=Ri({sourceX:i,sourceY:a,sourcePosition:l,targetX:c,targetY:s,targetPosition:u}),[y,w]=vi({sourceX:i,sourceY:a,targetX:c,targetY:s}),b=Math.round(100*p);return n.createElement(n.Fragment,null,n.createElement("path",{id:r,className:"react-flow__edge-path",d:m,markerEnd:g,style:Object.assign(Object.assign({},h),{strokeWidth:v.strokeWidth,stroke:v.stroke,strokeDasharray:v.strokeDasharray,opacity:f?1:v.opacity,fill:"none"})}),n.createElement("foreignObject",{width:50,height:24,x:y-25,y:w-12,requiredExtensions:"http://www.w3.org/1999/xhtml"},n.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%"}},n.createElement("div",{style:Bs(p),className:"nodrag nopan"},b,"%"))))}},Fs=e=>{var{nodes:t,edges:r,isDarkMode:i=!1,onNodeSelect:a,layoutOptions:c,width:s,height:l,showMinimap:u=!1,compactMode:d=!1}=e,h=Us(),{layoutNodes:g,layoutEdges:f,isSimulating:p}=ys(t,r,Object.assign(Object.assign({},c),{centerX:0,centerY:0})),v=n.useMemo(()=>g.map(e=>Object.assign(Object.assign({},e),{data:Object.assign(Object.assign({},e.data),{compactMode:d})})),[g,d]),[m,y,w]=Lc(v),[b,C,k]=Bc(f);n.useEffect(()=>{y(v)},[v,y]),n.useEffect(()=>{C(f)},[f,C]);var S=n.useCallback((e,t)=>{a&&a(t)},[a]);if(0===t.length)return n.createElement("div",{className:h.container},n.createElement("div",{className:h.emptyState},n.createElement(o.Text,{size:400},"No document relationships to display"),n.createElement(o.Text,{size:200},"Select a document to view its relationships")));var I=b.map(e=>Object.assign(Object.assign({},e),{type:"similarity"}));return n.createElement("div",{className:h.container},p&&n.createElement("div",{className:h.loadingOverlay},n.createElement(o.Spinner,{size:"medium",label:"Calculating layout..."})),n.createElement(Dc,{nodes:m,edges:I,onNodesChange:w,onEdgesChange:k,onNodeClick:S,nodeTypes:zs,edgeTypes:Ks,fitView:!0,fitViewOptions:{padding:.2,maxZoom:1.5,minZoom:.3},minZoom:.1,maxZoom:2,connectOnClick:!1,attributionPosition:"bottom-left",style:{width:"100%",height:"100%"}},n.createElement(Yc,{variant:yr.Dots,gap:20,size:1,color:i?"#444":"#ddd"}),n.createElement(Xo,{showZoom:!0,showFitView:!0,showInteractive:!1}),u&&n.createElement(Jc,{nodeColor:e=>{var t;return(null===(t=e.data)||void 0===t?void 0:t.isSource)?o.tokens.colorBrandBackground:o.tokens.colorNeutralBackground3},maskColor:i?"rgba(0,0,0,0.7)":"rgba(255,255,255,0.7)",style:{backgroundColor:i?o.tokens.colorNeutralBackground2:o.tokens.colorNeutralBackground1}})))},Vs=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function c(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,c)}s((r=r.apply(e,t||[])).next())})};class Ys{constructor(e){this.apiBaseUrl=e.replace(/\/$/,"")}getRelatedDocuments(e,t,n){return Vs(this,void 0,void 0,function*(){var r,o=this.buildUrl(e,t),i={"Content-Type":"application/json"};n&&(i.Authorization="Bearer ".concat(n));var a=yield fetch(o,{method:"GET",headers:i,credentials:"include"});if(!a.ok){var c=yield this.parseErrorResponse(a);throw new Gs(null!==(r=c.detail)&&void 0!==r?r:"API error: ".concat(a.status),a.status,c)}var s=yield a.json();return this.mapToGraphData(s)})}buildUrl(e,t){var n=new URL("".concat(this.apiBaseUrl,"/api/ai/visualization/related/").concat(e));return n.searchParams.set("tenantId",t.tenantId),void 0!==t.threshold&&n.searchParams.set("threshold",t.threshold.toString()),void 0!==t.limit&&n.searchParams.set("limit",t.limit.toString()),void 0!==t.depth&&n.searchParams.set("depth",t.depth.toString()),void 0!==t.includeKeywords&&n.searchParams.set("includeKeywords",t.includeKeywords.toString()),void 0!==t.includeParentEntity&&n.searchParams.set("includeParentEntity",t.includeParentEntity.toString()),t.documentTypes&&t.documentTypes.length>0&&t.documentTypes.forEach(e=>{n.searchParams.append("documentTypes",e)}),t.relationshipTypes&&t.relationshipTypes.length>0&&t.relationshipTypes.forEach(e=>{n.searchParams.append("relationshipTypes",e)}),n.toString()}parseErrorResponse(e){return Vs(this,void 0,void 0,function*(){try{return yield e.json()}catch(t){return{title:"Unknown Error",detail:"HTTP ".concat(e.status,": ").concat(e.statusText),status:e.status}}})}mapToGraphData(e){var t=e.edges.map(e=>this.mapApiEdgeToDocumentEdge(e)),n=this.buildNodeRelationshipMap(e.edges);return{nodes:e.nodes.map(e=>this.mapApiNodeToDocumentNode(e,n.get(e.id))),edges:t,metadata:e.metadata}}buildNodeRelationshipMap(e){var t,n,r={same_email:1,same_thread:2,same_matter:3,same_project:4,same_invoice:5,semantic:6},o=new Map;for(var i of e){var a=i.data.relationshipType,c=Rs(a,i.data.relationshipLabel),s=i.data.similarity;for(var l of[i.source,i.target]){var u=o.get(l),d=u&&null!==(t=r[u.type])&&void 0!==t?t:99;(null!==(n=r[a])&&void 0!==n?n:99)<d&&o.set(l,{type:a,label:c,similarity:s})}}return o}mapApiNodeToDocumentNode(e,t){var n,r,o,i,a,c,s=null!==(n=e.data.isOrphanFile)&&void 0!==n?n:"orphan"===e.type,l="matter"===e.type||"project"===e.type||"invoice"===e.type||"email"===e.type,u=l?null!==(o=null===(r=e.data.documentType)||void 0===r?void 0:r.toLowerCase())&&void 0!==o?o:e.type:null!==(i=e.data.fileType)&&void 0!==i?i:this.extractFileType(e.data.label,e.data.documentType),d={documentId:s||l?void 0:e.id,speFileId:e.data.speFileId,name:e.data.label,fileType:u,documentType:e.data.documentType,similarity:null!==(a=null==t?void 0:t.similarity)&&void 0!==a?a:e.data.similarity,isSource:"source"===e.type,isOrphanFile:s,nodeType:e.type,relationshipType:null==t?void 0:t.type,relationshipLabel:null==t?void 0:t.label,parentEntityName:e.data.parentEntityName,fileUrl:e.data.fileUrl,recordUrl:e.data.recordUrl,sharedKeywords:e.data.extractedKeywords,createdOn:e.data.createdOn,modifiedOn:e.data.modifiedOn};return{id:e.id,type:"document",position:null!==(c=e.position)&&void 0!==c?c:{x:0,y:0},data:d}}mapApiEdgeToDocumentEdge(e){var t={similarity:e.data.similarity,sharedKeywords:e.data.sharedKeywords,relationshipType:e.data.relationshipType,relationshipLabel:Rs(e.data.relationshipType,e.data.relationshipLabel)};return{id:e.id,source:e.source,target:e.target,data:t}}extractFileType(e,t){var n=/\.([a-zA-Z0-9]+)$/.exec(e);return n?n[1].toLowerCase():{Contract:"pdf",Invoice:"pdf",Agreement:"pdf",Report:"pdf",Spreadsheet:"xlsx",Presentation:"pptx",Document:"docx",Email:"msg",Image:"png"}[t]||"pdf"}}class Gs extends Error{constructor(e,t,n){super(e),this.statusCode=t,this.errorBody=n,this.name="VisualizationApiError"}isNotFound(){return 404===this.statusCode}isUnauthorized(){return 401===this.statusCode||403===this.statusCode}}function Ws(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Zs(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ws(Object(n),!0).forEach(function(t){Qs(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ws(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Qs(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Xs,Js={LIBRARY_NAME:"MSAL.JS",SKU:"msal.js.common",CACHE_PREFIX:"msal",DEFAULT_AUTHORITY:"https://login.microsoftonline.com/common/",DEFAULT_AUTHORITY_HOST:"login.microsoftonline.com",DEFAULT_COMMON_TENANT:"common",ADFS:"adfs",DSTS:"dstsv2",AAD_INSTANCE_DISCOVERY_ENDPT:"https://login.microsoftonline.com/common/discovery/instance?api-version=1.1&authorization_endpoint=",CIAM_AUTH_URL:".ciamlogin.com",AAD_TENANT_DOMAIN_SUFFIX:".onmicrosoft.com",RESOURCE_DELIM:"|",NO_ACCOUNT:"NO_ACCOUNT",CLAIMS:"claims",CONSUMER_UTID:"9188040d-6c67-4c5b-b112-36a304b66dad",OPENID_SCOPE:"openid",PROFILE_SCOPE:"profile",OFFLINE_ACCESS_SCOPE:"offline_access",EMAIL_SCOPE:"email",CODE_RESPONSE_TYPE:"code",CODE_GRANT_TYPE:"authorization_code",RT_GRANT_TYPE:"refresh_token",FRAGMENT_RESPONSE_MODE:"fragment",S256_CODE_CHALLENGE_METHOD:"S256",URL_FORM_CONTENT_TYPE:"application/x-www-form-urlencoded;charset=utf-8",AUTHORIZATION_PENDING:"authorization_pending",NOT_DEFINED:"not_defined",EMPTY_STRING:"",NOT_APPLICABLE:"N/A",NOT_AVAILABLE:"Not Available",FORWARD_SLASH:"/",IMDS_ENDPOINT:"http://169.254.169.254/metadata/instance/compute/location",IMDS_VERSION:"2020-06-01",IMDS_TIMEOUT:2e3,AZURE_REGION_AUTO_DISCOVER_FLAG:"TryAutoDetect",REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX:"login.microsoft.com",KNOWN_PUBLIC_CLOUDS:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],TOKEN_RESPONSE_TYPE:"token",ID_TOKEN_RESPONSE_TYPE:"id_token",SHR_NONCE_VALIDITY:240,INVALID_INSTANCE:"invalid_instance"},$s=[Js.OPENID_SCOPE,Js.PROFILE_SCOPE,Js.OFFLINE_ACCESS_SCOPE],el=[...$s,Js.EMAIL_SCOPE],tl="Content-Type",nl="Retry-After",rl="X-AnchorMailbox",ol="x-ms-request-id",il="x-ms-httpver",al="idtoken",cl="client.info",sl="adal.idtoken",ll="error",ul="error.description",dl="active-account",hl="active-account-filters",gl="common",fl="organizations",pl="consumers",vl="access_token",ml={LOGIN:"login",SELECT_ACCOUNT:"select_account",CONSENT:"consent",NONE:"none",CREATE:"create",NO_SESSION:"no_session"},yl={PLAIN:"plain",S256:"S256"},wl={QUERY:"query",FRAGMENT:"fragment"},bl=Zs(Zs({},wl),{},{FORM_POST:"form_post"}),Cl="Generic",kl="-",Sl={ID_TOKEN:"IdToken",ACCESS_TOKEN:"AccessToken",ACCESS_TOKEN_WITH_AUTH_SCHEME:"AccessToken_With_AuthScheme",REFRESH_TOKEN:"RefreshToken"},Il="appmetadata",El="1",_l="authority-metadata",Tl="config",Ol="cache",Al="network",Pl="hardcoded_values",Ml={SCHEMA_VERSION:5,MAX_CUR_HEADER_BYTES:80,MAX_LAST_HEADER_BYTES:330,MAX_CACHED_ERRORS:50,CACHE_KEY:"server-telemetry",CATEGORY_SEPARATOR:"|",VALUE_SEPARATOR:",",OVERFLOW_TRUE:"1",OVERFLOW_FALSE:"0",UNKNOWN_ERROR:"unknown_error"},xl={BEARER:"Bearer",POP:"pop",SSH:"ssh-cert"},Nl="throttling";!function(e){e[e.Error=0]="Error",e[e.Warning=1]="Warning",e[e.Info=2]="Info",e[e.Verbose=3]="Verbose",e[e.Trace=4]="Trace"}(Xs||(Xs={}));class Rl{constructor(e,t,n){this.level=Xs.Info;var r=e||Rl.createDefaultLoggerOptions();this.localCallback=r.loggerCallback||(()=>{}),this.piiLoggingEnabled=r.piiLoggingEnabled||!1,this.level="number"==typeof r.logLevel?r.logLevel:Xs.Info,this.correlationId=r.correlationId||Js.EMPTY_STRING,this.packageName=t||Js.EMPTY_STRING,this.packageVersion=n||Js.EMPTY_STRING}static createDefaultLoggerOptions(){return{loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:Xs.Info}}clone(e,t,n){return new Rl({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level,correlationId:n||this.correlationId},e,t)}logMessage(e,t){if(!(t.logLevel>this.level||!this.piiLoggingEnabled&&t.containsPii)){var n=(new Date).toUTCString(),r="[".concat(n,"] : [").concat(t.correlationId||this.correlationId||"","]"),o="".concat(r," : ").concat(this.packageName,"@").concat(this.packageVersion," : ").concat(Xs[t.logLevel]," - ").concat(e);this.executeCallback(t.logLevel,o,t.containsPii||!1)}}executeCallback(e,t,n){this.localCallback&&this.localCallback(e,t,n)}error(e,t){this.logMessage(e,{logLevel:Xs.Error,containsPii:!1,correlationId:t||Js.EMPTY_STRING})}errorPii(e,t){this.logMessage(e,{logLevel:Xs.Error,containsPii:!0,correlationId:t||Js.EMPTY_STRING})}warning(e,t){this.logMessage(e,{logLevel:Xs.Warning,containsPii:!1,correlationId:t||Js.EMPTY_STRING})}warningPii(e,t){this.logMessage(e,{logLevel:Xs.Warning,containsPii:!0,correlationId:t||Js.EMPTY_STRING})}info(e,t){this.logMessage(e,{logLevel:Xs.Info,containsPii:!1,correlationId:t||Js.EMPTY_STRING})}infoPii(e,t){this.logMessage(e,{logLevel:Xs.Info,containsPii:!0,correlationId:t||Js.EMPTY_STRING})}verbose(e,t){this.logMessage(e,{logLevel:Xs.Verbose,containsPii:!1,correlationId:t||Js.EMPTY_STRING})}verbosePii(e,t){this.logMessage(e,{logLevel:Xs.Verbose,containsPii:!0,correlationId:t||Js.EMPTY_STRING})}trace(e,t){this.logMessage(e,{logLevel:Xs.Trace,containsPii:!1,correlationId:t||Js.EMPTY_STRING})}tracePii(e,t){this.logMessage(e,{logLevel:Xs.Trace,containsPii:!0,correlationId:t||Js.EMPTY_STRING})}isPiiLoggingEnabled(){return this.piiLoggingEnabled||!1}}var jl="170c98e1-d486-4355-bcbe-170454e0207c",Dl="a221a95e-6abc-4434-aecc-e48338a1b2f2",ql="https://spaarkedev1.crm.dynamics.com",Hl={auth:{clientId:jl,authority:"https://login.microsoftonline.com/".concat(Dl),redirectUri:ql,navigateToLoginRequestUrl:!1},cache:{cacheLocation:"sessionStorage",storeAuthStateInCookie:!1},system:{loggerOptions:{loggerCallback:(e,t,n)=>{if(!n)switch(e){case Xs.Error:console.error("[MSAL] ".concat(t));break;case Xs.Warning:console.warn("[MSAL] ".concat(t));break;case Xs.Info:console.info("[MSAL] ".concat(t));break;case Xs.Verbose:console.debug("[MSAL] ".concat(t))}},logLevel:Xs.Warning}}},Ll=["api://1e40baad-e065-4aea-a8d4-4b7ab273458c/user_impersonation"],Bl=(0,o.makeStyles)({container:{display:"flex",flexDirection:"column",height:"calc(100vh - 180px)",minHeight:"500px",width:"calc(100vw - 320px)",backgroundColor:o.tokens.colorNeutralBackground1,color:o.tokens.colorNeutralForeground1},header:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:o.tokens.spacingHorizontalM,padding:"".concat(o.tokens.spacingVerticalS," ").concat(o.tokens.spacingHorizontalM),backgroundColor:o.tokens.colorNeutralBackground2,borderBottom:"1px solid ".concat(o.tokens.colorNeutralStroke1),position:"sticky",top:0,zIndex:10},headerTitle:{display:"flex",alignItems:"center",gap:o.tokens.spacingHorizontalS,fontSize:o.tokens.fontSizeBase200,fontWeight:o.tokens.fontWeightSemibold,textTransform:"uppercase",letterSpacing:"0.5px",color:o.tokens.colorNeutralForeground2},graphContainer:{flex:1,display:"flex",position:"relative",minHeight:0,width:"100%"},placeholder:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:o.tokens.spacingVerticalM,color:o.tokens.colorNeutralForeground3,width:"100%",height:"100%"},footer:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:o.tokens.spacingVerticalS,paddingLeft:o.tokens.spacingHorizontalM,paddingRight:o.tokens.spacingHorizontalM,borderTop:"1px solid ".concat(o.tokens.colorNeutralStroke1),fontSize:o.tokens.fontSizeBase200,color:o.tokens.colorNeutralForeground3},versionText:{color:o.tokens.colorNeutralForeground4},errorContainer:{padding:o.tokens.spacingVerticalL,width:"100%"},filterDropdown:{minWidth:"180px"},filterContainer:{display:"flex",alignItems:"center",gap:o.tokens.spacingHorizontalS}}),Ul=e=>{var t,r,i,a,c,s,l,u,{context:d,notifyOutputChanged:h,onDocumentSelect:g,authProvider:f}=e,p=Bl(),v=function(e){var t;return void 0!==(null===(t=null==e?void 0:e.fluentDesignLanguage)||void 0===t?void 0:t.isDarkTheme)?e.fluentDesignLanguage.isDarkTheme?o.webDarkTheme:o.webLightTheme:"undefined"!=typeof window&&window.matchMedia("(prefers-color-scheme: dark)").matches?o.webDarkTheme:o.webLightTheme}(d),m=function(e){var t;return void 0!==(null===(t=null==e?void 0:e.fluentDesignLanguage)||void 0===t?void 0:t.isDarkTheme)?e.fluentDesignLanguage.isDarkTheme:"undefined"!=typeof window&&window.matchMedia("(prefers-color-scheme: dark)").matches}(d),y=null===(r=null===(t=d.mode)||void 0===t?void 0:t.contextInfo)||void 0===r?void 0:r.entityId,w=null===(i=d.parameters.documentId)||void 0===i?void 0:i.raw,b=null!==(a=null!=y?y:w)&&void 0!==a?a:"",C=null!==(s=null===(c=d.parameters.apiBaseUrl)||void 0===c?void 0:c.raw)&&void 0!==s?s:"https://spe-api-dev-67e2xz.azurewebsites.net",k=null!==(u=null===(l=d.parameters.tenantId)||void 0===l?void 0:l.raw)&&void 0!==u?u:"",[S,I]=n.useState(null),[E,_]=n.useState([]),[T,O]=n.useState(void 0),[A,P]=n.useState(null);n.useEffect(()=>{var e,t,n,r;e=void 0,t=void 0,r=function*(){try{console.log("[DocumentRelationshipViewer] Acquiring access token...");var e=yield f.getToken(Ll);O(e),P(null),console.log("[DocumentRelationshipViewer] Access token acquired successfully")}catch(e){console.error("[DocumentRelationshipViewer] Failed to acquire token:",e),P(e instanceof Error?e.message:"Authentication failed"),O(void 0)}},new((n=void 0)||(n=Promise))(function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function c(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,c)}s((r=r.apply(e,t||[])).next())})},[f]);var{nodes:M,edges:x,metadata:N,isLoading:R,error:j}=function(e){var{apiBaseUrl:t,documentId:r,tenantId:o,accessToken:i,threshold:a=.65,limit:c=25,depth:s=1,documentTypes:l,relationshipTypes:u,enabled:d=!0}=e,[h,g]=n.useState([]),[f,p]=n.useState([]),[v,m]=n.useState(null),[y,w]=n.useState(!1),[b,C]=n.useState(null),k=n.useMemo(()=>new Ys(t),[t]),S=n.useMemo(()=>({tenantId:o,threshold:a,limit:c,depth:s,documentTypes:l,relationshipTypes:u,includeKeywords:!0,includeParentEntity:!0}),[o,a,c,s,l,u]),I=n.useCallback(()=>{return e=this,t=void 0,l=function*(){if(!d||!r||!o||""===r.trim())return g([]),p([]),m(null),void C(null);w(!0),C(null);try{console.log("[VisualizationApi] Fetching related documents:",{documentId:r,tenantId:o,threshold:a,limit:c,depth:s});var e=yield k.getRelatedDocuments(r,S,i);console.log("[VisualizationApi] Received data:",{nodeCount:e.nodes.length,edgeCount:e.edges.length,searchLatencyMs:e.metadata.searchLatencyMs}),g(e.nodes),p(e.edges),m(e.metadata)}catch(e){console.error("[VisualizationApi] Error fetching data:",e),e instanceof Gs?(C(e),e.isNotFound()&&(console.log("[VisualizationApi] Document not found or has no embedding, showing empty graph"),g([]),p([]),m(null))):e instanceof Error?C(e):C(new Error("Unknown error occurred"))}finally{w(!1)}},new((n=void 0)||(n=Promise))(function(r,o){function i(e){try{c(l.next(e))}catch(e){o(e)}}function a(e){try{c(l.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,a)}c((l=l.apply(e,t||[])).next())});var e,t,n,l},[d,r,o,k,S,i,a,c,s]);return n.useEffect(()=>{I()},[I]),{nodes:h,edges:f,metadata:v,isLoading:y,error:b,refetch:I}}({apiBaseUrl:C,documentId:b,tenantId:k,accessToken:T,threshold:.65,limit:25,depth:1,relationshipTypes:E.length>0?E:void 0,enabled:!!b&&""!==b.trim()&&!!k&&!!T}),D=n.useRef(null),[q,H]=n.useState(null);n.useEffect(()=>{var e=()=>{if(D.current){var e=D.current.clientWidth,t=D.current.clientHeight;e>0&&t>0&&H({width:e,height:t})}},t=setTimeout(e,50);return e(),window.addEventListener("resize",e),()=>{clearTimeout(t),window.removeEventListener("resize",e)}},[]);var L=n.useCallback(e=>{var t,n;if(I(e.id),g){var r=null!==(n=null!==(t=e.data.documentId)&&void 0!==t?t:e.data.speFileId)&&void 0!==n?n:e.id;g(r)}h()},[g,h]),B=n.useCallback((e,t)=>{"filter"===t.name&&_(t.checkedItems)},[]),z=n.useMemo(()=>Object.entries(Ns).map(e=>{var[t,n]=e;return{key:t,label:n}}),[]),K=n.useMemo(()=>0===E.length?"All types":"".concat(E.length," selected"),[E.length]),F=n.useMemo(()=>({filter:E}),[E]),Y=!b||""===b.trim(),G=b&&!k,W=!T&&!A,Z=null!==q&&q.width>0&&q.height>0,Q=null!=A?A:j?function(e){return e?e instanceof Gs?e.isNotFound()?"Document not found or has no relationship data yet. The document may still be processing.":e.isUnauthorized()?"You don't have permission to view relationships for this document.":e.message||"Failed to load document relationships.":e.message||"An unexpected error occurred.":""}(j):null;return n.createElement(o.FluentProvider,{theme:v},n.createElement("div",{className:p.container},n.createElement("div",{className:p.header},n.createElement("div",{className:p.headerTitle},n.createElement(U,null),n.createElement(o.Text,{weight:"semibold",size:400},"Document Relationships"),S&&n.createElement(o.Text,{size:200,style:{color:o.tokens.colorNeutralForeground3}},"Selected: ",S)),n.createElement("div",{className:p.filterContainer},n.createElement(o.Menu,{checkedValues:F,onCheckedValueChange:B},n.createElement(o.MenuTrigger,{disableButtonEnhancement:!0},n.createElement(o.Button,{appearance:"subtle",icon:n.createElement(V,null),size:"small"},K)),n.createElement(o.MenuPopover,null,n.createElement(o.MenuList,null,z.map(e=>n.createElement(o.MenuItemCheckbox,{key:e.key,name:"filter",value:e.key},e.label))))))),n.createElement("div",{className:p.graphContainer,ref:D},W?n.createElement("div",{className:p.placeholder},n.createElement(o.Spinner,{size:"large",label:"Authenticating..."})):R?n.createElement("div",{className:p.placeholder},n.createElement(o.Spinner,{size:"large",label:"Loading relationships..."})):Q?n.createElement("div",{className:p.errorContainer},n.createElement(o.MessageBar,{intent:"error"},n.createElement(o.MessageBarBody,null,Q))):G?n.createElement("div",{className:p.placeholder},n.createElement(U,{style:{fontSize:48}}),n.createElement(o.Text,null,"Configuration required"),n.createElement(o.Text,{size:200},"Tenant ID must be configured to load relationships")):Y?n.createElement("div",{className:p.placeholder},n.createElement(U,{style:{fontSize:48}}),n.createElement(o.Text,null,"Select a document to view its relationships"),n.createElement(o.Text,{size:200},"Graph visualization will appear here")):Z?0===M.length?n.createElement("div",{className:p.placeholder},n.createElement(U,{style:{fontSize:48}}),n.createElement(o.Text,null,"No related documents found"),n.createElement(o.Text,{size:200},"This document has no similar documents above the similarity threshold")):n.createElement(Fs,{nodes:M,edges:x,isDarkMode:m,onNodeSelect:L,width:q.width,height:q.height,showMinimap:!1,compactMode:!1}):n.createElement("div",{className:p.placeholder},n.createElement(o.Spinner,{size:"medium",label:"Initializing..."}))),n.createElement("div",{className:p.footer},n.createElement("span",null,M.length>0?"".concat(M.length," documents  ").concat(x.length," relationships"):N?"Searched in ".concat(N.searchLatencyMs,"ms"):"No data loaded"),n.createElement("span",{className:p.versionText},"v","1.0.29"))))},zl="AAD",Kl="OIDC",Fl="none",Vl="unexpected_error",Yl="post_request_failed",Gl={[Vl]:"Unexpected error in authentication.",[Yl]:"Post request failed from the network, could be a 4xx/5xx or a network unavailability. Please check the exact error code for details."};class Wl extends Error{constructor(e,t,n){super(t?"".concat(e,": ").concat(t):e),Object.setPrototypeOf(this,Wl.prototype),this.errorCode=e||Js.EMPTY_STRING,this.errorMessage=t||Js.EMPTY_STRING,this.subError=n||Js.EMPTY_STRING,this.name="AuthError"}setCorrelationId(e){this.correlationId=e}}function Zl(e,t){return new Wl(e,t?"".concat(Gl[e]," ").concat(t):Gl[e])}var Ql="client_info_decoding_error",Xl="client_info_empty_error",Jl="token_parsing_error",$l="null_or_empty_token",eu="endpoints_resolution_error",tu="network_error",nu="openid_config_error",ru="hash_not_deserialized",ou="invalid_state",iu="state_mismatch",au="state_not_found",cu="nonce_mismatch",su="auth_time_not_found",lu="max_age_transpired",uu="multiple_matching_tokens",du="multiple_matching_accounts",hu="multiple_matching_appMetadata",gu="request_cannot_be_made",fu="cannot_remove_empty_scope",pu="cannot_append_scopeset",vu="empty_input_scopeset",mu="device_code_polling_cancelled",yu="device_code_expired",wu="device_code_unknown_error",bu="no_account_in_silent_request",Cu="invalid_cache_record",ku="invalid_cache_environment",Su="no_account_found",Iu="no_crypto_object",Eu="unexpected_credential_type",_u="invalid_assertion",Tu="invalid_client_credential",Ou="token_refresh_required",Au="user_timeout_reached",Pu="token_claims_cnf_required_for_signedjwt",Mu="authorization_code_missing_from_server_response",xu="binding_key_not_removed",Nu="end_session_endpoint_not_supported",Ru="key_id_missing",ju="no_network_connectivity",Du="user_canceled",qu="missing_tenant_id_error",Hu="method_not_implemented",Lu="nested_app_auth_bridge_disabled",Bu={[Ql]:"The client info could not be parsed/decoded correctly",[Xl]:"The client info was empty",[Jl]:"Token cannot be parsed",[$l]:"The token is null or empty",[eu]:"Endpoints cannot be resolved",[tu]:"Network request failed",[nu]:"Could not retrieve endpoints. Check your authority and verify the .well-known/openid-configuration endpoint returns the required endpoints.",[ru]:"The hash parameters could not be deserialized",[ou]:"State was not the expected format",[iu]:"State mismatch error",[au]:"State not found",[cu]:"Nonce mismatch error",[su]:"Max Age was requested and the ID token is missing the auth_time variable. auth_time is an optional claim and is not enabled by default - it must be enabled. See https://aka.ms/msaljs/optional-claims for more information.",[lu]:"Max Age is set to 0, or too much time has elapsed since the last end-user authentication.",[uu]:"The cache contains multiple tokens satisfying the requirements. Call AcquireToken again providing more requirements such as authority or account.",[du]:"The cache contains multiple accounts satisfying the given parameters. Please pass more info to obtain the correct account",[hu]:"The cache contains multiple appMetadata satisfying the given parameters. Please pass more info to obtain the correct appMetadata",[gu]:"Token request cannot be made without authorization code or refresh token.",[fu]:"Cannot remove null or empty scope from ScopeSet",[pu]:"Cannot append ScopeSet",[vu]:"Empty input ScopeSet cannot be processed",[mu]:"Caller has cancelled token endpoint polling during device code flow by setting DeviceCodeRequest.cancel = true.",[yu]:"Device code is expired.",[wu]:"Device code stopped polling for unknown reasons.",[bu]:"Please pass an account object, silent flow is not supported without account information",[Cu]:"Cache record object was null or undefined.",[ku]:"Invalid environment when attempting to create cache entry",[Su]:"No account found in cache for given key.",[Iu]:"No crypto object detected.",[Eu]:"Unexpected credential type.",[_u]:"Client assertion must meet requirements described in https://tools.ietf.org/html/rfc7515",[Tu]:"Client credential (secret, certificate, or assertion) must not be empty when creating a confidential client. An application should at most have one credential",[Ou]:"Cannot return token from cache because it must be refreshed. This may be due to one of the following reasons: forceRefresh parameter is set to true, claims have been requested, there is no cached access token or it is expired.",[Au]:"User defined timeout for device code polling reached",[Pu]:"Cannot generate a POP jwt if the token_claims are not populated",[Mu]:"Server response does not contain an authorization code to proceed",[xu]:"Could not remove the credential's binding key from storage.",[Nu]:"The provided authority does not support logout",[Ru]:"A keyId value is missing from the requested bound token's cache record and is required to match the token to it's stored binding key.",[ju]:"No network connectivity. Check your internet connection.",[Du]:"User cancelled the flow.",[qu]:"A tenant id - not common, organizations, or consumers - must be specified when using the client_credentials flow.",[Hu]:"This method has not been implemented",[Lu]:"The nested app auth bridge is disabled"};class Uu extends Wl{constructor(e,t){super(e,t?"".concat(Bu[e],": ").concat(t):Bu[e]),this.name="ClientAuthError",Object.setPrototypeOf(this,Uu.prototype)}}function zu(e,t){return new Uu(e,t)}function Ku(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function Fu(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){Ku(i,r,o,a,c,"next",e)}function c(e){Ku(i,r,o,a,c,"throw",e)}a(void 0)})}}var Vu={createNewGuid:()=>{throw zu(Hu)},base64Decode:()=>{throw zu(Hu)},base64Encode:()=>{throw zu(Hu)},base64UrlEncode:()=>{throw zu(Hu)},encodeKid:()=>{throw zu(Hu)},getPublicKeyThumbprint:()=>Fu(function*(){throw zu(Hu)})(),removeTokenBindingKey:()=>Fu(function*(){throw zu(Hu)})(),clearKeystore:()=>Fu(function*(){throw zu(Hu)})(),signJwt:()=>Fu(function*(){throw zu(Hu)})(),hashString:()=>Fu(function*(){throw zu(Hu)})()},Yu="@azure/msal-common",Gu="14.16.1";function Wu(e,t){var n=function(e){if(!e)throw zu($l);var t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(e);if(!t||t.length<4)throw zu(Jl);return t[2]}(e);try{var r=t(n);return JSON.parse(r)}catch(e){throw zu(Jl)}}function Zu(e,t){if(0===t||Date.now()-3e5>e+t)throw zu(lu)}function Qu(){return Math.round((new Date).getTime()/1e3)}function Xu(e,t){var n=Number(e)||0;return Qu()+t>n}function Ju(e){return[ad(e),cd(e),sd(e),ld(e),ud(e)].join(kl).toLowerCase()}function $u(e,t,n,r,o){return{credentialType:Sl.ID_TOKEN,homeAccountId:e,environment:t,clientId:r,secret:n,realm:o}}function ed(e,t,n,r,o,i,a,c,s,l,u,d,h,g,f){var p,v,m={homeAccountId:e,credentialType:Sl.ACCESS_TOKEN,secret:n,cachedAt:Qu().toString(),expiresOn:a.toString(),extendedExpiresOn:c.toString(),environment:t,clientId:r,realm:o,target:i,tokenType:u||xl.BEARER};if(d&&(m.userAssertionHash=d),l&&(m.refreshOn=l.toString()),g&&(m.requestedClaims=g,m.requestedClaimsHash=f),(null===(p=m.tokenType)||void 0===p?void 0:p.toLowerCase())!==xl.BEARER.toLowerCase())switch(m.credentialType=Sl.ACCESS_TOKEN_WITH_AUTH_SCHEME,m.tokenType){case xl.POP:var y=Wu(n,s);if(null==y||null===(v=y.cnf)||void 0===v||!v.kid)throw zu(Pu);m.keyId=y.cnf.kid;break;case xl.SSH:m.keyId=h}return m}function td(e,t,n,r,o,i,a){var c={credentialType:Sl.REFRESH_TOKEN,homeAccountId:e,environment:t,clientId:r,secret:n};return i&&(c.userAssertionHash=i),o&&(c.familyId=o),a&&(c.expiresOn=a.toString()),c}function nd(e){return e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("credentialType")&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("secret")}function rd(e){return!!e&&nd(e)&&e.hasOwnProperty("realm")&&e.hasOwnProperty("target")&&(e.credentialType===Sl.ACCESS_TOKEN||e.credentialType===Sl.ACCESS_TOKEN_WITH_AUTH_SCHEME)}function od(e){return!!e&&nd(e)&&e.hasOwnProperty("realm")&&e.credentialType===Sl.ID_TOKEN}function id(e){return!!e&&nd(e)&&e.credentialType===Sl.REFRESH_TOKEN}function ad(e){return[e.homeAccountId,e.environment].join(kl).toLowerCase()}function cd(e){var t=e.credentialType===Sl.REFRESH_TOKEN&&e.familyId||e.clientId;return[e.credentialType,t,e.realm||""].join(kl).toLowerCase()}function sd(e){return(e.target||"").toLowerCase()}function ld(e){return(e.requestedClaimsHash||"").toLowerCase()}function ud(e){return e.tokenType&&e.tokenType.toLowerCase()!==xl.BEARER.toLowerCase()?e.tokenType.toLowerCase():""}function dd(){return Qu()+86400}function hd(e,t,n){e.authorization_endpoint=t.authorization_endpoint,e.token_endpoint=t.token_endpoint,e.end_session_endpoint=t.end_session_endpoint,e.issuer=t.issuer,e.endpointsFromNetwork=n,e.jwks_uri=t.jwks_uri}function gd(e,t,n){e.aliases=t.aliases,e.preferred_cache=t.preferred_cache,e.preferred_network=t.preferred_network,e.aliasesFromNetwork=n}function fd(e){return e.expiresAt<=Qu()}var pd="redirect_uri_empty",vd="claims_request_parsing_error",md="authority_uri_insecure",yd="url_parse_error",wd="empty_url_error",bd="empty_input_scopes_error",Cd="invalid_prompt_value",kd="invalid_claims",Sd="token_request_empty",Id="logout_request_empty",Ed="invalid_code_challenge_method",_d="pkce_params_missing",Td="invalid_cloud_discovery_metadata",Od="invalid_authority_metadata",Ad="untrusted_authority",Pd="missing_ssh_jwk",Md="missing_ssh_kid",xd="missing_nonce_authentication_header",Nd="invalid_authentication_header",Rd="cannot_set_OIDCOptions",jd="cannot_allow_native_broker",Dd="authority_mismatch",qd={[pd]:"A redirect URI is required for all calls, and none has been set.",[vd]:"Could not parse the given claims request object.",[md]:"Authority URIs must use https.  Please see here for valid authority configuration options: https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-js-initializing-client-applications#configuration-options",[yd]:"URL could not be parsed into appropriate segments.",[wd]:"URL was empty or null.",[bd]:"Scopes cannot be passed as null, undefined or empty array because they are required to obtain an access token.",[Cd]:"Please see here for valid configuration options: https://azuread.github.io/microsoft-authentication-library-for-js/ref/modules/_azure_msal_common.html#commonauthorizationurlrequest",[kd]:"Given claims parameter must be a stringified JSON object.",[Sd]:"Token request was empty and not found in cache.",[Id]:"The logout request was null or undefined.",[Ed]:'code_challenge_method passed is invalid. Valid values are "plain" and "S256".',[_d]:"Both params: code_challenge and code_challenge_method are to be passed if to be sent in the request",[Td]:"Invalid cloudDiscoveryMetadata provided. Must be a stringified JSON object containing tenant_discovery_endpoint and metadata fields",[Od]:"Invalid authorityMetadata provided. Must by a stringified JSON object containing authorization_endpoint, token_endpoint, issuer fields.",[Ad]:"The provided authority is not a trusted authority. Please include this authority in the knownAuthorities config parameter.",[Pd]:"Missing sshJwk in SSH certificate request. A stringified JSON Web Key is required when using the SSH authentication scheme.",[Md]:"Missing sshKid in SSH certificate request. A string that uniquely identifies the public SSH key is required when using the SSH authentication scheme.",[xd]:"Unable to find an authentication header containing server nonce. Either the Authentication-Info or WWW-Authenticate headers must be present in order to obtain a server nonce.",[Nd]:"Invalid authentication header provided",[Rd]:"Cannot set OIDCOptions parameter. Please change the protocol mode to OIDC or use a non-Microsoft authority.",[jd]:"Cannot set allowNativeBroker parameter to true when not in AAD protocol mode.",[Dd]:"Authority mismatch error. Authority provided in login request or PublicClientApplication config does not match the environment of the provided account. Please use a matching account or make an interactive request to login to this authority."};class Hd extends Wl{constructor(e){super(e,qd[e]),this.name="ClientConfigurationError",Object.setPrototypeOf(this,Hd.prototype)}}function Ld(e){return new Hd(e)}class Bd{static isEmptyObj(e){if(e)try{var t=JSON.parse(e);return 0===Object.keys(t).length}catch(e){}return!0}static startsWith(e,t){return 0===e.indexOf(t)}static endsWith(e,t){return e.length>=t.length&&e.lastIndexOf(t)===e.length-t.length}static queryStringToObject(e){var t={},n=e.split("&"),r=e=>decodeURIComponent(e.replace(/\+/g," "));return n.forEach(e=>{if(e.trim()){var[n,o]=e.split(/=(.+)/g,2);n&&o&&(t[r(n)]=r(o))}}),t}static trimArrayEntries(e){return e.map(e=>e.trim())}static removeEmptyStringsFromArray(e){return e.filter(e=>!!e)}static jsonParseHelper(e){try{return JSON.parse(e)}catch(e){return null}}static matchPattern(e,t){return new RegExp(e.replace(/\\/g,"\\\\").replace(/\*/g,"[^ ]*").replace(/\?/g,"\\?")).test(t)}}class Ud{constructor(e){var t=e?Bd.trimArrayEntries([...e]):[],n=t?Bd.removeEmptyStringsFromArray(t):[];this.validateInputScopes(n),this.scopes=new Set,n.forEach(e=>this.scopes.add(e))}static fromString(e){var t=(e||Js.EMPTY_STRING).split(" ");return new Ud(t)}static createSearchScopes(e){var t=new Ud(e);return t.containsOnlyOIDCScopes()?t.removeScope(Js.OFFLINE_ACCESS_SCOPE):t.removeOIDCScopes(),t}validateInputScopes(e){if(!e||e.length<1)throw Ld(bd)}containsScope(e){var t=this.printScopesLowerCase().split(" "),n=new Ud(t);return!!e&&n.scopes.has(e.toLowerCase())}containsScopeSet(e){return!(!e||e.scopes.size<=0)&&this.scopes.size>=e.scopes.size&&e.asArray().every(e=>this.containsScope(e))}containsOnlyOIDCScopes(){var e=0;return el.forEach(t=>{this.containsScope(t)&&(e+=1)}),this.scopes.size===e}appendScope(e){e&&this.scopes.add(e.trim())}appendScopes(e){try{e.forEach(e=>this.appendScope(e))}catch(e){throw zu(pu)}}removeScope(e){if(!e)throw zu(fu);this.scopes.delete(e.trim())}removeOIDCScopes(){el.forEach(e=>{this.scopes.delete(e)})}unionScopeSets(e){if(!e)throw zu(vu);var t=new Set;return e.scopes.forEach(e=>t.add(e.toLowerCase())),this.scopes.forEach(e=>t.add(e.toLowerCase())),t}intersectingScopeSets(e){if(!e)throw zu(vu);e.containsOnlyOIDCScopes()||e.removeOIDCScopes();var t=this.unionScopeSets(e),n=e.getScopeCount(),r=this.getScopeCount();return t.size<r+n}getScopeCount(){return this.scopes.size}asArray(){var e=[];return this.scopes.forEach(t=>e.push(t)),e}printScopes(){return this.scopes?this.asArray().join(" "):Js.EMPTY_STRING}printScopesLowerCase(){return this.printScopes().toLowerCase()}}function zd(e,t){if(!e)throw zu(Xl);try{var n=t(e);return JSON.parse(n)}catch(e){throw zu(Ql)}}function Kd(e){if(!e)throw zu(Ql);var t=e.split(".",2);return{uid:t[0],utid:t.length<2?Js.EMPTY_STRING:t[1]}}var Fd=["isHomeTenant"],Vd=["isHomeTenant"];function Yd(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Gd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yd(Object(n),!0).forEach(function(t){Wd(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yd(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Wd(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Zd(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function Qd(e,t){return!!e&&!!t&&e===t.split(".")[1]}function Xd(e,t,n,r){if(r){var{oid:o,sub:i,tid:a,name:c,tfp:s,acr:l}=r,u=a||s||l||"";return{tenantId:u,localAccountId:o||i||"",name:c,isHomeTenant:Qd(u,e)}}return{tenantId:n,localAccountId:t,isHomeTenant:Qd(n,e)}}function Jd(e,t,n,r){var o=e;if(t){var{isHomeTenant:i}=t,a=Zd(t,Fd);o=Gd(Gd({},e),a)}if(n){var c=Xd(e.homeAccountId,e.localAccountId,e.tenantId,n),{isHomeTenant:s}=c,l=Zd(c,Vd);return Gd(Gd(Gd({},o),l),{},{idTokenClaims:n,idToken:r})}return o}function $d(e){return e&&(e.tid||e.tfp||e.acr)||null}class eh{generateAccountId(){return[this.homeAccountId,this.environment].join(kl).toLowerCase()}generateAccountKey(){return eh.generateAccountCacheKey({homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId})}getAccountInfo(){return{homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId,name:this.name,nativeAccountId:this.nativeAccountId,authorityType:this.authorityType,tenantProfiles:new Map((this.tenantProfiles||[]).map(e=>[e.tenantId,e]))}}isSingleTenant(){return!this.tenantProfiles}static generateAccountCacheKey(e){var t=e.homeAccountId.split(".")[1];return[e.homeAccountId,e.environment||"",t||e.tenantId||""].join(kl).toLowerCase()}static createAccount(e,t,n){var r,o,i,a,c,s,l,u,d,h=new eh;1===t.authorityType?h.authorityType="ADFS":t.protocolMode===zl?h.authorityType="MSSTS":h.authorityType=Cl,e.clientInfo&&n&&(d=zd(e.clientInfo,n)),h.clientInfo=e.clientInfo,h.homeAccountId=e.homeAccountId,h.nativeAccountId=e.nativeAccountId;var g=e.environment||t&&t.getPreferredCache();if(!g)throw zu(ku);h.environment=g,h.realm=(null===(r=d)||void 0===r?void 0:r.utid)||$d(e.idTokenClaims)||"",h.localAccountId=(null===(o=d)||void 0===o?void 0:o.uid)||(null===(i=e.idTokenClaims)||void 0===i?void 0:i.oid)||(null===(a=e.idTokenClaims)||void 0===a?void 0:a.sub)||"";var f=(null===(c=e.idTokenClaims)||void 0===c?void 0:c.preferred_username)||(null===(s=e.idTokenClaims)||void 0===s?void 0:s.upn),p=null!==(l=e.idTokenClaims)&&void 0!==l&&l.emails?e.idTokenClaims.emails[0]:null;if(h.username=f||p||"",h.name=(null===(u=e.idTokenClaims)||void 0===u?void 0:u.name)||"",h.cloudGraphHostName=e.cloudGraphHostName,h.msGraphHost=e.msGraphHost,e.tenantProfiles)h.tenantProfiles=e.tenantProfiles;else{var v=Xd(e.homeAccountId,h.localAccountId,h.realm,e.idTokenClaims);h.tenantProfiles=[v]}return h}static createFromAccountInfo(e,t,n){var r,o=new eh;return o.authorityType=e.authorityType||Cl,o.homeAccountId=e.homeAccountId,o.localAccountId=e.localAccountId,o.nativeAccountId=e.nativeAccountId,o.realm=e.tenantId,o.environment=e.environment,o.username=e.username,o.name=e.name,o.cloudGraphHostName=t,o.msGraphHost=n,o.tenantProfiles=Array.from((null===(r=e.tenantProfiles)||void 0===r?void 0:r.values())||[]),o}static generateHomeAccountId(e,t,n,r,o){if(1!==t&&2!==t){if(e)try{var i=zd(e,r.base64Decode);if(i.uid&&i.utid)return"".concat(i.uid,".").concat(i.utid)}catch(e){}n.warning("No client info in response")}return(null==o?void 0:o.sub)||""}static isAccountEntity(e){return!!e&&e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("localAccountId")&&e.hasOwnProperty("username")&&e.hasOwnProperty("authorityType")}static accountInfoIsEqual(e,t,n){if(!e||!t)return!1;var r=!0;if(n){var o=e.idTokenClaims||{},i=t.idTokenClaims||{};r=o.iat===i.iat&&o.nonce===i.nonce}return e.homeAccountId===t.homeAccountId&&e.localAccountId===t.localAccountId&&e.username===t.username&&e.tenantId===t.tenantId&&e.environment===t.environment&&e.nativeAccountId===t.nativeAccountId&&r}}function th(e){return e.startsWith("#/")?e.substring(2):e.startsWith("#")||e.startsWith("?")?e.substring(1):e}function nh(e){if(!e||e.indexOf("=")<0)return null;try{var t=th(e),n=Object.fromEntries(new URLSearchParams(t));if(n.code||n.error||n.error_description||n.state)return n}catch(e){throw zu(ru)}return null}class rh{get urlString(){return this._urlString}constructor(e){if(this._urlString=e,!this._urlString)throw Ld(wd);e.includes("#")||(this._urlString=rh.canonicalizeUri(e))}static canonicalizeUri(e){if(e){var t=e.toLowerCase();return Bd.endsWith(t,"?")?t=t.slice(0,-1):Bd.endsWith(t,"?/")&&(t=t.slice(0,-2)),Bd.endsWith(t,"/")||(t+="/"),t}return e}validateAsUri(){var e;try{e=this.getUrlComponents()}catch(e){throw Ld(yd)}if(!e.HostNameAndPort||!e.PathSegments)throw Ld(yd);if(!e.Protocol||"https:"!==e.Protocol.toLowerCase())throw Ld(md)}static appendQueryString(e,t){return t?e.indexOf("?")<0?"".concat(e,"?").concat(t):"".concat(e,"&").concat(t):e}static removeHashFromUrl(e){return rh.canonicalizeUri(e.split("#")[0])}replaceTenantPath(e){var t=this.getUrlComponents(),n=t.PathSegments;return!e||0===n.length||n[0]!==gl&&n[0]!==fl||(n[0]=e),rh.constructAuthorityUriFromObject(t)}getUrlComponents(){var e=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),t=this.urlString.match(e);if(!t)throw Ld(yd);var n={Protocol:t[1],HostNameAndPort:t[4],AbsolutePath:t[5],QueryString:t[7]},r=n.AbsolutePath.split("/");return r=r.filter(e=>e&&e.length>0),n.PathSegments=r,n.QueryString&&n.QueryString.endsWith("/")&&(n.QueryString=n.QueryString.substring(0,n.QueryString.length-1)),n}static getDomainFromUrl(e){var t=RegExp("^([^:/?#]+://)?([^/?#]*)"),n=e.match(t);if(!n)throw Ld(yd);return n[2]}static getAbsoluteUrl(e,t){if(e[0]===Js.FORWARD_SLASH){var n=new rh(t).getUrlComponents();return n.Protocol+"//"+n.HostNameAndPort+e}return e}static constructAuthorityUriFromObject(e){return new rh(e.Protocol+"//"+e.HostNameAndPort+"/"+e.PathSegments.join("/"))}static hashContainsKnownProperties(e){return!!nh(e)}}var oh={"login.microsoftonline.com":{token_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.com/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.com/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/logout"},"login.chinacloudapi.cn":{token_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.chinacloudapi.cn/{tenantid}/discovery/v2.0/keys",issuer:"https://login.partner.microsoftonline.cn/{tenantid}/v2.0",authorization_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/logout"},"login.microsoftonline.us":{token_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.us/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.us/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/logout"}},ih={tenant_discovery_endpoint:"https://{canonicalAuthority}/v2.0/.well-known/openid-configuration",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},ah=new Set;function ch(e,t,n,r){if(null==r||r.trace("getAliasesFromMetadata called with source: ".concat(n)),e&&t){var o=sh(t,e);if(o)return null==r||r.trace("getAliasesFromMetadata: found cloud discovery metadata in ".concat(n,", returning aliases")),o.aliases;null==r||r.trace("getAliasesFromMetadata: did not find cloud discovery metadata in ".concat(n))}return null}function sh(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r.aliases.includes(t))return r}return null}ih.metadata.forEach(e=>{e.aliases.forEach(e=>{ah.add(e)})});var lh="cache_quota_exceeded",uh="cache_error_unknown",dh={[lh]:"Exceeded cache storage capacity.",[uh]:"Unexpected error occurred when using cache storage."};class hh extends Error{constructor(e,t){var n=t||(dh[e]?dh[e]:dh[uh]);super("".concat(e,": ").concat(n)),Object.setPrototypeOf(this,hh.prototype),this.name="CacheError",this.errorCode=e,this.errorMessage=n}}function gh(e){return e instanceof Error?"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name||e.message.includes("exceeded the quota")?new hh(lh):new hh(e.name,e.message):new hh(uh)}function fh(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ph(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fh(Object(n),!0).forEach(function(t){vh(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fh(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function vh(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function mh(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function yh(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){mh(i,r,o,a,c,"next",e)}function c(e){mh(i,r,o,a,c,"throw",e)}a(void 0)})}}class wh{constructor(e,t,n,r){this.clientId=e,this.cryptoImpl=t,this.commonLogger=n.clone(Yu,Gu),this.staticAuthorityOptions=r}getAllAccounts(e,t){return this.buildTenantProfiles(this.getAccountsFilteredBy(t||{},e),e,t)}getAccountInfoFilteredBy(e,t){var n=this.getAllAccounts(t,e);return n.length>1?n.sort(e=>e.idTokenClaims?-1:1)[0]:1===n.length?n[0]:null}getBaseAccountInfo(e,t){var n=this.getAccountsFilteredBy(e,t);return n.length>0?n[0].getAccountInfo():null}buildTenantProfiles(e,t,n){return e.flatMap(e=>this.getTenantProfilesFromAccountEntity(e,t,null==n?void 0:n.tenantId,n))}getTenantedAccountInfoByFilter(e,t,n,r,o){var i;if(o&&!this.tenantProfileMatchesFilter(n,o))return null;var a=this.getIdToken(e,r,t,n.tenantId);return a&&(i=Wu(a.secret,this.cryptoImpl.base64Decode),!this.idTokenClaimsMatchTenantProfileFilter(i,o))?null:Jd(e,n,i,null==a?void 0:a.secret)}getTenantProfilesFromAccountEntity(e,t,n,r){var o=e.getAccountInfo(),i=o.tenantProfiles||new Map,a=this.getTokenKeys();if(n){var c=i.get(n);if(!c)return[];i=new Map([[n,c]])}var s=[];return i.forEach(e=>{var n=this.getTenantedAccountInfoByFilter(o,a,e,t,r);n&&s.push(n)}),s}tenantProfileMatchesFilter(e,t){return!(t.localAccountId&&!this.matchLocalAccountIdFromTenantProfile(e,t.localAccountId)||t.name&&e.name!==t.name||void 0!==t.isHomeTenant&&e.isHomeTenant!==t.isHomeTenant)}idTokenClaimsMatchTenantProfileFilter(e,t){if(t){if(t.localAccountId&&!this.matchLocalAccountIdFromTokenClaims(e,t.localAccountId))return!1;if(t.loginHint&&!this.matchLoginHintFromTokenClaims(e,t.loginHint))return!1;if(t.username&&!this.matchUsername(e.preferred_username,t.username))return!1;if(t.name&&!this.matchName(e,t.name))return!1;if(t.sid&&!this.matchSid(e,t.sid))return!1}return!0}saveCacheRecord(e,t,n){var r=this;return yh(function*(){if(!e)throw zu(Cu);try{e.account&&r.setAccount(e.account,t),e.idToken&&!1!==(null==n?void 0:n.idToken)&&r.setIdTokenCredential(e.idToken,t),e.accessToken&&!1!==(null==n?void 0:n.accessToken)&&(yield r.saveAccessToken(e.accessToken,t)),e.refreshToken&&!1!==(null==n?void 0:n.refreshToken)&&r.setRefreshTokenCredential(e.refreshToken,t),e.appMetadata&&r.setAppMetadata(e.appMetadata,t)}catch(e){var o;throw null===(o=r.commonLogger)||void 0===o||o.error("CacheManager.saveCacheRecord: failed"),e instanceof Wl?e:gh(e)}})()}saveAccessToken(e,t){var n=this;return yh(function*(){var r={clientId:e.clientId,credentialType:e.credentialType,environment:e.environment,homeAccountId:e.homeAccountId,realm:e.realm,tokenType:e.tokenType,requestedClaimsHash:e.requestedClaimsHash},o=n.getTokenKeys(),i=Ud.fromString(e.target);o.accessToken.forEach(e=>{if(n.accessTokenKeyMatchesFilter(e,r,!1)){var o=n.getAccessTokenCredential(e,t);o&&n.credentialMatchesFilter(o,r)&&Ud.fromString(o.target).intersectingScopeSets(i)&&n.removeAccessToken(e,t)}}),n.setAccessTokenCredential(e,t)})()}getAccountsFilteredBy(e,t){var n=this.getAccountKeys(),r=[];return n.forEach(n=>{var o;if(this.isAccountKey(n,e.homeAccountId)){var i=this.getAccount(n,t,this.commonLogger);if(i&&(!e.homeAccountId||this.matchHomeAccountId(i,e.homeAccountId))&&(!e.username||this.matchUsername(i.username,e.username))&&(!e.environment||this.matchEnvironment(i,e.environment))&&(!e.realm||this.matchRealm(i,e.realm))&&(!e.nativeAccountId||this.matchNativeAccountId(i,e.nativeAccountId))&&(!e.authorityType||this.matchAuthorityType(i,e.authorityType))){var a={localAccountId:null==e?void 0:e.localAccountId,name:null==e?void 0:e.name},c=null===(o=i.tenantProfiles)||void 0===o?void 0:o.filter(e=>this.tenantProfileMatchesFilter(e,a));c&&0===c.length||r.push(i)}}}),r}isAccountKey(e,t,n){return!(e.split(kl).length<3||t&&!e.toLowerCase().includes(t.toLowerCase())||n&&!e.toLowerCase().includes(n.toLowerCase()))}isCredentialKey(e){if(e.split(kl).length<6)return!1;var t=e.toLowerCase();if(-1===t.indexOf(Sl.ID_TOKEN.toLowerCase())&&-1===t.indexOf(Sl.ACCESS_TOKEN.toLowerCase())&&-1===t.indexOf(Sl.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase())&&-1===t.indexOf(Sl.REFRESH_TOKEN.toLowerCase()))return!1;if(t.indexOf(Sl.REFRESH_TOKEN.toLowerCase())>-1){var n="".concat(Sl.REFRESH_TOKEN).concat(kl).concat(this.clientId).concat(kl),r="".concat(Sl.REFRESH_TOKEN).concat(kl).concat(El).concat(kl);if(-1===t.indexOf(n.toLowerCase())&&-1===t.indexOf(r.toLowerCase()))return!1}else if(-1===t.indexOf(this.clientId.toLowerCase()))return!1;return!0}credentialMatchesFilter(e,t){if(t.clientId&&!this.matchClientId(e,t.clientId))return!1;if(t.userAssertionHash&&!this.matchUserAssertionHash(e,t.userAssertionHash))return!1;if("string"==typeof t.homeAccountId&&!this.matchHomeAccountId(e,t.homeAccountId))return!1;if(t.environment&&!this.matchEnvironment(e,t.environment))return!1;if(t.realm&&!this.matchRealm(e,t.realm))return!1;if(t.credentialType&&!this.matchCredentialType(e,t.credentialType))return!1;if(t.familyId&&!this.matchFamilyId(e,t.familyId))return!1;if(t.target&&!this.matchTarget(e,t.target))return!1;if((t.requestedClaimsHash||e.requestedClaimsHash)&&e.requestedClaimsHash!==t.requestedClaimsHash)return!1;if(e.credentialType===Sl.ACCESS_TOKEN_WITH_AUTH_SCHEME){if(t.tokenType&&!this.matchTokenType(e,t.tokenType))return!1;if(t.tokenType===xl.SSH&&t.keyId&&!this.matchKeyId(e,t.keyId))return!1}return!0}getAppMetadataFilteredBy(e){var t=this.getKeys(),n={};return t.forEach(t=>{if(this.isAppMetadata(t)){var r=this.getAppMetadata(t);r&&(e.environment&&!this.matchEnvironment(r,e.environment)||e.clientId&&!this.matchClientId(r,e.clientId)||(n[t]=r))}}),n}getAuthorityMetadataByAlias(e){var t=this.getAuthorityMetadataKeys(),n=null;return t.forEach(t=>{if(this.isAuthorityMetadata(t)&&-1!==t.indexOf(this.clientId)){var r=this.getAuthorityMetadata(t);r&&-1!==r.aliases.indexOf(e)&&(n=r)}}),n}removeAllAccounts(e){var t=this;return yh(function*(){var n=t.getAccountKeys(),r=[];n.forEach(n=>{r.push(t.removeAccount(n,e))}),yield Promise.all(r)})()}removeAccount(e,t){var n=this;return yh(function*(){var r=n.getAccount(e,t,n.commonLogger);r&&(yield n.removeAccountContext(r,t),n.removeItem(e,t))})()}removeAccountContext(e,t){var n=this;return yh(function*(){var r=n.getTokenKeys(),o=e.generateAccountId();r.idToken.forEach(e=>{0===e.indexOf(o)&&n.removeIdToken(e,t)}),r.accessToken.forEach(e=>{0===e.indexOf(o)&&n.removeAccessToken(e,t)}),r.refreshToken.forEach(e=>{0===e.indexOf(o)&&n.removeRefreshToken(e,t)}),n.getKeys().forEach(e=>{e.includes(o)&&n.removeItem(e,t)})})()}updateOutdatedCachedAccount(e,t,n,r){if(t&&t.isSingleTenant()){var o;null===(o=this.commonLogger)||void 0===o||o.verbose("updateOutdatedCachedAccount: Found a single-tenant (outdated) account entity in the cache, migrating to multi-tenant account entity");var i=this.getAccountKeys().filter(e=>e.startsWith(t.homeAccountId)),a=[];i.forEach(e=>{var t=this.getCachedAccountEntity(e,n);t&&a.push(t)});var c=a.find(e=>Qd(e.realm,e.homeAccountId))||a[0];c.tenantProfiles=a.map(e=>({tenantId:e.realm,localAccountId:e.localAccountId,name:e.name,isHomeTenant:Qd(e.realm,e.homeAccountId)}));var s=wh.toObject(new eh,ph({},c)),l=s.generateAccountKey();return i.forEach(t=>{t!==l&&this.removeOutdatedAccount(e,n)}),this.setAccount(s,n),null==r||r.verbose("Updated an outdated account entity in the cache"),s}return t}removeAccessToken(e,t){var n=this.getAccessTokenCredential(e,t);if(this.removeItem(e,t),n&&n.credentialType.toLowerCase()===Sl.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase()&&n.tokenType===xl.POP){var r=n.keyId;r&&this.cryptoImpl.removeTokenBindingKey(r).catch(()=>{this.commonLogger.error("Binding key could not be removed")})}}removeAppMetadata(e){return this.getKeys().forEach(t=>{this.isAppMetadata(t)&&this.removeItem(t,e)}),!0}readAccountFromCache(e,t){var n=eh.generateAccountCacheKey(e);return this.getAccount(n,t,this.commonLogger)}getIdToken(e,t,n,r,o){this.commonLogger.trace("CacheManager - getIdToken called");var i={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:Sl.ID_TOKEN,clientId:this.clientId,realm:r},a=this.getIdTokensByFilter(i,t,n),c=a.size;if(c<1)return this.commonLogger.info("CacheManager:getIdToken - No token found"),null;if(c>1){var s=a;if(!r){var l=new Map;a.forEach((t,n)=>{t.realm===e.tenantId&&l.set(n,t)});var u=l.size;if(u<1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account but none match account entity tenant id, returning first result"),a.values().next().value;if(1===u)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account, defaulting to home tenant profile"),l.values().next().value;s=l}return this.commonLogger.info("CacheManager:getIdToken - Multiple matching ID tokens found, clearing them"),s.forEach((e,n)=>{this.removeIdToken(n,t)}),o&&t&&o.addFields({multiMatchedID:a.size},t),null}return this.commonLogger.info("CacheManager:getIdToken - Returning ID token"),a.values().next().value}getIdTokensByFilter(e,t,n){var r=n&&n.idToken||this.getTokenKeys().idToken,o=new Map;return r.forEach(n=>{if(this.idTokenKeyMatchesFilter(n,ph({clientId:this.clientId},e))){var r=this.getIdTokenCredential(n,t);r&&this.credentialMatchesFilter(r,e)&&o.set(n,r)}}),o}idTokenKeyMatchesFilter(e,t){var n=e.toLowerCase();return!(t.clientId&&-1===n.indexOf(t.clientId.toLowerCase())||t.homeAccountId&&-1===n.indexOf(t.homeAccountId.toLowerCase()))}removeIdToken(e,t){this.removeItem(e,t)}removeRefreshToken(e,t){this.removeItem(e,t)}getAccessToken(e,t,n,r,o){this.commonLogger.trace("CacheManager - getAccessToken called");var i=Ud.createSearchScopes(t.scopes),a=t.authenticationScheme||xl.BEARER,c=a&&a.toLowerCase()!==xl.BEARER.toLowerCase()?Sl.ACCESS_TOKEN_WITH_AUTH_SCHEME:Sl.ACCESS_TOKEN,s={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:c,clientId:this.clientId,realm:r||e.tenantId,target:i,tokenType:a,keyId:t.sshKid,requestedClaimsHash:t.requestedClaimsHash},l=n&&n.accessToken||this.getTokenKeys().accessToken,u=[];l.forEach(e=>{if(this.accessTokenKeyMatchesFilter(e,s,!0)){var n=this.getAccessTokenCredential(e,t.correlationId);n&&this.credentialMatchesFilter(n,s)&&u.push(n)}});var d=u.length;return d<1?(this.commonLogger.info("CacheManager:getAccessToken - No token found"),null):d>1?(this.commonLogger.info("CacheManager:getAccessToken - Multiple access tokens found, clearing them"),u.forEach(e=>{this.removeAccessToken(Ju(e),t.correlationId)}),o&&t.correlationId&&o.addFields({multiMatchedAT:u.length},t.correlationId),null):(this.commonLogger.info("CacheManager:getAccessToken - Returning access token"),u[0])}accessTokenKeyMatchesFilter(e,t,n){var r=e.toLowerCase();if(t.clientId&&-1===r.indexOf(t.clientId.toLowerCase()))return!1;if(t.homeAccountId&&-1===r.indexOf(t.homeAccountId.toLowerCase()))return!1;if(t.realm&&-1===r.indexOf(t.realm.toLowerCase()))return!1;if(t.requestedClaimsHash&&-1===r.indexOf(t.requestedClaimsHash.toLowerCase()))return!1;if(t.target)for(var o=t.target.asArray(),i=0;i<o.length;i++){if(n&&!r.includes(o[i].toLowerCase()))return!1;if(!n&&r.includes(o[i].toLowerCase()))return!0}return!0}getAccessTokensByFilter(e,t){var n=this.getTokenKeys(),r=[];return n.accessToken.forEach(n=>{if(this.accessTokenKeyMatchesFilter(n,e,!0)){var o=this.getAccessTokenCredential(n,t);o&&this.credentialMatchesFilter(o,e)&&r.push(o)}}),r}getRefreshToken(e,t,n,r,o){this.commonLogger.trace("CacheManager - getRefreshToken called");var i=t?El:void 0,a={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:Sl.REFRESH_TOKEN,clientId:this.clientId,familyId:i},c=r&&r.refreshToken||this.getTokenKeys().refreshToken,s=[];c.forEach(e=>{if(this.refreshTokenKeyMatchesFilter(e,a)){var t=this.getRefreshTokenCredential(e,n);t&&this.credentialMatchesFilter(t,a)&&s.push(t)}});var l=s.length;return l<1?(this.commonLogger.info("CacheManager:getRefreshToken - No refresh token found."),null):(l>1&&o&&n&&o.addFields({multiMatchedRT:l},n),this.commonLogger.info("CacheManager:getRefreshToken - returning refresh token"),s[0])}refreshTokenKeyMatchesFilter(e,t){var n=e.toLowerCase();return!(t.familyId&&-1===n.indexOf(t.familyId.toLowerCase())||!t.familyId&&t.clientId&&-1===n.indexOf(t.clientId.toLowerCase())||t.homeAccountId&&-1===n.indexOf(t.homeAccountId.toLowerCase()))}readAppMetadataFromCache(e){var t={environment:e,clientId:this.clientId},n=this.getAppMetadataFilteredBy(t),r=Object.keys(n).map(e=>n[e]),o=r.length;if(o<1)return null;if(o>1)throw zu(hu);return r[0]}isAppMetadataFOCI(e){var t=this.readAppMetadataFromCache(e);return!(!t||t.familyId!==El)}matchHomeAccountId(e,t){return!("string"!=typeof e.homeAccountId||t!==e.homeAccountId)}matchLocalAccountIdFromTokenClaims(e,t){return t===(e.oid||e.sub)}matchLocalAccountIdFromTenantProfile(e,t){return e.localAccountId===t}matchName(e,t){var n;return!(t.toLowerCase()!==(null===(n=e.name)||void 0===n?void 0:n.toLowerCase()))}matchUsername(e,t){return!(!e||"string"!=typeof e||(null==t?void 0:t.toLowerCase())!==e.toLowerCase())}matchUserAssertionHash(e,t){return!(!e.userAssertionHash||t!==e.userAssertionHash)}matchEnvironment(e,t){if(this.staticAuthorityOptions){var n=function(e,t){var n,r=e.canonicalAuthority;if(r){var o,i=new rh(r).getUrlComponents().HostNameAndPort;n=ch(i,null===(o=e.cloudDiscoveryMetadata)||void 0===o?void 0:o.metadata,Tl,t)||ch(i,ih.metadata,Pl,t)||e.knownAuthorities}return n||[]}(this.staticAuthorityOptions,this.commonLogger);if(n.includes(t)&&n.includes(e.environment))return!0}var r=this.getAuthorityMetadataByAlias(t);return!!(r&&r.aliases.indexOf(e.environment)>-1)}matchCredentialType(e,t){return e.credentialType&&t.toLowerCase()===e.credentialType.toLowerCase()}matchClientId(e,t){return!(!e.clientId||t!==e.clientId)}matchFamilyId(e,t){return!(!e.familyId||t!==e.familyId)}matchRealm(e,t){var n;return!((null===(n=e.realm)||void 0===n?void 0:n.toLowerCase())!==t.toLowerCase())}matchNativeAccountId(e,t){return!(!e.nativeAccountId||t!==e.nativeAccountId)}matchLoginHintFromTokenClaims(e,t){return e.login_hint===t||e.preferred_username===t||e.upn===t}matchSid(e,t){return e.sid===t}matchAuthorityType(e,t){return!(!e.authorityType||t.toLowerCase()!==e.authorityType.toLowerCase())}matchTarget(e,t){return!(e.credentialType!==Sl.ACCESS_TOKEN&&e.credentialType!==Sl.ACCESS_TOKEN_WITH_AUTH_SCHEME||!e.target)&&Ud.fromString(e.target).containsScopeSet(t)}matchTokenType(e,t){return!(!e.tokenType||e.tokenType!==t)}matchKeyId(e,t){return!(!e.keyId||e.keyId!==t)}isAppMetadata(e){return-1!==e.indexOf(Il)}isAuthorityMetadata(e){return-1!==e.indexOf(_l)}generateAuthorityMetadataCacheKey(e){return"".concat(_l,"-").concat(this.clientId,"-").concat(e)}static toObject(e,t){for(var n in t)e[n]=t[n];return e}}class bh extends wh{setAccount(){throw zu(Hu)}getAccount(){throw zu(Hu)}getCachedAccountEntity(){throw zu(Hu)}setIdTokenCredential(){throw zu(Hu)}getIdTokenCredential(){throw zu(Hu)}setAccessTokenCredential(){throw zu(Hu)}getAccessTokenCredential(){throw zu(Hu)}setRefreshTokenCredential(){throw zu(Hu)}getRefreshTokenCredential(){throw zu(Hu)}setAppMetadata(){throw zu(Hu)}getAppMetadata(){throw zu(Hu)}setServerTelemetry(){throw zu(Hu)}getServerTelemetry(){throw zu(Hu)}setAuthorityMetadata(){throw zu(Hu)}getAuthorityMetadata(){throw zu(Hu)}getAuthorityMetadataKeys(){throw zu(Hu)}setThrottlingCache(){throw zu(Hu)}getThrottlingCache(){throw zu(Hu)}removeItem(){throw zu(Hu)}getKeys(){throw zu(Hu)}getAccountKeys(){throw zu(Hu)}getTokenKeys(){throw zu(Hu)}updateCredentialCacheKey(){throw zu(Hu)}removeOutdatedAccount(){throw zu(Hu)}}function Ch(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function kh(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ch(Object(n),!0).forEach(function(t){Sh(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ch(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Sh(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ih(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function Eh(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){Ih(i,r,o,a,c,"next",e)}function c(e){Ih(i,r,o,a,c,"throw",e)}a(void 0)})}}var _h={tokenRenewalOffsetSeconds:300,preventCorsPreflight:!1},Th={loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:Xs.Info,correlationId:Js.EMPTY_STRING},Oh={claimsBasedCachingEnabled:!1},Ah={sendGetRequestAsync:()=>Eh(function*(){throw zu(Hu)})(),sendPostRequestAsync:()=>Eh(function*(){throw zu(Hu)})()},Ph={sku:Js.SKU,version:Gu,cpu:Js.EMPTY_STRING,os:Js.EMPTY_STRING},Mh={clientSecret:Js.EMPTY_STRING,clientAssertion:void 0},xh={azureCloudInstance:Fl,tenant:"".concat(Js.DEFAULT_COMMON_TENANT)},Nh={application:{appName:"",appVersion:""}};function Rh(e){return e.authOptions.authority.options.protocolMode===Kl}var jh={sendGetRequestAsync:()=>Promise.reject(zu(Hu)),sendPostRequestAsync:()=>Promise.reject(zu(Hu))},Dh="acquireTokenByCode",qh="acquireTokenByRefreshToken",Hh="acquireTokenSilent",Lh="acquireTokenSilentAsync",Bh="acquireTokenPopup",Uh="acquireTokenRedirect",zh="cryptoOptsGetPublicKeyThumbprint",Kh="cryptoOptsSignJwt",Fh="silentCacheClientAcquireToken",Vh="silentIframeClientAcquireToken",Yh="silentRefreshClientAcquireToken",Gh="ssoSilent",Wh="standardInteractionClientGetDiscoveredAuthority",Zh="fetchAccountIdWithNativeBroker",Qh="nativeInteractionClientAcquireToken",Xh="networkClientSendPostRequestAsync",Jh="refreshTokenClientExecutePostToTokenEndpoint",$h="authorizationCodeClientExecutePostToTokenEndpoint",eg="refreshTokenClientExecuteTokenRequest",tg="refreshTokenClientAcquireToken",ng="refreshTokenClientAcquireTokenWithCachedRefreshToken",rg="refreshTokenClientAcquireTokenByRefreshToken",og="refreshTokenClientCreateTokenRequestBody",ig="acquireTokenFromCache",ag="silentFlowClientAcquireCachedToken",cg="silentFlowClientGenerateResultFromCacheRecord",sg="acquireTokenBySilentIframe",lg="initializeBaseRequest",ug="initializeSilentRequest",dg="initializeClientApplication",hg="silentIframeClientTokenHelper",gg="silentHandlerInitiateAuthRequest",fg="silentHandlerMonitorIframeForHash",pg="silentHandlerLoadFrame",vg="silentHandlerLoadFrameSync",mg="standardInteractionClientCreateAuthCodeClient",yg="standardInteractionClientGetClientConfiguration",wg="standardInteractionClientInitializeAuthorizationRequest",bg="standardInteractionClientInitializeAuthorizationCodeRequest",Cg="getAuthCodeUrl",kg="handleCodeResponseFromServer",Sg="handleCodeResponse",Ig="updateTokenEndpointAuthority",Eg="authClientAcquireToken",_g="authClientExecuteTokenRequest",Tg="authClientCreateTokenRequestBody",Og="authClientCreateQueryString",Ag="popTokenGenerateCnf",Pg="popTokenGenerateKid",Mg="handleServerTokenResponse",xg="deserializeResponse",Ng="authorityFactoryCreateDiscoveredInstance",Rg="authorityResolveEndpointsAsync",jg="authorityGetCloudDiscoveryMetadataFromNetwork",Dg="authorityUpdateCloudDiscoveryMetadata",qg="authorityGetEndpointMetadataFromNetwork",Hg="authorityUpdateEndpointMetadata",Lg="authorityUpdateMetadataWithRegionalInformation",Bg="regionDiscoveryDetectRegion",Ug="regionDiscoveryGetRegionFromIMDS",zg="regionDiscoveryGetCurrentVersion",Kg="acquireTokenByCodeAsync",Fg="handleRedirectPromise",Vg="handleNativeRedirectPromise",Yg="nativeMessageHandlerHandshake",Gg="removeHiddenIframe",Wg="clearTokensAndKeysWithClaims",Zg="cacheManagerGetRefreshToken",Qg="generatePkceCodes",Xg="generateCodeVerifier",Jg="generateCodeChallengeFromVerifier",$g="sha256Digest",ef="getRandomValues",tf=(new Map([[Dh,"ATByCode"],[qh,"ATByRT"],[Hh,"ATS"],[Lh,"ATSAsync"],[Bh,"ATPopup"],[Uh,"ATRedirect"],[zh,"CryptoGetPKThumb"],[Kh,"CryptoSignJwt"],[Fh,"SltCacheClientAT"],[Vh,"SltIframeClientAT"],[Yh,"SltRClientAT"],[Gh,"SsoSlt"],[Wh,"StdIntClientGetDiscAuth"],[Zh,"FetchAccIdWithNtvBroker"],[Qh,"NtvIntClientAT"],["baseClientCreateTokenRequestHeaders","BaseClientCreateTReqHead"],[Xh,"NetClientSendPost"],[Jh,"RTClientExecPost"],[$h,"AuthCodeClientExecPost"],["brokerHandshake","BrokerHandshake"],["acquireTokenByRefreshTokenInBroker","ATByRTInBroker"],["acquireTokenByBroker","ATByBroker"],[eg,"RTClientExecTReq"],[tg,"RTClientAT"],[ng,"RTClientATWithCachedRT"],[rg,"RTClientATByRT"],[og,"RTClientCreateTReqBody"],[ig,"ATFromCache"],[ag,"SltFlowClientATCached"],[cg,"SltFlowClientGenResFromCache"],[sg,"ATBySltIframe"],[lg,"InitBaseReq"],[ug,"InitSltReq"],[dg,"InitClientApplication"],[hg,"SIClientTHelper"],[gg,"SHandlerInitAuthReq"],[fg,"SltHandlerMonitorIframeForHash"],[pg,"SHandlerLoadFrame"],[vg,"SHandlerLoadFrameSync"],[mg,"StdIntClientCreateAuthCodeClient"],[yg,"StdIntClientGetClientConf"],[wg,"StdIntClientInitAuthReq"],[bg,"StdIntClientInitAuthCodeReq"],[Cg,"GetAuthCodeUrl"],[kg,"HandleCodeResFromServer"],[Sg,"HandleCodeResp"],[Ig,"UpdTEndpointAuth"],[Eg,"AuthClientAT"],[_g,"AuthClientExecTReq"],[Tg,"AuthClientCreateTReqBody"],[Og,"AuthClientCreateQueryStr"],[Ag,"PopTGenCnf"],[Pg,"PopTGenKid"],[Mg,"HandleServerTRes"],[xg,"DeserializeRes"],[Ng,"AuthFactCreateDiscInst"],[Rg,"AuthResolveEndpointsAsync"],["authorityResolveEndpointsFromLocalSources","AuthResolveEndpointsFromLocal"],[jg,"AuthGetCDMetaFromNet"],[Dg,"AuthUpdCDMeta"],[qg,"AuthUpdCDMetaFromNet"],[Hg,"AuthUpdEndpointMeta"],[Lg,"AuthUpdMetaWithRegInfo"],[Bg,"RegDiscDetectReg"],[Ug,"RegDiscGetRegFromIMDS"],[zg,"RegDiscGetCurrentVer"],[Kg,"ATByCodeAsync"],["getEndpointMetadataFromNetwork","GetEndpointMetaFromNet"],["getCloudDiscoveryMetadataFromNetworkMeasurement","GetCDMetaFromNet"],[Fg,"HandleRedirectPromise"],[Vg,"HandleNtvRedirectPromise"],["updateCloudDiscoveryMetadataMeasurement","UpdateCDMeta"],["usernamePasswordClientAcquireToken","UserPassClientAT"],[Yg,"NtvMsgHandlerHandshake"],["nativeGenerateAuthResult","NtvGenAuthRes"],[Gg,"RemoveHiddenIframe"],[Wg,"ClearTAndKeysWithClaims"],[Zg,"CacheManagerGetRT"],[Qg,"GenPkceCodes"],[Xg,"GenCodeVerifier"],[Jg,"GenCodeChallengeFromVerifier"],[$g,"Sha256Digest"],[ef,"GetRandomValues"]]),1);new Set(["accessTokenSize","durationMs","idTokenSize","matsSilentStatus","matsHttpStatus","refreshTokenSize","queuedTimeMs","startTimeMs","status","multiMatchedAT","multiMatchedID","multiMatchedRT"]);class nf{startMeasurement(){}endMeasurement(){}flushMeasurement(){return null}}class rf{generateId(){return"callback-id"}startMeasurement(e,t){return{end:()=>null,discard:()=>{},add:()=>{},increment:()=>{},event:{eventId:this.generateId(),status:tf,authority:"",libraryName:"",libraryVersion:"",clientId:"",name:e,startTimeMs:Date.now(),correlationId:t||""},measurement:new nf}}startPerformanceMeasurement(){return new nf}calculateQueuedTime(){return 0}addQueueMeasurement(){}setPreQueueTime(){}endMeasurement(){return null}discardMeasurements(){}removePerformanceCallback(){return!0}addPerformanceCallback(){return""}emitEvents(){}addFields(){}incrementFields(){}cacheEventByCorrelationId(){}}var of,af="invalid_grant",cf="msal",sf="msal.js.browser",lf="53ee284d-920a-4b59-9d30-a60315b26836",uf="ppnbnpeolgkicgegkbkbjmhlideopiji",df="Handshake",hf="GetToken",gf="localStorage",ff="sessionStorage",pf="memoryStorage",vf="request.state",mf="request.origin",yf="urlHash",wf="request.params",bf="interaction.status",Cf="ccs.credential",kf="request.correlationId",Sf="request.native",If="msal.account.keys",Ef="msal.token.keys",_f="msal.version",Tf="wrapper.sku",Of="wrapper.version",Af=861,Pf=862;!function(e){e.Redirect="redirect",e.Popup="popup",e.Silent="silent",e.None="none"}(of||(of={}));var Mf={scopes:$s},xf="msal.db",Nf="".concat(xf,".keys"),Rf=[0,5,4];class jf{navigateInternal(e,t){return jf.defaultNavigateWindow(e,t)}navigateExternal(e,t){return jf.defaultNavigateWindow(e,t)}static defaultNavigateWindow(e,t){return t.noHistory?window.location.replace(e):window.location.assign(e),new Promise(e=>{setTimeout(()=>{e(!0)},t.timeout)})}}class Df extends Wl{constructor(e,t,n){super(e.errorCode,e.errorMessage,e.subError),Object.setPrototypeOf(this,Df.prototype),this.name="NetworkError",this.error=e,this.httpStatus=t,this.responseHeaders=n}}function qf(e,t,n){return new Df(e,t,n)}var Hf="pkce_not_created",Lf="crypto_nonexistent",Bf="empty_navigate_uri",Uf="hash_empty_error",zf="no_state_in_hash",Kf="hash_does_not_contain_known_properties",Ff="unable_to_parse_state",Vf="state_interaction_type_mismatch",Yf="interaction_in_progress",Gf="popup_window_error",Wf="empty_window_error",Zf="user_cancelled",Qf="monitor_popup_timeout",Xf="monitor_window_timeout",Jf="redirect_in_iframe",$f="block_iframe_reload",ep="block_nested_popups",tp="iframe_closed_prematurely",np="silent_logout_unsupported",rp="no_account_error",op="silent_prompt_value_error",ip="no_token_request_cache_error",ap="unable_to_parse_token_request_cache_error",cp="no_cached_authority_error",sp="auth_request_not_set_error",lp="invalid_cache_type",up="non_browser_environment",dp="database_not_open",hp="no_network_connectivity",gp="post_request_failed",fp="get_request_failed",pp="failed_to_parse_response",vp="unable_to_load_token",mp="crypto_key_not_found",yp="auth_code_required",wp="auth_code_or_nativeAccountId_required",bp="spa_code_and_nativeAccountId_present",Cp="database_unavailable",kp="unable_to_acquire_token_from_native_platform",Sp="native_handshake_timeout",Ip="native_extension_not_installed",Ep="native_connection_not_established",_p="uninitialized_public_client_application",Tp="native_prompt_not_supported",Op="invalid_base64_string",Ap="invalid_pop_token_request",Pp="failed_to_build_headers",Mp="failed_to_parse_headers",xp="For more visit: aka.ms/msaljs/browser-errors",Np={[Hf]:"The PKCE code challenge and verifier could not be generated.",[Lf]:"The crypto object or function is not available.",[Bf]:"Navigation URI is empty. Please check stack trace for more info.",[Uf]:"Hash value cannot be processed because it is empty. Please verify that your redirectUri is not clearing the hash. ".concat(xp),[zf]:"Hash does not contain state. Please verify that the request originated from msal.",[Kf]:"Hash does not contain known properites. Please verify that your redirectUri is not changing the hash.  ".concat(xp),[Ff]:"Unable to parse state. Please verify that the request originated from msal.",[Vf]:"Hash contains state but the interaction type does not match the caller.",[Yf]:"Interaction is currently in progress. Please ensure that this interaction has been completed before calling an interactive API.   ".concat(xp),[Gf]:"Error opening popup window. This can happen if you are using IE or if popups are blocked in the browser.",[Wf]:"window.open returned null or undefined window object.",[Zf]:"User cancelled the flow.",[Qf]:"Token acquisition in popup failed due to timeout.  ".concat(xp),[Xf]:"Token acquisition in iframe failed due to timeout.  ".concat(xp),[Jf]:"Redirects are not supported for iframed or brokered applications. Please ensure you are using MSAL.js in a top frame of the window if using the redirect APIs, or use the popup APIs.",[$f]:"Request was blocked inside an iframe because MSAL detected an authentication response.  ".concat(xp),[ep]:"Request was blocked inside a popup because MSAL detected it was running in a popup.",[tp]:"The iframe being monitored was closed prematurely.",[np]:"Silent logout not supported. Please call logoutRedirect or logoutPopup instead.",[rp]:"No account object provided to acquireTokenSilent and no active account has been set. Please call setActiveAccount or provide an account on the request.",[op]:"The value given for the prompt value is not valid for silent requests - must be set to 'none' or 'no_session'.",[ip]:"No token request found in cache.",[ap]:"The cached token request could not be parsed.",[cp]:"No cached authority found.",[sp]:"Auth Request not set. Please ensure initiateAuthRequest was called from the InteractionHandler",[lp]:"Invalid cache type",[up]:"Login and token requests are not supported in non-browser environments.",[dp]:"Database is not open!",[hp]:"No network connectivity. Check your internet connection.",[gp]:"Network request failed: If the browser threw a CORS error, check that the redirectUri is registered in the Azure App Portal as type 'SPA'",[fp]:"Network request failed. Please check the network trace to determine root cause.",[pp]:"Failed to parse network response. Check network trace.",[vp]:"Error loading token to cache.",[mp]:"Cryptographic Key or Keypair not found in browser storage.",[yp]:"An authorization code must be provided (as the `code` property on the request) to this flow.",[wp]:"An authorization code or nativeAccountId must be provided to this flow.",[bp]:"Request cannot contain both spa code and native account id.",[Cp]:"IndexedDB, which is required for persistent cryptographic key storage, is unavailable. This may be caused by browser privacy features which block persistent storage in third-party contexts.",[kp]:"Unable to acquire token from native platform.  ".concat(xp),[Sp]:"Timed out while attempting to establish connection to browser extension",[Ip]:"Native extension is not installed. If you think this is a mistake call the initialize function.",[Ep]:"Connection to native platform has not been established. Please install a compatible browser extension and run initialize().  ".concat(xp),[_p]:"You must call and await the initialize function before attempting to call any other MSAL API.  ".concat(xp),[Tp]:"The provided prompt is not supported by the native platform. This request should be routed to the web based flow.",[Op]:"Invalid base64 encoded string.",[Ap]:"Invalid PoP token request. The request should not have both a popKid value and signPopToken set to true.",[Pp]:"Failed to build request headers object.",[Mp]:"Failed to parse response headers"};class Rp extends Wl{constructor(e,t){super(e,Np[e],t),Object.setPrototypeOf(this,Rp.prototype),this.name="BrowserAuthError"}}function jp(e,t){return new Rp(e,t)}function Dp(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function qp(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){Dp(i,r,o,a,c,"next",e)}function c(e){Dp(i,r,o,a,c,"throw",e)}a(void 0)})}}class Hp{sendGetRequestAsync(e,t){return qp(function*(){var n,r,o=0,i=Lp(t);try{n=yield fetch(e,{method:"GET",headers:i})}catch(e){throw jp(window.navigator.onLine?fp:hp)}r=Bp(n.headers);try{return o=n.status,{headers:r,body:yield n.json(),status:o}}catch(e){throw qf(jp(pp),o,r)}})()}sendPostRequestAsync(e,t){return qp(function*(){var n,r,o=t&&t.body||"",i=Lp(t),a=0;try{n=yield fetch(e,{method:"POST",headers:i,body:o})}catch(e){throw jp(window.navigator.onLine?gp:hp)}r=Bp(n.headers);try{return a=n.status,{headers:r,body:yield n.json(),status:a}}catch(e){throw qf(jp(pp),a,r)}})()}}function Lp(e){try{var t=new Headers;if(!e||!e.headers)return t;var n=e.headers;return Object.entries(n).forEach(e=>{var[n,r]=e;t.append(n,r)}),t}catch(e){throw jp(Pp)}}function Bp(e){try{var t={};return e.forEach((e,n)=>{t[n]=e}),t}catch(e){throw jp(Mp)}}function Up(e){return encodeURIComponent(Kp(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"))}function zp(e){return Fp(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Kp(e){return Fp((new TextEncoder).encode(e))}function Fp(e){var t=Array.from(e,e=>String.fromCodePoint(e)).join("");return btoa(t)}function Vp(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function Yp(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){Vp(i,r,o,a,c,"next",e)}function c(e){Vp(i,r,o,a,c,"throw",e)}a(void 0)})}}var Gp="SHA-256",Wp=new Uint8Array([1,0,1]),Zp="0123456789abcdef",Qp=new Uint32Array(1),Xp={name:"RSASSA-PKCS1-v1_5",hash:Gp,modulusLength:2048,publicExponent:Wp};function Jp(e,t,n){return $p.apply(this,arguments)}function $p(){return($p=Yp(function*(e,t,n){null==t||t.addQueueMeasurement($g,n);var r=(new TextEncoder).encode(e);return window.crypto.subtle.digest(Gp,r)})).apply(this,arguments)}function ev(e){return window.crypto.getRandomValues(e)}function tv(){return window.crypto.getRandomValues(Qp),Qp[0]}function nv(){var e=Date.now(),t=1024*tv()+(1023&tv()),n=new Uint8Array(16),r=Math.trunc(t/2**30),o=t&2**30-1,i=tv();n[0]=e/2**40,n[1]=e/2**32,n[2]=e/2**24,n[3]=e/65536,n[4]=e/256,n[5]=e,n[6]=112|r>>>8,n[7]=r,n[8]=128|o>>>24,n[9]=o>>>16,n[10]=o>>>8,n[11]=o,n[12]=i>>>24,n[13]=i>>>16,n[14]=i>>>8,n[15]=i;for(var a="",c=0;c<n.length;c++)a+=Zp.charAt(n[c]>>>4),a+=Zp.charAt(15&n[c]),3!==c&&5!==c&&7!==c&&9!==c||(a+="-");return a}function rv(){return(rv=Yp(function*(e,t){return window.crypto.subtle.generateKey(Xp,e,t)})).apply(this,arguments)}function ov(e){return iv.apply(this,arguments)}function iv(){return(iv=Yp(function*(e){return window.crypto.subtle.exportKey("jwk",e)})).apply(this,arguments)}function av(){return(av=Yp(function*(e,t,n){return window.crypto.subtle.importKey("jwk",e,Xp,t,n)})).apply(this,arguments)}function cv(){return(cv=Yp(function*(e,t){return window.crypto.subtle.sign(Xp,e,t)})).apply(this,arguments)}function sv(e){return lv.apply(this,arguments)}function lv(){return(lv=Yp(function*(e){var t=yield Jp(e);return zp(new Uint8Array(t))})).apply(this,arguments)}var uv="storage_not_supported",dv="stubbed_public_client_application_called",hv="in_mem_redirect_unavailable",gv={[uv]:"Given storage configuration option was not supported.",[dv]:"Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors",[hv]:"Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true."};class fv extends Wl{constructor(e,t){super(e,t),this.name="BrowserConfigurationAuthError",Object.setPrototypeOf(this,fv.prototype)}}function pv(e){return new fv(e,gv[e])}function vv(){return window.parent!==window}function mv(){return"undefined"!=typeof window&&window.location?window.location.href.split("?")[0].split("#")[0]:""}function yv(){if("undefined"==typeof window)throw jp(up)}function wv(e){if(!e)throw jp(_p)}function bv(e){yv(),function(){if(rh.hashContainsKnownProperties(window.location.hash)&&vv())throw jp($f)}(),function(){if("undefined"!=typeof window&&window.opener&&window.opener!==window&&"string"==typeof window.name&&0===window.name.indexOf("".concat(cf,".")))throw jp(ep)}(),wv(e)}function Cv(e,t){if(bv(e),function(e){if(vv()&&!e)throw jp(Jf)}(t.system.allowRedirectInIframe),t.cache.cacheLocation===pf&&!t.cache.storeAuthStateInCookie)throw pv(hv)}function kv(e){var t=document.createElement("link");t.rel="preconnect",t.href=new URL(e).origin,t.crossOrigin="anonymous",document.head.appendChild(t),window.setTimeout(()=>{try{document.head.removeChild(t)}catch(e){}},1e4)}function Sv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Iv(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Sv(Object(n),!0).forEach(function(t){Ev(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Sv(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Ev(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var _v=1e4,Tv="3.30.0";function Ov(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Av(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Pv{static loggerCallback(e,t){switch(e){case Xs.Error:return void console.error(t);case Xs.Info:return void console.info(t);case Xs.Verbose:return void console.debug(t);case Xs.Warning:return void console.warn(t);default:return void console.log(t)}}constructor(e){var t,n,r;this.browserEnvironment="undefined"!=typeof window,this.config=function(e,t){var{auth:n,cache:r,system:o,telemetry:i}=e,a={clientId:Js.EMPTY_STRING,authority:"".concat(Js.DEFAULT_AUTHORITY),knownAuthorities:[],cloudDiscoveryMetadata:Js.EMPTY_STRING,authorityMetadata:Js.EMPTY_STRING,redirectUri:"undefined"!=typeof window?mv():"",postLogoutRedirectUri:Js.EMPTY_STRING,navigateToLoginRequestUrl:!0,clientCapabilities:[],protocolMode:zl,OIDCOptions:{serverResponseType:wl.FRAGMENT,defaultScopes:[Js.OPENID_SCOPE,Js.PROFILE_SCOPE,Js.OFFLINE_ACCESS_SCOPE]},azureCloudOptions:{azureCloudInstance:Fl,tenant:Js.EMPTY_STRING},skipAuthorityMetadataCache:!1,supportsNestedAppAuth:!1,instanceAware:!1},c={cacheLocation:ff,temporaryCacheLocation:ff,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!(!r||r.cacheLocation!==gf),claimsBasedCachingEnabled:!1},s={loggerCallback:()=>{},logLevel:Xs.Info,piiLoggingEnabled:!1},l=Iv(Iv({},_h),{},{loggerOptions:s,networkClient:t?new Hp:jh,navigationClient:new jf,loadFrameTimeout:0,windowHashTimeout:(null==o?void 0:o.loadFrameTimeout)||6e4,iframeHashTimeout:(null==o?void 0:o.loadFrameTimeout)||_v,navigateFrameWait:0,redirectNavigationTimeout:3e4,asyncPopups:!1,allowRedirectInIframe:!1,allowNativeBroker:!1,nativeBrokerHandshakeTimeout:(null==o?void 0:o.nativeBrokerHandshakeTimeout)||2e3,pollIntervalMilliseconds:30}),u=Iv(Iv(Iv({},l),o),{},{loggerOptions:(null==o?void 0:o.loggerOptions)||s}),d={application:{appName:Js.EMPTY_STRING,appVersion:Js.EMPTY_STRING},client:new rf};if((null==n?void 0:n.protocolMode)!==Kl&&null!=n&&n.OIDCOptions&&new Rl(u.loggerOptions).warning(JSON.stringify(Ld(Rd))),null!=n&&n.protocolMode&&n.protocolMode!==zl&&null!=u&&u.allowNativeBroker)throw Ld(jd);return{auth:Iv(Iv(Iv({},a),n),{},{OIDCOptions:Iv(Iv({},a.OIDCOptions),null==n?void 0:n.OIDCOptions)}),cache:Iv(Iv({},c),r),system:u,telemetry:Iv(Iv({},d),i)}}(e,this.browserEnvironment);try{r=window[ff]}catch(e){}var o=null===(t=r)||void 0===t?void 0:t.getItem("msal.browser.log.level"),i=null===(n=r)||void 0===n||null===(n=n.getItem("msal.browser.log.pii"))||void 0===n?void 0:n.toLowerCase(),a="true"===i||"false"!==i&&void 0,c=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ov(Object(n),!0).forEach(function(t){Av(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ov(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},this.config.system.loggerOptions),s=o&&Object.keys(Xs).includes(o)?Xs[o]:void 0;s&&(c.loggerCallback=Pv.loggerCallback,c.logLevel=s),void 0!==a&&(c.piiLoggingEnabled=a),this.logger=new Rl(c,"@azure/msal-browser",Tv),this.available=!1}getConfig(){return this.config}getLogger(){return this.logger}isAvailable(){return this.available}isBrowserEnvironment(){return this.browserEnvironment}}function Mv(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}class xv extends Pv{getModuleName(){return xv.MODULE_NAME}getId(){return xv.ID}initialize(){var e,t=this;return(e=function*(){return t.available="undefined"!=typeof window,t.available},function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){Mv(i,r,o,a,c,"next",e)}function c(e){Mv(i,r,o,a,c,"throw",e)}a(void 0)})})()}}xv.MODULE_NAME="",xv.ID="StandardOperatingContext";var Nv="missing_kid_error",Rv="missing_alg_error",jv={[Nv]:"The JOSE Header for the requested JWT, JWS or JWK object requires a keyId to be configured as the 'kid' header claim. No 'kid' value was provided.",[Rv]:"The JOSE Header for the requested JWT, JWS or JWK object requires an algorithm to be specified as the 'alg' header claim. No 'alg' value was provided."};class Dv extends Wl{constructor(e,t){super(e,t),this.name="JoseHeaderError",Object.setPrototypeOf(this,Dv.prototype)}}function qv(e){return new Dv(e,jv[e])}class Hv{constructor(e){this.typ=e.typ,this.alg=e.alg,this.kid=e.kid}static getShrHeaderString(e){if(!e.kid)throw qv(Nv);if(!e.alg)throw qv(Rv);var t=new Hv({typ:e.typ||"pop",kid:e.kid,alg:e.alg});return JSON.stringify(t)}}function Lv(e){return(new TextDecoder).decode(function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw jp(Op)}var n=atob(t);return Uint8Array.from(n,e=>e.codePointAt(0)||0)}(e))}function Bv(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function Uv(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){Bv(i,r,o,a,c,"next",e)}function c(e){Bv(i,r,o,a,c,"throw",e)}a(void 0)})}}class zv{constructor(){this.dbName=xf,this.version=1,this.tableName=Nf,this.dbOpen=!1}open(){var e=this;return Uv(function*(){return new Promise((t,n)=>{var r=window.indexedDB.open(e.dbName,e.version);r.addEventListener("upgradeneeded",t=>{t.target.result.createObjectStore(e.tableName)}),r.addEventListener("success",n=>{var r=n;e.db=r.target.result,e.dbOpen=!0,t()}),r.addEventListener("error",()=>n(jp(Cp)))})})()}closeConnection(){var e=this.db;e&&this.dbOpen&&(e.close(),this.dbOpen=!1)}validateDbIsOpen(){var e=this;return Uv(function*(){if(!e.dbOpen)return e.open()})()}getItem(e){var t=this;return Uv(function*(){return yield t.validateDbIsOpen(),new Promise((n,r)=>{if(!t.db)return r(jp(dp));var o=t.db.transaction([t.tableName],"readonly").objectStore(t.tableName).get(e);o.addEventListener("success",e=>{var r=e;t.closeConnection(),n(r.target.result)}),o.addEventListener("error",e=>{t.closeConnection(),r(e)})})})()}setItem(e,t){var n=this;return Uv(function*(){return yield n.validateDbIsOpen(),new Promise((r,o)=>{if(!n.db)return o(jp(dp));var i=n.db.transaction([n.tableName],"readwrite").objectStore(n.tableName).put(t,e);i.addEventListener("success",()=>{n.closeConnection(),r()}),i.addEventListener("error",e=>{n.closeConnection(),o(e)})})})()}removeItem(e){var t=this;return Uv(function*(){return yield t.validateDbIsOpen(),new Promise((n,r)=>{if(!t.db)return r(jp(dp));var o=t.db.transaction([t.tableName],"readwrite").objectStore(t.tableName).delete(e);o.addEventListener("success",()=>{t.closeConnection(),n()}),o.addEventListener("error",e=>{t.closeConnection(),r(e)})})})()}getKeys(){var e=this;return Uv(function*(){return yield e.validateDbIsOpen(),new Promise((t,n)=>{if(!e.db)return n(jp(dp));var r=e.db.transaction([e.tableName],"readonly").objectStore(e.tableName).getAllKeys();r.addEventListener("success",n=>{var r=n;e.closeConnection(),t(r.target.result)}),r.addEventListener("error",t=>{e.closeConnection(),n(t)})})})()}containsKey(e){var t=this;return Uv(function*(){return yield t.validateDbIsOpen(),new Promise((n,r)=>{if(!t.db)return r(jp(dp));var o=t.db.transaction([t.tableName],"readonly").objectStore(t.tableName).count(e);o.addEventListener("success",e=>{var r=e;t.closeConnection(),n(1===r.target.result)}),o.addEventListener("error",e=>{t.closeConnection(),r(e)})})})()}deleteDatabase(){var e=this;return Uv(function*(){return e.db&&e.dbOpen&&e.closeConnection(),new Promise((e,t)=>{var n=window.indexedDB.deleteDatabase(xf),r=setTimeout(()=>t(!1),200);n.addEventListener("success",()=>(clearTimeout(r),e(!0))),n.addEventListener("blocked",()=>(clearTimeout(r),e(!0))),n.addEventListener("error",()=>(clearTimeout(r),t(!1)))})})()}}class Kv{constructor(){this.cache=new Map}getItem(e){return this.cache.get(e)||null}setItem(e,t){this.cache.set(e,t)}removeItem(e){this.cache.delete(e)}getKeys(){var e=[];return this.cache.forEach((t,n)=>{e.push(n)}),e}containsKey(e){return this.cache.has(e)}clear(){this.cache.clear()}}function Fv(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function Vv(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){Fv(i,r,o,a,c,"next",e)}function c(e){Fv(i,r,o,a,c,"throw",e)}a(void 0)})}}class Yv{constructor(e){this.inMemoryCache=new Kv,this.indexedDBCache=new zv,this.logger=e}handleDatabaseAccessError(e){if(!(e instanceof Rp&&e.errorCode===Cp))throw e;this.logger.error("Could not access persistent storage. This may be caused by browser privacy features which block persistent storage in third-party contexts.")}getItem(e){var t=this;return Vv(function*(){var n=t.inMemoryCache.getItem(e);if(!n)try{return t.logger.verbose("Queried item not found in in-memory cache, now querying persistent storage."),yield t.indexedDBCache.getItem(e)}catch(e){t.handleDatabaseAccessError(e)}return n})()}setItem(e,t){var n=this;return Vv(function*(){n.inMemoryCache.setItem(e,t);try{yield n.indexedDBCache.setItem(e,t)}catch(e){n.handleDatabaseAccessError(e)}})()}removeItem(e){var t=this;return Vv(function*(){t.inMemoryCache.removeItem(e);try{yield t.indexedDBCache.removeItem(e)}catch(e){t.handleDatabaseAccessError(e)}})()}getKeys(){var e=this;return Vv(function*(){var t=e.inMemoryCache.getKeys();if(0===t.length)try{return e.logger.verbose("In-memory cache is empty, now querying persistent storage."),yield e.indexedDBCache.getKeys()}catch(t){e.handleDatabaseAccessError(t)}return t})()}containsKey(e){var t=this;return Vv(function*(){var n=t.inMemoryCache.containsKey(e);if(!n)try{return t.logger.verbose("Key not found in in-memory cache, now querying persistent storage."),yield t.indexedDBCache.containsKey(e)}catch(e){t.handleDatabaseAccessError(e)}return n})()}clearInMemory(){this.logger.verbose("Deleting in-memory keystore"),this.inMemoryCache.clear(),this.logger.verbose("In-memory keystore deleted")}clearPersistent(){var e=this;return Vv(function*(){try{e.logger.verbose("Deleting persistent keystore");var t=yield e.indexedDBCache.deleteDatabase();return t&&e.logger.verbose("Persistent keystore deleted"),t}catch(t){return e.handleDatabaseAccessError(t),!1}})()}}function Gv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Wv(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Gv(Object(n),!0).forEach(function(t){Zv(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Gv(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Zv(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Qv(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function Xv(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){Qv(i,r,o,a,c,"next",e)}function c(e){Qv(i,r,o,a,c,"throw",e)}a(void 0)})}}class Jv{constructor(e,t,n){this.logger=e,function(e){if(!window)throw jp(up);if(!window.crypto)throw jp(Lf);if(!e&&!window.crypto.subtle)throw jp(Lf,"crypto_subtle_undefined")}(null!=n&&n),this.cache=new Yv(this.logger),this.performanceClient=t}createNewGuid(){return nv()}base64Encode(e){return Kp(e)}base64Decode(e){return Lv(e)}base64UrlEncode(e){return Up(e)}encodeKid(e){return this.base64UrlEncode(JSON.stringify({kid:e}))}getPublicKeyThumbprint(e){var t=this;return Xv(function*(){var n,r=null===(n=t.performanceClient)||void 0===n?void 0:n.startMeasurement(zh,e.correlationId),o=yield function(e,t){return rv.apply(this,arguments)}(Jv.EXTRACTABLE,Jv.POP_KEY_USAGES),i=yield ov(o.publicKey),a=$v({e:i.e,kty:i.kty,n:i.n}),c=yield t.hashString(a),s=yield ov(o.privateKey),l=yield function(e,t,n){return av.apply(this,arguments)}(s,!1,["sign"]);return yield t.cache.setItem(c,{privateKey:l,publicKey:o.publicKey,requestMethod:e.resourceRequestMethod,requestUri:e.resourceRequestUri}),r&&r.end({success:!0}),c})()}removeTokenBindingKey(e){var t=this;return Xv(function*(){return yield t.cache.removeItem(e),!(yield t.cache.containsKey(e))})()}clearKeystore(){var e=this;return Xv(function*(){e.cache.clearInMemory();try{return yield e.cache.clearPersistent(),!0}catch(t){return t instanceof Error?e.logger.error("Clearing keystore failed with error: ".concat(t.message)):e.logger.error("Clearing keystore failed with unknown error"),!1}})()}signJwt(e,t,n,r){var o=this;return Xv(function*(){var i,a=null===(i=o.performanceClient)||void 0===i?void 0:i.startMeasurement(Kh,r),c=yield o.cache.getItem(t);if(!c)throw jp(mp);var s=yield ov(c.publicKey),l=$v(s),u=Up(JSON.stringify({kid:t})),d=Up(Hv.getShrHeaderString(Wv(Wv({},null==n?void 0:n.header),{},{alg:s.alg,kid:u})));e.cnf={jwk:JSON.parse(l)};var h=Up(JSON.stringify(e)),g="".concat(d,".").concat(h),f=(new TextEncoder).encode(g),p=yield function(e,t){return cv.apply(this,arguments)}(c.privateKey,f),v=zp(new Uint8Array(p)),m="".concat(g,".").concat(v);return a&&a.end({success:!0}),m})()}hashString(e){return Xv(function*(){return sv(e)})()}}function $v(e){return JSON.stringify(e,Object.keys(e).sort())}Jv.POP_KEY_USAGES=["sign","verify"],Jv.EXTRACTABLE=!0;var em=(e,t,n,r,o)=>function(){n.trace("Executing function ".concat(t));var i=null==r?void 0:r.startMeasurement(t,o);if(o){var a=t+"CallCount";null==r||r.incrementFields({[a]:1},o)}try{var c=e(...arguments);return null==i||i.end({success:!0}),n.trace("Returning result from ".concat(t)),c}catch(e){n.trace("Error occurred in ".concat(t));try{n.trace(JSON.stringify(e))}catch(e){n.trace("Unable to print error message.")}throw null==i||i.end({success:!1},e),e}},tm=(e,t,n,r,o)=>function(){n.trace("Executing function ".concat(t));var i=null==r?void 0:r.startMeasurement(t,o);if(o){var a=t+"CallCount";null==r||r.incrementFields({[a]:1},o)}return null==r||r.setPreQueueTime(t,o),e(...arguments).then(e=>(n.trace("Returning result from ".concat(t)),null==i||i.end({success:!0}),e)).catch(e=>{n.trace("Error occurred in ".concat(t));try{n.trace(JSON.stringify(e))}catch(e){n.trace("Unable to print error message.")}throw null==i||i.end({success:!1},e),e})};function nm(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function rm(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){nm(i,r,o,a,c,"next",e)}function c(e){nm(i,r,o,a,c,"throw",e)}a(void 0)})}}class om{constructor(e,t,n,r){this.networkInterface=e,this.logger=t,this.performanceClient=n,this.correlationId=r}detectRegion(e,t){var n=this;return rm(function*(){var r;null===(r=n.performanceClient)||void 0===r||r.addQueueMeasurement(Bg,n.correlationId);var o=e;if(o)t.region_source="3";else{var i=om.IMDS_OPTIONS;try{var a=yield tm(n.getRegionFromIMDS.bind(n),Ug,n.logger,n.performanceClient,n.correlationId)(Js.IMDS_VERSION,i);if(200===a.status&&(o=a.body,t.region_source="4"),400===a.status){var c=yield tm(n.getCurrentVersion.bind(n),zg,n.logger,n.performanceClient,n.correlationId)(i);if(!c)return t.region_source="1",null;var s=yield tm(n.getRegionFromIMDS.bind(n),Ug,n.logger,n.performanceClient,n.correlationId)(c,i);200===s.status&&(o=s.body,t.region_source="4")}}catch(e){return t.region_source="1",null}}return o||(t.region_source="1"),o||null})()}getRegionFromIMDS(e,t){var n=this;return rm(function*(){var r;return null===(r=n.performanceClient)||void 0===r||r.addQueueMeasurement(Ug,n.correlationId),n.networkInterface.sendGetRequestAsync("".concat(Js.IMDS_ENDPOINT,"?api-version=").concat(e,"&format=text"),t,Js.IMDS_TIMEOUT)})()}getCurrentVersion(e){var t=this;return rm(function*(){var n;null===(n=t.performanceClient)||void 0===n||n.addQueueMeasurement(zg,t.correlationId);try{var r=yield t.networkInterface.sendGetRequestAsync("".concat(Js.IMDS_ENDPOINT,"?format=json"),e);return 400===r.status&&r.body&&r.body["newest-versions"]&&r.body["newest-versions"].length>0?r.body["newest-versions"][0]:null}catch(e){return null}})()}}function im(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function am(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?im(Object(n),!0).forEach(function(t){cm(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):im(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function cm(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function sm(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function lm(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){sm(i,r,o,a,c,"next",e)}function c(e){sm(i,r,o,a,c,"throw",e)}a(void 0)})}}om.IMDS_OPTIONS={headers:{Metadata:"true"}};class um{constructor(e,t,n,r,o,i,a,c){this.canonicalAuthority=e,this._canonicalAuthority.validateAsUri(),this.networkInterface=t,this.cacheManager=n,this.authorityOptions=r,this.regionDiscoveryMetadata={region_used:void 0,region_source:void 0,region_outcome:void 0},this.logger=o,this.performanceClient=a,this.correlationId=i,this.managedIdentity=c||!1,this.regionDiscovery=new om(t,this.logger,this.performanceClient,this.correlationId)}getAuthorityType(e){if(e.HostNameAndPort.endsWith(Js.CIAM_AUTH_URL))return 3;var t=e.PathSegments;if(t.length)switch(t[0].toLowerCase()){case Js.ADFS:return 1;case Js.DSTS:return 2}return 0}get authorityType(){return this.getAuthorityType(this.canonicalAuthorityUrlComponents)}get protocolMode(){return this.authorityOptions.protocolMode}get options(){return this.authorityOptions}get canonicalAuthority(){return this._canonicalAuthority.urlString}set canonicalAuthority(e){this._canonicalAuthority=new rh(e),this._canonicalAuthority.validateAsUri(),this._canonicalAuthorityUrlComponents=null}get canonicalAuthorityUrlComponents(){return this._canonicalAuthorityUrlComponents||(this._canonicalAuthorityUrlComponents=this._canonicalAuthority.getUrlComponents()),this._canonicalAuthorityUrlComponents}get hostnameAndPort(){return this.canonicalAuthorityUrlComponents.HostNameAndPort.toLowerCase()}get tenant(){return this.canonicalAuthorityUrlComponents.PathSegments[0]}get authorizationEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.authorization_endpoint);throw zu(eu)}get tokenEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint);throw zu(eu)}get deviceCodeEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint.replace("/token","/devicecode"));throw zu(eu)}get endSessionEndpoint(){if(this.discoveryComplete()){if(!this.metadata.end_session_endpoint)throw zu(Nu);return this.replacePath(this.metadata.end_session_endpoint)}throw zu(eu)}get selfSignedJwtAudience(){if(this.discoveryComplete())return this.replacePath(this.metadata.issuer);throw zu(eu)}get jwksUri(){if(this.discoveryComplete())return this.replacePath(this.metadata.jwks_uri);throw zu(eu)}canReplaceTenant(e){return 1===e.PathSegments.length&&!um.reservedTenantDomains.has(e.PathSegments[0])&&0===this.getAuthorityType(e)&&this.protocolMode===zl}replaceTenant(e){return e.replace(/{tenant}|{tenantid}/g,this.tenant)}replacePath(e){var t=e,n=new rh(this.metadata.canonical_authority).getUrlComponents(),r=n.PathSegments;return this.canonicalAuthorityUrlComponents.PathSegments.forEach((e,o)=>{var i=r[o];if(0===o&&this.canReplaceTenant(n)){var a=new rh(this.metadata.authorization_endpoint).getUrlComponents().PathSegments[0];i!==a&&(this.logger.verbose("Replacing tenant domain name ".concat(i," with id ").concat(a)),i=a)}e!==i&&(t=t.replace("/".concat(i,"/"),"/".concat(e,"/")))}),this.replaceTenant(t)}get defaultOpenIdConfigurationEndpoint(){var e=this.hostnameAndPort;return this.canonicalAuthority.endsWith("v2.0/")||1===this.authorityType||this.protocolMode!==zl&&!this.isAliasOfKnownMicrosoftAuthority(e)?"".concat(this.canonicalAuthority,".well-known/openid-configuration"):"".concat(this.canonicalAuthority,"v2.0/.well-known/openid-configuration")}discoveryComplete(){return!!this.metadata}resolveEndpointsAsync(){var e=this;return lm(function*(){var t,n;null===(t=e.performanceClient)||void 0===t||t.addQueueMeasurement(Rg,e.correlationId);var r=e.getCurrentMetadataEntity(),o=yield tm(e.updateCloudDiscoveryMetadata.bind(e),Dg,e.logger,e.performanceClient,e.correlationId)(r);e.canonicalAuthority=e.canonicalAuthority.replace(e.hostnameAndPort,r.preferred_network);var i=yield tm(e.updateEndpointMetadata.bind(e),Hg,e.logger,e.performanceClient,e.correlationId)(r);e.updateCachedMetadata(r,o,{source:i}),null===(n=e.performanceClient)||void 0===n||n.addFields({cloudDiscoverySource:o,authorityEndpointSource:i},e.correlationId)})()}getCurrentMetadataEntity(){var e=this.cacheManager.getAuthorityMetadataByAlias(this.hostnameAndPort);return e||(e={aliases:[],preferred_cache:this.hostnameAndPort,preferred_network:this.hostnameAndPort,canonical_authority:this.canonicalAuthority,authorization_endpoint:"",token_endpoint:"",end_session_endpoint:"",issuer:"",aliasesFromNetwork:!1,endpointsFromNetwork:!1,expiresAt:dd(),jwks_uri:""}),e}updateCachedMetadata(e,t,n){t!==Ol&&(null==n?void 0:n.source)!==Ol&&(e.expiresAt=dd(),e.canonical_authority=this.canonicalAuthority);var r=this.cacheManager.generateAuthorityMetadataCacheKey(e.preferred_cache);this.cacheManager.setAuthorityMetadata(r,e),this.metadata=e}updateEndpointMetadata(e){var t=this;return lm(function*(){var n;null===(n=t.performanceClient)||void 0===n||n.addQueueMeasurement(Hg,t.correlationId);var r=t.updateEndpointMetadataFromLocalSources(e);if(r){var o;if(r.source===Pl&&null!==(o=t.authorityOptions.azureRegionConfiguration)&&void 0!==o&&o.azureRegion&&r.metadata){var i=yield tm(t.updateMetadataWithRegionalInformation.bind(t),Lg,t.logger,t.performanceClient,t.correlationId)(r.metadata);hd(e,i,!1),e.canonical_authority=t.canonicalAuthority}return r.source}var a,c=yield tm(t.getEndpointMetadataFromNetwork.bind(t),qg,t.logger,t.performanceClient,t.correlationId)();if(c)return null!==(a=t.authorityOptions.azureRegionConfiguration)&&void 0!==a&&a.azureRegion&&(c=yield tm(t.updateMetadataWithRegionalInformation.bind(t),Lg,t.logger,t.performanceClient,t.correlationId)(c)),hd(e,c,!0),Al;throw zu(nu,t.defaultOpenIdConfigurationEndpoint)})()}updateEndpointMetadataFromLocalSources(e){this.logger.verbose("Attempting to get endpoint metadata from authority configuration");var t=this.getEndpointMetadataFromConfig();if(t)return this.logger.verbose("Found endpoint metadata in authority configuration"),hd(e,t,!1),{source:Tl};if(this.logger.verbose("Did not find endpoint metadata in the config... Attempting to get endpoint metadata from the hardcoded values."),this.authorityOptions.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get endpoint metadata from the network metadata cache.");else{var n=this.getEndpointMetadataFromHardcodedValues();if(n)return hd(e,n,!1),{source:Pl,metadata:n};this.logger.verbose("Did not find endpoint metadata in hardcoded values... Attempting to get endpoint metadata from the network metadata cache.")}var r=fd(e);return this.isAuthoritySameType(e)&&e.endpointsFromNetwork&&!r?(this.logger.verbose("Found endpoint metadata in the cache."),{source:Ol}):(r&&this.logger.verbose("The metadata entity is expired."),null)}isAuthoritySameType(e){return new rh(e.canonical_authority).getUrlComponents().PathSegments.length===this.canonicalAuthorityUrlComponents.PathSegments.length}getEndpointMetadataFromConfig(){if(this.authorityOptions.authorityMetadata)try{return JSON.parse(this.authorityOptions.authorityMetadata)}catch(e){throw Ld(Od)}return null}getEndpointMetadataFromNetwork(){var e=this;return lm(function*(){var t;null===(t=e.performanceClient)||void 0===t||t.addQueueMeasurement(qg,e.correlationId);var n=e.defaultOpenIdConfigurationEndpoint;e.logger.verbose("Authority.getEndpointMetadataFromNetwork: attempting to retrieve OAuth endpoints from ".concat(n));try{var r=yield e.networkInterface.sendGetRequestAsync(n,{}),o=function(e){return e.hasOwnProperty("authorization_endpoint")&&e.hasOwnProperty("token_endpoint")&&e.hasOwnProperty("issuer")&&e.hasOwnProperty("jwks_uri")}(r.body);return o?r.body:(e.logger.verbose("Authority.getEndpointMetadataFromNetwork: could not parse response as OpenID configuration"),null)}catch(t){return e.logger.verbose("Authority.getEndpointMetadataFromNetwork: ".concat(t)),null}})()}getEndpointMetadataFromHardcodedValues(){return this.hostnameAndPort in oh?oh[this.hostnameAndPort]:null}updateMetadataWithRegionalInformation(e){var t=this;return lm(function*(){var n,r;null===(n=t.performanceClient)||void 0===n||n.addQueueMeasurement(Lg,t.correlationId);var o=null===(r=t.authorityOptions.azureRegionConfiguration)||void 0===r?void 0:r.azureRegion;if(o){var i;if(o!==Js.AZURE_REGION_AUTO_DISCOVER_FLAG)return t.regionDiscoveryMetadata.region_outcome="2",t.regionDiscoveryMetadata.region_used=o,um.replaceWithRegionalInformation(e,o);var a=yield tm(t.regionDiscovery.detectRegion.bind(t.regionDiscovery),Bg,t.logger,t.performanceClient,t.correlationId)(null===(i=t.authorityOptions.azureRegionConfiguration)||void 0===i?void 0:i.environmentRegion,t.regionDiscoveryMetadata);if(a)return t.regionDiscoveryMetadata.region_outcome="4",t.regionDiscoveryMetadata.region_used=a,um.replaceWithRegionalInformation(e,a);t.regionDiscoveryMetadata.region_outcome="5"}return e})()}updateCloudDiscoveryMetadata(e){var t=this;return lm(function*(){var n;null===(n=t.performanceClient)||void 0===n||n.addQueueMeasurement(Dg,t.correlationId);var r=t.updateCloudDiscoveryMetadataFromLocalSources(e);if(r)return r;var o=yield tm(t.getCloudDiscoveryMetadataFromNetwork.bind(t),jg,t.logger,t.performanceClient,t.correlationId)();if(o)return gd(e,o,!0),Al;throw Ld(Ad)})()}updateCloudDiscoveryMetadataFromLocalSources(e){this.logger.verbose("Attempting to get cloud discovery metadata  from authority configuration"),this.logger.verbosePii("Known Authorities: ".concat(this.authorityOptions.knownAuthorities||Js.NOT_APPLICABLE)),this.logger.verbosePii("Authority Metadata: ".concat(this.authorityOptions.authorityMetadata||Js.NOT_APPLICABLE)),this.logger.verbosePii("Canonical Authority: ".concat(e.canonical_authority||Js.NOT_APPLICABLE));var t,n=this.getCloudDiscoveryMetadataFromConfig();if(n)return this.logger.verbose("Found cloud discovery metadata in authority configuration"),gd(e,n,!1),Tl;if(this.logger.verbose("Did not find cloud discovery metadata in the config... Attempting to get cloud discovery metadata from the hardcoded values."),this.options.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded cloud discovery metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get cloud discovery metadata from the network metadata cache.");else{var r=(t=this.hostnameAndPort,sh(ih.metadata,t));if(r)return this.logger.verbose("Found cloud discovery metadata from hardcoded values."),gd(e,r,!1),Pl;this.logger.verbose("Did not find cloud discovery metadata in hardcoded values... Attempting to get cloud discovery metadata from the network metadata cache.")}var o=fd(e);return this.isAuthoritySameType(e)&&e.aliasesFromNetwork&&!o?(this.logger.verbose("Found cloud discovery metadata in the cache."),Ol):(o&&this.logger.verbose("The metadata entity is expired."),null)}getCloudDiscoveryMetadataFromConfig(){if(3===this.authorityType)return this.logger.verbose("CIAM authorities do not support cloud discovery metadata, generate the aliases from authority host."),um.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort);if(this.authorityOptions.cloudDiscoveryMetadata){this.logger.verbose("The cloud discovery metadata has been provided as a network response, in the config.");try{this.logger.verbose("Attempting to parse the cloud discovery metadata.");var e=sh(JSON.parse(this.authorityOptions.cloudDiscoveryMetadata).metadata,this.hostnameAndPort);if(this.logger.verbose("Parsed the cloud discovery metadata."),e)return this.logger.verbose("There is returnable metadata attached to the parsed cloud discovery metadata."),e;this.logger.verbose("There is no metadata attached to the parsed cloud discovery metadata.")}catch(e){throw this.logger.verbose("Unable to parse the cloud discovery metadata. Throwing Invalid Cloud Discovery Metadata Error."),Ld(Td)}}return this.isInKnownAuthorities()?(this.logger.verbose("The host is included in knownAuthorities. Creating new cloud discovery metadata from the host."),um.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)):null}getCloudDiscoveryMetadataFromNetwork(){var e=this;return lm(function*(){var t;null===(t=e.performanceClient)||void 0===t||t.addQueueMeasurement(jg,e.correlationId);var n="".concat(Js.AAD_INSTANCE_DISCOVERY_ENDPT).concat(e.canonicalAuthority,"oauth2/v2.0/authorize"),r=null;try{var o,i,a=yield e.networkInterface.sendGetRequestAsync(n,{});if(function(e){return e.hasOwnProperty("tenant_discovery_endpoint")&&e.hasOwnProperty("metadata")}(a.body))i=(o=a.body).metadata,e.logger.verbosePii("tenant_discovery_endpoint is: ".concat(o.tenant_discovery_endpoint));else{if(!function(e){return e.hasOwnProperty("error")&&e.hasOwnProperty("error_description")}(a.body))return e.logger.error("AAD did not return a CloudInstanceDiscoveryResponse or CloudInstanceDiscoveryErrorResponse"),null;if(e.logger.warning("A CloudInstanceDiscoveryErrorResponse was returned. The cloud instance discovery network request's status code is: ".concat(a.status)),(o=a.body).error===Js.INVALID_INSTANCE)return e.logger.error("The CloudInstanceDiscoveryErrorResponse error is invalid_instance."),null;e.logger.warning("The CloudInstanceDiscoveryErrorResponse error is ".concat(o.error)),e.logger.warning("The CloudInstanceDiscoveryErrorResponse error description is ".concat(o.error_description)),e.logger.warning("Setting the value of the CloudInstanceDiscoveryMetadata (returned from the network) to []"),i=[]}e.logger.verbose("Attempting to find a match between the developer's authority and the CloudInstanceDiscoveryMetadata returned from the network request."),r=sh(i,e.hostnameAndPort)}catch(t){if(t instanceof Wl)e.logger.error("There was a network error while attempting to get the cloud discovery instance metadata.\nError: ".concat(t.errorCode,"\nError Description: ").concat(t.errorMessage));else{var c=t;e.logger.error("A non-MSALJS error was thrown while attempting to get the cloud instance discovery metadata.\nError: ".concat(c.name,"\nError Description: ").concat(c.message))}return null}return r||(e.logger.warning("The developer's authority was not found within the CloudInstanceDiscoveryMetadata returned from the network request."),e.logger.verbose("Creating custom Authority for custom domain scenario."),r=um.createCloudDiscoveryMetadataFromHost(e.hostnameAndPort)),r})()}isInKnownAuthorities(){return this.authorityOptions.knownAuthorities.filter(e=>e&&rh.getDomainFromUrl(e).toLowerCase()===this.hostnameAndPort).length>0}static generateAuthority(e,t){var n;if(t&&t.azureCloudInstance!==Fl){var r=t.tenant?t.tenant:Js.DEFAULT_COMMON_TENANT;n="".concat(t.azureCloudInstance,"/").concat(r,"/")}return n||e}static createCloudDiscoveryMetadataFromHost(e){return{preferred_network:e,preferred_cache:e,aliases:[e]}}getPreferredCache(){if(this.managedIdentity)return Js.DEFAULT_AUTHORITY_HOST;if(this.discoveryComplete())return this.metadata.preferred_cache;throw zu(eu)}isAlias(e){return this.metadata.aliases.indexOf(e)>-1}isAliasOfKnownMicrosoftAuthority(e){return ah.has(e)}static isPublicCloudAuthority(e){return Js.KNOWN_PUBLIC_CLOUDS.indexOf(e)>=0}static buildRegionalAuthorityString(e,t,n){var r=new rh(e);r.validateAsUri();var o=r.getUrlComponents(),i="".concat(t,".").concat(o.HostNameAndPort);this.isPublicCloudAuthority(o.HostNameAndPort)&&(i="".concat(t,".").concat(Js.REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX));var a=rh.constructAuthorityUriFromObject(am(am({},r.getUrlComponents()),{},{HostNameAndPort:i})).urlString;return n?"".concat(a,"?").concat(n):a}static replaceWithRegionalInformation(e,t){var n=am({},e);return n.authorization_endpoint=um.buildRegionalAuthorityString(n.authorization_endpoint,t),n.token_endpoint=um.buildRegionalAuthorityString(n.token_endpoint,t),n.end_session_endpoint&&(n.end_session_endpoint=um.buildRegionalAuthorityString(n.end_session_endpoint,t)),n}static transformCIAMAuthority(e){var t=e,n=new rh(e).getUrlComponents();if(0===n.PathSegments.length&&n.HostNameAndPort.endsWith(Js.CIAM_AUTH_URL)){var r=n.HostNameAndPort.split(".")[0];t="".concat(t).concat(r).concat(Js.AAD_TENANT_DOMAIN_SUFFIX)}return t}}function dm(e){return e.endsWith(Js.FORWARD_SLASH)?e:"".concat(e).concat(Js.FORWARD_SLASH)}um.reservedTenantDomains=new Set(["{tenant}","{tenantid}",gl,pl,fl]);var hm="no_tokens_found",gm="native_account_unavailable",fm="refresh_token_expired",pm="bad_token",vm=["interaction_required","consent_required","login_required",pm],mm=["message_only","additional_action","basic_action","user_password_expired","consent_required","bad_token"],ym={[hm]:"No refresh token found in the cache. Please sign-in.",[gm]:"The requested account is not available in the native broker. It may have been deleted or logged out. Please sign-in again using an interactive API.",[fm]:"Refresh token has expired.",[pm]:"Identity provider returned bad_token due to an expired or invalid refresh token. Please invoke an interactive API to resolve."};class wm extends Wl{constructor(e,t,n,r,o,i,a,c){super(e,t,n),Object.setPrototypeOf(this,wm.prototype),this.timestamp=r||Js.EMPTY_STRING,this.traceId=o||Js.EMPTY_STRING,this.correlationId=i||Js.EMPTY_STRING,this.claims=a||Js.EMPTY_STRING,this.name="InteractionRequiredAuthError",this.errorNo=c}}function bm(e,t,n){var r=!!e&&vm.indexOf(e)>-1,o=!!n&&mm.indexOf(n)>-1,i=!!t&&vm.some(e=>t.indexOf(e)>-1);return r||i||o}function Cm(e){return new wm(e,ym[e])}class km{static setRequestState(e,t,n){var r=km.generateLibraryState(e,n);return t?"".concat(r).concat(Js.RESOURCE_DELIM).concat(t):r}static generateLibraryState(e,t){if(!e)throw zu(Iu);var n={id:e.createNewGuid()};t&&(n.meta=t);var r=JSON.stringify(n);return e.base64Encode(r)}static parseRequestState(e,t){if(!e)throw zu(Iu);if(!t)throw zu(ou);try{var n=t.split(Js.RESOURCE_DELIM),r=n[0],o=n.length>1?n.slice(1).join(Js.RESOURCE_DELIM):Js.EMPTY_STRING,i=e.base64Decode(r),a=JSON.parse(i);return{userRequestState:o||Js.EMPTY_STRING,libraryState:a}}catch(e){throw zu(ou)}}}var Sm="home_account_id",Im="UPN";class Em{constructor(){if(!window.localStorage)throw pv(uv)}getItem(e){return window.localStorage.getItem(e)}setItem(e,t){window.localStorage.setItem(e,t)}removeItem(e){window.localStorage.removeItem(e)}getKeys(){return Object.keys(window.localStorage)}containsKey(e){return window.localStorage.hasOwnProperty(e)}}class _m{constructor(){if(!window.sessionStorage)throw pv(uv)}getItem(e){return window.sessionStorage.getItem(e)}setItem(e,t){window.sessionStorage.setItem(e,t)}removeItem(e){window.sessionStorage.removeItem(e)}getKeys(){return Object.keys(window.sessionStorage)}containsKey(e){return window.sessionStorage.hasOwnProperty(e)}}function Tm(e,t){if(!t)return null;try{return km.parseRequestState(e,t).libraryState.meta}catch(e){throw zu(ou)}}class Om{getItem(e){for(var t="".concat(encodeURIComponent(e)),n=document.cookie.split(";"),r=0;r<n.length;r++){var o=n[r],[i,...a]=decodeURIComponent(o).trim().split("="),c=a.join("=");if(i===t)return c}return""}setItem(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o="".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(t),";path=/;SameSite=Lax;");if(n){var i=function(e){var t=new Date;return new Date(t.getTime()+864e5*e).toUTCString()}(n);o+="expires=".concat(i,";")}r&&(o+="Secure;"),document.cookie=o}removeItem(e){this.setItem(e,"",-1)}getKeys(){var e=document.cookie.split(";"),t=[];return e.forEach(e=>{var n=decodeURIComponent(e).trim().split("=");t.push(n[0])}),t}containsKey(e){return this.getKeys().includes(e)}}function Am(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function Pm(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){Am(i,r,o,a,c,"next",e)}function c(e){Am(i,r,o,a,c,"throw",e)}a(void 0)})}}class Mm extends wh{constructor(e,t,n,r,o,i){super(e,n,r,o),this.cacheConfig=t,this.logger=r,this.internalStorage=new Kv,this.browserStorage=this.setupBrowserStorage(this.cacheConfig.cacheLocation),this.temporaryCacheStorage=this.setupBrowserStorage(this.cacheConfig.temporaryCacheLocation),this.cookieStorage=new Om,t.cacheMigrationEnabled&&(this.migrateCacheEntries(),this.createKeyMaps()),this.performanceClient=i}setupBrowserStorage(e){try{switch(e){case gf:return new Em;case ff:return new _m}}catch(e){this.logger.error(e)}return this.cacheConfig.cacheLocation=pf,new Kv}migrateCacheEntries(){var e=this.browserStorage.getItem(_f);e&&this.logger.info("MSAL.js was last initialized with version ".concat(e)),e!==Tv&&this.browserStorage.setItem(_f,Tv);var t="".concat(Js.CACHE_PREFIX,".").concat(al),n="".concat(Js.CACHE_PREFIX,".").concat(cl),r="".concat(Js.CACHE_PREFIX,".").concat(ll),o="".concat(Js.CACHE_PREFIX,".").concat(ul),i=[this.browserStorage.getItem(t),this.browserStorage.getItem(n),this.browserStorage.getItem(r),this.browserStorage.getItem(o)];[al,cl,ll,ul].forEach((e,t)=>{var n=i[t];n&&this.setTemporaryCache(e,n,!0)})}createKeyMaps(){this.logger.trace("BrowserCacheManager - createKeyMaps called.");var e=this.cryptoImpl.createNewGuid(),t=this.getItem(If),n=this.getItem("".concat(Ef,".").concat(this.clientId));t&&n?this.logger.verbose("BrowserCacheManager:createKeyMaps - account and token key maps already exist, skipping migration."):this.browserStorage.getKeys().forEach(t=>{if(this.isCredentialKey(t)){var n=this.getItem(t);if(n){var r=this.validateAndParseJson(n);if(r&&r.hasOwnProperty("credentialType"))switch(r.credentialType){case Sl.ID_TOKEN:if(od(r)){this.logger.trace("BrowserCacheManager:createKeyMaps - idToken found, saving key to token key map"),this.logger.tracePii("BrowserCacheManager:createKeyMaps - idToken with key: ".concat(t," found, saving key to token key map"));var o=r,i=this.updateCredentialCacheKey(t,o,e);return void this.addTokenKey(i,Sl.ID_TOKEN,e)}this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching idToken schema with value containing idToken credentialType field but value failed IdTokenEntity validation, skipping."),this.logger.tracePii("BrowserCacheManager:createKeyMaps - failed idToken validation on key: ".concat(t));break;case Sl.ACCESS_TOKEN:case Sl.ACCESS_TOKEN_WITH_AUTH_SCHEME:if(rd(r)){this.logger.trace("BrowserCacheManager:createKeyMaps - accessToken found, saving key to token key map"),this.logger.tracePii("BrowserCacheManager:createKeyMaps - accessToken with key: ".concat(t," found, saving key to token key map"));var a=r,c=this.updateCredentialCacheKey(t,a,e);return void this.addTokenKey(c,Sl.ACCESS_TOKEN,e)}this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching accessToken schema with value containing accessToken credentialType field but value failed AccessTokenEntity validation, skipping."),this.logger.tracePii("BrowserCacheManager:createKeyMaps - failed accessToken validation on key: ".concat(t));break;case Sl.REFRESH_TOKEN:if(id(r)){this.logger.trace("BrowserCacheManager:createKeyMaps - refreshToken found, saving key to token key map"),this.logger.tracePii("BrowserCacheManager:createKeyMaps - refreshToken with key: ".concat(t," found, saving key to token key map"));var s=r,l=this.updateCredentialCacheKey(t,s,e);return void this.addTokenKey(l,Sl.REFRESH_TOKEN,e)}this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching refreshToken schema with value containing refreshToken credentialType field but value failed RefreshTokenEntity validation, skipping."),this.logger.tracePii("BrowserCacheManager:createKeyMaps - failed refreshToken validation on key: ".concat(t))}}}if(this.isAccountKey(t)){var u=this.getItem(t);if(u){var d=this.validateAndParseJson(u);d&&eh.isAccountEntity(d)&&(this.logger.trace("BrowserCacheManager:createKeyMaps - account found, saving key to account key map"),this.logger.tracePii("BrowserCacheManager:createKeyMaps - account with key: ".concat(t," found, saving key to account key map")),this.addAccountKeyToMap(t,e))}}})}validateAndParseJson(e){try{var t=JSON.parse(e);return t&&"object"==typeof t?t:null}catch(e){return null}}getItem(e){return this.browserStorage.getItem(e)}setItem(e,t,n){for(var r=[],o=0;o<=20;o++)try{this.browserStorage.setItem(e,t),o>0&&this.removeAccessTokenKeys(r.slice(0,o),n);break}catch(a){var i=gh(a);if(!(i.errorCode===lh&&o<20))throw i;if(r.length||(r=e==="".concat(Ef,".").concat(this.clientId)?JSON.parse(t).accessToken:this.getTokenKeys().accessToken),r.length<=o)throw i;this.removeAccessToken(r[o],n,!1)}}getAccount(e,t,n){this.logger.trace("BrowserCacheManager.getAccount called");var r=this.getCachedAccountEntity(e,t);return this.updateOutdatedCachedAccount(e,r,t,n)}getCachedAccountEntity(e,t){var n=this.getItem(e);if(!n)return this.removeAccountKeyFromMap(e,t),null;var r=this.validateAndParseJson(n);return r&&eh.isAccountEntity(r)?wh.toObject(new eh,r):null}setAccount(e,t){this.logger.trace("BrowserCacheManager.setAccount called");var n=e.generateAccountKey();e.lastUpdatedAt=Date.now().toString(),this.setItem(n,JSON.stringify(e),t),this.addAccountKeyToMap(n,t)}getAccountKeys(){this.logger.trace("BrowserCacheManager.getAccountKeys called");var e=this.getItem(If);return e?JSON.parse(e):(this.logger.verbose("BrowserCacheManager.getAccountKeys - No account keys found"),[])}addAccountKeyToMap(e,t){this.logger.trace("BrowserCacheManager.addAccountKeyToMap called"),this.logger.tracePii("BrowserCacheManager.addAccountKeyToMap called with key: ".concat(e));var n=this.getAccountKeys();-1===n.indexOf(e)?(n.push(e),this.setItem(If,JSON.stringify(n),t),this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key added")):this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key already exists in map")}removeAccountKeyFromMap(e,t){this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap called"),this.logger.tracePii("BrowserCacheManager.removeAccountKeyFromMap called with key: ".concat(e));var n=this.getAccountKeys(),r=n.indexOf(e);if(r>-1){if(n.splice(r,1),0===n.length)return void this.removeItem(If);this.setItem(If,JSON.stringify(n),t),this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap account key removed")}else this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap key not found in existing map")}removeAccount(e,t){var n=()=>super.removeAccount,r=this;return Pm(function*(){n().call(r,e,t),r.removeAccountKeyFromMap(e,t)})()}removeOutdatedAccount(e,t){this.removeItem(e),this.removeAccountKeyFromMap(e,t)}removeIdToken(e,t){super.removeIdToken(e,t),this.removeTokenKey(e,Sl.ID_TOKEN,t)}removeAccessToken(e,t){var n,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super.removeAccessToken(e,t),null===(n=this.performanceClient)||void 0===n||n.incrementFields({accessTokensRemoved:1},t),r&&this.removeTokenKey(e,Sl.ACCESS_TOKEN,t)}removeAccessTokenKeys(e,t){this.logger.trace("removeAccessTokenKey called");var n=this.getTokenKeys(),r=0;if(e.forEach(e=>{var t=n.accessToken.indexOf(e);t>-1&&(n.accessToken.splice(t,1),r++)}),r>0)return this.logger.info("removed ".concat(r," accessToken keys from tokenKeys map")),void this.setTokenKeys(n,t)}removeRefreshToken(e,t){super.removeRefreshToken(e,t),this.removeTokenKey(e,Sl.REFRESH_TOKEN,t)}getTokenKeys(){this.logger.trace("BrowserCacheManager.getTokenKeys called");var e=this.getItem("".concat(Ef,".").concat(this.clientId));if(e){var t=this.validateAndParseJson(e);if(t&&t.hasOwnProperty("idToken")&&t.hasOwnProperty("accessToken")&&t.hasOwnProperty("refreshToken"))return t;this.logger.error("BrowserCacheManager.getTokenKeys - Token keys found but in an unknown format. Returning empty key map.")}else this.logger.verbose("BrowserCacheManager.getTokenKeys - No token keys found");return{idToken:[],accessToken:[],refreshToken:[]}}setTokenKeys(e,t){0!==e.idToken.length||0!==e.accessToken.length||0!==e.refreshToken.length?this.setItem("".concat(Ef,".").concat(this.clientId),JSON.stringify(e),t):this.removeItem("".concat(Ef,".").concat(this.clientId))}addTokenKey(e,t,n){this.logger.trace("BrowserCacheManager addTokenKey called");var r=this.getTokenKeys();switch(t){case Sl.ID_TOKEN:-1===r.idToken.indexOf(e)&&(this.logger.info("BrowserCacheManager: addTokenKey - idToken added to map"),r.idToken.push(e));break;case Sl.ACCESS_TOKEN:var o=r.accessToken.indexOf(e);-1!==o&&r.accessToken.splice(o,1),this.logger.trace("access token ".concat(-1===o?"added to":"updated in"," map")),r.accessToken.push(e);break;case Sl.REFRESH_TOKEN:-1===r.refreshToken.indexOf(e)&&(this.logger.info("BrowserCacheManager: addTokenKey - refreshToken added to map"),r.refreshToken.push(e));break;default:throw this.logger.error("BrowserCacheManager:addTokenKey - CredentialType provided invalid. CredentialType: ".concat(t)),zu(Eu)}this.setTokenKeys(r,n)}removeTokenKey(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.getTokenKeys();switch(this.logger.trace("BrowserCacheManager removeTokenKey called"),t){case Sl.ID_TOKEN:this.logger.infoPii("BrowserCacheManager: removeTokenKey - attempting to remove idToken with key: ".concat(e," from map"));var o=r.idToken.indexOf(e);o>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - idToken removed from map"),r.idToken.splice(o,1)):this.logger.info("BrowserCacheManager: removeTokenKey - idToken does not exist in map. Either it was previously removed or it was never added.");break;case Sl.ACCESS_TOKEN:this.logger.infoPii("BrowserCacheManager: removeTokenKey - attempting to remove accessToken with key: ".concat(e," from map"));var i=r.accessToken.indexOf(e);i>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - accessToken removed from map"),r.accessToken.splice(i,1)):this.logger.info("BrowserCacheManager: removeTokenKey - accessToken does not exist in map. Either it was previously removed or it was never added.");break;case Sl.REFRESH_TOKEN:this.logger.infoPii("BrowserCacheManager: removeTokenKey - attempting to remove refreshToken with key: ".concat(e," from map"));var a=r.refreshToken.indexOf(e);a>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken removed from map"),r.refreshToken.splice(a,1)):this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken does not exist in map. Either it was previously removed or it was never added.");break;default:throw this.logger.error("BrowserCacheManager:removeTokenKey - CredentialType provided invalid. CredentialType: ".concat(t)),zu(Eu)}this.setTokenKeys(r,n)}getIdTokenCredential(e,t){var n=this.getItem(e);if(!n)return this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeIdToken(e,t),null;var r=this.validateAndParseJson(n);return r&&od(r)?(this.logger.trace("BrowserCacheManager.getIdTokenCredential: cache hit"),r):(this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),null)}setIdTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setIdTokenCredential called");var n=Ju(e);e.lastUpdatedAt=Date.now().toString(),this.setItem(n,JSON.stringify(e),t),this.addTokenKey(n,Sl.ID_TOKEN,t)}getAccessTokenCredential(e,t){var n=this.getItem(e);if(!n)return this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(e,Sl.ACCESS_TOKEN,t),null;var r=this.validateAndParseJson(n);return r&&rd(r)?(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: cache hit"),r):(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),null)}setAccessTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setAccessTokenCredential called");var n=Ju(e);e.lastUpdatedAt=Date.now().toString(),this.setItem(n,JSON.stringify(e),t),this.addTokenKey(n,Sl.ACCESS_TOKEN,t)}getRefreshTokenCredential(e,t){var n=this.getItem(e);if(!n)return this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(e,Sl.REFRESH_TOKEN,t),null;var r=this.validateAndParseJson(n);return r&&id(r)?(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: cache hit"),r):(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),null)}setRefreshTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setRefreshTokenCredential called");var n=Ju(e);e.lastUpdatedAt=Date.now().toString(),this.setItem(n,JSON.stringify(e),t),this.addTokenKey(n,Sl.REFRESH_TOKEN,t)}getAppMetadata(e){var t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null;var n,r=this.validateAndParseJson(t);return r&&((n=r)&&0===e.indexOf(Il)&&n.hasOwnProperty("clientId")&&n.hasOwnProperty("environment"))?(this.logger.trace("BrowserCacheManager.getAppMetadata: cache hit"),r):(this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null)}setAppMetadata(e,t){this.logger.trace("BrowserCacheManager.setAppMetadata called");var n=function(e){var{environment:t,clientId:n}=e;return[Il,t,n].join(kl).toLowerCase()}(e);this.setItem(n,JSON.stringify(e),t)}getServerTelemetry(e){var t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null;var n,r,o,i=this.validateAndParseJson(t);return i&&(n=i,r=0===e.indexOf(Ml.CACHE_KEY),o=!0,n&&(o=n.hasOwnProperty("failedRequests")&&n.hasOwnProperty("errors")&&n.hasOwnProperty("cacheHits")),r&&o)?(this.logger.trace("BrowserCacheManager.getServerTelemetry: cache hit"),i):(this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null)}setServerTelemetry(e,t,n){this.logger.trace("BrowserCacheManager.setServerTelemetry called"),this.setItem(e,JSON.stringify(t),n)}getAuthorityMetadata(e){var t=this.internalStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAuthorityMetadata: called, no cache hit"),null;var n=this.validateAndParseJson(t);return n&&function(e,t){return!!t&&0===e.indexOf(_l)&&t.hasOwnProperty("aliases")&&t.hasOwnProperty("preferred_cache")&&t.hasOwnProperty("preferred_network")&&t.hasOwnProperty("canonical_authority")&&t.hasOwnProperty("authorization_endpoint")&&t.hasOwnProperty("token_endpoint")&&t.hasOwnProperty("issuer")&&t.hasOwnProperty("aliasesFromNetwork")&&t.hasOwnProperty("endpointsFromNetwork")&&t.hasOwnProperty("expiresAt")&&t.hasOwnProperty("jwks_uri")}(e,n)?(this.logger.trace("BrowserCacheManager.getAuthorityMetadata: cache hit"),n):null}getAuthorityMetadataKeys(){return this.internalStorage.getKeys().filter(e=>this.isAuthorityMetadata(e))}setWrapperMetadata(e,t){this.internalStorage.setItem(Tf,e),this.internalStorage.setItem(Of,t)}getWrapperMetadata(){return[this.internalStorage.getItem(Tf)||Js.EMPTY_STRING,this.internalStorage.getItem(Of)||Js.EMPTY_STRING]}setAuthorityMetadata(e,t){this.logger.trace("BrowserCacheManager.setAuthorityMetadata called"),this.internalStorage.setItem(e,JSON.stringify(t))}getActiveAccount(e){var t=this.generateCacheKey(hl),n=this.getItem(t);if(!n){this.logger.trace("BrowserCacheManager.getActiveAccount: No active account filters cache schema found, looking for legacy schema");var r=this.generateCacheKey(dl),o=this.getItem(r);if(!o)return this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null;var i=this.getAccountInfoFilteredBy({localAccountId:o},e);return i?(this.logger.trace("BrowserCacheManager.getActiveAccount: Legacy active account cache schema found"),this.logger.trace("BrowserCacheManager.getActiveAccount: Adding active account filters cache schema"),this.setActiveAccount(i,e),i):null}var a=this.validateAndParseJson(n);return a?(this.logger.trace("BrowserCacheManager.getActiveAccount: Active account filters schema found"),this.getAccountInfoFilteredBy({homeAccountId:a.homeAccountId,localAccountId:a.localAccountId,tenantId:a.tenantId},e)):(this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null)}setActiveAccount(e,t){var n=this.generateCacheKey(hl),r=this.generateCacheKey(dl);if(e){this.logger.verbose("setActiveAccount: Active account set");var o={homeAccountId:e.homeAccountId,localAccountId:e.localAccountId,tenantId:e.tenantId,lastUpdatedAt:Date.now().toString()};this.setItem(n,JSON.stringify(o),t),this.setItem(r,e.localAccountId,t)}else this.logger.verbose("setActiveAccount: No account passed, active account not set"),this.browserStorage.removeItem(n),this.browserStorage.removeItem(r)}getThrottlingCache(e){var t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null;var n=this.validateAndParseJson(t);return n&&function(e,t){var n=!1;e&&(n=0===e.indexOf(Nl));var r=!0;return t&&(r=t.hasOwnProperty("throttleTime")),n&&r}(e,n)?(this.logger.trace("BrowserCacheManager.getThrottlingCache: cache hit"),n):(this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null)}setThrottlingCache(e,t,n){this.logger.trace("BrowserCacheManager.setThrottlingCache called"),this.setItem(e,JSON.stringify(t),n)}getTemporaryCache(e,t){var n=t?this.generateCacheKey(e):e;if(this.cacheConfig.storeAuthStateInCookie){var r=this.cookieStorage.getItem(n);if(r)return this.logger.trace("BrowserCacheManager.getTemporaryCache: storeAuthStateInCookies set to true, retrieving from cookies"),r}var o=this.temporaryCacheStorage.getItem(n);if(!o){if(this.cacheConfig.cacheLocation===gf){var i=this.browserStorage.getItem(n);if(i)return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item found in local storage"),i}return this.logger.trace("BrowserCacheManager.getTemporaryCache: No cache item found in local storage"),null}return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item returned"),o}setTemporaryCache(e,t,n){var r=n?this.generateCacheKey(e):e;this.temporaryCacheStorage.setItem(r,t),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.setTemporaryCache: storeAuthStateInCookie set to true, setting item cookie"),this.cookieStorage.setItem(r,t,void 0,this.cacheConfig.secureCookies))}removeItem(e){this.browserStorage.removeItem(e)}removeTemporaryItem(e){this.temporaryCacheStorage.removeItem(e),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.removeItem: storeAuthStateInCookie is true, clearing item cookie"),this.cookieStorage.removeItem(e))}getKeys(){return this.browserStorage.getKeys()}clear(e){var t=this;return Pm(function*(){yield t.removeAllAccounts(e),t.removeAppMetadata(e),t.temporaryCacheStorage.getKeys().forEach(e=>{-1===e.indexOf(Js.CACHE_PREFIX)&&-1===e.indexOf(t.clientId)||t.removeTemporaryItem(e)}),t.browserStorage.getKeys().forEach(e=>{-1===e.indexOf(Js.CACHE_PREFIX)&&-1===e.indexOf(t.clientId)||t.browserStorage.removeItem(e)}),t.internalStorage.clear()})()}clearTokensAndKeysWithClaims(e,t){var n=this;return Pm(function*(){e.addQueueMeasurement(Wg,t);var r=n.getTokenKeys(),o=0;r.accessToken.forEach(e=>{var r=n.getAccessTokenCredential(e,t);null!=r&&r.requestedClaimsHash&&e.includes(r.requestedClaimsHash.toLowerCase())&&(n.removeAccessToken(e,t),o++)}),o>0&&n.logger.warning("".concat(o," access tokens with claims in the cache keys have been removed from the cache."))})()}generateCacheKey(e){return this.validateAndParseJson(e)?JSON.stringify(e):Bd.startsWith(e,Js.CACHE_PREFIX)||Bd.startsWith(e,sl)?e:"".concat(Js.CACHE_PREFIX,".").concat(this.clientId,".").concat(e)}generateAuthorityKey(e){var{libraryState:{id:t}}=km.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey("".concat("authority",".").concat(t))}generateNonceKey(e){var{libraryState:{id:t}}=km.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey("".concat("nonce.id_token",".").concat(t))}generateStateKey(e){var{libraryState:{id:t}}=km.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey("".concat(vf,".").concat(t))}getCachedAuthority(e){var t=this.generateStateKey(e),n=this.getTemporaryCache(t);if(!n)return null;var r=this.generateAuthorityKey(n);return this.getTemporaryCache(r)}updateCacheEntries(e,t,n,r,o){this.logger.trace("BrowserCacheManager.updateCacheEntries called");var i=this.generateStateKey(e);this.setTemporaryCache(i,e,!1);var a=this.generateNonceKey(e);this.setTemporaryCache(a,t,!1);var c=this.generateAuthorityKey(e);if(this.setTemporaryCache(c,n,!1),o){var s={credential:o.homeAccountId,type:Sm};this.setTemporaryCache(Cf,JSON.stringify(s),!0)}else if(r){var l={credential:r,type:Im};this.setTemporaryCache(Cf,JSON.stringify(l),!0)}}resetRequestCache(e){this.logger.trace("BrowserCacheManager.resetRequestCache called"),e&&(this.temporaryCacheStorage.getKeys().forEach(t=>{-1!==t.indexOf(e)&&this.removeTemporaryItem(t)}),this.removeTemporaryItem(this.generateStateKey(e)),this.removeTemporaryItem(this.generateNonceKey(e)),this.removeTemporaryItem(this.generateAuthorityKey(e))),this.removeTemporaryItem(this.generateCacheKey(wf)),this.removeTemporaryItem(this.generateCacheKey(mf)),this.removeTemporaryItem(this.generateCacheKey(yf)),this.removeTemporaryItem(this.generateCacheKey(kf)),this.removeTemporaryItem(this.generateCacheKey(Cf)),this.removeTemporaryItem(this.generateCacheKey(Sf)),this.setInteractionInProgress(!1)}cleanRequestByState(e){if(this.logger.trace("BrowserCacheManager.cleanRequestByState called"),e){var t=this.generateStateKey(e),n=this.temporaryCacheStorage.getItem(t);this.logger.infoPii("BrowserCacheManager.cleanRequestByState: Removing temporary cache items for state: ".concat(n)),this.resetRequestCache(n||Js.EMPTY_STRING)}}cleanRequestByInteractionType(e){this.logger.trace("BrowserCacheManager.cleanRequestByInteractionType called"),this.temporaryCacheStorage.getKeys().forEach(t=>{if(-1!==t.indexOf(vf)){var n=this.temporaryCacheStorage.getItem(t);if(n){var r=Tm(this.cryptoImpl,n);r&&r.interactionType===e&&(this.logger.infoPii("BrowserCacheManager.cleanRequestByInteractionType: Removing temporary cache items for state: ".concat(n)),this.resetRequestCache(n))}}}),this.setInteractionInProgress(!1)}cacheCodeRequest(e){this.logger.trace("BrowserCacheManager.cacheCodeRequest called");var t=Kp(JSON.stringify(e));this.setTemporaryCache(wf,t,!0)}getCachedRequest(e){this.logger.trace("BrowserCacheManager.getCachedRequest called");var t,n=this.getTemporaryCache(wf,!0);if(!n)throw jp(ip);try{t=JSON.parse(Lv(n))}catch(e){throw this.logger.errorPii("Attempted to parse: ".concat(n)),this.logger.error("Parsing cached token request threw with error: ".concat(e)),jp(ap)}if(this.removeTemporaryItem(this.generateCacheKey(wf)),!t.authority){var r=this.generateAuthorityKey(e),o=this.getTemporaryCache(r);if(!o)throw jp(cp);t.authority=o}return t}getCachedNativeRequest(){this.logger.trace("BrowserCacheManager.getCachedNativeRequest called");var e=this.getTemporaryCache(Sf,!0);return e?this.validateAndParseJson(e)||(this.logger.error("BrowserCacheManager.getCachedNativeRequest: Unable to parse native request"),null):(this.logger.trace("BrowserCacheManager.getCachedNativeRequest: No cached native request found"),null)}isInteractionInProgress(e){var t=this.getInteractionInProgress();return e?t===this.clientId:!!t}getInteractionInProgress(){var e="".concat(Js.CACHE_PREFIX,".").concat(bf);return this.getTemporaryCache(e,!1)}setInteractionInProgress(e){var t="".concat(Js.CACHE_PREFIX,".").concat(bf);if(e){if(this.getInteractionInProgress())throw jp(Yf);this.setTemporaryCache(t,this.clientId,!1)}else e||this.getInteractionInProgress()!==this.clientId||this.removeTemporaryItem(t)}getLegacyLoginHint(){var e=this.getTemporaryCache(sl);e&&(this.browserStorage.removeItem(sl),this.logger.verbose("Cached ADAL id token retrieved."));var t=this.getTemporaryCache(al,!0);t&&(this.browserStorage.removeItem(this.generateCacheKey(al)),this.logger.verbose("Cached MSAL.js v1 id token retrieved"));var n=t||e;if(n){var r=Wu(n,Lv);if(r.preferred_username)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 preferred_username as loginHint"),r.preferred_username;if(r.upn)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 upn as loginHint"),r.upn;this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, however, no account hint claim found. Enable preferred_username or upn id token claim to get SSO.")}return null}updateCredentialCacheKey(e,t,n){var r=Ju(t);if(e!==r){var o=this.getItem(e);if(o)return this.browserStorage.removeItem(e),this.setItem(r,o,n),this.logger.verbose("Updated an outdated ".concat(t.credentialType," cache key")),r;this.logger.error("Attempted to update an outdated ".concat(t.credentialType," cache key but no item matching the outdated key was found in storage"))}return e}hydrateCache(e,t){var n=this;return Pm(function*(){var r,o,i,a,c=$u(null===(r=e.account)||void 0===r?void 0:r.homeAccountId,null===(o=e.account)||void 0===o?void 0:o.environment,e.idToken,n.clientId,e.tenantId);t.claims&&(a=yield n.cryptoImpl.hashString(t.claims));var s={idToken:c,accessToken:ed(null===(i=e.account)||void 0===i?void 0:i.homeAccountId,e.account.environment,e.accessToken,n.clientId,e.tenantId,e.scopes.join(" "),e.expiresOn?e.expiresOn.getTime()/1e3:0,e.extExpiresOn?e.extExpiresOn.getTime()/1e3:0,Lv,void 0,e.tokenType,void 0,t.sshKid,t.claims,a)};return n.saveCacheRecord(s,e.correlationId)})()}saveCacheRecord(e,t,n){var r=()=>super.saveCacheRecord,o=this;return Pm(function*(){try{yield r().call(o,e,t,n)}catch(e){if(e instanceof hh&&o.performanceClient&&t)try{var i=o.getTokenKeys();o.performanceClient.addFields({cacheRtCount:i.refreshToken.length,cacheIdCount:i.idToken.length,cacheAtCount:i.accessToken.length},t)}catch(e){}throw e}})()}}var xm="msal:initializeEnd",Nm="msal:loginStart",Rm="msal:loginSuccess",jm="msal:loginFailure",Dm="msal:acquireTokenStart",qm="msal:acquireTokenSuccess",Hm="msal:acquireTokenFailure",Lm="msal:acquireTokenByCodeFailure",Bm="msal:handleRedirectEnd",Um="msal:popupOpened",zm="msal:logoutStart",Km="msal:logoutSuccess",Fm="msal:logoutFailure",Vm="msal:logoutEnd";class Ym{constructor(e){this.eventCallbacks=new Map,this.logger=e||new Rl({})}addEventCallback(e,t,n){if("undefined"!=typeof window){var r=n||nv();return this.eventCallbacks.has(r)?(this.logger.error("Event callback with id: ".concat(r," is already registered. Please provide a unique id or remove the existing callback and try again.")),null):(this.eventCallbacks.set(r,[e,t||[]]),this.logger.verbose("Event callback registered with id: ".concat(r)),r)}return null}removeEventCallback(e){this.eventCallbacks.delete(e),this.logger.verbose("Event callback ".concat(e," removed."))}emitEvent(e,t,n,r){if("undefined"!=typeof window){var o={eventType:e,interactionType:t||null,payload:n||null,error:r||null,timestamp:Date.now()};this.eventCallbacks.forEach((t,n)=>{var[r,i]=t;(0===i.length||i.includes(e))&&(this.logger.verbose("Emitting event to callback ".concat(n,": ").concat(e)),r.apply(null,[o]))})}}}class Gm extends Wl{constructor(e,t,n,r,o){super(e,t,n),this.name="ServerError",this.errorNo=r,this.status=o,Object.setPrototypeOf(this,Gm.prototype)}}class Wm{static generateThrottlingStorageKey(e){return"".concat(Nl,".").concat(JSON.stringify(e))}static preProcess(e,t,n){var r=Wm.generateThrottlingStorageKey(t),o=e.getThrottlingCache(r);if(o){var i;if(o.throttleTime<Date.now())return void e.removeItem(r,n);throw new Gm((null===(i=o.errorCodes)||void 0===i?void 0:i.join(" "))||Js.EMPTY_STRING,o.errorMessage,o.subError)}}static postProcess(e,t,n,r){if(Wm.checkResponseStatus(n)||Wm.checkResponseForRetryAfter(n)){var o={throttleTime:Wm.calculateThrottleTime(parseInt(n.headers[nl])),error:n.body.error,errorCodes:n.body.error_codes,errorMessage:n.body.error_description,subError:n.body.suberror};e.setThrottlingCache(Wm.generateThrottlingStorageKey(t),o,r)}}static checkResponseStatus(e){return 429===e.status||e.status>=500&&e.status<600}static checkResponseForRetryAfter(e){return!!e.headers&&e.headers.hasOwnProperty(nl)&&(e.status<200||e.status>=300)}static calculateThrottleTime(e){var t=e<=0?0:e,n=Date.now()/1e3;return Math.floor(1e3*Math.min(n+(t||60),n+3600))}static removeThrottle(e,t,n,r){var o={clientId:t,authority:n.authority,scopes:n.scopes,homeAccountIdentifier:r,claims:n.claims,authenticationScheme:n.authenticationScheme,resourceRequestMethod:n.resourceRequestMethod,resourceRequestUri:n.resourceRequestUri,shrClaims:n.shrClaims,sshKid:n.sshKid},i=this.generateThrottlingStorageKey(o);e.removeItem(i,n.correlationId)}}var Zm="client_id",Qm="redirect_uri",Xm="response_type",Jm="token_type",$m="req_cnf",ey="return_spa_code",ty="x-client-xtra-sku",ny="brk_client_id",ry="brk_redirect_uri";class oy{static validateRedirectUri(e){if(!e)throw Ld(pd)}static validatePrompt(e){var t=[];for(var n in ml)t.push(ml[n]);if(t.indexOf(e)<0)throw Ld(Cd)}static validateClaims(e){try{JSON.parse(e)}catch(e){throw Ld(kd)}}static validateCodeChallengeParams(e,t){if(!e||!t)throw Ld(_d);this.validateCodeChallengeMethod(t)}static validateCodeChallengeMethod(e){if([yl.PLAIN,yl.S256].indexOf(e)<0)throw Ld(Ed)}}class iy{constructor(e,t){this.parameters=new Map,this.performanceClient=t,this.correlationId=e}addResponseTypeCode(){this.parameters.set(Xm,encodeURIComponent(Js.CODE_RESPONSE_TYPE))}addResponseTypeForTokenAndIdToken(){this.parameters.set(Xm,encodeURIComponent("".concat(Js.TOKEN_RESPONSE_TYPE," ").concat(Js.ID_TOKEN_RESPONSE_TYPE)))}addResponseMode(e){this.parameters.set("response_mode",encodeURIComponent(e||bl.QUERY))}addNativeBroker(){this.parameters.set("nativebroker",encodeURIComponent("1"))}addScopes(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:$s;!t||n.includes("openid")||e.includes("openid")||n.push("openid");var r=t?[...e||[],...n]:e||[],o=new Ud(r);this.parameters.set("scope",encodeURIComponent(o.printScopes()))}addClientId(e){this.parameters.set(Zm,encodeURIComponent(e))}addRedirectUri(e){oy.validateRedirectUri(e),this.parameters.set(Qm,encodeURIComponent(e))}addPostLogoutRedirectUri(e){oy.validateRedirectUri(e),this.parameters.set("post_logout_redirect_uri",encodeURIComponent(e))}addIdTokenHint(e){this.parameters.set("id_token_hint",encodeURIComponent(e))}addDomainHint(e){this.parameters.set("domain_hint",encodeURIComponent(e))}addLoginHint(e){this.parameters.set("login_hint",encodeURIComponent(e))}addCcsUpn(e){this.parameters.set(rl,encodeURIComponent("UPN:".concat(e)))}addCcsOid(e){this.parameters.set(rl,encodeURIComponent("Oid:".concat(e.uid,"@").concat(e.utid)))}addSid(e){this.parameters.set("sid",encodeURIComponent(e))}addClaims(e,t){var n=this.addClientCapabilitiesToClaims(e,t);oy.validateClaims(n),this.parameters.set("claims",encodeURIComponent(n))}addCorrelationId(e){this.parameters.set("client-request-id",encodeURIComponent(e))}addLibraryInfo(e){this.parameters.set("x-client-SKU",e.sku),this.parameters.set("x-client-VER",e.version),e.os&&this.parameters.set("x-client-OS",e.os),e.cpu&&this.parameters.set("x-client-CPU",e.cpu)}addApplicationTelemetry(e){null!=e&&e.appName&&this.parameters.set("x-app-name",e.appName),null!=e&&e.appVersion&&this.parameters.set("x-app-ver",e.appVersion)}addPrompt(e){oy.validatePrompt(e),this.parameters.set("".concat("prompt"),encodeURIComponent(e))}addState(e){e&&this.parameters.set("state",encodeURIComponent(e))}addNonce(e){this.parameters.set("nonce",encodeURIComponent(e))}addCodeChallengeParams(e,t){if(oy.validateCodeChallengeParams(e,t),!e||!t)throw Ld(_d);this.parameters.set("code_challenge",encodeURIComponent(e)),this.parameters.set("code_challenge_method",encodeURIComponent(t))}addAuthorizationCode(e){this.parameters.set("code",encodeURIComponent(e))}addDeviceCode(e){this.parameters.set("device_code",encodeURIComponent(e))}addRefreshToken(e){this.parameters.set("refresh_token",encodeURIComponent(e))}addCodeVerifier(e){this.parameters.set("code_verifier",encodeURIComponent(e))}addClientSecret(e){this.parameters.set("client_secret",encodeURIComponent(e))}addClientAssertion(e){e&&this.parameters.set("client_assertion",encodeURIComponent(e))}addClientAssertionType(e){e&&this.parameters.set("client_assertion_type",encodeURIComponent(e))}addOboAssertion(e){this.parameters.set("assertion",encodeURIComponent(e))}addRequestTokenUse(e){this.parameters.set("requested_token_use",encodeURIComponent(e))}addGrantType(e){this.parameters.set("grant_type",encodeURIComponent(e))}addClientInfo(){this.parameters.set("client_info","1")}addExtraQueryParameters(e){Object.entries(e).forEach(e=>{var[t,n]=e;!this.parameters.has(t)&&n&&this.parameters.set(t,n)})}addClientCapabilitiesToClaims(e,t){var n;if(e)try{n=JSON.parse(e)}catch(e){throw Ld(kd)}else n={};return t&&t.length>0&&(n.hasOwnProperty(vl)||(n[vl]={}),n[vl].xms_cc={values:t}),JSON.stringify(n)}addUsername(e){this.parameters.set("username",encodeURIComponent(e))}addPassword(e){this.parameters.set("password",encodeURIComponent(e))}addPopToken(e){e&&(this.parameters.set(Jm,xl.POP),this.parameters.set($m,encodeURIComponent(e)))}addSshJwk(e){e&&(this.parameters.set(Jm,xl.SSH),this.parameters.set($m,encodeURIComponent(e)))}addServerTelemetry(e){this.parameters.set("x-client-current-telemetry",e.generateCurrentRequestHeaderValue()),this.parameters.set("x-client-last-telemetry",e.generateLastRequestHeaderValue())}addThrottling(){this.parameters.set("x-ms-lib-capability","retry-after, h429")}addLogoutHint(e){this.parameters.set("logout_hint",encodeURIComponent(e))}addBrokerParameters(e){var t={};t[ny]=e.brokerClientId,t[ry]=e.brokerRedirectUri,this.addExtraQueryParameters(t)}createQueryString(){var e=new Array;return this.parameters.forEach((t,n)=>{e.push("".concat(n,"=").concat(t))}),function(e,t,n){if(t){var r=e.get(Zm);r&&e.has(ny)&&(null==n||n.addFields({embeddedClientId:r,embeddedRedirectUri:e.get(Qm)},t))}}(this.parameters,this.correlationId,this.performanceClient),e.join("&")}}function ay(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function cy(e,t,n,r,o,i,a){return sy.apply(this,arguments)}function sy(){var e;return e=function*(e,t,n,r,o,i,a){null==a||a.addQueueMeasurement(Ng,i);var c=um.transformCIAMAuthority(dm(e)),s=new um(c,t,n,r,o,i,a);try{return yield tm(s.resolveEndpointsAsync.bind(s),Rg,o,a,i)(),s}catch(e){throw zu(eu)}},sy=function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){ay(i,r,o,a,c,"next",e)}function c(e){ay(i,r,o,a,c,"throw",e)}a(void 0)})},sy.apply(this,arguments)}function ly(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function uy(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){ly(i,r,o,a,c,"next",e)}function c(e){ly(i,r,o,a,c,"throw",e)}a(void 0)})}}class dy{constructor(e,t){this.config=function(e){var t,{authOptions:n,systemOptions:r,loggerOptions:o,cacheOptions:i,storageInterface:a,networkInterface:c,cryptoInterface:s,clientCredentials:l,libraryInfo:u,telemetry:d,serverTelemetryManager:h,persistencePlugin:g,serializableCache:f}=e,p=kh(kh({},Th),o);return{authOptions:(t=n,kh({clientCapabilities:[],azureCloudOptions:xh,skipAuthorityMetadataCache:!1,instanceAware:!1},t)),systemOptions:kh(kh({},_h),r),loggerOptions:p,cacheOptions:kh(kh({},Oh),i),storageInterface:a||new bh(n.clientId,Vu,new Rl(p)),networkInterface:c||Ah,cryptoInterface:s||Vu,clientCredentials:l||Mh,libraryInfo:kh(kh({},Ph),u),telemetry:kh(kh({},Nh),d),serverTelemetryManager:h||null,persistencePlugin:g||null,serializableCache:f||null}}(e),this.logger=new Rl(this.config.loggerOptions,Yu,Gu),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}createTokenRequestHeaders(e){var t={};if(t[tl]=Js.URL_FORM_CONTENT_TYPE,!this.config.systemOptions.preventCorsPreflight&&e)switch(e.type){case Sm:try{var n=Kd(e.credential);t[rl]="Oid:".concat(n.uid,"@").concat(n.utid)}catch(e){this.logger.verbose("Could not parse home account ID for CCS Header: "+e)}break;case Im:t[rl]="UPN: ".concat(e.credential)}return t}executePostToTokenEndpoint(e,t,n,r,o,i){var a=this;return uy(function*(){var c;i&&(null===(c=a.performanceClient)||void 0===c||c.addQueueMeasurement(i,o));var s=yield a.sendPostRequest(r,e,{body:t,headers:n},o);return a.config.serverTelemetryManager&&s.status<500&&429!==s.status&&a.config.serverTelemetryManager.clearTelemetryCache(),s})()}sendPostRequest(e,t,n,r){var o=this;return uy(function*(){var i;Wm.preProcess(o.cacheManager,e,r);try{var a,c,s=(i=yield tm(o.networkClient.sendPostRequestAsync.bind(o.networkClient),Xh,o.logger,o.performanceClient,r)(t,n)).headers||{};null===(a=o.performanceClient)||void 0===a||a.addFields({refreshTokenSize:(null===(c=i.body.refresh_token)||void 0===c?void 0:c.length)||0,httpVerToken:s[il]||"",requestId:s[ol]||""},r)}catch(e){if(e instanceof Df){var l,u=e.responseHeaders;throw u&&(null===(l=o.performanceClient)||void 0===l||l.addFields({httpVerToken:u[il]||"",requestId:u[ol]||"",contentTypeHeader:u[tl]||void 0,contentLengthHeader:u["Content-Length"]||void 0,httpStatus:e.httpStatus},r)),e.error}throw e instanceof Wl?e:zu(tu)}return Wm.postProcess(o.cacheManager,e,i,r),i})()}updateAuthority(e,t){var n=this;return uy(function*(){var r;null===(r=n.performanceClient)||void 0===r||r.addQueueMeasurement(Ig,t);var o="https://".concat(e,"/").concat(n.authority.tenant,"/"),i=yield cy(o,n.networkClient,n.cacheManager,n.authority.options,n.logger,t,n.performanceClient);n.authority=i})()}createTokenQueryParameters(e){var t=new iy(e.correlationId,this.performanceClient);return e.embeddedClientId&&t.addBrokerParameters({brokerClientId:this.config.authOptions.clientId,brokerRedirectUri:this.config.authOptions.redirectUri}),e.tokenQueryParameters&&t.addExtraQueryParameters(e.tokenQueryParameters),t.addCorrelationId(e.correlationId),t.createQueryString()}}function hy(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function gy(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function fy(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function py(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){fy(i,r,o,a,c,"next",e)}function c(e){fy(i,r,o,a,c,"throw",e)}a(void 0)})}}class vy{constructor(e,t){this.cryptoUtils=e,this.performanceClient=t}generateCnf(e,t){var n=this;return py(function*(){var r;null===(r=n.performanceClient)||void 0===r||r.addQueueMeasurement(Ag,e.correlationId);var o=yield tm(n.generateKid.bind(n),Ag,t,n.performanceClient,e.correlationId)(e),i=n.cryptoUtils.base64UrlEncode(JSON.stringify(o));return{kid:o.kid,reqCnfString:i}})()}generateKid(e){var t=this;return py(function*(){var n;return null===(n=t.performanceClient)||void 0===n||n.addQueueMeasurement(Pg,e.correlationId),{kid:yield t.cryptoUtils.getPublicKeyThumbprint(e),xms_ksl:"sw"}})()}signPopToken(e,t,n){var r=this;return py(function*(){return r.signPayload(e,t,n)})()}signPayload(e,t,n,r){var o=this;return py(function*(){var{resourceRequestMethod:i,resourceRequestUri:a,shrClaims:c,shrNonce:s,shrOptions:l}=n,u=a?new rh(a):void 0,d=null==u?void 0:u.getUrlComponents();return o.cryptoUtils.signJwt(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hy(Object(n),!0).forEach(function(t){gy(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hy(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({at:e,ts:Qu(),m:null==i?void 0:i.toUpperCase(),u:null==d?void 0:d.HostNameAndPort,nonce:s||o.cryptoUtils.createNewGuid(),p:null==d?void 0:d.AbsolutePath,q:null!=d&&d.QueryString?[[],d.QueryString]:void 0,client_claims:c||void 0},r),t,l,n.correlationId)})()}}class my{constructor(e,t){this.cache=e,this.hasChanged=t}get cacheHasChanged(){return this.hasChanged}get tokenCache(){return this.cache}}function yy(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function wy(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){yy(i,r,o,a,c,"next",e)}function c(e){yy(i,r,o,a,c,"throw",e)}a(void 0)})}}class by{constructor(e,t,n,r,o,i,a){this.clientId=e,this.cacheStorage=t,this.cryptoObj=n,this.logger=r,this.serializableCache=o,this.persistencePlugin=i,this.performanceClient=a}validateServerAuthorizationCodeResponse(e,t){if(!e.state||!t)throw e.state?zu(au,"Cached State"):zu(au,"Server State");var n,r;try{n=decodeURIComponent(e.state)}catch(t){throw zu(ou,e.state)}try{r=decodeURIComponent(t)}catch(t){throw zu(ou,e.state)}if(n!==r)throw zu(iu);if(e.error||e.error_description||e.suberror){var o=function(e){var t,n,r=null===(t=e.error_uri)||void 0===t?void 0:t.lastIndexOf("code=");return r&&r>=0?null===(n=e.error_uri)||void 0===n?void 0:n.substring(r+5):void 0}(e);if(bm(e.error,e.error_description,e.suberror))throw new wm(e.error||"",e.error_description,e.suberror,e.timestamp||"",e.trace_id||"",e.correlation_id||"",e.claims||"",o);throw new Gm(e.error||"",e.error_description,e.suberror,o)}}validateTokenResponse(e,t){if(e.error||e.error_description||e.suberror){var n,r="Error(s): ".concat(e.error_codes||Js.NOT_AVAILABLE," - Timestamp: ").concat(e.timestamp||Js.NOT_AVAILABLE," - Description: ").concat(e.error_description||Js.NOT_AVAILABLE," - Correlation ID: ").concat(e.correlation_id||Js.NOT_AVAILABLE," - Trace ID: ").concat(e.trace_id||Js.NOT_AVAILABLE),o=null!==(n=e.error_codes)&&void 0!==n&&n.length?e.error_codes[0]:void 0,i=new Gm(e.error,r,e.suberror,o,e.status);if(t&&e.status&&e.status>=500&&e.status<=599)return void this.logger.warning("executeTokenRequest:validateTokenResponse - AAD is currently unavailable and the access token is unable to be refreshed.\n".concat(i));if(t&&e.status&&e.status>=400&&e.status<=499)return void this.logger.warning("executeTokenRequest:validateTokenResponse - AAD is currently available but is unable to refresh the access token.\n".concat(i));if(bm(e.error,e.error_description,e.suberror))throw new wm(e.error,e.error_description,e.suberror,e.timestamp||Js.EMPTY_STRING,e.trace_id||Js.EMPTY_STRING,e.correlation_id||Js.EMPTY_STRING,e.claims||Js.EMPTY_STRING,o);throw i}}handleServerTokenResponse(e,t,n,r,o,i,a,c,s){var l=this;return wy(function*(){var u,d,h;if(null===(u=l.performanceClient)||void 0===u||u.addQueueMeasurement(Mg,e.correlation_id),e.id_token){if(d=Wu(e.id_token||Js.EMPTY_STRING,l.cryptoObj.base64Decode),o&&o.nonce&&d.nonce!==o.nonce)throw zu(cu);if(r.maxAge||0===r.maxAge){var g=d.auth_time;if(!g)throw zu(su);Zu(g,r.maxAge)}}l.homeAccountIdentifier=eh.generateHomeAccountId(e.client_info||Js.EMPTY_STRING,t.authorityType,l.logger,l.cryptoObj,d),o&&o.state&&(h=km.parseRequestState(l.cryptoObj,o.state)),e.key_id=e.key_id||r.sshKid||void 0;var f,p=l.generateCacheRecord(e,t,n,r,d,i,o);try{if(l.persistencePlugin&&l.serializableCache&&(l.logger.verbose("Persistence enabled, calling beforeCacheAccess"),f=new my(l.serializableCache,!0),yield l.persistencePlugin.beforeCacheAccess(f)),a&&!c&&p.account){var v=p.account.generateAccountKey();if(!l.cacheStorage.getAccount(v,r.correlationId,l.logger))return l.logger.warning("Account used to refresh tokens not in persistence, refreshed tokens will not be stored in the cache"),yield by.generateAuthenticationResult(l.cryptoObj,t,p,!1,r,d,h,void 0,s)}yield l.cacheStorage.saveCacheRecord(p,r.correlationId,r.storeInCache)}finally{l.persistencePlugin&&l.serializableCache&&f&&(l.logger.verbose("Persistence enabled, calling afterCacheAccess"),yield l.persistencePlugin.afterCacheAccess(f))}return by.generateAuthenticationResult(l.cryptoObj,t,p,!1,r,d,h,e,s)})()}generateCacheRecord(e,t,n,r,o,i,a){var c=t.getPreferredCache();if(!c)throw zu(ku);var s,l,u=$d(o);e.id_token&&o&&(s=$u(this.homeAccountIdentifier,c,e.id_token,this.clientId,u||""),l=Cy(this.cacheStorage,t,this.homeAccountIdentifier,this.cryptoObj.base64Decode,r.correlationId,o,e.client_info,c,u,a,void 0,this.logger));var d=null;if(e.access_token){var h=e.scope?Ud.fromString(e.scope):new Ud(r.scopes||[]),g=("string"==typeof e.expires_in?parseInt(e.expires_in,10):e.expires_in)||0,f=("string"==typeof e.ext_expires_in?parseInt(e.ext_expires_in,10):e.ext_expires_in)||0,p=("string"==typeof e.refresh_in?parseInt(e.refresh_in,10):e.refresh_in)||void 0,v=n+g,m=v+f,y=p&&p>0?n+p:void 0;d=ed(this.homeAccountIdentifier,c,e.access_token,this.clientId,u||t.tenant||"",h.printScopes(),v,m,this.cryptoObj.base64Decode,y,e.token_type,i,e.key_id,r.claims,r.requestedClaimsHash)}var w,b=null;e.refresh_token&&(e.refresh_token_expires_in&&(w=n+("string"==typeof e.refresh_token_expires_in?parseInt(e.refresh_token_expires_in,10):e.refresh_token_expires_in)),b=td(this.homeAccountIdentifier,c,e.refresh_token,this.clientId,e.foci,i,w));var C=null;return e.foci&&(C={clientId:this.clientId,environment:c,familyId:e.foci}),{account:l,idToken:s,accessToken:d,refreshToken:b,appMetadata:C}}static generateAuthenticationResult(e,t,n,r,o,i,a,c,s){return wy(function*(){var l,u,d,h,g,f,p,v=Js.EMPTY_STRING,m=[],y=null,w=Js.EMPTY_STRING;if(n.accessToken){if(n.accessToken.tokenType!==xl.POP||o.popKid)v=n.accessToken.secret;else{var b=new vy(e),{secret:C,keyId:k}=n.accessToken;if(!k)throw zu(Ru);v=yield b.signPopToken(C,k,o)}m=Ud.fromString(n.accessToken.target).asArray(),y=new Date(1e3*Number(n.accessToken.expiresOn)),f=new Date(1e3*Number(n.accessToken.extendedExpiresOn)),n.accessToken.refreshOn&&(p=new Date(1e3*Number(n.accessToken.refreshOn)))}n.appMetadata&&(w=n.appMetadata.familyId===El?El:"");var S=(null==i?void 0:i.oid)||(null==i?void 0:i.sub)||"",I=(null==i?void 0:i.tid)||"";null!=c&&c.spa_accountid&&n.account&&(n.account.nativeAccountId=null==c?void 0:c.spa_accountid);var E=n.account?Jd(n.account.getAccountInfo(),void 0,i,null===(l=n.idToken)||void 0===l?void 0:l.secret):null;return{authority:t.canonicalAuthority,uniqueId:S,tenantId:I,scopes:m,account:E,idToken:(null==n||null===(u=n.idToken)||void 0===u?void 0:u.secret)||"",idTokenClaims:i||{},accessToken:v,fromCache:r,expiresOn:y,extExpiresOn:f,refreshOn:p,correlationId:o.correlationId,requestId:s||Js.EMPTY_STRING,familyId:w,tokenType:(null===(d=n.accessToken)||void 0===d?void 0:d.tokenType)||Js.EMPTY_STRING,state:a?a.userRequestState:Js.EMPTY_STRING,cloudGraphHostName:(null===(h=n.account)||void 0===h?void 0:h.cloudGraphHostName)||Js.EMPTY_STRING,msGraphHost:(null===(g=n.account)||void 0===g?void 0:g.msGraphHost)||Js.EMPTY_STRING,code:null==c?void 0:c.spa_code,fromNativeBroker:!1}})()}}function Cy(e,t,n,r,o,i,a,c,s,l,u,d){null==d||d.verbose("setCachedAccount called");var h=e.getAccountKeys().find(e=>e.startsWith(n)),g=null;h&&(g=e.getAccount(h,o,d));var f=g||eh.createAccount({homeAccountId:n,idTokenClaims:i,clientInfo:a,environment:c,cloudGraphHostName:null==l?void 0:l.cloud_graph_host_name,msGraphHost:null==l?void 0:l.msgraph_host,nativeAccountId:u},t,r),p=f.tenantProfiles||[],v=s||f.realm;if(v&&!p.find(e=>e.tenantId===v)){var m=Xd(n,f.localAccountId,v,i);p.push(m)}return f.tenantProfiles=p,f}function ky(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function Sy(e,t,n){return Iy.apply(this,arguments)}function Iy(){var e;return e=function*(e,t,n){return"string"==typeof e?e:e({clientId:t,tokenEndpoint:n})},Iy=function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){ky(i,r,o,a,c,"next",e)}function c(e){ky(i,r,o,a,c,"throw",e)}a(void 0)})},Iy.apply(this,arguments)}function Ey(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function _y(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){Ey(i,r,o,a,c,"next",e)}function c(e){Ey(i,r,o,a,c,"throw",e)}a(void 0)})}}class Ty extends dy{constructor(e,t){var n;super(e,t),this.includeRedirectUri=!0,this.oidcDefaultScopes=null===(n=this.config.authOptions.authority.options.OIDCOptions)||void 0===n?void 0:n.defaultScopes}getAuthCodeUrl(e){var t=this;return _y(function*(){var n;null===(n=t.performanceClient)||void 0===n||n.addQueueMeasurement(Cg,e.correlationId);var r=yield tm(t.createAuthCodeUrlQueryString.bind(t),Og,t.logger,t.performanceClient,e.correlationId)(e);return rh.appendQueryString(t.authority.authorizationEndpoint,r)})()}acquireToken(e,t){var n=this;return _y(function*(){var r,o;if(null===(r=n.performanceClient)||void 0===r||r.addQueueMeasurement(Eg,e.correlationId),!e.code)throw zu(gu);var i=Qu(),a=yield tm(n.executeTokenRequest.bind(n),_g,n.logger,n.performanceClient,e.correlationId)(n.authority,e),c=null===(o=a.headers)||void 0===o?void 0:o[ol],s=new by(n.config.authOptions.clientId,n.cacheManager,n.cryptoUtils,n.logger,n.config.serializableCache,n.config.persistencePlugin,n.performanceClient);return s.validateTokenResponse(a.body),tm(s.handleServerTokenResponse.bind(s),Mg,n.logger,n.performanceClient,e.correlationId)(a.body,n.authority,i,e,t,void 0,void 0,void 0,c)})()}handleFragmentResponse(e,t){if(new by(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,null,null).validateServerAuthorizationCodeResponse(e,t),!e.code)throw zu(Mu);return e}getLogoutUri(e){if(!e)throw Ld(Id);var t=this.createLogoutUrlQueryString(e);return rh.appendQueryString(this.authority.endSessionEndpoint,t)}executeTokenRequest(e,t){var n=this;return _y(function*(){var r,o;null===(r=n.performanceClient)||void 0===r||r.addQueueMeasurement(_g,t.correlationId);var i=n.createTokenQueryParameters(t),a=rh.appendQueryString(e.tokenEndpoint,i),c=yield tm(n.createTokenRequestBody.bind(n),Tg,n.logger,n.performanceClient,t.correlationId)(t),s=void 0;if(t.clientInfo)try{var l=zd(t.clientInfo,n.cryptoUtils.base64Decode);s={credential:"".concat(l.uid).concat(".").concat(l.utid),type:Sm}}catch(e){n.logger.verbose("Could not parse client info for CCS Header: "+e)}var u=n.createTokenRequestHeaders(s||t.ccsCredential),d={clientId:(null===(o=t.tokenBodyParameters)||void 0===o?void 0:o.clientId)||n.config.authOptions.clientId,authority:e.canonicalAuthority,scopes:t.scopes,claims:t.claims,authenticationScheme:t.authenticationScheme,resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,sshKid:t.sshKid};return tm(n.executePostToTokenEndpoint.bind(n),$h,n.logger,n.performanceClient,t.correlationId)(a,c,u,d,t.correlationId,$h)})()}createTokenRequestBody(e){var t=this;return _y(function*(){var n,r;null===(n=t.performanceClient)||void 0===n||n.addQueueMeasurement(Tg,e.correlationId);var o=new iy(e.correlationId,t.performanceClient);if(o.addClientId(e.embeddedClientId||(null===(r=e.tokenBodyParameters)||void 0===r?void 0:r[Zm])||t.config.authOptions.clientId),t.includeRedirectUri?o.addRedirectUri(e.redirectUri):oy.validateRedirectUri(e.redirectUri),o.addScopes(e.scopes,!0,t.oidcDefaultScopes),o.addAuthorizationCode(e.code),o.addLibraryInfo(t.config.libraryInfo),o.addApplicationTelemetry(t.config.telemetry.application),o.addThrottling(),t.serverTelemetryManager&&!Rh(t.config)&&o.addServerTelemetry(t.serverTelemetryManager),e.codeVerifier&&o.addCodeVerifier(e.codeVerifier),t.config.clientCredentials.clientSecret&&o.addClientSecret(t.config.clientCredentials.clientSecret),t.config.clientCredentials.clientAssertion){var i=t.config.clientCredentials.clientAssertion;o.addClientAssertion(yield Sy(i.assertion,t.config.authOptions.clientId,e.resourceRequestUri)),o.addClientAssertionType(i.assertionType)}if(o.addGrantType("authorization_code"),o.addClientInfo(),e.authenticationScheme===xl.POP){var a,c=new vy(t.cryptoUtils,t.performanceClient);a=e.popKid?t.cryptoUtils.encodeKid(e.popKid):(yield tm(c.generateCnf.bind(c),Ag,t.logger,t.performanceClient,e.correlationId)(e,t.logger)).reqCnfString,o.addPopToken(a)}else if(e.authenticationScheme===xl.SSH){if(!e.sshJwk)throw Ld(Pd);o.addSshJwk(e.sshJwk)}(!Bd.isEmptyObj(e.claims)||t.config.authOptions.clientCapabilities&&t.config.authOptions.clientCapabilities.length>0)&&o.addClaims(e.claims,t.config.authOptions.clientCapabilities);var s=void 0;if(e.clientInfo)try{var l=zd(e.clientInfo,t.cryptoUtils.base64Decode);s={credential:"".concat(l.uid).concat(".").concat(l.utid),type:Sm}}catch(e){t.logger.verbose("Could not parse client info for CCS Header: "+e)}else s=e.ccsCredential;if(t.config.systemOptions.preventCorsPreflight&&s)switch(s.type){case Sm:try{var u=Kd(s.credential);o.addCcsOid(u)}catch(e){t.logger.verbose("Could not parse home account ID for CCS Header: "+e)}break;case Im:o.addCcsUpn(s.credential)}return e.embeddedClientId&&o.addBrokerParameters({brokerClientId:t.config.authOptions.clientId,brokerRedirectUri:t.config.authOptions.redirectUri}),e.tokenBodyParameters&&o.addExtraQueryParameters(e.tokenBodyParameters),!e.enableSpaAuthorizationCode||e.tokenBodyParameters&&e.tokenBodyParameters[ey]||o.addExtraQueryParameters({[ey]:"1"}),o.createQueryString()})()}createAuthCodeUrlQueryString(e){var t=this;return _y(function*(){var n,r,o=e.correlationId||t.config.cryptoInterface.createNewGuid();null===(n=t.performanceClient)||void 0===n||n.addQueueMeasurement(Og,o);var i=new iy(o,t.performanceClient);i.addClientId(e.embeddedClientId||(null===(r=e.extraQueryParameters)||void 0===r?void 0:r[Zm])||t.config.authOptions.clientId);var a=[...e.scopes||[],...e.extraScopesToConsent||[]];if(i.addScopes(a,!0,t.oidcDefaultScopes),i.addRedirectUri(e.redirectUri),i.addCorrelationId(o),i.addResponseMode(e.responseMode),i.addResponseTypeCode(),i.addLibraryInfo(t.config.libraryInfo),Rh(t.config)||i.addApplicationTelemetry(t.config.telemetry.application),i.addClientInfo(),e.codeChallenge&&e.codeChallengeMethod&&i.addCodeChallengeParams(e.codeChallenge,e.codeChallengeMethod),e.prompt&&i.addPrompt(e.prompt),e.domainHint&&i.addDomainHint(e.domainHint),e.prompt!==ml.SELECT_ACCOUNT)if(e.sid&&e.prompt===ml.NONE)t.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from request"),i.addSid(e.sid);else if(e.account){var c=t.extractAccountSid(e.account),s=t.extractLoginHint(e.account);if(s&&e.domainHint&&(t.logger.warning('AuthorizationCodeClient.createAuthCodeUrlQueryString: "domainHint" param is set, skipping opaque "login_hint" claim. Please consider not passing domainHint'),s=null),s){t.logger.verbose("createAuthCodeUrlQueryString: login_hint claim present on account"),i.addLoginHint(s);try{var l=Kd(e.account.homeAccountId);i.addCcsOid(l)}catch(e){t.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(c&&e.prompt===ml.NONE){t.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from account"),i.addSid(c);try{var u=Kd(e.account.homeAccountId);i.addCcsOid(u)}catch(e){t.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(e.loginHint)t.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from request"),i.addLoginHint(e.loginHint),i.addCcsUpn(e.loginHint);else if(e.account.username){t.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from account"),i.addLoginHint(e.account.username);try{var d=Kd(e.account.homeAccountId);i.addCcsOid(d)}catch(e){t.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}}else e.loginHint&&(t.logger.verbose("createAuthCodeUrlQueryString: No account, adding login_hint from request"),i.addLoginHint(e.loginHint),i.addCcsUpn(e.loginHint));else t.logger.verbose("createAuthCodeUrlQueryString: Prompt is select_account, ignoring account hints");if(e.nonce&&i.addNonce(e.nonce),e.state&&i.addState(e.state),(e.claims||t.config.authOptions.clientCapabilities&&t.config.authOptions.clientCapabilities.length>0)&&i.addClaims(e.claims,t.config.authOptions.clientCapabilities),e.embeddedClientId&&i.addBrokerParameters({brokerClientId:t.config.authOptions.clientId,brokerRedirectUri:t.config.authOptions.redirectUri}),t.addExtraQueryParams(e,i),e.nativeBroker&&(i.addNativeBroker(),e.authenticationScheme===xl.POP)){var h,g=new vy(t.cryptoUtils);h=e.popKid?t.cryptoUtils.encodeKid(e.popKid):(yield tm(g.generateCnf.bind(g),Ag,t.logger,t.performanceClient,e.correlationId)(e,t.logger)).reqCnfString,i.addPopToken(h)}return i.createQueryString()})()}createLogoutUrlQueryString(e){var t=new iy(e.correlationId,this.performanceClient);return e.postLogoutRedirectUri&&t.addPostLogoutRedirectUri(e.postLogoutRedirectUri),e.correlationId&&t.addCorrelationId(e.correlationId),e.idTokenHint&&t.addIdTokenHint(e.idTokenHint),e.state&&t.addState(e.state),e.logoutHint&&t.addLogoutHint(e.logoutHint),this.addExtraQueryParams(e,t),t.createQueryString()}addExtraQueryParams(e,t){!(e.extraQueryParameters&&e.extraQueryParameters.hasOwnProperty("instance_aware"))&&this.config.authOptions.instanceAware&&(e.extraQueryParameters=e.extraQueryParameters||{},e.extraQueryParameters.instance_aware="true"),e.extraQueryParameters&&t.addExtraQueryParameters(e.extraQueryParameters)}extractAccountSid(e){var t;return(null===(t=e.idTokenClaims)||void 0===t?void 0:t.sid)||null}extractLoginHint(e){var t;return(null===(t=e.idTokenClaims)||void 0===t?void 0:t.login_hint)||null}}class Oy{constructor(e,t){this.cacheOutcome="0",this.cacheManager=t,this.apiId=e.apiId,this.correlationId=e.correlationId,this.wrapperSKU=e.wrapperSKU||Js.EMPTY_STRING,this.wrapperVer=e.wrapperVer||Js.EMPTY_STRING,this.telemetryCacheKey=Ml.CACHE_KEY+kl+e.clientId}generateCurrentRequestHeaderValue(){var e="".concat(this.apiId).concat(Ml.VALUE_SEPARATOR).concat(this.cacheOutcome),t=[this.wrapperSKU,this.wrapperVer],n=this.getNativeBrokerErrorCode();null!=n&&n.length&&t.push("broker_error=".concat(n));var r=t.join(Ml.VALUE_SEPARATOR),o=[e,this.getRegionDiscoveryFields()].join(Ml.VALUE_SEPARATOR);return[Ml.SCHEMA_VERSION,o,r].join(Ml.CATEGORY_SEPARATOR)}generateLastRequestHeaderValue(){var e=this.getLastRequests(),t=Oy.maxErrorsToSend(e),n=e.failedRequests.slice(0,2*t).join(Ml.VALUE_SEPARATOR),r=e.errors.slice(0,t).join(Ml.VALUE_SEPARATOR),o=e.errors.length,i=[o,t<o?Ml.OVERFLOW_TRUE:Ml.OVERFLOW_FALSE].join(Ml.VALUE_SEPARATOR);return[Ml.SCHEMA_VERSION,e.cacheHits,n,r,i].join(Ml.CATEGORY_SEPARATOR)}cacheFailedRequest(e){var t=this.getLastRequests();t.errors.length>=Ml.MAX_CACHED_ERRORS&&(t.failedRequests.shift(),t.failedRequests.shift(),t.errors.shift()),t.failedRequests.push(this.apiId,this.correlationId),e instanceof Error&&e&&e.toString()?e instanceof Wl?e.subError?t.errors.push(e.subError):e.errorCode?t.errors.push(e.errorCode):t.errors.push(e.toString()):t.errors.push(e.toString()):t.errors.push(Ml.UNKNOWN_ERROR),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t,this.correlationId)}incrementCacheHits(){var e=this.getLastRequests();return e.cacheHits+=1,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e,this.correlationId),e.cacheHits}getLastRequests(){return this.cacheManager.getServerTelemetry(this.telemetryCacheKey)||{failedRequests:[],errors:[],cacheHits:0}}clearTelemetryCache(){var e=this.getLastRequests(),t=Oy.maxErrorsToSend(e);if(t===e.errors.length)this.cacheManager.removeItem(this.telemetryCacheKey,this.correlationId);else{var n={failedRequests:e.failedRequests.slice(2*t),errors:e.errors.slice(t),cacheHits:0};this.cacheManager.setServerTelemetry(this.telemetryCacheKey,n,this.correlationId)}}static maxErrorsToSend(e){var t,n=0,r=0,o=e.errors.length;for(t=0;t<o;t++){var i=e.failedRequests[2*t]||Js.EMPTY_STRING,a=e.failedRequests[2*t+1]||Js.EMPTY_STRING,c=e.errors[t]||Js.EMPTY_STRING;if(!((r+=i.toString().length+a.toString().length+c.length+3)<Ml.MAX_LAST_HEADER_BYTES))break;n+=1}return n}getRegionDiscoveryFields(){var e=[];return e.push(this.regionUsed||Js.EMPTY_STRING),e.push(this.regionSource||Js.EMPTY_STRING),e.push(this.regionOutcome||Js.EMPTY_STRING),e.join(",")}updateRegionDiscoveryMetadata(e){this.regionUsed=e.region_used,this.regionSource=e.region_source,this.regionOutcome=e.region_outcome}setCacheOutcome(e){this.cacheOutcome=e}setNativeBrokerErrorCode(e){var t=this.getLastRequests();t.nativeBrokerErrorCode=e,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t,this.correlationId)}getNativeBrokerErrorCode(){return this.getLastRequests().nativeBrokerErrorCode}clearNativeBrokerErrorCode(){var e=this.getLastRequests();delete e.nativeBrokerErrorCode,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e,this.correlationId)}static makeExtraSkuString(e){return function(e){var{skus:t,libraryName:n,libraryVersion:r,extensionName:o,extensionVersion:i}=e,a=new Map([[0,[n,r]],[2,[o,i]]]),c=[];if(null!=t&&t.length){if((c=t.split(",")).length<4)return t}else c=Array.from({length:4},()=>"|");return a.forEach((e,t)=>{var n,r;2===e.length&&null!==(n=e[0])&&void 0!==n&&n.length&&null!==(r=e[1])&&void 0!==r&&r.length&&function(e){var{skuArr:t,index:n,skuName:r,skuVersion:o}=e;n>=t.length||(t[n]=[r,o].join("|"))}({skuArr:c,index:t,skuName:e[0],skuVersion:e[1]})}),c.join(",")}(e)}}function Ay(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function Py(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){Ay(i,r,o,a,c,"next",e)}function c(e){Ay(i,r,o,a,c,"throw",e)}a(void 0)})}}class My{constructor(e,t,n,r,o,i,a,c,s){this.config=e,this.browserStorage=t,this.browserCrypto=n,this.networkClient=this.config.system.networkClient,this.eventHandler=o,this.navigationClient=i,this.nativeMessageHandler=c,this.correlationId=s||nv(),this.logger=r.clone(sf,Tv,this.correlationId),this.performanceClient=a}clearCacheOnLogout(e){var t=this;return Py(function*(){if(e){eh.accountInfoIsEqual(e,t.browserStorage.getActiveAccount(t.correlationId),!1)&&(t.logger.verbose("Setting active account to null"),t.browserStorage.setActiveAccount(null,t.correlationId));try{yield t.browserStorage.removeAccount(eh.generateAccountCacheKey(e),t.correlationId),t.logger.verbose("Cleared cache items belonging to the account provided in the logout request.")}catch(e){t.logger.error("Account provided in logout request was not found. Local cache unchanged.")}}else try{t.logger.verbose("No account provided in logout request, clearing all cache items.",t.correlationId),yield t.browserStorage.clear(t.correlationId),yield t.browserCrypto.clearKeystore()}catch(e){t.logger.error("Attempted to clear all MSAL cache items and failed. Local cache unchanged.")}})()}getRedirectUri(e){this.logger.verbose("getRedirectUri called");var t=e||this.config.auth.redirectUri;return rh.getAbsoluteUrl(t,mv())}initializeServerTelemetryManager(e,t){this.logger.verbose("initializeServerTelemetryManager called");var n={clientId:this.config.auth.clientId,correlationId:this.correlationId,apiId:e,forceRefresh:t||!1,wrapperSKU:this.browserStorage.getWrapperMetadata()[0],wrapperVer:this.browserStorage.getWrapperMetadata()[1]};return new Oy(n,this.browserStorage)}getDiscoveredAuthority(e){var t=this;return Py(function*(){var{account:n}=e,r=e.requestExtraQueryParameters&&e.requestExtraQueryParameters.hasOwnProperty("instance_aware")?e.requestExtraQueryParameters.instance_aware:void 0;t.performanceClient.addQueueMeasurement(Wh,t.correlationId);var o={protocolMode:t.config.auth.protocolMode,OIDCOptions:t.config.auth.OIDCOptions,knownAuthorities:t.config.auth.knownAuthorities,cloudDiscoveryMetadata:t.config.auth.cloudDiscoveryMetadata,authorityMetadata:t.config.auth.authorityMetadata,skipAuthorityMetadataCache:t.config.auth.skipAuthorityMetadataCache},i=e.requestAuthority||t.config.auth.authority,a=null!=r&&r.length?"true"===r:t.config.auth.instanceAware,c=n&&a?t.config.auth.authority.replace(rh.getDomainFromUrl(i),n.environment):i,s=um.generateAuthority(c,e.requestAzureCloudOptions||t.config.auth.azureCloudOptions),l=yield tm(cy,Ng,t.logger,t.performanceClient,t.correlationId)(s,t.config.system.networkClient,t.browserStorage,o,t.logger,t.correlationId,t.performanceClient);if(n&&!l.isAlias(n.environment))throw Ld(Dd);return l})()}}function xy(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function Ny(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){xy(i,r,o,a,c,"next",e)}function c(e){xy(i,r,o,a,c,"throw",e)}a(void 0)})}}function Ry(e,t,n){return jy.apply(this,arguments)}function jy(){return(jy=Ny(function*(e,t,n){e.addQueueMeasurement(Qg,n);var r=em(Dy,Xg,t,e,n)(e,t,n);return{verifier:r,challenge:yield tm(qy,Jg,t,e,n)(r,e,t,n)}})).apply(this,arguments)}function Dy(e,t,n){try{var r=new Uint8Array(32);return em(ev,ef,t,e,n)(r),zp(r)}catch(e){throw jp(Hf)}}function qy(e,t,n,r){return Hy.apply(this,arguments)}function Hy(){return(Hy=Ny(function*(e,t,n,r){t.addQueueMeasurement(Jg,r);try{var o=yield tm(Jp,$g,n,t,r)(e,t,r);return zp(new Uint8Array(o))}catch(e){throw jp(Hf)}})).apply(this,arguments)}function Ly(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function By(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ly(Object(n),!0).forEach(function(t){Uy(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ly(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Uy(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function zy(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function Ky(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){zy(i,r,o,a,c,"next",e)}function c(e){zy(i,r,o,a,c,"throw",e)}a(void 0)})}}function Fy(e,t,n,r){return Vy.apply(this,arguments)}function Vy(){return(Vy=Ky(function*(e,t,n,r){n.addQueueMeasurement(lg,e.correlationId);var o=e.authority||t.auth.authority,i=[...e&&e.scopes||[]],a=By(By({},e),{},{correlationId:e.correlationId,authority:o,scopes:i});if(a.authenticationScheme){if(a.authenticationScheme===xl.SSH){if(!e.sshJwk)throw Ld(Pd);if(!e.sshKid)throw Ld(Md)}r.verbose('Authentication Scheme set to "'.concat(a.authenticationScheme,'" as configured in Auth request'))}else a.authenticationScheme=xl.BEARER,r.verbose('Authentication Scheme wasn\'t explicitly set in request, defaulting to "Bearer" request');return t.cache.claimsBasedCachingEnabled&&e.claims&&!Bd.isEmptyObj(e.claims)&&(a.requestedClaimsHash=yield sv(e.claims)),a})).apply(this,arguments)}function Yy(e,t,n,r,o){return Gy.apply(this,arguments)}function Gy(){return(Gy=Ky(function*(e,t,n,r,o){r.addQueueMeasurement(ug,e.correlationId);var i=yield tm(Fy,lg,o,r,e.correlationId)(e,n,r,o);return By(By(By({},e),i),{},{account:t,forceRefresh:e.forceRefresh||!1})})).apply(this,arguments)}function Wy(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Zy(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Wy(Object(n),!0).forEach(function(t){Qy(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Wy(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Qy(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Xy(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function Jy(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){Xy(i,r,o,a,c,"next",e)}function c(e){Xy(i,r,o,a,c,"throw",e)}a(void 0)})}}class $y extends My{initializeAuthorizationCodeRequest(e){var t=this;return Jy(function*(){t.performanceClient.addQueueMeasurement(bg,t.correlationId);var n=yield tm(Ry,Qg,t.logger,t.performanceClient,t.correlationId)(t.performanceClient,t.logger,t.correlationId),r=Zy(Zy({},e),{},{redirectUri:e.redirectUri,code:Js.EMPTY_STRING,codeVerifier:n.verifier});return e.codeChallenge=n.challenge,e.codeChallengeMethod=Js.S256_CODE_CHALLENGE_METHOD,r})()}initializeLogoutRequest(e){this.logger.verbose("initializeLogoutRequest called",null==e?void 0:e.correlationId);var t=Zy({correlationId:this.correlationId||nv()},e);if(e)if(e.logoutHint)this.logger.verbose("logoutHint has already been set in logoutRequest");else if(e.account){var n=this.getLogoutHintFromIdTokenClaims(e.account);n&&(this.logger.verbose("Setting logoutHint to login_hint ID Token Claim value for the account provided"),t.logoutHint=n)}else this.logger.verbose("logoutHint was not set and account was not passed into logout request, logoutHint will not be set");else this.logger.verbose("logoutHint will not be set since no logout request was configured");return e&&null===e.postLogoutRedirectUri?this.logger.verbose("postLogoutRedirectUri passed as null, not setting post logout redirect uri",t.correlationId):e&&e.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to uri set on logout request",t.correlationId),t.postLogoutRedirectUri=rh.getAbsoluteUrl(e.postLogoutRedirectUri,mv())):null===this.config.auth.postLogoutRedirectUri?this.logger.verbose("postLogoutRedirectUri configured as null and no uri set on request, not passing post logout redirect",t.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to configured uri",t.correlationId),t.postLogoutRedirectUri=rh.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,mv())):(this.logger.verbose("Setting postLogoutRedirectUri to current page",t.correlationId),t.postLogoutRedirectUri=rh.getAbsoluteUrl(mv(),mv())),t}getLogoutHintFromIdTokenClaims(e){var t=e.idTokenClaims;if(t){if(t.login_hint)return t.login_hint;this.logger.verbose("The ID Token Claims tied to the provided account do not contain a login_hint claim, logoutHint will not be added to logout request")}else this.logger.verbose("The provided account does not contain ID Token Claims, logoutHint will not be added to logout request");return null}createAuthCodeClient(e){var t=this;return Jy(function*(){t.performanceClient.addQueueMeasurement(mg,t.correlationId);var n=yield tm(t.getClientConfiguration.bind(t),yg,t.logger,t.performanceClient,t.correlationId)(e);return new Ty(n,t.performanceClient)})()}getClientConfiguration(e){var t=this;return Jy(function*(){var{serverTelemetryManager:n,requestAuthority:r,requestAzureCloudOptions:o,requestExtraQueryParameters:i,account:a}=e;t.performanceClient.addQueueMeasurement(yg,t.correlationId);var c=yield tm(t.getDiscoveredAuthority.bind(t),Wh,t.logger,t.performanceClient,t.correlationId)({requestAuthority:r,requestAzureCloudOptions:o,requestExtraQueryParameters:i,account:a}),s=t.config.system.loggerOptions;return{authOptions:{clientId:t.config.auth.clientId,authority:c,clientCapabilities:t.config.auth.clientCapabilities,redirectUri:t.config.auth.redirectUri},systemOptions:{tokenRenewalOffsetSeconds:t.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:s.loggerCallback,piiLoggingEnabled:s.piiLoggingEnabled,logLevel:s.logLevel,correlationId:t.correlationId},cacheOptions:{claimsBasedCachingEnabled:t.config.cache.claimsBasedCachingEnabled},cryptoInterface:t.browserCrypto,networkInterface:t.networkClient,storageInterface:t.browserStorage,serverTelemetryManager:n,libraryInfo:{sku:sf,version:Tv,cpu:Js.EMPTY_STRING,os:Js.EMPTY_STRING},telemetry:t.config.telemetry}})()}initializeAuthorizationRequest(e,t){var n=this;return Jy(function*(){n.performanceClient.addQueueMeasurement(wg,n.correlationId);var r=n.getRedirectUri(e.redirectUri),o={interactionType:t},i=km.setRequestState(n.browserCrypto,e&&e.state||Js.EMPTY_STRING,o),a=yield tm(Fy,lg,n.logger,n.performanceClient,n.correlationId)(Zy(Zy({},e),{},{correlationId:n.correlationId}),n.config,n.performanceClient,n.logger),c=Zy(Zy({},a),{},{redirectUri:r,state:i,nonce:e.nonce||nv(),responseMode:n.config.auth.OIDCOptions.serverResponseType});if(e.loginHint||e.sid)return c;var s=e.account||n.browserStorage.getActiveAccount(n.correlationId);if(s&&(n.logger.verbose("Setting validated request account",n.correlationId),n.logger.verbosePii("Setting validated request account: ".concat(s.homeAccountId),n.correlationId),c.account=s),!c.loginHint&&!s){var l=n.browserStorage.getLegacyLoginHint();l&&(c.loginHint=l)}return c})()}}var ew="user_switch",tw={[ew]:"User attempted to switch accounts in the native broker, which is not allowed. All new accounts must sign-in through the standard web flow first, please try again."};class nw extends Wl{constructor(e,t,n){super(e,t),Object.setPrototypeOf(this,nw.prototype),this.name="NativeAuthError",this.ext=n}}function rw(e){return!(!e.ext||!e.ext.status||"PERSISTENT_ERROR"!==e.ext.status&&"DISABLED"!==e.ext.status)||!(!e.ext||!e.ext.error||-2147186943!==e.ext.error)||"ContentError"===e.errorCode}function ow(e,t,n){if(n&&n.status)switch(n.status){case"ACCOUNT_UNAVAILABLE":return Cm(gm);case"USER_INTERACTION_REQUIRED":return new wm(e,t);case"USER_CANCEL":return jp(Zf);case"NO_NETWORK":return jp(hp)}return new nw(e,tw[e]||t,n)}function iw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function aw(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?iw(Object(n),!0).forEach(function(t){cw(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):iw(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function cw(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function sw(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function lw(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){sw(i,r,o,a,c,"next",e)}function c(e){sw(i,r,o,a,c,"throw",e)}a(void 0)})}}class uw extends dy{constructor(e,t){super(e,t)}acquireToken(e){var t=this;return lw(function*(){var n,r;null===(n=t.performanceClient)||void 0===n||n.addQueueMeasurement(tg,e.correlationId);var o=Qu(),i=yield tm(t.executeTokenRequest.bind(t),eg,t.logger,t.performanceClient,e.correlationId)(e,t.authority),a=null===(r=i.headers)||void 0===r?void 0:r[ol],c=new by(t.config.authOptions.clientId,t.cacheManager,t.cryptoUtils,t.logger,t.config.serializableCache,t.config.persistencePlugin);return c.validateTokenResponse(i.body),tm(c.handleServerTokenResponse.bind(c),Mg,t.logger,t.performanceClient,e.correlationId)(i.body,t.authority,o,e,void 0,void 0,!0,e.forceCache,a)})()}acquireTokenByRefreshToken(e){var t=this;return lw(function*(){var n;if(!e)throw Ld(Sd);if(null===(n=t.performanceClient)||void 0===n||n.addQueueMeasurement(rg,e.correlationId),!e.account)throw zu(bu);if(t.cacheManager.isAppMetadataFOCI(e.account.environment))try{return yield tm(t.acquireTokenWithCachedRefreshToken.bind(t),ng,t.logger,t.performanceClient,e.correlationId)(e,!0)}catch(n){var r=n instanceof wm&&n.errorCode===hm,o=n instanceof Gm&&"invalid_grant"===n.errorCode&&"client_mismatch"===n.subError;if(r||o)return tm(t.acquireTokenWithCachedRefreshToken.bind(t),ng,t.logger,t.performanceClient,e.correlationId)(e,!1);throw n}return tm(t.acquireTokenWithCachedRefreshToken.bind(t),ng,t.logger,t.performanceClient,e.correlationId)(e,!1)})()}acquireTokenWithCachedRefreshToken(e,t){var n=this;return lw(function*(){var r;null===(r=n.performanceClient)||void 0===r||r.addQueueMeasurement(ng,e.correlationId);var o=em(n.cacheManager.getRefreshToken.bind(n.cacheManager),Zg,n.logger,n.performanceClient,e.correlationId)(e.account,t,e.correlationId,void 0,n.performanceClient);if(!o)throw Cm(hm);if(o.expiresOn&&Xu(o.expiresOn,e.refreshTokenExpirationOffsetSeconds||300))throw Cm(fm);var i=aw(aw({},e),{},{refreshToken:o.secret,authenticationScheme:e.authenticationScheme||xl.BEARER,ccsCredential:{credential:e.account.homeAccountId,type:Sm}});try{return yield tm(n.acquireToken.bind(n),tg,n.logger,n.performanceClient,e.correlationId)(i)}catch(t){if(t instanceof wm&&t.subError===pm){n.logger.verbose("acquireTokenWithRefreshToken: bad refresh token, removing from cache");var a=Ju(o);n.cacheManager.removeRefreshToken(a,e.correlationId)}throw t}})()}executeTokenRequest(e,t){var n=this;return lw(function*(){var r,o;null===(r=n.performanceClient)||void 0===r||r.addQueueMeasurement(eg,e.correlationId);var i=n.createTokenQueryParameters(e),a=rh.appendQueryString(t.tokenEndpoint,i),c=yield tm(n.createTokenRequestBody.bind(n),og,n.logger,n.performanceClient,e.correlationId)(e),s=n.createTokenRequestHeaders(e.ccsCredential),l={clientId:(null===(o=e.tokenBodyParameters)||void 0===o?void 0:o.clientId)||n.config.authOptions.clientId,authority:t.canonicalAuthority,scopes:e.scopes,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid};return tm(n.executePostToTokenEndpoint.bind(n),Jh,n.logger,n.performanceClient,e.correlationId)(a,c,s,l,e.correlationId,Jh)})()}createTokenRequestBody(e){var t=this;return lw(function*(){var n,r,o;null===(n=t.performanceClient)||void 0===n||n.addQueueMeasurement(og,e.correlationId);var i=e.correlationId,a=new iy(i,t.performanceClient);if(a.addClientId(e.embeddedClientId||(null===(r=e.tokenBodyParameters)||void 0===r?void 0:r[Zm])||t.config.authOptions.clientId),e.redirectUri&&a.addRedirectUri(e.redirectUri),a.addScopes(e.scopes,!0,null===(o=t.config.authOptions.authority.options.OIDCOptions)||void 0===o?void 0:o.defaultScopes),a.addGrantType("refresh_token"),a.addClientInfo(),a.addLibraryInfo(t.config.libraryInfo),a.addApplicationTelemetry(t.config.telemetry.application),a.addThrottling(),t.serverTelemetryManager&&!Rh(t.config)&&a.addServerTelemetry(t.serverTelemetryManager),a.addRefreshToken(e.refreshToken),t.config.clientCredentials.clientSecret&&a.addClientSecret(t.config.clientCredentials.clientSecret),t.config.clientCredentials.clientAssertion){var c=t.config.clientCredentials.clientAssertion;a.addClientAssertion(yield Sy(c.assertion,t.config.authOptions.clientId,e.resourceRequestUri)),a.addClientAssertionType(c.assertionType)}if(e.authenticationScheme===xl.POP){var s,l=new vy(t.cryptoUtils,t.performanceClient);s=e.popKid?t.cryptoUtils.encodeKid(e.popKid):(yield tm(l.generateCnf.bind(l),Ag,t.logger,t.performanceClient,e.correlationId)(e,t.logger)).reqCnfString,a.addPopToken(s)}else if(e.authenticationScheme===xl.SSH){if(!e.sshJwk)throw Ld(Pd);a.addSshJwk(e.sshJwk)}if((!Bd.isEmptyObj(e.claims)||t.config.authOptions.clientCapabilities&&t.config.authOptions.clientCapabilities.length>0)&&a.addClaims(e.claims,t.config.authOptions.clientCapabilities),t.config.systemOptions.preventCorsPreflight&&e.ccsCredential)switch(e.ccsCredential.type){case Sm:try{var u=Kd(e.ccsCredential.credential);a.addCcsOid(u)}catch(e){t.logger.verbose("Could not parse home account ID for CCS Header: "+e)}break;case Im:a.addCcsUpn(e.ccsCredential.credential)}return e.embeddedClientId&&a.addBrokerParameters({brokerClientId:t.config.authOptions.clientId,brokerRedirectUri:t.config.authOptions.redirectUri}),e.tokenBodyParameters&&a.addExtraQueryParameters(e.tokenBodyParameters),a.createQueryString()})()}}function dw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function hw(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?dw(Object(n),!0).forEach(function(t){gw(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dw(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function gw(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function fw(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function pw(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){fw(i,r,o,a,c,"next",e)}function c(e){fw(i,r,o,a,c,"throw",e)}a(void 0)})}}class vw extends dy{constructor(e,t){super(e,t)}acquireToken(e){var t=this;return pw(function*(){try{var n,[r,o]=yield t.acquireCachedToken(hw(hw({},e),{},{scopes:null!==(n=e.scopes)&&void 0!==n&&n.length?e.scopes:[...$s]}));return"4"===o&&(t.logger.info("SilentFlowClient:acquireCachedToken - Cached access token's refreshOn property has been exceeded'. It's not expired, but must be refreshed."),new uw(t.config,t.performanceClient).acquireTokenByRefreshToken(e).catch(()=>{})),r}catch(n){if(n instanceof Uu&&n.errorCode===Ou)return new uw(t.config,t.performanceClient).acquireTokenByRefreshToken(e);throw n}})()}acquireCachedToken(e){var t=this;return pw(function*(){var n;null===(n=t.performanceClient)||void 0===n||n.addQueueMeasurement(ag,e.correlationId);var r="0";if(e.forceRefresh||!t.config.cacheOptions.claimsBasedCachingEnabled&&!Bd.isEmptyObj(e.claims))throw t.setCacheOutcome("1",e.correlationId),zu(Ou);if(!e.account)throw zu(bu);var o,i=e.account.tenantId||function(e){var t,n=null===(t=new rh(e).getUrlComponents().PathSegments.slice(-1)[0])||void 0===t?void 0:t.toLowerCase();switch(n){case gl:case fl:case pl:return;default:return n}}(e.authority),a=t.cacheManager.getTokenKeys(),c=t.cacheManager.getAccessToken(e.account,e,a,i,t.performanceClient);if(!c)throw t.setCacheOutcome("2",e.correlationId),zu(Ou);if(o=c.cachedAt,Number(o)>Qu()||Xu(c.expiresOn,t.config.systemOptions.tokenRenewalOffsetSeconds))throw t.setCacheOutcome("3",e.correlationId),zu(Ou);c.refreshOn&&Xu(c.refreshOn,0)&&(r="4");var s=e.authority||t.authority.getPreferredCache(),l={account:t.cacheManager.readAccountFromCache(e.account,e.correlationId),accessToken:c,idToken:t.cacheManager.getIdToken(e.account,e.correlationId,a,i,t.performanceClient),refreshToken:null,appMetadata:t.cacheManager.readAppMetadataFromCache(s)};return t.setCacheOutcome(r,e.correlationId),t.config.serverTelemetryManager&&t.config.serverTelemetryManager.incrementCacheHits(),[yield tm(t.generateResultFromCacheRecord.bind(t),cg,t.logger,t.performanceClient,e.correlationId)(l,e),r]})()}setCacheOutcome(e,t){var n,r;null===(n=this.serverTelemetryManager)||void 0===n||n.setCacheOutcome(e),null===(r=this.performanceClient)||void 0===r||r.addFields({cacheOutcome:e},t),"0"!==e&&this.logger.info("Token refresh is required due to cache outcome: ".concat(e))}generateResultFromCacheRecord(e,t){var n=this;return pw(function*(){var r,o;if(null===(r=n.performanceClient)||void 0===r||r.addQueueMeasurement(cg,t.correlationId),e.idToken&&(o=Wu(e.idToken.secret,n.config.cryptoInterface.base64Decode)),t.maxAge||0===t.maxAge){var i,a=null===(i=o)||void 0===i?void 0:i.auth_time;if(!a)throw zu(su);Zu(a,t.maxAge)}return by.generateAuthenticationResult(n.cryptoUtils,n.authority,e,!0,t,o)})()}}function mw(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}class yw extends $y{acquireToken(e){var t,n=this;return(t=function*(){n.performanceClient.addQueueMeasurement(Fh,e.correlationId);var t=n.initializeServerTelemetryManager(61),r=yield tm(n.getClientConfiguration.bind(n),yg,n.logger,n.performanceClient,n.correlationId)({serverTelemetryManager:t,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,account:e.account}),o=new vw(r,n.performanceClient);n.logger.verbose("Silent auth client created");try{var i=(yield tm(o.acquireCachedToken.bind(o),ag,n.logger,n.performanceClient,e.correlationId)(e))[0];return n.performanceClient.addFields({fromCache:!0},e.correlationId),i}catch(e){throw e instanceof Rp&&e.errorCode===mp&&n.logger.verbose("Signing keypair for bound access token not found. Refreshing bound access token and generating a new crypto keypair."),e}},function(){var e=this,n=arguments;return new Promise(function(r,o){var i=t.apply(e,n);function a(e){mw(i,r,o,a,c,"next",e)}function c(e){mw(i,r,o,a,c,"throw",e)}a(void 0)})})()}logout(e){this.logger.verbose("logoutRedirect called");var t=this.initializeLogoutRequest(e);return this.clearCacheOnLogout(null==t?void 0:t.account)}}var ww=["prompt"],bw=["scopes"];function Cw(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function kw(e){if(null==e)throw new TypeError("Cannot destructure "+e)}function Sw(){return Sw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Sw.apply(null,arguments)}function Iw(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function Ew(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){Iw(i,r,o,a,c,"next",e)}function c(e){Iw(i,r,o,a,c,"throw",e)}a(void 0)})}}function _w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Tw(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_w(Object(n),!0).forEach(function(t){Ow(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_w(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Ow(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Aw extends My{constructor(e,t,n,r,o,i,a,c,s,l,u,d){var h;super(e,t,n,r,o,i,c,s,d),this.apiId=a,this.accountId=l,this.nativeMessageHandler=s,this.nativeStorageManager=u,this.silentCacheClient=new yw(e,this.nativeStorageManager,n,r,o,i,c,s,d),this.serverTelemetryManager=this.initializeServerTelemetryManager(this.apiId);var g=this.nativeMessageHandler.getExtensionId()===uf?"chrome":null!==(h=this.nativeMessageHandler.getExtensionId())&&void 0!==h&&h.length?"unknown":void 0;this.skus=Oy.makeExtraSkuString({libraryName:sf,libraryVersion:Tv,extensionName:g,extensionVersion:this.nativeMessageHandler.getExtensionVersion()})}addRequestSKUs(e){e.extraParameters=Tw(Tw({},e.extraParameters),{},{[ty]:this.skus})}acquireToken(e){var t=this;return Ew(function*(){t.performanceClient.addQueueMeasurement(Qh,e.correlationId),t.logger.trace("NativeInteractionClient - acquireToken called.");var n=t.performanceClient.startMeasurement(Qh,e.correlationId),r=Qu();try{var o=yield t.initializeNativeRequest(e);try{var i=yield t.acquireTokensFromCache(t.accountId,o);return n.end({success:!0,isNativeBroker:!1,fromCache:!0}),i}catch(e){t.logger.info("MSAL internal Cache does not contain tokens, proceed to make a native call")}var a=Sw({},(kw(o),o)),c={method:hf,request:a},s=yield t.nativeMessageHandler.sendMessage(c),l=t.validateNativeResponse(s);return yield t.handleNativeResponse(l,o,r).then(e=>(n.end({success:!0,isNativeBroker:!0,requestId:e.requestId}),t.serverTelemetryManager.clearNativeBrokerErrorCode(),e)).catch(e=>{throw n.end({success:!1,errorCode:e.errorCode,subErrorCode:e.subError,isNativeBroker:!0}),e})}catch(e){throw e instanceof nw&&t.serverTelemetryManager.setNativeBrokerErrorCode(e.errorCode),e}})()}createSilentCacheRequest(e,t){return{authority:e.authority,correlationId:this.correlationId,scopes:Ud.fromString(e.scope).asArray(),account:t,forceRefresh:!1}}acquireTokensFromCache(e,t){var n=this;return Ew(function*(){if(!e)throw n.logger.warning("NativeInteractionClient:acquireTokensFromCache - No nativeAccountId provided"),zu(Su);var r=n.browserStorage.getBaseAccountInfo({nativeAccountId:e},t.correlationId);if(!r)throw zu(Su);try{var o=n.createSilentCacheRequest(t,r),i=yield n.silentCacheClient.acquireToken(o),a=Tw(Tw({},r),{},{idTokenClaims:null==i?void 0:i.idTokenClaims,idToken:null==i?void 0:i.idToken});return Tw(Tw({},i),{},{account:a})}catch(e){throw e}})()}acquireTokenRedirect(e,t){var n=this;return Ew(function*(){n.logger.trace("NativeInteractionClient - acquireTokenRedirect called.");var r=Sw({},(kw(e),e));delete r.onRedirectNavigate;var o=yield n.initializeNativeRequest(r),i={method:hf,request:o};try{var a=yield n.nativeMessageHandler.sendMessage(i);n.validateNativeResponse(a)}catch(e){if(e instanceof nw&&(n.serverTelemetryManager.setNativeBrokerErrorCode(e.errorCode),rw(e)))throw e}n.browserStorage.setTemporaryCache(Sf,JSON.stringify(o),!0);var c={apiId:Af,timeout:n.config.system.redirectNavigationTimeout,noHistory:!1},s=n.config.auth.navigateToLoginRequestUrl?window.location.href:n.getRedirectUri(e.redirectUri);t.end({success:!0}),yield n.navigationClient.navigateExternal(s,c)})()}handleRedirectPromise(e,t){var n=this;return Ew(function*(){if(n.logger.trace("NativeInteractionClient - handleRedirectPromise called."),!n.browserStorage.isInteractionInProgress(!0))return n.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;var r=n.browserStorage.getCachedNativeRequest();if(!r)return n.logger.verbose("NativeInteractionClient - handleRedirectPromise called but there is no cached request, returning null."),e&&t&&(null==e||e.addFields({errorCode:"no_cached_request"},t)),null;var{prompt:o}=r,i=Cw(r,ww);o&&n.logger.verbose("NativeInteractionClient - handleRedirectPromise called and prompt was included in the original request, removing prompt from cached request to prevent second interaction with native broker window."),n.browserStorage.removeItem(n.browserStorage.generateCacheKey(Sf));var a={method:hf,request:i},c=Qu();try{n.logger.verbose("NativeInteractionClient - handleRedirectPromise sending message to native broker.");var s=yield n.nativeMessageHandler.sendMessage(a);n.validateNativeResponse(s);var l=n.handleNativeResponse(s,i,c);n.browserStorage.setInteractionInProgress(!1);var u=yield l;return n.serverTelemetryManager.clearNativeBrokerErrorCode(),u}catch(e){throw n.browserStorage.setInteractionInProgress(!1),e}})()}logout(){return this.logger.trace("NativeInteractionClient - logout called."),Promise.reject("Logout not implemented yet")}handleNativeResponse(e,t,n){var r=this;return Ew(function*(){var o;r.logger.trace("NativeInteractionClient - handleNativeResponse called.");var i=Wu(e.id_token,Lv),a=r.createHomeAccountIdentifier(e,i);if(a!==(null===(o=r.browserStorage.getAccountInfoFilteredBy({nativeAccountId:t.accountId},r.correlationId))||void 0===o?void 0:o.homeAccountId)&&e.account.id!==t.accountId)throw ow(ew);var c=yield r.getDiscoveredAuthority({requestAuthority:t.authority}),s=Cy(r.browserStorage,c,a,Lv,r.correlationId,i,e.client_info,void 0,i.tid,void 0,e.account.id,r.logger),l=yield r.generateAuthenticationResult(e,t,i,s,c.canonicalAuthority,n);return r.cacheAccount(s),r.cacheNativeTokens(e,t,a,i,e.access_token,l.tenantId,n),l})()}createHomeAccountIdentifier(e,t){return eh.generateHomeAccountId(e.client_info||Js.EMPTY_STRING,0,this.logger,this.browserCrypto,t)}generateScopes(e,t){return e.scope?Ud.fromString(e.scope):Ud.fromString(t.scope)}generatePopAccessToken(e,t){var n=this;return Ew(function*(){if(t.tokenType===xl.POP&&t.signPopToken){if(e.shr)return n.logger.trace("handleNativeServerResponse: SHR is enabled in native layer"),e.shr;var r=new vy(n.browserCrypto),o={resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,shrNonce:t.shrNonce};if(!t.keyId)throw zu(Ru);return r.signPopToken(e.access_token,t.keyId,o)}return e.access_token})()}generateAuthenticationResult(e,t,n,r,o,i){var a=this;return Ew(function*(){var c=a.addTelemetryFromNativeResponse(e),s=e.scope?Ud.fromString(e.scope):Ud.fromString(t.scope),l=e.account.properties||{},u=l.UID||n.oid||n.sub||Js.EMPTY_STRING,d=l.TenantId||n.tid||Js.EMPTY_STRING,h=Jd(r.getAccountInfo(),void 0,n,e.id_token);h.nativeAccountId!==e.account.id&&(h.nativeAccountId=e.account.id);var g=yield a.generatePopAccessToken(e,t),f=t.tokenType===xl.POP?xl.POP:xl.BEARER;return{authority:o,uniqueId:u,tenantId:d,scopes:s.asArray(),account:h,idToken:e.id_token,idTokenClaims:n,accessToken:g,fromCache:!!c&&a.isResponseFromCache(c),expiresOn:new Date(1e3*Number(i+e.expires_in)),tokenType:f,correlationId:a.correlationId,state:e.state,fromNativeBroker:!0}})()}cacheAccount(e){this.browserStorage.setAccount(e,this.correlationId),this.browserStorage.removeAccountContext(e,this.correlationId).catch(e=>{this.logger.error("Error occurred while removing account context from browser storage. ".concat(e))})}cacheNativeTokens(e,t,n,r,o,i,a){var c=$u(n,t.authority,e.id_token||"",t.clientId,r.tid||""),s=a+(t.tokenType===xl.POP?Js.SHR_NONCE_VALIDITY:("string"==typeof e.expires_in?parseInt(e.expires_in,10):e.expires_in)||0),l=this.generateScopes(e,t),u={idToken:c,accessToken:ed(n,t.authority,o,t.clientId,r.tid||i,l.printScopes(),s,0,Lv,void 0,t.tokenType,void 0,t.keyId)};this.nativeStorageManager.saveCacheRecord(u,t.correlationId,t.storeInCache)}addTelemetryFromNativeResponse(e){var t=this.getMATSFromResponse(e);return t?(this.performanceClient.addFields({extensionId:this.nativeMessageHandler.getExtensionId(),extensionVersion:this.nativeMessageHandler.getExtensionVersion(),matsBrokerVersion:t.broker_version,matsAccountJoinOnStart:t.account_join_on_start,matsAccountJoinOnEnd:t.account_join_on_end,matsDeviceJoin:t.device_join,matsPromptBehavior:t.prompt_behavior,matsApiErrorCode:t.api_error_code,matsUiVisible:t.ui_visible,matsSilentCode:t.silent_code,matsSilentBiSubCode:t.silent_bi_sub_code,matsSilentMessage:t.silent_message,matsSilentStatus:t.silent_status,matsHttpStatus:t.http_status,matsHttpEventCount:t.http_event_count},this.correlationId),t):null}validateNativeResponse(e){if(e.hasOwnProperty("access_token")&&e.hasOwnProperty("id_token")&&e.hasOwnProperty("client_info")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scope")&&e.hasOwnProperty("expires_in"))return e;throw Zl(Vl,"Response missing expected properties.")}getMATSFromResponse(e){if(e.properties.MATS)try{return JSON.parse(e.properties.MATS)}catch(e){this.logger.error("NativeInteractionClient - Error parsing MATS telemetry, returning null instead")}return null}isResponseFromCache(e){return void 0===e.is_cached?(this.logger.verbose("NativeInteractionClient - MATS telemetry does not contain field indicating if response was served from cache. Returning false."),!1):!!e.is_cached}initializeNativeRequest(e){var t=this;return Ew(function*(){t.logger.trace("NativeInteractionClient - initializeNativeRequest called");var n=e.authority||t.config.auth.authority;e.account&&(yield t.getDiscoveredAuthority({requestAuthority:n,requestAzureCloudOptions:e.azureCloudOptions,account:e.account}));var r=new rh(n);r.validateAsUri();var{scopes:o}=e,i=Cw(e,bw),a=new Ud(o||[]);a.appendScopes($s);var c=Tw(Tw({},i),{},{accountId:t.accountId,clientId:t.config.auth.clientId,authority:r.urlString,scope:a.printScopes(),redirectUri:t.getRedirectUri(e.redirectUri),prompt:(()=>{switch(t.apiId){case 863:case 61:return t.logger.trace("initializeNativeRequest: silent request sets prompt to none"),ml.NONE}if(e.prompt)switch(e.prompt){case ml.NONE:case ml.CONSENT:case ml.LOGIN:return t.logger.trace("initializeNativeRequest: prompt is compatible with native flow"),e.prompt;default:throw t.logger.trace("initializeNativeRequest: prompt = ".concat(e.prompt," is not compatible with native flow")),jp(Tp)}else t.logger.trace("initializeNativeRequest: prompt was not provided")})(),correlationId:t.correlationId,tokenType:e.authenticationScheme,windowTitleSubstring:document.title,extraParameters:Tw(Tw({},e.extraQueryParameters),e.tokenQueryParameters),extendedExpiryToken:!1,keyId:e.popKid});if(c.signPopToken&&e.popKid)throw jp(Ap);if(t.handleExtraBrokerParams(c),c.extraParameters=c.extraParameters||{},c.extraParameters.telemetry="MATS",e.authenticationScheme===xl.POP){var s,l={resourceRequestUri:e.resourceRequestUri,resourceRequestMethod:e.resourceRequestMethod,shrClaims:e.shrClaims,shrNonce:e.shrNonce},u=new vy(t.browserCrypto);if(c.keyId)s=t.browserCrypto.base64UrlEncode(JSON.stringify({kid:c.keyId})),c.signPopToken=!1;else{var d=yield tm(u.generateCnf.bind(u),Ag,t.logger,t.performanceClient,e.correlationId)(l,t.logger);s=d.reqCnfString,c.keyId=d.kid,c.signPopToken=!0}c.reqCnf=s}return t.addRequestSKUs(c),c})()}handleExtraBrokerParams(e){var t,n=e.extraParameters&&e.extraParameters.hasOwnProperty(ny)&&e.extraParameters.hasOwnProperty(ry)&&e.extraParameters.hasOwnProperty(Zm);if(e.embeddedClientId||n){var r="",o=e.redirectUri;e.embeddedClientId?(e.redirectUri=this.config.auth.redirectUri,r=e.embeddedClientId):e.extraParameters&&(e.redirectUri=e.extraParameters[ry],r=e.extraParameters[Zm]),e.extraParameters={child_client_id:r,child_redirect_uri:o},null===(t=this.performanceClient)||void 0===t||t.addFields({embeddedClientId:r,embeddedRedirectUri:o},e.correlationId)}}}function Pw(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function Mw(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){Pw(i,r,o,a,c,"next",e)}function c(e){Pw(i,r,o,a,c,"throw",e)}a(void 0)})}}class xw{constructor(e,t,n,r){this.logger=e,this.handshakeTimeoutMs=t,this.extensionId=r,this.resolvers=new Map,this.handshakeResolvers=new Map,this.messageChannel=new MessageChannel,this.windowListener=this.onWindowMessage.bind(this),this.performanceClient=n,this.handshakeEvent=n.startMeasurement(Yg)}sendMessage(e){var t=this;return Mw(function*(){t.logger.trace("NativeMessageHandler - sendMessage called.");var n={channel:lf,extensionId:t.extensionId,responseId:nv(),body:e};return t.logger.trace("NativeMessageHandler - Sending request to browser extension"),t.logger.tracePii("NativeMessageHandler - Sending request to browser extension: ".concat(JSON.stringify(n))),t.messageChannel.port1.postMessage(n),new Promise((e,r)=>{t.resolvers.set(n.responseId,{resolve:e,reject:r})})})()}static createProvider(e,t,n){return Mw(function*(){e.trace("NativeMessageHandler - createProvider called.");try{var r=new xw(e,t,n,uf);return yield r.sendHandshakeRequest(),r}catch(r){var o=new xw(e,t,n);return yield o.sendHandshakeRequest(),o}})()}sendHandshakeRequest(){var e=this;return Mw(function*(){e.logger.trace("NativeMessageHandler - sendHandshakeRequest called."),window.addEventListener("message",e.windowListener,!1);var t={channel:lf,extensionId:e.extensionId,responseId:nv(),body:{method:df}};return e.handshakeEvent.add({extensionId:e.extensionId,extensionHandshakeTimeoutMs:e.handshakeTimeoutMs}),e.messageChannel.port1.onmessage=t=>{e.onChannelMessage(t)},window.postMessage(t,window.origin,[e.messageChannel.port2]),new Promise((n,r)=>{e.handshakeResolvers.set(t.responseId,{resolve:n,reject:r}),e.timeoutId=window.setTimeout(()=>{window.removeEventListener("message",e.windowListener,!1),e.messageChannel.port1.close(),e.messageChannel.port2.close(),e.handshakeEvent.end({extensionHandshakeTimedOut:!0,success:!1}),r(jp(Sp)),e.handshakeResolvers.delete(t.responseId)},e.handshakeTimeoutMs)})})()}onWindowMessage(e){if(this.logger.trace("NativeMessageHandler - onWindowMessage called"),e.source===window){var t=e.data;if(t.channel&&t.channel===lf&&(!t.extensionId||t.extensionId===this.extensionId)&&t.body.method===df){var n=this.handshakeResolvers.get(t.responseId);if(!n)return void this.logger.trace("NativeMessageHandler.onWindowMessage - resolver can't be found for request ".concat(t.responseId));this.logger.verbose(t.extensionId?"Extension with id: ".concat(t.extensionId," not installed"):"No extension installed"),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1),this.handshakeEvent.end({success:!1,extensionInstalled:!1}),n.reject(jp(Ip))}}}onChannelMessage(e){this.logger.trace("NativeMessageHandler - onChannelMessage called.");var t=e.data,n=this.resolvers.get(t.responseId),r=this.handshakeResolvers.get(t.responseId);try{var o=t.body.method;if("Response"===o){if(!n)return;var i=t.body.response;if(this.logger.trace("NativeMessageHandler - Received response from browser extension"),this.logger.tracePii("NativeMessageHandler - Received response from browser extension: ".concat(JSON.stringify(i))),"Success"!==i.status)n.reject(ow(i.code,i.description,i.ext));else{if(!i.result)throw Zl(Vl,"Event does not contain result.");i.result.code&&i.result.description?n.reject(ow(i.result.code,i.result.description,i.result.ext)):n.resolve(i.result)}this.resolvers.delete(t.responseId)}else if("HandshakeResponse"===o){if(!r)return void this.logger.trace("NativeMessageHandler.onChannelMessage - resolver can't be found for request ".concat(t.responseId));clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=t.extensionId,this.extensionVersion=t.body.version,this.logger.verbose("NativeMessageHandler - Received HandshakeResponse from extension: ".concat(this.extensionId)),this.handshakeEvent.end({extensionInstalled:!0,success:!0}),r.resolve(),this.handshakeResolvers.delete(t.responseId)}}catch(t){this.logger.error("Error parsing response from WAM Extension"),this.logger.errorPii("Error parsing response from WAM Extension: ".concat(t)),this.logger.errorPii("Unable to parse ".concat(e)),n?n.reject(t):r&&r.reject(t)}}getExtensionId(){return this.extensionId}getExtensionVersion(){return this.extensionVersion}static isNativeAvailable(e,t,n,r){if(t.trace("isNativeAvailable called"),!e.system.allowNativeBroker)return t.trace("isNativeAvailable: allowNativeBroker is not enabled, returning false"),!1;if(!n)return t.trace("isNativeAvailable: WAM extension provider is not initialized, returning false"),!1;if(r)switch(r){case xl.BEARER:case xl.POP:return t.trace("isNativeAvailable: authenticationScheme is supported, returning true"),!0;default:return t.trace("isNativeAvailable: authenticationScheme is not supported, returning false"),!1}return!0}}function Nw(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function Rw(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){Nw(i,r,o,a,c,"next",e)}function c(e){Nw(i,r,o,a,c,"throw",e)}a(void 0)})}}class jw{constructor(e,t,n,r,o){this.authModule=e,this.browserStorage=t,this.authCodeRequest=n,this.logger=r,this.performanceClient=o}handleCodeResponse(e,t){var n=this;return Rw(function*(){var r;n.performanceClient.addQueueMeasurement(Sg,t.correlationId);try{r=n.authModule.handleFragmentResponse(e,t.state)}catch(e){throw e instanceof Gm&&e.subError===Zf?jp(Zf):e}return tm(n.handleCodeResponseFromServer.bind(n),kg,n.logger,n.performanceClient,t.correlationId)(r,t)})()}handleCodeResponseFromServer(e,t){var n=arguments,r=this;return Rw(function*(){var o=!(n.length>2&&void 0!==n[2])||n[2];if(r.performanceClient.addQueueMeasurement(kg,t.correlationId),r.logger.trace("InteractionHandler.handleCodeResponseFromServer called"),r.authCodeRequest.code=e.code,e.cloud_instance_host_name&&(yield tm(r.authModule.updateAuthority.bind(r.authModule),Ig,r.logger,r.performanceClient,t.correlationId)(e.cloud_instance_host_name,t.correlationId)),o&&(e.nonce=t.nonce||void 0),e.state=t.state,e.client_info)r.authCodeRequest.clientInfo=e.client_info;else{var i=r.createCcsCredentials(t);i&&(r.authCodeRequest.ccsCredential=i)}return yield tm(r.authModule.acquireToken.bind(r.authModule),Eg,r.logger,r.performanceClient,t.correlationId)(r.authCodeRequest,e)})()}createCcsCredentials(e){return e.account?{credential:e.account.homeAccountId,type:Sm}:e.loginHint?{credential:e.loginHint,type:Im}:null}}function Dw(e,t,n){var r=nh(e);if(!r)throw th(e)?(n.error("A ".concat(t," is present in the iframe but it does not contain known properties. It's likely that the ").concat(t," has been replaced by code running on the redirectUri page.")),n.errorPii("The ".concat(t," detected is: ").concat(e)),jp(Kf)):(n.error("The request has returned to the redirectUri but a ".concat(t," is not present. It's likely that the ").concat(t," has been removed or the page has been redirected by code running on the redirectUri page.")),jp(Uf));return r}function qw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Hw(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qw(Object(n),!0).forEach(function(t){Lw(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qw(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Lw(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Bw(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function Uw(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){Bw(i,r,o,a,c,"next",e)}function c(e){Bw(i,r,o,a,c,"throw",e)}a(void 0)})}}class zw extends $y{constructor(e,t,n,r,o,i,a,c,s,l){super(e,t,n,r,o,i,a,s,l),this.unloadWindow=this.unloadWindow.bind(this),this.nativeStorage=c}acquireToken(e){try{var t,n={popupName:this.generatePopupName(e.scopes||$s,e.authority||this.config.auth.authority),popupWindowAttributes:e.popupWindowAttributes||{},popupWindowParent:null!==(t=e.popupWindowParent)&&void 0!==t?t:window};return this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true, acquiring token"),this.acquireTokenPopupAsync(e,n)):(this.logger.verbose("asyncPopup set to false, opening popup before acquiring token"),n.popup=this.openSizedPopup("about:blank",n),this.acquireTokenPopupAsync(e,n))}catch(e){return Promise.reject(e)}}logout(e){try{var t;this.logger.verbose("logoutPopup called");var n=this.initializeLogoutRequest(e),r={popupName:this.generateLogoutPopupName(n),popupWindowAttributes:(null==e?void 0:e.popupWindowAttributes)||{},popupWindowParent:null!==(t=null==e?void 0:e.popupWindowParent)&&void 0!==t?t:window},o=e&&e.authority,i=e&&e.mainWindowRedirectUri;return this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true"),this.logoutPopupAsync(n,r,o,i)):(this.logger.verbose("asyncPopup set to false, opening popup"),r.popup=this.openSizedPopup("about:blank",r),this.logoutPopupAsync(n,r,o,i))}catch(e){return Promise.reject(e)}}acquireTokenPopupAsync(e,t){var n=this;return Uw(function*(){n.logger.verbose("acquireTokenPopupAsync called");var r=n.initializeServerTelemetryManager(Pf),o=yield tm(n.initializeAuthorizationRequest.bind(n),wg,n.logger,n.performanceClient,n.correlationId)(e,of.Popup);kv(o.authority);try{var i,a=yield tm(n.initializeAuthorizationCodeRequest.bind(n),bg,n.logger,n.performanceClient,n.correlationId)(o),c=yield tm(n.createAuthCodeClient.bind(n),mg,n.logger,n.performanceClient,n.correlationId)({serverTelemetryManager:r,requestAuthority:o.authority,requestAzureCloudOptions:o.azureCloudOptions,requestExtraQueryParameters:o.extraQueryParameters,account:o.account}),s=xw.isNativeAvailable(n.config,n.logger,n.nativeMessageHandler,e.authenticationScheme);s&&(i=n.performanceClient.startMeasurement(Zh,e.correlationId));var l=yield c.getAuthCodeUrl(Hw(Hw({},o),{},{nativeBroker:s})),u=new jw(c,n.browserStorage,a,n.logger,n.performanceClient),d=n.initiateAuthRequest(l,t);n.eventHandler.emitEvent(Um,of.Popup,{popupWindow:d},null);var h=yield n.monitorPopupForHash(d,t.popupWindowParent),g=em(Dw,xg,n.logger,n.performanceClient,n.correlationId)(h,n.config.auth.OIDCOptions.serverResponseType,n.logger);if(Wm.removeThrottle(n.browserStorage,n.config.auth.clientId,a),g.accountId){if(n.logger.verbose("Account id found in hash, calling WAM for token"),i&&i.end({success:!0,isNativeBroker:!0}),!n.nativeMessageHandler)throw jp(Ep);var f=new Aw(n.config,n.browserStorage,n.browserCrypto,n.logger,n.eventHandler,n.navigationClient,Pf,n.performanceClient,n.nativeMessageHandler,g.accountId,n.nativeStorage,o.correlationId),{userRequestState:p}=km.parseRequestState(n.browserCrypto,o.state);return yield f.acquireToken(Hw(Hw({},o),{},{state:p,prompt:void 0}))}return yield u.handleCodeResponse(g,o)}catch(e){var v;throw null===(v=t.popup)||void 0===v||v.close(),e instanceof Wl&&(e.setCorrelationId(n.correlationId),r.cacheFailedRequest(e)),e}})()}logoutPopupAsync(e,t,n,r){var o=this;return Uw(function*(){o.logger.verbose("logoutPopupAsync called"),o.eventHandler.emitEvent(zm,of.Popup,e);var i=o.initializeServerTelemetryManager(962);try{yield o.clearCacheOnLogout(e.account);var a=yield tm(o.createAuthCodeClient.bind(o),mg,o.logger,o.performanceClient,o.correlationId)({serverTelemetryManager:i,requestAuthority:n,account:e.account||void 0});try{a.authority.endSessionEndpoint}catch(n){var c;if(null!==(c=e.account)&&void 0!==c&&c.homeAccountId&&e.postLogoutRedirectUri&&a.authority.protocolMode===Kl){var s,l;if(o.browserStorage.removeAccount(null===(s=e.account)||void 0===s?void 0:s.homeAccountId,o.correlationId),o.eventHandler.emitEvent(Km,of.Popup,e),r){var u={apiId:962,timeout:o.config.system.redirectNavigationTimeout,noHistory:!1},d=rh.getAbsoluteUrl(r,mv());yield o.navigationClient.navigateInternal(d,u)}return void(null===(l=t.popup)||void 0===l||l.close())}}var h=a.getLogoutUri(e);o.eventHandler.emitEvent(Km,of.Popup,e);var g=o.openPopup(h,t);if(o.eventHandler.emitEvent(Um,of.Popup,{popupWindow:g},null),yield o.monitorPopupForHash(g,t.popupWindowParent).catch(()=>{}),r){var f={apiId:962,timeout:o.config.system.redirectNavigationTimeout,noHistory:!1},p=rh.getAbsoluteUrl(r,mv());o.logger.verbose("Redirecting main window to url specified in the request"),o.logger.verbosePii("Redirecting main window to: ".concat(p)),yield o.navigationClient.navigateInternal(p,f)}else o.logger.verbose("No main window navigation requested")}catch(e){var v;throw null===(v=t.popup)||void 0===v||v.close(),e instanceof Wl&&(e.setCorrelationId(o.correlationId),i.cacheFailedRequest(e)),o.browserStorage.setInteractionInProgress(!1),o.eventHandler.emitEvent(Fm,of.Popup,null,e),o.eventHandler.emitEvent(Vm,of.Popup),e}o.eventHandler.emitEvent(Vm,of.Popup)})()}initiateAuthRequest(e,t){if(e)return this.logger.infoPii("Navigate to: ".concat(e)),this.openPopup(e,t);throw this.logger.error("Navigate url is empty"),jp(Bf)}monitorPopupForHash(e,t){return new Promise((t,n)=>{this.logger.verbose("PopupHandler.monitorPopupForHash - polling started");var r=setInterval(()=>{if(e.closed)return this.logger.error("PopupHandler.monitorPopupForHash - window closed"),clearInterval(r),void n(jp(Zf));var o="";try{o=e.location.href}catch(e){}if(o&&"about:blank"!==o){clearInterval(r);var i="",a=this.config.auth.OIDCOptions.serverResponseType;e&&(i=a===wl.QUERY?e.location.search:e.location.hash),this.logger.verbose("PopupHandler.monitorPopupForHash - popup window is on same origin as caller"),t(i)}},this.config.system.pollIntervalMilliseconds)}).finally(()=>{this.cleanPopup(e,t)})}openPopup(e,t){try{var n;if(t.popup?(n=t.popup,this.logger.verbosePii("Navigating popup window to: ".concat(e)),n.location.assign(e)):void 0===t.popup&&(this.logger.verbosePii("Opening popup window to: ".concat(e)),n=this.openSizedPopup(e,t)),!n)throw jp(Wf);return n.focus&&n.focus(),this.currentWindow=n,t.popupWindowParent.addEventListener("beforeunload",this.unloadWindow),n}catch(e){throw this.logger.error("error opening popup "+e.message),this.browserStorage.setInteractionInProgress(!1),jp(Gf)}}openSizedPopup(e,t){var n,r,o,i,{popupName:a,popupWindowAttributes:c,popupWindowParent:s}=t,l=s.screenLeft?s.screenLeft:s.screenX,u=s.screenTop?s.screenTop:s.screenY,d=s.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,h=s.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,g=null===(n=c.popupSize)||void 0===n?void 0:n.width,f=null===(r=c.popupSize)||void 0===r?void 0:r.height,p=null===(o=c.popupPosition)||void 0===o?void 0:o.top,v=null===(i=c.popupPosition)||void 0===i?void 0:i.left;return(!g||g<0||g>d)&&(this.logger.verbose("Default popup window width used. Window width not configured or invalid."),g=483),(!f||f<0||f>h)&&(this.logger.verbose("Default popup window height used. Window height not configured or invalid."),f=600),(!p||p<0||p>h)&&(this.logger.verbose("Default popup window top position used. Window top not configured or invalid."),p=Math.max(0,h/2-300+u)),(!v||v<0||v>d)&&(this.logger.verbose("Default popup window left position used. Window left not configured or invalid."),v=Math.max(0,d/2-241.5+l)),s.open(e,a,"width=".concat(g,", height=").concat(f,", top=").concat(p,", left=").concat(v,", scrollbars=yes"))}unloadWindow(e){this.browserStorage.cleanRequestByInteractionType(of.Popup),this.currentWindow&&this.currentWindow.close(),e.preventDefault()}cleanPopup(e,t){e.close(),t.removeEventListener("beforeunload",this.unloadWindow),this.browserStorage.setInteractionInProgress(!1)}generatePopupName(e,t){return"".concat(cf,".").concat(this.config.auth.clientId,".").concat(e.join("-"),".").concat(t,".").concat(this.correlationId)}generateLogoutPopupName(e){var t=e.account&&e.account.homeAccountId;return"".concat(cf,".").concat(this.config.auth.clientId,".").concat(t,".").concat(this.correlationId)}}function Kw(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function Fw(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){Kw(i,r,o,a,c,"next",e)}function c(e){Kw(i,r,o,a,c,"throw",e)}a(void 0)})}}class Vw{constructor(e,t,n,r,o){this.authModule=e,this.browserStorage=t,this.authCodeRequest=n,this.logger=r,this.performanceClient=o}initiateAuthRequest(e,t){var n=this;return Fw(function*(){if(n.logger.verbose("RedirectHandler.initiateAuthRequest called"),e){t.redirectStartPage&&(n.logger.verbose("RedirectHandler.initiateAuthRequest: redirectStartPage set, caching start page"),n.browserStorage.setTemporaryCache(mf,t.redirectStartPage,!0)),n.browserStorage.setTemporaryCache(kf,n.authCodeRequest.correlationId,!0),n.browserStorage.cacheCodeRequest(n.authCodeRequest),n.logger.infoPii("RedirectHandler.initiateAuthRequest: Navigate to: ".concat(e));var r={apiId:Af,timeout:t.redirectTimeout,noHistory:!1};return"function"==typeof t.onRedirectNavigate?(n.logger.verbose("RedirectHandler.initiateAuthRequest: Invoking onRedirectNavigate callback"),!1!==t.onRedirectNavigate(e)?(n.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate did not return false, navigating"),void(yield t.navigationClient.navigateExternal(e,r))):void n.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate returned false, stopping navigation")):(n.logger.verbose("RedirectHandler.initiateAuthRequest: Navigating window to navigate url"),void(yield t.navigationClient.navigateExternal(e,r)))}throw n.logger.info("RedirectHandler.initiateAuthRequest: Navigate url is empty"),jp(Bf)})()}handleCodeResponse(e,t){var n=this;return Fw(function*(){n.logger.verbose("RedirectHandler.handleCodeResponse called"),n.browserStorage.setInteractionInProgress(!1);var r,o=n.browserStorage.generateStateKey(t),i=n.browserStorage.getTemporaryCache(o);if(!i)throw zu(au,"Cached State");try{r=n.authModule.handleFragmentResponse(e,i)}catch(e){throw e instanceof Gm&&e.subError===Zf?jp(Zf):e}var a=n.browserStorage.generateNonceKey(i),c=n.browserStorage.getTemporaryCache(a);if(n.authCodeRequest.code=r.code,r.cloud_instance_host_name&&(yield tm(n.authModule.updateAuthority.bind(n.authModule),Ig,n.logger,n.performanceClient,n.authCodeRequest.correlationId)(r.cloud_instance_host_name,n.authCodeRequest.correlationId)),r.nonce=c||void 0,r.state=i,r.client_info)n.authCodeRequest.clientInfo=r.client_info;else{var s=n.checkCcsCredentials();s&&(n.authCodeRequest.ccsCredential=s)}var l=yield n.authModule.acquireToken(n.authCodeRequest,r);return n.browserStorage.cleanRequestByState(t),l})()}checkCcsCredentials(){var e=this.browserStorage.getTemporaryCache(Cf,!0);if(e)try{return JSON.parse(e)}catch(t){this.authModule.logger.error("Cache credential could not be parsed"),this.authModule.logger.errorPii("Cache credential could not be parsed: ".concat(e))}return null}}function Yw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Gw(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yw(Object(n),!0).forEach(function(t){Ww(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yw(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Ww(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Zw(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function Qw(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){Zw(i,r,o,a,c,"next",e)}function c(e){Zw(i,r,o,a,c,"throw",e)}a(void 0)})}}class Xw extends $y{constructor(e,t,n,r,o,i,a,c,s,l){super(e,t,n,r,o,i,a,s,l),this.nativeStorage=c}acquireToken(e){var t=this;return Qw(function*(){var n=yield tm(t.initializeAuthorizationRequest.bind(t),wg,t.logger,t.performanceClient,t.correlationId)(e,of.Redirect);t.browserStorage.updateCacheEntries(n.state,n.nonce,n.authority,n.loginHint||"",n.account||null);var r=t.initializeServerTelemetryManager(Af),o=e=>{e.persisted&&(t.logger.verbose("Page was restored from back/forward cache. Clearing temporary cache."),t.browserStorage.cleanRequestByState(n.state),t.eventHandler.emitEvent("msal:restoreFromBFCache",of.Redirect))};try{var i=yield tm(t.initializeAuthorizationCodeRequest.bind(t),bg,t.logger,t.performanceClient,t.correlationId)(n),a=yield tm(t.createAuthCodeClient.bind(t),mg,t.logger,t.performanceClient,t.correlationId)({serverTelemetryManager:r,requestAuthority:n.authority,requestAzureCloudOptions:n.azureCloudOptions,requestExtraQueryParameters:n.extraQueryParameters,account:n.account}),c=new Vw(a,t.browserStorage,i,t.logger,t.performanceClient),s=yield a.getAuthCodeUrl(Gw(Gw({},n),{},{nativeBroker:xw.isNativeAvailable(t.config,t.logger,t.nativeMessageHandler,e.authenticationScheme)})),l=t.getRedirectStartPage(e.redirectStartPage);return t.logger.verbosePii("Redirect start page: ".concat(l)),window.addEventListener("pageshow",o),yield c.initiateAuthRequest(s,{navigationClient:t.navigationClient,redirectTimeout:t.config.system.redirectNavigationTimeout,redirectStartPage:l,onRedirectNavigate:e.onRedirectNavigate||t.config.auth.onRedirectNavigate})}catch(e){throw e instanceof Wl&&(e.setCorrelationId(t.correlationId),r.cacheFailedRequest(e)),window.removeEventListener("pageshow",o),t.browserStorage.cleanRequestByState(n.state),e}})()}handleRedirectPromise(){var e=arguments,t=this;return Qw(function*(){var n,r,o=e.length>0&&void 0!==e[0]?e[0]:"",i=e.length>1?e[1]:void 0,a=t.initializeServerTelemetryManager(865);try{if(!t.browserStorage.isInteractionInProgress(!0))return t.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;var[c,s]=t.getRedirectResponse(o||"");if(!c)return t.logger.info("handleRedirectPromise did not detect a response as a result of a redirect. Cleaning temporary cache."),t.browserStorage.cleanRequestByInteractionType(of.Redirect),"back_forward"!==function(){if("undefined"!=typeof window&&void 0!==window.performance&&"function"==typeof window.performance.getEntriesByType){var e=window.performance.getEntriesByType("navigation"),t=e.length?e[0]:void 0;return null==t?void 0:t.type}}()?i.event.errorCode="no_server_response":t.logger.verbose("Back navigation event detected. Muting no_server_response error"),null;var l=t.browserStorage.getTemporaryCache(mf,!0)||Js.EMPTY_STRING;if(rh.removeHashFromUrl(l)===rh.removeHashFromUrl(window.location.href)&&t.config.auth.navigateToLoginRequestUrl)return t.logger.verbose("Current page is loginRequestUrl, handling response"),l.indexOf("#")>-1&&((r=l.split("#")).shift(),window.location.hash=r.length>0?r.join("#"):""),yield t.handleResponse(c,a);if(!t.config.auth.navigateToLoginRequestUrl)return t.logger.verbose("NavigateToLoginRequestUrl set to false, handling response"),yield t.handleResponse(c,a);if(!vv()||t.config.system.allowRedirectInIframe){t.browserStorage.setTemporaryCache(yf,s,!0);var u={apiId:865,timeout:t.config.system.redirectNavigationTimeout,noHistory:!0},d=!0;if(l&&"null"!==l)t.logger.verbose("Navigating to loginRequestUrl: ".concat(l)),d=yield t.navigationClient.navigateInternal(l,u);else{var h=(n=new rh(window.location.href).getUrlComponents(),"".concat(n.Protocol,"//").concat(n.HostNameAndPort,"/"));t.browserStorage.setTemporaryCache(mf,h,!0),t.logger.warning("Unable to get valid login request url from cache, redirecting to home page"),d=yield t.navigationClient.navigateInternal(h,u)}if(!d)return yield t.handleResponse(c,a)}return null}catch(e){throw e instanceof Wl&&(e.setCorrelationId(t.correlationId),a.cacheFailedRequest(e)),t.browserStorage.cleanRequestByInteractionType(of.Redirect),e}})()}getRedirectResponse(e){this.logger.verbose("getRedirectResponseHash called");var t=e;t||(t=this.config.auth.OIDCOptions.serverResponseType===wl.QUERY?window.location.search:window.location.hash);var n,r=nh(t);if(r){try{!function(e,t,n){if(!e.state)throw jp(zf);var r=Tm(t,e.state);if(!r)throw jp(Ff);if(r.interactionType!==n)throw jp(Vf)}(r,this.browserCrypto,of.Redirect)}catch(e){return e instanceof Wl&&this.logger.error("Interaction type validation failed due to ".concat(e.errorCode,": ").concat(e.errorMessage)),[null,""]}return(n=window).location.hash="","function"==typeof n.history.replaceState&&n.history.replaceState(null,"","".concat(n.location.origin).concat(n.location.pathname).concat(n.location.search)),this.logger.verbose("Hash contains known properties, returning response hash"),[r,t]}var o=this.browserStorage.getTemporaryCache(yf,!0);return this.browserStorage.removeItem(this.browserStorage.generateCacheKey(yf)),o&&(r=nh(o))?(this.logger.verbose("Hash does not contain known properties, returning cached hash"),[r,o]):[null,""]}handleResponse(e,t){var n=this;return Qw(function*(){var r=e.state;if(!r)throw jp(zf);var o=n.browserStorage.getCachedRequest(r);if(n.logger.verbose("handleResponse called, retrieved cached request"),e.accountId){if(n.logger.verbose("Account id found in hash, calling WAM for token"),!n.nativeMessageHandler)throw jp(Ep);var i=new Aw(n.config,n.browserStorage,n.browserCrypto,n.logger,n.eventHandler,n.navigationClient,Pf,n.performanceClient,n.nativeMessageHandler,e.accountId,n.nativeStorage,o.correlationId),{userRequestState:a}=km.parseRequestState(n.browserCrypto,r);return i.acquireToken(Gw(Gw({},o),{},{state:a,prompt:void 0})).finally(()=>{n.browserStorage.cleanRequestByState(r)})}var c=n.browserStorage.getCachedAuthority(r);if(!c)throw jp(cp);var s=yield tm(n.createAuthCodeClient.bind(n),mg,n.logger,n.performanceClient,n.correlationId)({serverTelemetryManager:t,requestAuthority:c});return Wm.removeThrottle(n.browserStorage,n.config.auth.clientId,o),new Vw(s,n.browserStorage,o,n.logger,n.performanceClient).handleCodeResponse(e,r)})()}logout(e){var t=this;return Qw(function*(){t.logger.verbose("logoutRedirect called");var n=t.initializeLogoutRequest(e),r=t.initializeServerTelemetryManager(961);try{t.eventHandler.emitEvent(zm,of.Redirect,e),yield t.clearCacheOnLogout(n.account);var o={apiId:961,timeout:t.config.system.redirectNavigationTimeout,noHistory:!1},i=yield tm(t.createAuthCodeClient.bind(t),mg,t.logger,t.performanceClient,t.correlationId)({serverTelemetryManager:r,requestAuthority:e&&e.authority,requestExtraQueryParameters:null==e?void 0:e.extraQueryParameters,account:e&&e.account||void 0});if(i.authority.protocolMode===Kl)try{i.authority.endSessionEndpoint}catch(e){var a,c;if(null!==(a=n.account)&&void 0!==a&&a.homeAccountId)return t.browserStorage.removeAccount(null===(c=n.account)||void 0===c?void 0:c.homeAccountId,t.correlationId),void t.eventHandler.emitEvent(Km,of.Redirect,n)}var s=i.getLogoutUri(n);if(t.eventHandler.emitEvent(Km,of.Redirect,n),!e||"function"!=typeof e.onRedirectNavigate)return t.browserStorage.getInteractionInProgress()||t.browserStorage.setInteractionInProgress(!0),void(yield t.navigationClient.navigateExternal(s,o));if(!1!==e.onRedirectNavigate(s))return t.logger.verbose("Logout onRedirectNavigate did not return false, navigating"),t.browserStorage.getInteractionInProgress()||t.browserStorage.setInteractionInProgress(!0),void(yield t.navigationClient.navigateExternal(s,o));t.browserStorage.setInteractionInProgress(!1),t.logger.verbose("Logout onRedirectNavigate returned false, stopping navigation")}catch(e){throw e instanceof Wl&&(e.setCorrelationId(t.correlationId),r.cacheFailedRequest(e)),t.eventHandler.emitEvent(Fm,of.Redirect,null,e),t.eventHandler.emitEvent(Vm,of.Redirect),e}t.eventHandler.emitEvent(Vm,of.Redirect)})()}getRedirectStartPage(e){var t=e||window.location.href;return rh.getAbsoluteUrl(t,mv())}}function Jw(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function $w(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){Jw(i,r,o,a,c,"next",e)}function c(e){Jw(i,r,o,a,c,"throw",e)}a(void 0)})}}function eb(e,t,n,r,o){return tb.apply(this,arguments)}function tb(){return(tb=$w(function*(e,t,n,r,o){if(t.addQueueMeasurement(gg,r),!e)throw n.info("Navigate url is empty"),jp(Bf);return o?tm(ob,pg,n,t,r)(e,o,t,r):em(ib,vg,n,t,r)(e)})).apply(this,arguments)}function nb(e,t,n,r,o,i,a){return rb.apply(this,arguments)}function rb(){return rb=$w(function*(e,t,n,r,o,i,a){return r.addQueueMeasurement(fg,i),new Promise((r,i)=>{t<_v&&o.warning("system.loadFrameTimeout or system.iframeHashTimeout set to lower (".concat(t,"ms) than the default (").concat(_v,"ms). This may result in timeouts."));var c=window.setTimeout(()=>{window.clearInterval(s),i(jp(Xf))},t),s=window.setInterval(()=>{var t="",n=e.contentWindow;try{t=n?n.location.href:""}catch(e){}if(t&&"about:blank"!==t){var o="";n&&(o=a===wl.QUERY?n.location.search:n.location.hash),window.clearTimeout(c),window.clearInterval(s),r(o)}},n)}).finally(()=>{em(cb,Gg,o,r,i)(e)})}),rb.apply(this,arguments)}function ob(e,t,n,r){return n.addQueueMeasurement(pg,r),new Promise((n,r)=>{var o=ab();window.setTimeout(()=>{o?(o.src=e,n(o)):r("Unable to load iframe")},t)})}function ib(e){var t=ab();return t.src=e,t}function ab(){var e=document.createElement("iframe");return e.className="msalSilentIframe",e.style.visibility="hidden",e.style.position="absolute",e.style.width=e.style.height="0",e.style.border="0",e.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),document.body.appendChild(e),e}function cb(e){document.body===e.parentNode&&document.body.removeChild(e)}function sb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function lb(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?sb(Object(n),!0).forEach(function(t){ub(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sb(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function ub(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function db(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function hb(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){db(i,r,o,a,c,"next",e)}function c(e){db(i,r,o,a,c,"throw",e)}a(void 0)})}}class gb extends $y{constructor(e,t,n,r,o,i,a,c,s,l,u){super(e,t,n,r,o,i,c,l,u),this.apiId=a,this.nativeStorage=s}acquireToken(e){var t=this;return hb(function*(){t.performanceClient.addQueueMeasurement(Vh,e.correlationId),e.loginHint||e.sid||e.account&&e.account.username||t.logger.warning("No user hint provided. The authorization server may need more information to complete this request.");var n=lb({},e);n.prompt?n.prompt!==ml.NONE&&n.prompt!==ml.NO_SESSION&&(t.logger.warning("SilentIframeClient. Replacing invalid prompt ".concat(n.prompt," with ").concat(ml.NONE)),n.prompt=ml.NONE):n.prompt=ml.NONE;var r=yield tm(t.initializeAuthorizationRequest.bind(t),wg,t.logger,t.performanceClient,e.correlationId)(n,of.Silent);kv(r.authority);var o,i=t.initializeServerTelemetryManager(t.apiId);try{return o=yield tm(t.createAuthCodeClient.bind(t),mg,t.logger,t.performanceClient,e.correlationId)({serverTelemetryManager:i,requestAuthority:r.authority,requestAzureCloudOptions:r.azureCloudOptions,requestExtraQueryParameters:r.extraQueryParameters,account:r.account}),yield tm(t.silentTokenHelper.bind(t),hg,t.logger,t.performanceClient,e.correlationId)(o,r)}catch(r){if(r instanceof Wl&&(r.setCorrelationId(t.correlationId),i.cacheFailedRequest(r)),!(o&&r instanceof Wl&&r.errorCode===af))throw r;t.performanceClient.addFields({retryError:r.errorCode},t.correlationId);var a=yield tm(t.initializeAuthorizationRequest.bind(t),wg,t.logger,t.performanceClient,e.correlationId)(n,of.Silent);return yield tm(t.silentTokenHelper.bind(t),hg,t.logger,t.performanceClient,t.correlationId)(o,a)}})()}logout(){return Promise.reject(jp(np))}silentTokenHelper(e,t){var n=this;return hb(function*(){var r=t.correlationId;n.performanceClient.addQueueMeasurement(hg,r);var o=yield tm(n.initializeAuthorizationCodeRequest.bind(n),bg,n.logger,n.performanceClient,r)(t),i=yield tm(e.getAuthCodeUrl.bind(e),Cg,n.logger,n.performanceClient,r)(lb(lb({},t),{},{nativeBroker:xw.isNativeAvailable(n.config,n.logger,n.nativeMessageHandler,t.authenticationScheme)})),a=new jw(e,n.browserStorage,o,n.logger,n.performanceClient),c=yield tm(eb,gg,n.logger,n.performanceClient,r)(i,n.performanceClient,n.logger,r,n.config.system.navigateFrameWait),s=n.config.auth.OIDCOptions.serverResponseType,l=yield tm(nb,fg,n.logger,n.performanceClient,r)(c,n.config.system.iframeHashTimeout,n.config.system.pollIntervalMilliseconds,n.performanceClient,n.logger,r,s),u=em(Dw,xg,n.logger,n.performanceClient,n.correlationId)(l,s,n.logger);if(u.accountId){if(n.logger.verbose("Account id found in hash, calling WAM for token"),!n.nativeMessageHandler)throw jp(Ep);var d=new Aw(n.config,n.browserStorage,n.browserCrypto,n.logger,n.eventHandler,n.navigationClient,n.apiId,n.performanceClient,n.nativeMessageHandler,u.accountId,n.browserStorage,r),{userRequestState:h}=km.parseRequestState(n.browserCrypto,t.state);return tm(d.acquireToken.bind(d),Qh,n.logger,n.performanceClient,r)(lb(lb({},t),{},{state:h,prompt:t.prompt||ml.NONE}))}return tm(a.handleCodeResponse.bind(a),Sg,n.logger,n.performanceClient,r)(u,t)})()}}function fb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function pb(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fb(Object(n),!0).forEach(function(t){vb(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fb(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function vb(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function mb(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function yb(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){mb(i,r,o,a,c,"next",e)}function c(e){mb(i,r,o,a,c,"throw",e)}a(void 0)})}}class wb extends $y{acquireToken(e){var t=this;return yb(function*(){t.performanceClient.addQueueMeasurement(Yh,e.correlationId);var n=yield tm(Fy,lg,t.logger,t.performanceClient,e.correlationId)(e,t.config,t.performanceClient,t.logger),r=pb(pb({},e),n);e.redirectUri&&(r.redirectUri=t.getRedirectUri(e.redirectUri));var o=t.initializeServerTelemetryManager(61),i=yield t.createRefreshTokenClient({serverTelemetryManager:o,authorityUrl:r.authority,azureCloudOptions:r.azureCloudOptions,account:r.account});return tm(i.acquireTokenByRefreshToken.bind(i),rg,t.logger,t.performanceClient,e.correlationId)(r).catch(e=>{throw e.setCorrelationId(t.correlationId),o.cacheFailedRequest(e),e})})()}logout(){return Promise.reject(jp(np))}createRefreshTokenClient(e){var t=this;return yb(function*(){var n=yield tm(t.getClientConfiguration.bind(t),yg,t.logger,t.performanceClient,t.correlationId)({serverTelemetryManager:e.serverTelemetryManager,requestAuthority:e.authorityUrl,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account});return new uw(n,t.performanceClient)})()}}class bb{constructor(e,t,n,r){this.isBrowserEnvironment="undefined"!=typeof window,this.config=e,this.storage=t,this.logger=n,this.cryptoObj=r}loadExternalTokens(e,t,n){if(!this.isBrowserEnvironment)throw jp(up);var r=e.correlationId||nv(),o=t.id_token?Wu(t.id_token,Lv):void 0,i={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},a=e.authority?new um(um.generateAuthority(e.authority,e.azureCloudOptions),this.config.system.networkClient,this.storage,i,this.logger,e.correlationId||nv()):void 0,c=this.loadAccount(e,n.clientInfo||t.client_info||"",r,o,a),s=this.loadIdToken(t,c.homeAccountId,c.environment,c.realm,r),l=this.loadAccessToken(e,t,c.homeAccountId,c.environment,c.realm,n,r),u=this.loadRefreshToken(t,c.homeAccountId,c.environment,r);return this.generateAuthenticationResult(e,{account:c,idToken:s,accessToken:l,refreshToken:u},o,a)}loadAccount(e,t,n,r,o){if(this.logger.verbose("TokenCache - loading account"),e.account){var i=eh.createFromAccountInfo(e.account);return this.storage.setAccount(i,n),i}if(!o||!t&&!r)throw this.logger.error("TokenCache - if an account is not provided on the request, authority and either clientInfo or idToken must be provided instead."),jp(vp);var a=eh.generateHomeAccountId(t,o.authorityType,this.logger,this.cryptoObj,r),c=null==r?void 0:r.tid,s=Cy(this.storage,o,a,Lv,n,r,t,o.hostnameAndPort,c,void 0,void 0,this.logger);return this.storage.setAccount(s,n),s}loadIdToken(e,t,n,r,o){if(!e.id_token)return this.logger.verbose("TokenCache - no id token found in response"),null;this.logger.verbose("TokenCache - loading id token");var i=$u(t,n,e.id_token,this.config.auth.clientId,r);return this.storage.setIdTokenCredential(i,o),i}loadAccessToken(e,t,n,r,o,i,a){if(!t.access_token)return this.logger.verbose("TokenCache - no access token found in response"),null;if(!t.expires_in)return this.logger.error("TokenCache - no expiration set on the access token. Cannot add it to the cache."),null;if(!(t.scope||e.scopes&&e.scopes.length))return this.logger.error("TokenCache - scopes not specified in the request or response. Cannot add token to the cache."),null;this.logger.verbose("TokenCache - loading access token");var c=t.scope?Ud.fromString(t.scope):new Ud(e.scopes),s=i.expiresOn||t.expires_in+(new Date).getTime()/1e3,l=i.extendedExpiresOn||(t.ext_expires_in||t.expires_in)+(new Date).getTime()/1e3,u=ed(n,r,t.access_token,this.config.auth.clientId,o,c.printScopes(),s,l,Lv);return this.storage.setAccessTokenCredential(u,a),u}loadRefreshToken(e,t,n,r){if(!e.refresh_token)return this.logger.verbose("TokenCache - no refresh token found in response"),null;this.logger.verbose("TokenCache - loading refresh token");var o=td(t,n,e.refresh_token,this.config.auth.clientId,e.foci,void 0,e.refresh_token_expires_in);return this.storage.setRefreshTokenCredential(o,r),o}generateAuthenticationResult(e,t,n,r){var o,i,a,c,s="",l=[],u=null;null!=t&&t.accessToken&&(s=t.accessToken.secret,l=Ud.fromString(t.accessToken.target).asArray(),u=new Date(1e3*Number(t.accessToken.expiresOn)),c=new Date(1e3*Number(t.accessToken.extendedExpiresOn)));var d=t.account;return{authority:r?r.canonicalAuthority:"",uniqueId:t.account.localAccountId,tenantId:t.account.realm,scopes:l,account:d.getAccountInfo(),idToken:(null===(o=t.idToken)||void 0===o?void 0:o.secret)||"",idTokenClaims:n||{},accessToken:s,fromCache:!0,expiresOn:u,correlationId:e.correlationId||"",requestId:"",extExpiresOn:c,familyId:(null===(i=t.refreshToken)||void 0===i?void 0:i.familyId)||"",tokenType:(null==t||null===(a=t.accessToken)||void 0===a?void 0:a.tokenType)||"",state:e.state||"",cloudGraphHostName:d.cloudGraphHostName||"",msGraphHost:d.msGraphHost||"",fromNativeBroker:!1}}}class Cb extends Ty{constructor(e){super(e),this.includeRedirectUri=!1}}function kb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Sb(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?kb(Object(n),!0).forEach(function(t){Ib(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kb(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Ib(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Eb(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}class _b extends $y{constructor(e,t,n,r,o,i,a,c,s,l){super(e,t,n,r,o,i,c,s,l),this.apiId=a}acquireToken(e){var t,n=this;return(t=function*(){if(!e.code)throw jp(yp);var t=yield tm(n.initializeAuthorizationRequest.bind(n),wg,n.logger,n.performanceClient,e.correlationId)(e,of.Silent),r=n.initializeServerTelemetryManager(n.apiId);try{var o=Sb(Sb({},t),{},{code:e.code}),i=yield tm(n.getClientConfiguration.bind(n),yg,n.logger,n.performanceClient,e.correlationId)({serverTelemetryManager:r,requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account}),a=new Cb(i);n.logger.verbose("Auth code client created");var c=new jw(a,n.browserStorage,o,n.logger,n.performanceClient);return yield tm(c.handleCodeResponseFromServer.bind(c),kg,n.logger,n.performanceClient,e.correlationId)({code:e.code,msgraph_host:e.msGraphHost,cloud_graph_host_name:e.cloudGraphHostName,cloud_instance_host_name:e.cloudInstanceHostName},t,!1)}catch(e){throw e instanceof Wl&&(e.setCorrelationId(n.correlationId),r.cacheFailedRequest(e)),e}},function(){var e=this,n=arguments;return new Promise(function(r,o){var i=t.apply(e,n);function a(e){Eb(i,r,o,a,c,"next",e)}function c(e){Eb(i,r,o,a,c,"throw",e)}a(void 0)})})()}logout(){return Promise.reject(jp(np))}}function Tb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Ob(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Tb(Object(n),!0).forEach(function(t){Ab(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Tb(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Ab(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Pb(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function Mb(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){Pb(i,r,o,a,c,"next",e)}function c(e){Pb(i,r,o,a,c,"throw",e)}a(void 0)})}}function xb(e){var t=null==e?void 0:e.idTokenClaims;return null!=t&&t.tfp||null!=t&&t.acr?"B2C":null!=t&&t.tid?"9188040d-6c67-4c5b-b112-36a304b66dad"===(null==t?void 0:t.tid)?"MSA":"AAD":void 0}function Nb(e,t){try{bv(e)}catch(e){throw t.end({success:!1},e),e}}class Rb{constructor(e){var t,n;this.operatingContext=e,this.isBrowserEnvironment=this.operatingContext.isBrowserEnvironment(),this.config=e.getConfig(),this.initialized=!1,this.logger=this.operatingContext.getLogger(),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.config.telemetry.client,this.browserCrypto=this.isBrowserEnvironment?new Jv(this.logger,this.performanceClient):Vu,this.eventHandler=new Ym(this.logger),this.browserStorage=this.isBrowserEnvironment?new Mm(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,function(e){var t=e.cloudDiscoveryMetadata,n=void 0;if(t)try{n=JSON.parse(t)}catch(e){throw Ld(Td)}return{canonicalAuthority:e.authority?dm(e.authority):void 0,knownAuthorities:e.knownAuthorities,cloudDiscoveryMetadata:n}}(this.config.auth),this.performanceClient):(t=this.config.auth.clientId,n=this.logger,new Mm(t,{cacheLocation:pf,temporaryCacheLocation:pf,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1},Vu,n));var r={cacheLocation:pf,temporaryCacheLocation:pf,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};this.nativeInternalStorage=new Mm(this.config.auth.clientId,r,this.browserCrypto,this.logger,void 0,this.performanceClient),this.tokenCache=new bb(this.config,this.browserStorage,this.logger,this.browserCrypto),this.activeSilentTokenRequests=new Map,this.trackPageVisibility=this.trackPageVisibility.bind(this),this.trackPageVisibilityWithMeasurement=this.trackPageVisibilityWithMeasurement.bind(this),this.listeningToStorageEvents=!1,this.handleAccountCacheChange=this.handleAccountCacheChange.bind(this)}static createController(e,t){return Mb(function*(){var n=new Rb(e);return yield n.initialize(t),n})()}trackPageVisibility(e){e&&(this.logger.info("Perf: Visibility change detected"),this.performanceClient.incrementFields({visibilityChangeCount:1},e))}initialize(e){var t=this;return Mb(function*(){if(t.logger.trace("initialize called"),t.initialized)t.logger.info("initialize has already been called, exiting early.");else{if(!t.isBrowserEnvironment)return t.logger.info("in non-browser environment, exiting early."),t.initialized=!0,void t.eventHandler.emitEvent(xm);var n=(null==e?void 0:e.correlationId)||t.getRequestCorrelationId(),r=t.config.system.allowNativeBroker,o=t.performanceClient.startMeasurement(dg,n);if(t.eventHandler.emitEvent("msal:initializeStart"),r)try{t.nativeExtensionProvider=yield xw.createProvider(t.logger,t.config.system.nativeBrokerHandshakeTimeout,t.performanceClient)}catch(e){t.logger.verbose(e)}t.config.cache.claimsBasedCachingEnabled||(t.logger.verbose("Claims-based caching is disabled. Clearing the previous cache with claims"),yield tm(t.browserStorage.clearTokensAndKeysWithClaims.bind(t.browserStorage),Wg,t.logger,t.performanceClient,n)(t.performanceClient,n)),t.initialized=!0,t.eventHandler.emitEvent(xm),o.end({allowNativeBroker:r,success:!0})}})()}handleRedirectPromise(e){var t=this;return Mb(function*(){if(t.logger.verbose("handleRedirectPromise called"),wv(t.initialized),t.isBrowserEnvironment){var n=e||"",r=t.redirectResponse.get(n);return void 0===r?(r=t.handleRedirectPromiseInternal(e),t.redirectResponse.set(n,r),t.logger.verbose("handleRedirectPromise has been called for the first time, storing the promise")):t.logger.verbose("handleRedirectPromise has been called previously, returning the result from the first call"),r}return t.logger.verbose("handleRedirectPromise returns null, not browser environment"),null})()}handleRedirectPromiseInternal(e){var t=this;return Mb(function*(){var n,r=t.getAllAccounts(),o=t.browserStorage.getCachedNativeRequest(),i=o&&xw.isNativeAvailable(t.config,t.logger,t.nativeExtensionProvider)&&t.nativeExtensionProvider&&!e,a=i?null==o?void 0:o.correlationId:t.browserStorage.getTemporaryCache(kf,!0)||"",c=t.performanceClient.startMeasurement(Uh,a);if(t.eventHandler.emitEvent("msal:handleRedirectStart",of.Redirect),i&&t.nativeExtensionProvider){t.logger.trace("handleRedirectPromise - acquiring token from native platform");var s=new Aw(t.config,t.browserStorage,t.browserCrypto,t.logger,t.eventHandler,t.navigationClient,865,t.performanceClient,t.nativeExtensionProvider,o.accountId,t.nativeInternalStorage,o.correlationId);n=tm(s.handleRedirectPromise.bind(s),Vg,t.logger,t.performanceClient,c.event.correlationId)(t.performanceClient,c.event.correlationId)}else{t.logger.trace("handleRedirectPromise - acquiring token from web flow");var l=t.createRedirectClient(a);n=tm(l.handleRedirectPromise.bind(l),Fg,t.logger,t.performanceClient,c.event.correlationId)(e,c)}return n.then(e=>(e?(r.length<t.getAllAccounts().length?(t.eventHandler.emitEvent(Rm,of.Redirect,e),t.logger.verbose("handleRedirectResponse returned result, login success")):(t.eventHandler.emitEvent(qm,of.Redirect,e),t.logger.verbose("handleRedirectResponse returned result, acquire token success")),c.end({success:!0,accountType:xb(e.account)})):c.event.errorCode?c.end({success:!1}):c.discard(),t.eventHandler.emitEvent(Bm,of.Redirect),e)).catch(e=>{var n=e;throw r.length>0?t.eventHandler.emitEvent(Hm,of.Redirect,null,n):t.eventHandler.emitEvent(jm,of.Redirect,null,n),t.eventHandler.emitEvent(Bm,of.Redirect),c.end({success:!1},n),e})})()}acquireTokenRedirect(e){var t=this;return Mb(function*(){var n=t.getRequestCorrelationId(e);t.logger.verbose("acquireTokenRedirect called",n);var r=t.performanceClient.startMeasurement("acquireTokenPreRedirect",n);r.add({accountType:xb(e.account),scenarioId:e.scenarioId});var o=e.onRedirectNavigate;if(o)e.onRedirectNavigate=e=>{var t="function"==typeof o?o(e):void 0;return!1!==t?r.end({success:!0}):r.discard(),t};else{var i=t.config.auth.onRedirectNavigate;t.config.auth.onRedirectNavigate=e=>{var t="function"==typeof i?i(e):void 0;return!1!==t?r.end({success:!0}):r.discard(),t}}var a=t.getAllAccounts().length>0;try{var c;return Cv(t.initialized,t.config),t.browserStorage.setInteractionInProgress(!0),a?t.eventHandler.emitEvent(Dm,of.Redirect,e):t.eventHandler.emitEvent(Nm,of.Redirect,e),c=t.nativeExtensionProvider&&t.canUseNative(e)?new Aw(t.config,t.browserStorage,t.browserCrypto,t.logger,t.eventHandler,t.navigationClient,Af,t.performanceClient,t.nativeExtensionProvider,t.getNativeAccountId(e),t.nativeInternalStorage,n).acquireTokenRedirect(e,r).catch(r=>{if(r instanceof nw&&rw(r))return t.nativeExtensionProvider=void 0,t.createRedirectClient(n).acquireToken(e);if(r instanceof wm)return t.logger.verbose("acquireTokenRedirect - Resolving interaction required error thrown by native broker by falling back to web flow"),t.createRedirectClient(n).acquireToken(e);throw t.browserStorage.setInteractionInProgress(!1),r}):t.createRedirectClient(n).acquireToken(e),yield c}catch(e){throw r.end({success:!1},e),a?t.eventHandler.emitEvent(Hm,of.Redirect,null,e):t.eventHandler.emitEvent(jm,of.Redirect,null,e),e}})()}acquireTokenPopup(e){var t=this.getRequestCorrelationId(e),n=this.performanceClient.startMeasurement(Bh,t);n.add({scenarioId:e.scenarioId,accountType:xb(e.account)});try{this.logger.verbose("acquireTokenPopup called",t),Nb(this.initialized,n),this.browserStorage.setInteractionInProgress(!0)}catch(e){return Promise.reject(e)}var r=this.getAllAccounts();return r.length>0?this.eventHandler.emitEvent(Dm,of.Popup,e):this.eventHandler.emitEvent(Nm,of.Popup,e),(this.canUseNative(e)?this.acquireTokenNative(Ob(Ob({},e),{},{correlationId:t}),Pf).then(e=>(this.browserStorage.setInteractionInProgress(!1),n.end({success:!0,isNativeBroker:!0,accountType:xb(e.account)}),e)).catch(n=>{if(n instanceof nw&&rw(n))return this.nativeExtensionProvider=void 0,this.createPopupClient(t).acquireToken(e);if(n instanceof wm)return this.logger.verbose("acquireTokenPopup - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createPopupClient(t).acquireToken(e);throw this.browserStorage.setInteractionInProgress(!1),n}):this.createPopupClient(t).acquireToken(e)).then(e=>(r.length<this.getAllAccounts().length?this.eventHandler.emitEvent(Rm,of.Popup,e):this.eventHandler.emitEvent(qm,of.Popup,e),n.end({success:!0,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length,accountType:xb(e.account)}),e)).catch(e=>(r.length>0?this.eventHandler.emitEvent(Hm,of.Popup,null,e):this.eventHandler.emitEvent(jm,of.Popup,null,e),n.end({success:!1},e),Promise.reject(e)))}trackPageVisibilityWithMeasurement(){var e=this.ssoSilentMeasurement||this.acquireTokenByCodeAsyncMeasurement;e&&(this.logger.info("Perf: Visibility change detected in ",e.event.name),e.increment({visibilityChangeCount:1}))}ssoSilent(e){var t=this;return Mb(function*(){var n,r,o=t.getRequestCorrelationId(e),i=Ob(Ob({},e),{},{prompt:e.prompt,correlationId:o});return t.ssoSilentMeasurement=t.performanceClient.startMeasurement(Gh,o),null===(n=t.ssoSilentMeasurement)||void 0===n||n.add({scenarioId:e.scenarioId,accountType:xb(e.account)}),Nb(t.initialized,t.ssoSilentMeasurement),null===(r=t.ssoSilentMeasurement)||void 0===r||r.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",t.trackPageVisibilityWithMeasurement),t.logger.verbose("ssoSilent called",o),t.eventHandler.emitEvent("msal:ssoSilentStart",of.Silent,i),(t.canUseNative(i)?t.acquireTokenNative(i,863).catch(e=>{if(e instanceof nw&&rw(e))return t.nativeExtensionProvider=void 0,t.createSilentIframeClient(i.correlationId).acquireToken(i);throw e}):t.createSilentIframeClient(i.correlationId).acquireToken(i)).then(e=>{var n;return t.eventHandler.emitEvent("msal:ssoSilentSuccess",of.Silent,e),null===(n=t.ssoSilentMeasurement)||void 0===n||n.end({success:!0,isNativeBroker:e.fromNativeBroker,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length,accountType:xb(e.account)}),e}).catch(e=>{var n;throw t.eventHandler.emitEvent("msal:ssoSilentFailure",of.Silent,null,e),null===(n=t.ssoSilentMeasurement)||void 0===n||n.end({success:!1},e),e}).finally(()=>{document.removeEventListener("visibilitychange",t.trackPageVisibilityWithMeasurement)})})()}acquireTokenByCode(e){var t=this;return Mb(function*(){var n=t.getRequestCorrelationId(e);t.logger.trace("acquireTokenByCode called",n);var r=t.performanceClient.startMeasurement(Dh,n);Nb(t.initialized,r),t.eventHandler.emitEvent("msal:acquireTokenByCodeStart",of.Silent,e),r.add({scenarioId:e.scenarioId});try{if(e.code&&e.nativeAccountId)throw jp(bp);if(e.code){var o=e.code,i=t.hybridAuthCodeResponses.get(o);return i?(t.logger.verbose("Existing acquireTokenByCode request found",n),r.discard()):(t.logger.verbose("Initiating new acquireTokenByCode request",n),i=t.acquireTokenByCodeAsync(Ob(Ob({},e),{},{correlationId:n})).then(e=>(t.eventHandler.emitEvent("msal:acquireTokenByCodeSuccess",of.Silent,e),t.hybridAuthCodeResponses.delete(o),r.end({success:!0,isNativeBroker:e.fromNativeBroker,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length,accountType:xb(e.account)}),e)).catch(e=>{throw t.hybridAuthCodeResponses.delete(o),t.eventHandler.emitEvent(Lm,of.Silent,null,e),r.end({success:!1},e),e}),t.hybridAuthCodeResponses.set(o,i)),yield i}if(e.nativeAccountId){if(t.canUseNative(e,e.nativeAccountId)){var a=yield t.acquireTokenNative(Ob(Ob({},e),{},{correlationId:n}),866,e.nativeAccountId).catch(e=>{throw e instanceof nw&&rw(e)&&(t.nativeExtensionProvider=void 0),e});return r.end({accountType:xb(a.account),success:!0}),a}throw jp(kp)}throw jp(wp)}catch(e){throw t.eventHandler.emitEvent(Lm,of.Silent,null,e),r.end({success:!1},e),e}})()}acquireTokenByCodeAsync(e){var t=this;return Mb(function*(){var n;t.logger.trace("acquireTokenByCodeAsync called",e.correlationId),t.acquireTokenByCodeAsyncMeasurement=t.performanceClient.startMeasurement(Kg,e.correlationId),null===(n=t.acquireTokenByCodeAsyncMeasurement)||void 0===n||n.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",t.trackPageVisibilityWithMeasurement);var r=t.createSilentAuthCodeClient(e.correlationId);return yield r.acquireToken(e).then(e=>{var n;return null===(n=t.acquireTokenByCodeAsyncMeasurement)||void 0===n||n.end({success:!0,fromCache:e.fromCache,isNativeBroker:e.fromNativeBroker}),e}).catch(e=>{var n;throw null===(n=t.acquireTokenByCodeAsyncMeasurement)||void 0===n||n.end({success:!1},e),e}).finally(()=>{document.removeEventListener("visibilitychange",t.trackPageVisibilityWithMeasurement)})})()}acquireTokenFromCache(e,t){var n=this;return Mb(function*(){switch(n.performanceClient.addQueueMeasurement(ig,e.correlationId),t){case 0:case 1:case 2:var r=n.createSilentCacheClient(e.correlationId);return tm(r.acquireToken.bind(r),Fh,n.logger,n.performanceClient,e.correlationId)(e);default:throw zu(Ou)}})()}acquireTokenByRefreshToken(e,t){var n=this;return Mb(function*(){switch(n.performanceClient.addQueueMeasurement(qh,e.correlationId),t){case 0:case 2:case 3:case 4:var r=n.createSilentRefreshClient(e.correlationId);return tm(r.acquireToken.bind(r),Yh,n.logger,n.performanceClient,e.correlationId)(e);default:throw zu(Ou)}})()}acquireTokenBySilentIframe(e){var t=this;return Mb(function*(){t.performanceClient.addQueueMeasurement(sg,e.correlationId);var n=t.createSilentIframeClient(e.correlationId);return tm(n.acquireToken.bind(n),Vh,t.logger,t.performanceClient,e.correlationId)(e)})()}logout(e){var t=this;return Mb(function*(){var n=t.getRequestCorrelationId(e);return t.logger.warning("logout API is deprecated and will be removed in msal-browser v3.0.0. Use logoutRedirect instead.",n),t.logoutRedirect(Ob({correlationId:n},e))})()}logoutRedirect(e){var t=this;return Mb(function*(){var n=t.getRequestCorrelationId(e);return Cv(t.initialized,t.config),t.browserStorage.setInteractionInProgress(!0),t.createRedirectClient(n).logout(e)})()}logoutPopup(e){try{var t=this.getRequestCorrelationId(e);return bv(this.initialized),this.browserStorage.setInteractionInProgress(!0),this.createPopupClient(t).logout(e)}catch(e){return Promise.reject(e)}}clearCache(e){var t=this;return Mb(function*(){if(t.isBrowserEnvironment){var n=t.getRequestCorrelationId(e);return t.createSilentCacheClient(n).logout(e)}t.logger.info("in non-browser environment, returning early.")})()}getAllAccounts(e){var t=this.getRequestCorrelationId();return function(e,t,n,r,o){return e.verbose("getAllAccounts called"),n?t.getAllAccounts(r,o):[]}(this.logger,this.browserStorage,this.isBrowserEnvironment,t,e)}getAccount(e){var t=this.getRequestCorrelationId();return function(e,t,n,r){if(t.trace("getAccount called"),0===Object.keys(e).length)return t.warning("getAccount: No accountFilter provided"),null;var o=n.getAccountInfoFilteredBy(e,r);return o?(t.verbose("getAccount: Account matching provided filter found, returning"),o):(t.verbose("getAccount: No matching account found, returning null"),null)}(e,this.logger,this.browserStorage,t)}getAccountByUsername(e){var t=this.getRequestCorrelationId();return function(e,t,n,r){if(t.trace("getAccountByUsername called"),!e)return t.warning("getAccountByUsername: No username provided"),null;var o=n.getAccountInfoFilteredBy({username:e},r);return o?(t.verbose("getAccountByUsername: Account matching username found, returning"),t.verbosePii("getAccountByUsername: Returning signed-in accounts matching username: ".concat(e)),o):(t.verbose("getAccountByUsername: No matching account found, returning null"),null)}(e,this.logger,this.browserStorage,t)}getAccountByHomeId(e){var t=this.getRequestCorrelationId();return function(e,t,n,r){if(t.trace("getAccountByHomeId called"),!e)return t.warning("getAccountByHomeId: No homeAccountId provided"),null;var o=n.getAccountInfoFilteredBy({homeAccountId:e},r);return o?(t.verbose("getAccountByHomeId: Account matching homeAccountId found, returning"),t.verbosePii("getAccountByHomeId: Returning signed-in accounts matching homeAccountId: ".concat(e)),o):(t.verbose("getAccountByHomeId: No matching account found, returning null"),null)}(e,this.logger,this.browserStorage,t)}getAccountByLocalId(e){var t=this.getRequestCorrelationId();return function(e,t,n,r){if(t.trace("getAccountByLocalId called"),!e)return t.warning("getAccountByLocalId: No localAccountId provided"),null;var o=n.getAccountInfoFilteredBy({localAccountId:e},r);return o?(t.verbose("getAccountByLocalId: Account matching localAccountId found, returning"),t.verbosePii("getAccountByLocalId: Returning signed-in accounts matching localAccountId: ".concat(e)),o):(t.verbose("getAccountByLocalId: No matching account found, returning null"),null)}(e,this.logger,this.browserStorage,t)}setActiveAccount(e){var t=this.getRequestCorrelationId();!function(e,t,n){t.setActiveAccount(e,n)}(e,this.browserStorage,t)}getActiveAccount(){var e=this.getRequestCorrelationId();return function(e,t){return e.getActiveAccount(t)}(this.browserStorage,e)}hydrateCache(e,t){var n=this;return Mb(function*(){n.logger.verbose("hydrateCache called");var r=eh.createFromAccountInfo(e.account,e.cloudGraphHostName,e.msGraphHost);return n.browserStorage.setAccount(r,e.correlationId),e.fromNativeBroker?(n.logger.verbose("Response was from native broker, storing in-memory"),n.nativeInternalStorage.hydrateCache(e,t)):n.browserStorage.hydrateCache(e,t)})()}acquireTokenNative(e,t,n){var r=this;return Mb(function*(){if(r.logger.trace("acquireTokenNative called"),!r.nativeExtensionProvider)throw jp(Ep);return new Aw(r.config,r.browserStorage,r.browserCrypto,r.logger,r.eventHandler,r.navigationClient,t,r.performanceClient,r.nativeExtensionProvider,n||r.getNativeAccountId(e),r.nativeInternalStorage,e.correlationId).acquireToken(e)})()}canUseNative(e,t){if(this.logger.trace("canUseNative called"),!xw.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme))return this.logger.trace("canUseNative: isNativeAvailable returned false, returning false"),!1;if(e.prompt)switch(e.prompt){case ml.NONE:case ml.CONSENT:case ml.LOGIN:this.logger.trace("canUseNative: prompt is compatible with native flow");break;default:return this.logger.trace("canUseNative: prompt = ".concat(e.prompt," is not compatible with native flow, returning false")),!1}return!(!t&&!this.getNativeAccountId(e)&&(this.logger.trace("canUseNative: nativeAccountId is not available, returning false"),1))}getNativeAccountId(e){var t=e.account||this.getAccount({loginHint:e.loginHint,sid:e.sid})||this.getActiveAccount();return t&&t.nativeAccountId||""}createPopupClient(e){return new zw(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createRedirectClient(e){return new Xw(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentIframeClient(e){return new gb(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,863,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentCacheClient(e){return new yw(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentRefreshClient(e){return new wb(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentAuthCodeClient(e){return new _b(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,866,this.performanceClient,this.nativeExtensionProvider,e)}addEventCallback(e,t){return this.eventHandler.addEventCallback(e,t)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){return yv(),this.performanceClient.addPerformanceCallback(e)}removePerformanceCallback(e){return this.performanceClient.removePerformanceCallback(e)}enableAccountStorageEvents(){"undefined"!=typeof window&&(this.listeningToStorageEvents?this.logger.verbose("Account storage listener already registered."):(this.logger.verbose("Adding account storage listener."),this.listeningToStorageEvents=!0,window.addEventListener("storage",this.handleAccountCacheChange)))}disableAccountStorageEvents(){"undefined"!=typeof window&&(this.listeningToStorageEvents?(this.logger.verbose("Removing account storage listener."),window.removeEventListener("storage",this.handleAccountCacheChange),this.listeningToStorageEvents=!1):this.logger.verbose("No account storage listener registered."))}handleAccountCacheChange(e){try{var t;null!==(t=e.key)&&void 0!==t&&t.includes(hl)&&this.eventHandler.emitEvent("msal:activeAccountChanged");var n=e.newValue||e.oldValue;if(!n)return;var r=JSON.parse(n);if("object"!=typeof r||!eh.isAccountEntity(r))return;var o=wh.toObject(new eh,r).getAccountInfo();!e.oldValue&&e.newValue?(this.logger.info("Account was added to cache in a different window"),this.eventHandler.emitEvent("msal:accountAdded",void 0,o)):!e.newValue&&e.oldValue&&(this.logger.info("Account was removed from cache in a different window"),this.eventHandler.emitEvent("msal:accountRemoved",void 0,o))}catch(e){return}}getTokenCache(){return this.tokenCache}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){this.browserStorage.setWrapperMetadata(e,t)}setNavigationClient(e){this.navigationClient=e}getConfiguration(){return this.config}getPerformanceClient(){return this.performanceClient}isBrowserEnv(){return this.isBrowserEnvironment}getRequestCorrelationId(e){return null!=e&&e.correlationId?e.correlationId:this.isBrowserEnvironment?nv():Js.EMPTY_STRING}loginRedirect(e){var t=this;return Mb(function*(){var n=t.getRequestCorrelationId(e);return t.logger.verbose("loginRedirect called",n),t.acquireTokenRedirect(Ob({correlationId:n},e||Mf))})()}loginPopup(e){var t=this.getRequestCorrelationId(e);return this.logger.verbose("loginPopup called",t),this.acquireTokenPopup(Ob({correlationId:t},e||Mf))}acquireTokenSilent(e){var t=this;return Mb(function*(){var n=t.getRequestCorrelationId(e),r=t.performanceClient.startMeasurement(Hh,n);r.add({cacheLookupPolicy:e.cacheLookupPolicy,scenarioId:e.scenarioId}),Nb(t.initialized,r),t.logger.verbose("acquireTokenSilent called",n);var o=e.account||t.getActiveAccount();if(!o)throw jp(rp);r.add({accountType:xb(o)});var i={clientId:t.config.auth.clientId,authority:e.authority||Js.EMPTY_STRING,scopes:e.scopes,homeAccountIdentifier:o.homeAccountId,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid,shrOptions:e.shrOptions},a=JSON.stringify(i),c=t.activeSilentTokenRequests.get(a);if(void 0===c){t.logger.verbose("acquireTokenSilent called for the first time, storing active request",n);var s=tm(t.acquireTokenSilentAsync.bind(t),Lh,t.logger,t.performanceClient,n)(Ob(Ob({},e),{},{correlationId:n}),o).then(n=>(t.activeSilentTokenRequests.delete(a),r.end({success:!0,fromCache:n.fromCache,isNativeBroker:n.fromNativeBroker,cacheLookupPolicy:e.cacheLookupPolicy,accessTokenSize:n.accessToken.length,idTokenSize:n.idToken.length}),n)).catch(e=>{throw t.activeSilentTokenRequests.delete(a),r.end({success:!1},e),e});return t.activeSilentTokenRequests.set(a,s),Ob(Ob({},yield s),{},{state:e.state})}return t.logger.verbose("acquireTokenSilent has been called previously, returning the result from the first call",n),r.discard(),Ob(Ob({},yield c),{},{state:e.state})})()}acquireTokenSilentAsync(e,t){var n=this;return Mb(function*(){var r=()=>n.trackPageVisibility(e.correlationId);n.performanceClient.addQueueMeasurement(Lh,e.correlationId),n.eventHandler.emitEvent(Dm,of.Silent,e),e.correlationId&&n.performanceClient.incrementFields({visibilityChangeCount:0},e.correlationId),document.addEventListener("visibilitychange",r);var o=yield tm(Yy,ug,n.logger,n.performanceClient,e.correlationId)(e,t,n.config,n.performanceClient,n.logger),i=e.cacheLookupPolicy||0,a=n.acquireTokenSilentNoIframe(o,i).catch(function(){var e=Mb(function*(e){var t=function(e,t){var n=!(e instanceof wm&&e.subError!==pm),r=e.errorCode===af||e.errorCode===Ou,o=n&&r||e.errorCode===hm||e.errorCode===fm,i=Rf.includes(t);return o&&i}(e,i);if(t){if(n.activeIframeRequest){if(5!==i){var[r,a]=n.activeIframeRequest;n.logger.verbose("Iframe request is already in progress, awaiting resolution for request with correlationId: ".concat(a),o.correlationId);var c=n.performanceClient.startMeasurement("awaitConcurrentIframe",o.correlationId);c.add({awaitIframeCorrelationId:a});var s=yield r;if(c.end({success:s}),s)return n.logger.verbose("Parallel iframe request with correlationId: ".concat(a," succeeded. Retrying cache and/or RT redemption"),o.correlationId),n.acquireTokenSilentNoIframe(o,i);throw n.logger.info("Iframe request with correlationId: ".concat(a," failed. Interaction is required.")),e}return n.logger.warning("Another iframe request is currently in progress and CacheLookupPolicy is set to Skip. This may result in degraded performance and/or reliability for both calls. Please consider changing the CacheLookupPolicy to take advantage of request queuing and token cache.",o.correlationId),tm(n.acquireTokenBySilentIframe.bind(n),sg,n.logger,n.performanceClient,o.correlationId)(o)}var l;return n.activeIframeRequest=[new Promise(e=>{l=e}),o.correlationId],n.logger.verbose("Refresh token expired/invalid or CacheLookupPolicy is set to Skip, attempting acquire token by iframe.",o.correlationId),tm(n.acquireTokenBySilentIframe.bind(n),sg,n.logger,n.performanceClient,o.correlationId)(o).then(e=>(l(!0),e)).catch(e=>{throw l(!1),e}).finally(()=>{n.activeIframeRequest=void 0})}throw e});return function(t){return e.apply(this,arguments)}}());return a.then(t=>(n.eventHandler.emitEvent(qm,of.Silent,t),e.correlationId&&n.performanceClient.addFields({fromCache:t.fromCache,isNativeBroker:t.fromNativeBroker},e.correlationId),t)).catch(e=>{throw n.eventHandler.emitEvent(Hm,of.Silent,null,e),e}).finally(()=>{document.removeEventListener("visibilitychange",r)})})()}acquireTokenSilentNoIframe(e,t){var n=this;return Mb(function*(){return xw.isNativeAvailable(n.config,n.logger,n.nativeExtensionProvider,e.authenticationScheme)&&e.account.nativeAccountId?(n.logger.verbose("acquireTokenSilent - attempting to acquire token from native platform"),n.acquireTokenNative(e,61).catch(function(){var e=Mb(function*(e){if(e instanceof nw&&rw(e))throw n.logger.verbose("acquireTokenSilent - native platform unavailable, falling back to web flow"),n.nativeExtensionProvider=void 0,zu(Ou);throw e});return function(t){return e.apply(this,arguments)}}())):(n.logger.verbose("acquireTokenSilent - attempting to acquire token from web flow"),tm(n.acquireTokenFromCache.bind(n),ig,n.logger,n.performanceClient,e.correlationId)(e,t).catch(r=>{if(1===t)throw r;return n.eventHandler.emitEvent("msal:acquireTokenFromNetworkStart",of.Silent,e),tm(n.acquireTokenByRefreshToken.bind(n),qh,n.logger,n.performanceClient,e.correlationId)(e,t)}))})()}}function jb(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function Db(){return(e=function*(e,t){var n=new xv(e);return yield n.initialize(),Rb.createController(n,t)},Db=function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){jb(i,r,o,a,c,"next",e)}function c(e){jb(i,r,o,a,c,"throw",e)}a(void 0)})}).apply(this,arguments);var e}function qb(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function Hb(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){qb(i,r,o,a,c,"next",e)}function c(e){qb(i,r,o,a,c,"throw",e)}a(void 0)})}}class Lb{static createPublicClientApplication(e){return Hb(function*(){var t=yield function(e,t){return Db.apply(this,arguments)}(e);return new Lb(e,t)})()}constructor(e,t){this.controller=t||new Rb(new xv(e))}initialize(e){var t=this;return Hb(function*(){return t.controller.initialize(e)})()}acquireTokenPopup(e){var t=this;return Hb(function*(){return t.controller.acquireTokenPopup(e)})()}acquireTokenRedirect(e){return this.controller.acquireTokenRedirect(e)}acquireTokenSilent(e){return this.controller.acquireTokenSilent(e)}acquireTokenByCode(e){return this.controller.acquireTokenByCode(e)}addEventCallback(e,t){return this.controller.addEventCallback(e,t)}removeEventCallback(e){return this.controller.removeEventCallback(e)}addPerformanceCallback(e){return this.controller.addPerformanceCallback(e)}removePerformanceCallback(e){return this.controller.removePerformanceCallback(e)}enableAccountStorageEvents(){this.controller.enableAccountStorageEvents()}disableAccountStorageEvents(){this.controller.disableAccountStorageEvents()}getAccount(e){return this.controller.getAccount(e)}getAccountByHomeId(e){return this.controller.getAccountByHomeId(e)}getAccountByLocalId(e){return this.controller.getAccountByLocalId(e)}getAccountByUsername(e){return this.controller.getAccountByUsername(e)}getAllAccounts(e){return this.controller.getAllAccounts(e)}handleRedirectPromise(e){return this.controller.handleRedirectPromise(e)}loginPopup(e){return this.controller.loginPopup(e)}loginRedirect(e){return this.controller.loginRedirect(e)}logout(e){return this.controller.logout(e)}logoutRedirect(e){return this.controller.logoutRedirect(e)}logoutPopup(e){return this.controller.logoutPopup(e)}ssoSilent(e){return this.controller.ssoSilent(e)}getTokenCache(){return this.controller.getTokenCache()}getLogger(){return this.controller.getLogger()}setLogger(e){this.controller.setLogger(e)}setActiveAccount(e){this.controller.setActiveAccount(e)}getActiveAccount(){return this.controller.getActiveAccount()}initializeWrapperLibrary(e,t){return this.controller.initializeWrapperLibrary(e,t)}setNavigationClient(e){this.controller.setNavigationClient(e)}getConfiguration(){return this.controller.getConfiguration()}hydrateCache(e,t){var n=this;return Hb(function*(){return n.controller.hydrateCache(e,t)})()}clearCache(e){return this.controller.clearCache(e)}}var Bb=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function c(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,c)}s((r=r.apply(e,t||[])).next())})};class Ub{constructor(){this.msalInstance=null,this.currentAccount=null,this.isInitialized=!1,this.refreshPromises=new Map}static getInstance(){return Ub.instance||(Ub.instance=new Ub),Ub.instance}initialize(){return Bb(this,void 0,void 0,function*(){if(this.isInitialized)console.warn("[MsalAuthProvider] Already initialized, skipping");else{console.info("[MsalAuthProvider] Initializing MSAL...");try{!function(){var e=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;if(!e.test(jl))throw new Error('[MSAL Config] Invalid CLIENT_ID: "'.concat(jl,'"'));if(!e.test(Dl))throw new Error('[MSAL Config] Invalid TENANT_ID: "'.concat(Dl,'"'));if(!ql.startsWith("https://")||!ql.includes(".dynamics.com"))throw new Error('[MSAL Config] Invalid REDIRECT_URI: "'.concat(ql,'"'));console.info("[MSAL Config] Configuration validation passed")}(),this.msalInstance=new Lb(Hl),yield this.msalInstance.initialize();var e=yield this.msalInstance.handleRedirectPromise();if(e&&(this.currentAccount=e.account),!this.currentAccount){var t=this.msalInstance.getAllAccounts();t.length>0&&(this.currentAccount=t[0],console.info("[MsalAuthProvider] Active account found: ".concat(this.currentAccount.username)))}this.isInitialized=!0,console.info("[MsalAuthProvider] Initialization complete")}catch(e){throw console.error("[MsalAuthProvider] Initialization failed",e),new Error("MSAL initialization failed: ".concat(e instanceof Error?e.message:String(e)))}}})}isAuthenticated(){return null!==this.currentAccount}getToken(e){return Bb(this,void 0,void 0,function*(){if(!this.isInitialized||!this.msalInstance)throw new Error("MSAL not initialized. Call initialize() first.");if(!e||0===e.length)throw new Error("Scopes parameter is required and must not be empty.");var t=this.getCachedToken(e);if(t)return t;console.info("[MsalAuthProvider] Acquiring token for scopes: ".concat(e.join(", ")));try{var n=yield this.acquireTokenSilent(e);return console.info("[MsalAuthProvider] Token acquired successfully via silent flow"),n.expiresOn&&this.setCachedToken(n.accessToken,n.expiresOn,e),n.accessToken}catch(t){if(t instanceof wm){console.warn("[MsalAuthProvider] Silent token acquisition failed, falling back to popup...");try{var r=yield this.acquireTokenPopup(e);return console.info("[MsalAuthProvider] Token acquired successfully via popup"),r.expiresOn&&this.setCachedToken(r.accessToken,r.expiresOn,e),r.accessToken}catch(e){throw console.error("[MsalAuthProvider] Popup token acquisition failed",e),new Error("Failed to acquire token via popup: ".concat(e instanceof Error?e.message:"Unknown error"))}}throw console.error("[MsalAuthProvider] Token acquisition failed",t),new Error("Failed to acquire token: ".concat(t instanceof Error?t.message:"Unknown error"))}})}clearCache(){console.info("[MsalAuthProvider] Clearing token cache"),this.refreshPromises.clear();try{for(var e=[],t=0;t<sessionStorage.length;t++){var n=sessionStorage.key(t);(null==n?void 0:n.startsWith(Ub.CACHE_KEY_PREFIX))&&e.push(n)}e.forEach(e=>sessionStorage.removeItem(e))}catch(e){console.warn("[MsalAuthProvider] Failed to clear sessionStorage cache",e)}this.currentAccount=null,console.info("[MsalAuthProvider] Token cache cleared")}acquireTokenSilent(e){return Bb(this,void 0,void 0,function*(){if(!this.msalInstance)throw new Error("MSAL instance not initialized");if(this.currentAccount){var t={scopes:e,account:this.currentAccount};try{return yield this.msalInstance.acquireTokenSilent(t)}catch(e){console.debug("[MsalAuthProvider] acquireTokenSilent failed, trying ssoSilent")}}var n={scopes:e},r=yield this.msalInstance.ssoSilent(n);return r.account&&(this.currentAccount=r.account),r})}acquireTokenPopup(e){return Bb(this,void 0,void 0,function*(){var t;if(!this.msalInstance)throw new Error("MSAL instance not initialized");var n={scopes:e,loginHint:null===(t=this.currentAccount)||void 0===t?void 0:t.username};try{var r=yield this.msalInstance.acquireTokenPopup(n);return r.account&&(this.currentAccount=r.account),r}catch(e){if(e instanceof Error){if(e.message.includes("user_cancelled")||e.message.includes("popup_window_closed"))throw new Error("Authentication cancelled by user");if(e.message.includes("popup_window_error")||e.message.includes("BrowserAuthError"))throw new Error("Popup blocked. Please allow popups for this site and try again.")}throw e}})}getCachedToken(e){try{var t=this.getCacheKey(e),n=sessionStorage.getItem(t);if(!n)return null;var r=JSON.parse(n);return Date.now()>=r.expiresAt-Ub.EXPIRATION_BUFFER_MS?(this.removeCachedToken(e),null):this.scopesMatch(r.scopes,e)?r.token:null}catch(e){return console.warn("[MsalAuthProvider] Failed to read cached token",e),null}}setCachedToken(e,t,n){try{var r=this.getCacheKey(n),o={token:e,expiresAt:t.getTime(),scopes:n};sessionStorage.setItem(r,JSON.stringify(o))}catch(e){console.warn("[MsalAuthProvider] Failed to cache token",e)}}removeCachedToken(e){try{var t=this.getCacheKey(e);sessionStorage.removeItem(t)}catch(e){console.warn("[MsalAuthProvider] Failed to remove cached token",e)}}getCacheKey(e){var t=e.slice().sort();return Ub.CACHE_KEY_PREFIX+t.join(",")}scopesMatch(e,t){if(e.length!==t.length)return!1;var n=e.slice().sort(),r=t.slice().sort();return n.every((e,t)=>e===r[t])}}Ub.CACHE_KEY_PREFIX="msal.token.",Ub.EXPIRATION_BUFFER_MS=3e5;class zb{constructor(){this.authProvider=Ub.getInstance()}init(e,t,n){this.notifyOutputChanged=t,this.authProvider.initialize().catch(e=>{console.error("[DocumentRelationshipViewer] MSAL initialization failed:",e)})}updateView(e){var t={context:e,notifyOutputChanged:this.notifyOutputChanged,onDocumentSelect:this.handleDocumentSelect.bind(this),authProvider:this.authProvider};return n.createElement(Ul,t)}handleDocumentSelect(e){this.selectedDocumentId=e,this.notifyOutputChanged()}getOutputs(){return{selectedDocumentId:this.selectedDocumentId}}destroy(){}}pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad=t})();
if (window.ComponentFramework && window.ComponentFramework.registerControl) {
	ComponentFramework.registerControl('Spaarke.Controls.DocumentRelationshipViewer', pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad.DocumentRelationshipViewer);
} else {
	var Spaarke = Spaarke || {};
	Spaarke.Controls = Spaarke.Controls || {};
	Spaarke.Controls.DocumentRelationshipViewer = pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad.DocumentRelationshipViewer;
	pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad = undefined;
}