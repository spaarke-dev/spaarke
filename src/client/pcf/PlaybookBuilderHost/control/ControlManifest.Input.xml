<?xml version="1.0" encoding="utf-8"?>
<manifest>
  <control namespace="Spaarke.Controls"
           constructor="PlaybookBuilderHost"
           version="1.2.4"
           display-name-key="Playbook Builder Host"
           description-key="Host control for the node-based Playbook Builder visual canvas"
           control-type="standard">

    <external-service-usage enabled="false" />

    <!--
      PLAYBOOK BUILDER HOST PCF CONTROL

      Purpose: Embeds the React 18 Playbook Builder app in an iframe.
      - Passes playbook data to iframe via postMessage
      - Receives dirty state notifications from iframe
      - Handles save/load operations with Dataverse

      Entity: sprk_analysisplaybook (Analysis Playbook)

      Architecture:
      - PCF uses React 16 APIs (platform-provided)
      - Builder app uses React 18 (bundled in iframe)
      - Communication via postMessage bridge

      Note: The playbook ID is automatically obtained from the form context
      (context.mode.contextInfo.entityId). The playbookId property below is
      only used as a fallback if contextInfo is not available.
    -->

    <!-- Playbook ID (OPTIONAL - auto-detected from form context) -->
    <property name="playbookId"
              display-name-key="Playbook ID"
              description-key="Optional fallback - record ID is auto-detected from form context"
              of-type="SingleLine.Text"
              usage="input"
              required="false" />

    <!-- Playbook Name (INPUT - for display) -->
    <property name="playbookName"
              display-name-key="Playbook Name"
              description-key="Display name of the playbook"
              of-type="SingleLine.Text"
              usage="input"
              required="false" />

    <!-- Canvas JSON (BOUND - serialized node graph) -->
    <property name="canvasJson"
              display-name-key="Canvas JSON"
              description-key="Serialized JSON of the canvas nodes and edges"
              of-type="Multiple"
              usage="bound"
              required="false" />

    <!-- Builder Base URL (INPUT - where the React 18 app is hosted) -->
    <property name="builderBaseUrl"
              display-name-key="Builder Base URL"
              description-key="Base URL for the playbook builder app"
              of-type="SingleLine.Text"
              usage="input"
              required="false" />

    <!-- Is Dirty (OUTPUT - indicates unsaved changes) -->
    <property name="isDirty"
              display-name-key="Is Dirty"
              description-key="True when canvas has unsaved changes"
              of-type="TwoOptions"
              usage="output"
              required="false" />

    <resources>
      <code path="index.ts" order="1" />
      <css path="styles.css" order="2" />
      <!-- Host-provided libraries (Dataverse runtime provides these) -->
      <platform-library name="React" version="16.14.0" />
      <platform-library name="Fluent" version="9.46.2" />
    </resources>

    <feature-usage>
      <uses-feature name="WebAPI" required="true" />
      <uses-feature name="Utility" required="true" />
    </feature-usage>
  </control>
</manifest>
