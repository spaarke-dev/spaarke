/*! For license information please see bundle.js.LICENSE.txt */
var pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad;(()=>{"use strict";var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})}};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var t={};e.r(t),e.d(t,{SemanticSearchControl:()=>Uh});const r=Reactv16,n=FluentUIReactv940;var o="spaarke-theme-change";function i(e){var t,r=function(){try{var e=localStorage.getItem("spaarke-theme");if("light"===e||"dark"===e||"auto"===e)return e}catch(e){}return"auto"}();if("dark"===r)return!0;if("light"===r)return!1;var n=function(){try{var e=new URLSearchParams(window.location.search).get("flags");if(null==e?void 0:e.includes("themeOption=dark"))return!0;if(null==e?void 0:e.includes("themeOption=light"))return!1}catch(e){}return null}();if(null!==n)return n;if(void 0!==(null===(t=null==e?void 0:e.fluentDesignLanguage)||void 0===t?void 0:t.isDarkTheme))return e.fluentDesignLanguage.isDarkTheme;var o=function(){var e,t;try{var r=document.querySelector('[data-id="navbar-container"]');if(!r)return null;var n=null!==(t=null===(e=window.getComputedStyle(r).backgroundColor.match(/\d+/g))||void 0===e?void 0:e.map(Number))&&void 0!==t?t:[];return n.length<3?null:(.299*n[0]+.587*n[1]+.114*n[2])/255<.5}catch(e){}return null}();return null!==o?o:function(){try{return window.matchMedia("(prefers-color-scheme: dark)").matches}catch(e){return!1}}()}function a(e){var t;if(null===(t=null==e?void 0:e.fluentDesignLanguage)||void 0===t?void 0:t.tokenTheme){var r=String(e.fluentDesignLanguage.tokenTheme);if("TeamsHighContrast"===r||"HighContrastWhite"===r||"HighContrastBlack"===r)return n.teamsHighContrastTheme}return i(e)?n.webDarkTheme:n.webLightTheme}var s=(0,n.makeStyles)({container:{display:"flex",flexDirection:"column",gap:n.tokens.spacingVerticalM,padding:n.tokens.spacingHorizontalM},card:{display:"flex",flexDirection:"column",gap:n.tokens.spacingVerticalS,padding:n.tokens.spacingHorizontalM,backgroundColor:n.tokens.colorNeutralBackground1,borderRadius:n.tokens.borderRadiusMedium,border:"1px solid ".concat(n.tokens.colorNeutralStroke1)},header:{display:"flex",alignItems:"center",gap:n.tokens.spacingHorizontalM},icon:{width:"32px",height:"32px"},titleGroup:{display:"flex",flexDirection:"column",gap:n.tokens.spacingVerticalXS,flex:1},title:{width:"60%",height:"20px"},subtitle:{width:"40%",height:"14px"},badge:{width:"48px",height:"24px"},content:{display:"flex",flexDirection:"column",gap:n.tokens.spacingVerticalXS,marginTop:n.tokens.spacingVerticalS},line:{height:"14px"},lineFull:{width:"100%"},lineMedium:{width:"80%"},lineShort:{width:"50%"},metadata:{display:"flex",gap:n.tokens.spacingHorizontalM,marginTop:n.tokens.spacingVerticalS},metaItem:{width:"80px",height:"14px"}}),c=()=>{var e=s();return r.createElement("div",{className:e.card},r.createElement(n.Skeleton,null,r.createElement("div",{className:e.header},r.createElement(n.SkeletonItem,{shape:"square",className:e.icon}),r.createElement("div",{className:e.titleGroup},r.createElement(n.SkeletonItem,{shape:"rectangle",className:e.title}),r.createElement(n.SkeletonItem,{shape:"rectangle",className:e.subtitle})),r.createElement(n.SkeletonItem,{shape:"rectangle",className:e.badge})),r.createElement("div",{className:e.content},r.createElement(n.SkeletonItem,{shape:"rectangle",className:"".concat(e.line," ").concat(e.lineFull)}),r.createElement(n.SkeletonItem,{shape:"rectangle",className:"".concat(e.line," ").concat(e.lineMedium)}),r.createElement(n.SkeletonItem,{shape:"rectangle",className:"".concat(e.line," ").concat(e.lineShort)})),r.createElement("div",{className:e.metadata},r.createElement(n.SkeletonItem,{shape:"rectangle",className:e.metaItem}),r.createElement(n.SkeletonItem,{shape:"rectangle",className:e.metaItem}),r.createElement(n.SkeletonItem,{shape:"rectangle",className:e.metaItem}))))},l=e=>{var{count:t=3}=e,n=s(),o=Array.from({length:t},(e,t)=>t);return r.createElement("div",{className:n.container},o.map(e=>r.createElement(c,{key:e})))},u="undefined"==typeof window?e.g:window,d="@griffel/";function h(e,t){return u[Symbol.for(d+e)]||(u[Symbol.for(d+e)]=t),u[Symbol.for(d+e)]}var g=h("DEFINITION_LOOKUP_TABLE",{}),p="data-make-styles-bucket";function m(e,t){return"___"+function(e){var t=e.length;if(7===t)return e;for(var r=t;r<7;r++)e+="0";return e}(function(e){for(var t,r=0,n=0,o=e.length;o>=4;++n,o-=4)t=1540483477*(65535&(t=255&e.charCodeAt(n)|(255&e.charCodeAt(++n))<<8|(255&e.charCodeAt(++n))<<16|(255&e.charCodeAt(++n))<<24))+(59797*(t>>>16)<<16),r=1540483477*(65535&(t^=t>>>24))+(59797*(t>>>16)<<16)^1540483477*(65535&r)+(59797*(r>>>16)<<16);switch(o){case 3:r^=(255&e.charCodeAt(n+2))<<16;case 2:r^=(255&e.charCodeAt(n+1))<<8;case 1:r=1540483477*(65535&(r^=255&e.charCodeAt(n)))+(59797*(r>>>16)<<16)}return(((r=1540483477*(65535&(r^=r>>>13))+(59797*(r>>>16)<<16))^r>>>15)>>>0).toString(36)}(e+t))}function v(e,t){var r="",n="";for(var o in e){var i=e[o];if(0!==i){var a=Array.isArray(i),s="rtl"===t?(a?i[1]:i)+" ":(a?i[0]:i)+" ";r+=s,n+=s}else n+=o+" "}return[r.slice(0,-1),n.slice(0,-1)]}function f(e,t){var r={};for(var n in e){var[o,i]=v(e[n],t);if(""!==i){var a=m(i,t),s=a+(""===o?"":" "+o);g[a]=[e[n],t],r[n]=s}else r[n]=""}return r}var y={};function C(){for(var e=arguments,t=null,r="",n="",o=new Array(arguments.length),i=function(){var t=e[a];if("string"==typeof t&&""!==t){var i=t.indexOf("___");if(-1===i)r+=t+" ";else{var s=t.substr(i,10);i>0&&(r+=t.slice(0,i)),n+=s,o[a]=s}}},a=0;a<arguments.length;a++)i();if(""===n)return r.slice(0,-1);var s=y[n];if(void 0!==s)return r+s;for(var c=[],l=0;l<arguments.length;l++){var u=o[l];if(u){var d=g[u];d&&(c.push(d[0]),t=d[1])}}var h=Object.assign.apply(Object,[{}].concat(c)),[p,f]=v(h,t),C=m(f,t),w=C+" "+p;return y[n]=w,g[C]=[h,t],r+w}var w=r.createContext(void 0),b={},k=(w.Provider,()=>{var e={};return function(t,r){void 0===e[t.id]&&(t.insertCSSRules(r),e[t.id]=!0)}}),I=r.useInsertionEffect?r.useInsertionEffect:void 0,T=()=>{var e={};return function(t,r){I&&"undefined"!=typeof window&&window.document&&window.document.createElement?I(()=>{t.insertCSSRules(r)},[t,r]):void 0===e[t.id]&&(t.insertCSSRules(r),e[t.id]=!0)}};function S(e){return Array.isArray(e)?e:[e]}var A=["r","d","l","v","w","f","i","h","a","s","k","t","m","c"].reduce((e,t,r)=>(e[t]=r,e),{});function E(e,t,r,n){var o,i,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},s="m"===e,c=null!==(o=a.m)&&void 0!==o?o:"0",l=null!==(i=a.p)&&void 0!==i?i:0,u=function(e,t,r){return("m"===e?e+t:e)+r}(e,c,l);if(!n.stylesheets[u]){var d=t&&t.createElement("style"),h=function(e,t,r,n){var o=[];if(n[p]=t,n["data-priority"]=String(r),e)for(var i in n)e.setAttribute(i,n[i]);return{elementAttributes:n,insertRule:function(t){return(null==e?void 0:e.sheet)?e.sheet.insertRule(t,e.sheet.cssRules.length):o.push(t)},element:e,bucketName:t,cssRules:()=>(null==e?void 0:e.sheet)?Array.from(e.sheet.cssRules).map(e=>e.cssText):o}}(d,e,l,Object.assign({},n.styleElementAttributes,s&&{media:c}));n.stylesheets[u]=h,(null==t?void 0:t.head)&&d&&t.head.insertBefore(d,function(e,t,r,n){var o,i,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},s=A[r],c=null!==(o=a.m)&&void 0!==o?o:"",l=null!==(i=a.p)&&void 0!==i?i:0,u=e=>s-A[e.getAttribute(p)],d=e.head.querySelectorAll("[".concat(p,"]"));if("m"===r){var h=e.head.querySelectorAll("[".concat(p,'="').concat(r,'"]'));h.length&&(d=h,u=e=>n.compareMediaQueries(c,e.media))}for(var g=e=>function(e,t,r){var n,o;return t+(null!==(n=r.m)&&void 0!==n?n:"")===e.getAttribute(p)+(null!==(o=e.media)&&void 0!==o?o:"")}(e,r,a)?l-Number(e.getAttribute("data-priority")):u(e),m=d.length,v=m-1;v>=0;){var f=d.item(v);if(g(f)>0)return f.nextSibling;v--}return m>0?d.item(0):t?t.nextSibling:null}(t,r,e,n,a))}return n.stylesheets[u]}function O(e,t){try{e.insertRule(t)}catch(e){}}":(".concat(["-moz-placeholder","-moz-focus-inner","-moz-focusring","-ms-input-placeholder","-moz-read-write","-moz-read-only"].join("|"),")");var P=0,R=(e,t)=>e<t?-1:e>t?1:0;function _(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"undefined"==typeof document?void 0:document,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{classNameHashSalt:r,unstable_filterCSSRule:n,insertionPoint:o,styleElementAttributes:i,compareMediaQueries:a=R}=t,s={classNameHashSalt:r,insertionCache:{},stylesheets:{},styleElementAttributes:Object.freeze(i),compareMediaQueries:a,id:"d".concat(P++),insertCSSRules(t){for(var r in t)for(var i=t[r],a=0,c=i.length;a<c;a++){var[l,u]=S(i[a]),d=E(r,e,o||null,s,u);s.insertionCache[l]||(s.insertionCache[l]=r,n?n(l)&&O(d,l):O(d,l))}}};return s}var M=r.createContext(_()),N=r.createContext("ltr");function x(e,t){var n=function(e,t){var r=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:k)(),n=null,o=null;return function(i){var{dir:a,renderer:s}=i,c="ltr"===a;return c?null===n&&(n=f(e,a)):null===o&&(o=f(e,a)),r(s,t),c?n:o}}(e,t,T);return function(){var e=r.useContext(N),t=r.useContext(M);return n({dir:e,renderer:t})}}var q=x({root:{mc9l5x:"f1w7gpdv",Bg96gwp:"fez10in"},rtl:{Bz10aip:"f13rod7r"}},{d:[".f1w7gpdv{display:inline;}",".fez10in{line-height:0;}",".f13rod7r{transform:scaleX(-1);}"]}),L=["title","primaryFill"];function H(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function j(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?H(Object(r),!0).forEach(function(t){D(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function D(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var U=x({root:{B8gzw0y:"f1dd5bof"}},{m:[["@media (forced-colors: active){.f1dd5bof{forced-color-adjust:auto;}}",{m:"(forced-colors: active)"}]]});function B(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function F(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?B(Object(r),!0).forEach(function(t){K(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function K(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var z=(e,t,n,o)=>{var i="1em"===t?"20":t,a=r.forwardRef((e,a)=>{var s=U(),c=((e,t)=>{var n,{title:o,primaryFill:i="currentColor"}=e,a=j(j({},function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(e,L)),{},{title:void 0,fill:i}),s=q(),c=null!=(n=r.useContext(w))?n:b;return a.className=C(s.root,(null==t?void 0:t.flipInRtl)&&"rtl"===(null==c?void 0:c.textDirection)&&s.rtl,a.className),o&&(a["aria-label"]=o),a["aria-label"]||a["aria-labelledby"]?a.role="img":a["aria-hidden"]=!0,a})(e,{flipInRtl:null==o?void 0:o.flipInRtl}),l=F(F({},c),{},{className:C("fui-Icon",c.className,s.root),ref:a,width:t,height:t,viewBox:"0 0 ".concat(i," ").concat(i),xmlns:"http://www.w3.org/2000/svg"});return"string"==typeof n?r.createElement("svg",F(F({},l),{},{dangerouslySetInnerHTML:{__html:n}})):r.createElement("svg",l,...n.map(e=>r.createElement("path",{d:e,fill:l.fill})))});return a.displayName=e,a},G=z("Search20Regular","20",["M13.73 14.44a6.5 6.5 0 1 1 .7-.7l3.42 3.4a.5.5 0 0 1-.63.77l-.07-.06-3.42-3.41Zm-.71-.71A5.54 5.54 0 0 0 15 9.5a5.5 5.5 0 1 0-1.98 4.23Z"]),V=z("SearchInfo20Regular","20",["M13.73 14.44a6.5 6.5 0 1 1 .7-.7l3.42 3.4a.5.5 0 0 1-.63.77l-.07-.06-3.42-3.41Zm-.71-.71A5.54 5.54 0 0 0 15 9.5a5.5 5.5 0 1 0-1.98 4.23ZM9.5 8.5c.28 0 .5.22.5.5v3a.5.5 0 0 1-1 0V9c0-.28.22-.5.5-.5Zm0-1a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z"]),W=(0,n.makeStyles)({container:{display:"flex",gap:n.tokens.spacingHorizontalS,alignItems:"center"},input:{flex:1,minWidth:"200px"},button:{minWidth:"100px"}}),Q=e=>{var{value:t,placeholder:o,disabled:i,onValueChange:a,onSearch:s}=e,c=W(),[l,u]=(0,r.useState)(t);r.useEffect(()=>{u(t)},[t]);var d=(0,r.useCallback)(e=>{var t=e.target.value;u(t),a(t)},[a]),h=(0,r.useCallback)(e=>{"Enter"===e.key&&!i&&l.trim()&&s()},[i,l,s]),g=(0,r.useCallback)(()=>{!i&&l.trim()&&s()},[i,l,s]);return r.createElement("div",{className:c.container},r.createElement(n.Input,{className:c.input,value:l,placeholder:o,disabled:i,onChange:d,onKeyDown:h,contentBefore:r.createElement(G,null),appearance:"outline",size:"medium"}),r.createElement(n.Button,{className:c.button,appearance:"primary",disabled:i||!l.trim(),onClick:g,icon:i?r.createElement(n.Spinner,{size:"tiny"}):void 0},i?"Searching...":"Search"))},Y=z("Dismiss20Regular","20",["m4.09 4.22.06-.07a.5.5 0 0 1 .63-.06l.07.06L10 9.29l5.15-5.14a.5.5 0 0 1 .63-.06l.07.06c.18.17.2.44.06.63l-.06.07L10.71 10l5.14 5.15c.18.17.2.44.06.63l-.06.07a.5.5 0 0 1-.63.06l-.07-.06L10 10.71l-5.15 5.14a.5.5 0 0 1-.63.06l-.07-.06a.5.5 0 0 1-.06-.63l.06-.07L9.29 10 4.15 4.85a.5.5 0 0 1-.06-.63l.06-.07-.06.07Z"]),J=(0,n.makeStyles)({container:{display:"flex",flexDirection:"column",gap:n.tokens.spacingVerticalXS,minWidth:"150px"},label:{fontWeight:n.tokens.fontWeightSemibold,fontSize:n.tokens.fontSizeBase200},dropdown:{width:"100%"},loading:{display:"flex",alignItems:"center",gap:n.tokens.spacingHorizontalS}}),X=e=>{var{label:t,options:o,selectedKeys:i,onSelectionChange:a,disabled:s,multiSelect:c=!0}=e,l=J(),u=(0,n.useId)("filter-dropdown"),d=(0,r.useCallback)((e,t)=>{a(t.selectedOptions)},[a]),h=(0,r.useMemo)(()=>{var e;if(0===i.length)return"All";if(1===i.length){var t=o.find(e=>e.key===i[0]);return null!==(e=null==t?void 0:t.label)&&void 0!==e?e:i[0]}return"".concat(i.length," selected")},[i,o]);return 0!==o.length||s?r.createElement("div",{className:l.container},r.createElement(n.Label,{className:l.label,htmlFor:u},t),r.createElement(n.Dropdown,{id:u,className:l.dropdown,placeholder:"All",value:h,selectedOptions:i,onOptionSelect:d,disabled:s,multiselect:c},o.map(e=>r.createElement(n.Option,{key:e.key,value:e.key},e.label)))):r.createElement("div",{className:l.container},r.createElement(n.Label,{className:l.label,htmlFor:u},t),r.createElement("div",{className:l.loading},r.createElement(n.Spinner,{size:"tiny"}),r.createElement("span",null,"Loading...")))},Z=z("CalendarRegular","1em",["M7 11a1 1 0 1 0 0-2 1 1 0 0 0 0 2Zm1 2a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm2-2a1 1 0 1 0 0-2 1 1 0 0 0 0 2Zm1 2a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm2-2a1 1 0 1 0 0-2 1 1 0 0 0 0 2Zm4-5.5A2.5 2.5 0 0 0 14.5 3h-9A2.5 2.5 0 0 0 3 5.5v9A2.5 2.5 0 0 0 5.5 17h9a2.5 2.5 0 0 0 2.5-2.5v-9ZM4 7h12v7.5c0 .83-.67 1.5-1.5 1.5h-9A1.5 1.5 0 0 1 4 14.5V7Zm1.5-3h9c.83 0 1.5.67 1.5 1.5V6H4v-.5C4 4.67 4.67 4 5.5 4Z"],{flipInRtl:!0}),$=z("ChevronDownRegular","1em",["M15.85 7.65c.2.2.2.5 0 .7l-5.46 5.49a.55.55 0 0 1-.78 0L4.15 8.35a.5.5 0 1 1 .7-.7L10 12.8l5.15-5.16c.2-.2.5-.2.7 0Z"]),ee=(0,n.makeStyles)({container:{display:"flex",flexDirection:"column",gap:n.tokens.spacingVerticalXS},label:{fontWeight:n.tokens.fontWeightSemibold,fontSize:n.tokens.fontSizeBase200},inputGroup:{display:"flex",alignItems:"center",gap:n.tokens.spacingHorizontalS},dateInput:{flex:1,minWidth:"120px"},separator:{color:n.tokens.colorNeutralForeground3},presets:{marginTop:n.tokens.spacingVerticalXS},clearButton:{marginLeft:n.tokens.spacingHorizontalS}}),te=[{label:"Last 30 days",days:30},{label:"Last 90 days",days:90},{label:"This year",days:-1},{label:"Last year",days:-2}];function re(e){return e.toISOString().split("T")[0]}var ne=e=>{var t,o,{label:i,value:a,onChange:s,disabled:c}=e,l=ee(),u=(0,n.useId)("date-from"),d=(0,n.useId)("date-to"),[h,g]=(0,r.useState)(null!==(t=null==a?void 0:a.from)&&void 0!==t?t:""),[p,m]=(0,r.useState)(null!==(o=null==a?void 0:a.to)&&void 0!==o?o:""),[v,f]=(0,r.useState)(null);r.useEffect(()=>{var e,t;g(null!==(e=null==a?void 0:a.from)&&void 0!==e?e:""),m(null!==(t=null==a?void 0:a.to)&&void 0!==t?t:"")},[a]);var y=(0,r.useCallback)((e,t)=>{f(null),e||t?e&&t&&e>t?f("From date must be before To date"):s({from:e||null,to:t||null}):s(null)},[s]),C=(0,r.useCallback)(e=>{var t=e.target.value;g(t),y(t,p)},[p,y]),w=(0,r.useCallback)(e=>{var t=e.target.value;m(t),y(h,t)},[h,y]),b=(0,r.useCallback)(e=>{var t,r,n=function(e){var t=new Date,r=re(t);if(-1===e)return{from:re(new Date(t.getFullYear(),0,1)),to:r};if(-2===e){var n=new Date(t.getFullYear()-1,0,1),o=new Date(t.getFullYear()-1,11,31);return{from:re(n),to:re(o)}}var i=new Date(t);return i.setDate(i.getDate()-e),{from:re(i),to:r}}(e);g(null!==(t=n.from)&&void 0!==t?t:""),m(null!==(r=n.to)&&void 0!==r?r:""),s(n),f(null)},[s]),k=(0,r.useCallback)(()=>{g(""),m(""),s(null),f(null)},[s]),I=(0,r.useMemo)(()=>Boolean(h||p),[h,p]);return r.createElement("div",{className:l.container},r.createElement(n.Label,{className:l.label},i),r.createElement("div",{className:l.inputGroup},r.createElement(n.Input,{id:u,className:l.dateInput,type:"date",value:h,onChange:C,disabled:c,contentBefore:r.createElement(Z,null),placeholder:"From","aria-label":"From date"}),r.createElement("span",{className:l.separator},"to"),r.createElement(n.Input,{id:d,className:l.dateInput,type:"date",value:p,onChange:w,disabled:c,contentBefore:r.createElement(Z,null),placeholder:"To","aria-label":"To date"}),I&&r.createElement(n.Button,{appearance:"subtle",size:"small",onClick:k,disabled:c,className:l.clearButton},"Clear")),v&&r.createElement("span",{style:{color:n.tokens.colorPaletteRedForeground1,fontSize:n.tokens.fontSizeBase200}},v),r.createElement("div",{className:l.presets},r.createElement(n.Menu,null,r.createElement(n.MenuTrigger,{disableButtonEnhancement:!0},r.createElement(n.Button,{appearance:"subtle",size:"small",icon:r.createElement($,null),iconPosition:"after",disabled:c},"Quick select")),r.createElement(n.MenuPopover,null,r.createElement(n.MenuList,null,te.map(e=>r.createElement(n.MenuItem,{key:e.label,onClick:()=>b(e.days)},e.label)))))))};function oe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function ie(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?oe(Object(r),!0).forEach(function(t){ae(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):oe(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function ae(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var se,ce={LIBRARY_NAME:"MSAL.JS",SKU:"msal.js.common",CACHE_PREFIX:"msal",DEFAULT_AUTHORITY:"https://login.microsoftonline.com/common/",DEFAULT_AUTHORITY_HOST:"login.microsoftonline.com",DEFAULT_COMMON_TENANT:"common",ADFS:"adfs",DSTS:"dstsv2",AAD_INSTANCE_DISCOVERY_ENDPT:"https://login.microsoftonline.com/common/discovery/instance?api-version=1.1&authorization_endpoint=",CIAM_AUTH_URL:".ciamlogin.com",AAD_TENANT_DOMAIN_SUFFIX:".onmicrosoft.com",RESOURCE_DELIM:"|",NO_ACCOUNT:"NO_ACCOUNT",CLAIMS:"claims",CONSUMER_UTID:"9188040d-6c67-4c5b-b112-36a304b66dad",OPENID_SCOPE:"openid",PROFILE_SCOPE:"profile",OFFLINE_ACCESS_SCOPE:"offline_access",EMAIL_SCOPE:"email",CODE_RESPONSE_TYPE:"code",CODE_GRANT_TYPE:"authorization_code",RT_GRANT_TYPE:"refresh_token",FRAGMENT_RESPONSE_MODE:"fragment",S256_CODE_CHALLENGE_METHOD:"S256",URL_FORM_CONTENT_TYPE:"application/x-www-form-urlencoded;charset=utf-8",AUTHORIZATION_PENDING:"authorization_pending",NOT_DEFINED:"not_defined",EMPTY_STRING:"",NOT_APPLICABLE:"N/A",NOT_AVAILABLE:"Not Available",FORWARD_SLASH:"/",IMDS_ENDPOINT:"http://169.254.169.254/metadata/instance/compute/location",IMDS_VERSION:"2020-06-01",IMDS_TIMEOUT:2e3,AZURE_REGION_AUTO_DISCOVER_FLAG:"TryAutoDetect",REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX:"login.microsoft.com",KNOWN_PUBLIC_CLOUDS:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],TOKEN_RESPONSE_TYPE:"token",ID_TOKEN_RESPONSE_TYPE:"id_token",SHR_NONCE_VALIDITY:240,INVALID_INSTANCE:"invalid_instance"},le=[ce.OPENID_SCOPE,ce.PROFILE_SCOPE,ce.OFFLINE_ACCESS_SCOPE],ue=[...le,ce.EMAIL_SCOPE],de="Content-Type",he="Retry-After",ge="X-AnchorMailbox",pe="x-ms-request-id",me="x-ms-httpver",ve="idtoken",fe="client.info",ye="adal.idtoken",Ce="error",we="error.description",be="active-account",ke="active-account-filters",Ie="common",Te="organizations",Se="consumers",Ae="access_token",Ee={LOGIN:"login",SELECT_ACCOUNT:"select_account",CONSENT:"consent",NONE:"none",CREATE:"create",NO_SESSION:"no_session"},Oe={PLAIN:"plain",S256:"S256"},Pe={QUERY:"query",FRAGMENT:"fragment"},Re=ie(ie({},Pe),{},{FORM_POST:"form_post"}),_e="Generic",Me="-",Ne={ID_TOKEN:"IdToken",ACCESS_TOKEN:"AccessToken",ACCESS_TOKEN_WITH_AUTH_SCHEME:"AccessToken_With_AuthScheme",REFRESH_TOKEN:"RefreshToken"},xe="appmetadata",qe="1",Le="authority-metadata",He="config",je="cache",De="network",Ue="hardcoded_values",Be={SCHEMA_VERSION:5,MAX_CUR_HEADER_BYTES:80,MAX_LAST_HEADER_BYTES:330,MAX_CACHED_ERRORS:50,CACHE_KEY:"server-telemetry",CATEGORY_SEPARATOR:"|",VALUE_SEPARATOR:",",OVERFLOW_TRUE:"1",OVERFLOW_FALSE:"0",UNKNOWN_ERROR:"unknown_error"},Fe={BEARER:"Bearer",POP:"pop",SSH:"ssh-cert"},Ke="throttling";!function(e){e[e.Error=0]="Error",e[e.Warning=1]="Warning",e[e.Info=2]="Info",e[e.Verbose=3]="Verbose",e[e.Trace=4]="Trace"}(se||(se={}));class ze{constructor(e,t,r){this.level=se.Info;var n=e||ze.createDefaultLoggerOptions();this.localCallback=n.loggerCallback||(()=>{}),this.piiLoggingEnabled=n.piiLoggingEnabled||!1,this.level="number"==typeof n.logLevel?n.logLevel:se.Info,this.correlationId=n.correlationId||ce.EMPTY_STRING,this.packageName=t||ce.EMPTY_STRING,this.packageVersion=r||ce.EMPTY_STRING}static createDefaultLoggerOptions(){return{loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:se.Info}}clone(e,t,r){return new ze({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level,correlationId:r||this.correlationId},e,t)}logMessage(e,t){if(!(t.logLevel>this.level||!this.piiLoggingEnabled&&t.containsPii)){var r=(new Date).toUTCString(),n="[".concat(r,"] : [").concat(t.correlationId||this.correlationId||"","]"),o="".concat(n," : ").concat(this.packageName,"@").concat(this.packageVersion," : ").concat(se[t.logLevel]," - ").concat(e);this.executeCallback(t.logLevel,o,t.containsPii||!1)}}executeCallback(e,t,r){this.localCallback&&this.localCallback(e,t,r)}error(e,t){this.logMessage(e,{logLevel:se.Error,containsPii:!1,correlationId:t||ce.EMPTY_STRING})}errorPii(e,t){this.logMessage(e,{logLevel:se.Error,containsPii:!0,correlationId:t||ce.EMPTY_STRING})}warning(e,t){this.logMessage(e,{logLevel:se.Warning,containsPii:!1,correlationId:t||ce.EMPTY_STRING})}warningPii(e,t){this.logMessage(e,{logLevel:se.Warning,containsPii:!0,correlationId:t||ce.EMPTY_STRING})}info(e,t){this.logMessage(e,{logLevel:se.Info,containsPii:!1,correlationId:t||ce.EMPTY_STRING})}infoPii(e,t){this.logMessage(e,{logLevel:se.Info,containsPii:!0,correlationId:t||ce.EMPTY_STRING})}verbose(e,t){this.logMessage(e,{logLevel:se.Verbose,containsPii:!1,correlationId:t||ce.EMPTY_STRING})}verbosePii(e,t){this.logMessage(e,{logLevel:se.Verbose,containsPii:!0,correlationId:t||ce.EMPTY_STRING})}trace(e,t){this.logMessage(e,{logLevel:se.Trace,containsPii:!1,correlationId:t||ce.EMPTY_STRING})}tracePii(e,t){this.logMessage(e,{logLevel:se.Trace,containsPii:!0,correlationId:t||ce.EMPTY_STRING})}isPiiLoggingEnabled(){return this.piiLoggingEnabled||!1}}var Ge="AAD",Ve="OIDC",We="none",Qe="unexpected_error",Ye="post_request_failed",Je={[Qe]:"Unexpected error in authentication.",[Ye]:"Post request failed from the network, could be a 4xx/5xx or a network unavailability. Please check the exact error code for details."};class Xe extends Error{constructor(e,t,r){super(t?"".concat(e,": ").concat(t):e),Object.setPrototypeOf(this,Xe.prototype),this.errorCode=e||ce.EMPTY_STRING,this.errorMessage=t||ce.EMPTY_STRING,this.subError=r||ce.EMPTY_STRING,this.name="AuthError"}setCorrelationId(e){this.correlationId=e}}function Ze(e,t){return new Xe(e,t?"".concat(Je[e]," ").concat(t):Je[e])}var $e="client_info_decoding_error",et="client_info_empty_error",tt="token_parsing_error",rt="null_or_empty_token",nt="endpoints_resolution_error",ot="network_error",it="openid_config_error",at="hash_not_deserialized",st="invalid_state",ct="state_mismatch",lt="state_not_found",ut="nonce_mismatch",dt="auth_time_not_found",ht="max_age_transpired",gt="multiple_matching_tokens",pt="multiple_matching_accounts",mt="multiple_matching_appMetadata",vt="request_cannot_be_made",ft="cannot_remove_empty_scope",yt="cannot_append_scopeset",Ct="empty_input_scopeset",wt="device_code_polling_cancelled",bt="device_code_expired",kt="device_code_unknown_error",It="no_account_in_silent_request",Tt="invalid_cache_record",St="invalid_cache_environment",At="no_account_found",Et="no_crypto_object",Ot="unexpected_credential_type",Pt="invalid_assertion",Rt="invalid_client_credential",_t="token_refresh_required",Mt="user_timeout_reached",Nt="token_claims_cnf_required_for_signedjwt",xt="authorization_code_missing_from_server_response",qt="binding_key_not_removed",Lt="end_session_endpoint_not_supported",Ht="key_id_missing",jt="no_network_connectivity",Dt="user_canceled",Ut="missing_tenant_id_error",Bt="method_not_implemented",Ft="nested_app_auth_bridge_disabled",Kt={[$e]:"The client info could not be parsed/decoded correctly",[et]:"The client info was empty",[tt]:"Token cannot be parsed",[rt]:"The token is null or empty",[nt]:"Endpoints cannot be resolved",[ot]:"Network request failed",[it]:"Could not retrieve endpoints. Check your authority and verify the .well-known/openid-configuration endpoint returns the required endpoints.",[at]:"The hash parameters could not be deserialized",[st]:"State was not the expected format",[ct]:"State mismatch error",[lt]:"State not found",[ut]:"Nonce mismatch error",[dt]:"Max Age was requested and the ID token is missing the auth_time variable. auth_time is an optional claim and is not enabled by default - it must be enabled. See https://aka.ms/msaljs/optional-claims for more information.",[ht]:"Max Age is set to 0, or too much time has elapsed since the last end-user authentication.",[gt]:"The cache contains multiple tokens satisfying the requirements. Call AcquireToken again providing more requirements such as authority or account.",[pt]:"The cache contains multiple accounts satisfying the given parameters. Please pass more info to obtain the correct account",[mt]:"The cache contains multiple appMetadata satisfying the given parameters. Please pass more info to obtain the correct appMetadata",[vt]:"Token request cannot be made without authorization code or refresh token.",[ft]:"Cannot remove null or empty scope from ScopeSet",[yt]:"Cannot append ScopeSet",[Ct]:"Empty input ScopeSet cannot be processed",[wt]:"Caller has cancelled token endpoint polling during device code flow by setting DeviceCodeRequest.cancel = true.",[bt]:"Device code is expired.",[kt]:"Device code stopped polling for unknown reasons.",[It]:"Please pass an account object, silent flow is not supported without account information",[Tt]:"Cache record object was null or undefined.",[St]:"Invalid environment when attempting to create cache entry",[At]:"No account found in cache for given key.",[Et]:"No crypto object detected.",[Ot]:"Unexpected credential type.",[Pt]:"Client assertion must meet requirements described in https://tools.ietf.org/html/rfc7515",[Rt]:"Client credential (secret, certificate, or assertion) must not be empty when creating a confidential client. An application should at most have one credential",[_t]:"Cannot return token from cache because it must be refreshed. This may be due to one of the following reasons: forceRefresh parameter is set to true, claims have been requested, there is no cached access token or it is expired.",[Mt]:"User defined timeout for device code polling reached",[Nt]:"Cannot generate a POP jwt if the token_claims are not populated",[xt]:"Server response does not contain an authorization code to proceed",[qt]:"Could not remove the credential's binding key from storage.",[Lt]:"The provided authority does not support logout",[Ht]:"A keyId value is missing from the requested bound token's cache record and is required to match the token to it's stored binding key.",[jt]:"No network connectivity. Check your internet connection.",[Dt]:"User cancelled the flow.",[Ut]:"A tenant id - not common, organizations, or consumers - must be specified when using the client_credentials flow.",[Bt]:"This method has not been implemented",[Ft]:"The nested app auth bridge is disabled"};class zt extends Xe{constructor(e,t){super(e,t?"".concat(Kt[e],": ").concat(t):Kt[e]),this.name="ClientAuthError",Object.setPrototypeOf(this,zt.prototype)}}function Gt(e,t){return new zt(e,t)}function Vt(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function Wt(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){Vt(i,n,o,a,s,"next",e)}function s(e){Vt(i,n,o,a,s,"throw",e)}a(void 0)})}}var Qt={createNewGuid:()=>{throw Gt(Bt)},base64Decode:()=>{throw Gt(Bt)},base64Encode:()=>{throw Gt(Bt)},base64UrlEncode:()=>{throw Gt(Bt)},encodeKid:()=>{throw Gt(Bt)},getPublicKeyThumbprint:()=>Wt(function*(){throw Gt(Bt)})(),removeTokenBindingKey:()=>Wt(function*(){throw Gt(Bt)})(),clearKeystore:()=>Wt(function*(){throw Gt(Bt)})(),signJwt:()=>Wt(function*(){throw Gt(Bt)})(),hashString:()=>Wt(function*(){throw Gt(Bt)})()},Yt="@azure/msal-common",Jt="14.16.1";function Xt(e,t){var r=function(e){if(!e)throw Gt(rt);var t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(e);if(!t||t.length<4)throw Gt(tt);return t[2]}(e);try{var n=t(r);return JSON.parse(n)}catch(e){throw Gt(tt)}}function Zt(e,t){if(0===t||Date.now()-3e5>e+t)throw Gt(ht)}function $t(){return Math.round((new Date).getTime()/1e3)}function er(e,t){var r=Number(e)||0;return $t()+t>r}function tr(e){return[lr(e),ur(e),dr(e),hr(e),gr(e)].join(Me).toLowerCase()}function rr(e,t,r,n,o){return{credentialType:Ne.ID_TOKEN,homeAccountId:e,environment:t,clientId:n,secret:r,realm:o}}function nr(e,t,r,n,o,i,a,s,c,l,u,d,h,g,p){var m,v,f={homeAccountId:e,credentialType:Ne.ACCESS_TOKEN,secret:r,cachedAt:$t().toString(),expiresOn:a.toString(),extendedExpiresOn:s.toString(),environment:t,clientId:n,realm:o,target:i,tokenType:u||Fe.BEARER};if(d&&(f.userAssertionHash=d),l&&(f.refreshOn=l.toString()),g&&(f.requestedClaims=g,f.requestedClaimsHash=p),(null===(m=f.tokenType)||void 0===m?void 0:m.toLowerCase())!==Fe.BEARER.toLowerCase())switch(f.credentialType=Ne.ACCESS_TOKEN_WITH_AUTH_SCHEME,f.tokenType){case Fe.POP:var y=Xt(r,c);if(null==y||null===(v=y.cnf)||void 0===v||!v.kid)throw Gt(Nt);f.keyId=y.cnf.kid;break;case Fe.SSH:f.keyId=h}return f}function or(e,t,r,n,o,i,a){var s={credentialType:Ne.REFRESH_TOKEN,homeAccountId:e,environment:t,clientId:n,secret:r};return i&&(s.userAssertionHash=i),o&&(s.familyId=o),a&&(s.expiresOn=a.toString()),s}function ir(e){return e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("credentialType")&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("secret")}function ar(e){return!!e&&ir(e)&&e.hasOwnProperty("realm")&&e.hasOwnProperty("target")&&(e.credentialType===Ne.ACCESS_TOKEN||e.credentialType===Ne.ACCESS_TOKEN_WITH_AUTH_SCHEME)}function sr(e){return!!e&&ir(e)&&e.hasOwnProperty("realm")&&e.credentialType===Ne.ID_TOKEN}function cr(e){return!!e&&ir(e)&&e.credentialType===Ne.REFRESH_TOKEN}function lr(e){return[e.homeAccountId,e.environment].join(Me).toLowerCase()}function ur(e){var t=e.credentialType===Ne.REFRESH_TOKEN&&e.familyId||e.clientId;return[e.credentialType,t,e.realm||""].join(Me).toLowerCase()}function dr(e){return(e.target||"").toLowerCase()}function hr(e){return(e.requestedClaimsHash||"").toLowerCase()}function gr(e){return e.tokenType&&e.tokenType.toLowerCase()!==Fe.BEARER.toLowerCase()?e.tokenType.toLowerCase():""}function pr(){return $t()+86400}function mr(e,t,r){e.authorization_endpoint=t.authorization_endpoint,e.token_endpoint=t.token_endpoint,e.end_session_endpoint=t.end_session_endpoint,e.issuer=t.issuer,e.endpointsFromNetwork=r,e.jwks_uri=t.jwks_uri}function vr(e,t,r){e.aliases=t.aliases,e.preferred_cache=t.preferred_cache,e.preferred_network=t.preferred_network,e.aliasesFromNetwork=r}function fr(e){return e.expiresAt<=$t()}var yr="redirect_uri_empty",Cr="claims_request_parsing_error",wr="authority_uri_insecure",br="url_parse_error",kr="empty_url_error",Ir="empty_input_scopes_error",Tr="invalid_prompt_value",Sr="invalid_claims",Ar="token_request_empty",Er="logout_request_empty",Or="invalid_code_challenge_method",Pr="pkce_params_missing",Rr="invalid_cloud_discovery_metadata",_r="invalid_authority_metadata",Mr="untrusted_authority",Nr="missing_ssh_jwk",xr="missing_ssh_kid",qr="missing_nonce_authentication_header",Lr="invalid_authentication_header",Hr="cannot_set_OIDCOptions",jr="cannot_allow_native_broker",Dr="authority_mismatch",Ur={[yr]:"A redirect URI is required for all calls, and none has been set.",[Cr]:"Could not parse the given claims request object.",[wr]:"Authority URIs must use https.  Please see here for valid authority configuration options: https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-js-initializing-client-applications#configuration-options",[br]:"URL could not be parsed into appropriate segments.",[kr]:"URL was empty or null.",[Ir]:"Scopes cannot be passed as null, undefined or empty array because they are required to obtain an access token.",[Tr]:"Please see here for valid configuration options: https://azuread.github.io/microsoft-authentication-library-for-js/ref/modules/_azure_msal_common.html#commonauthorizationurlrequest",[Sr]:"Given claims parameter must be a stringified JSON object.",[Ar]:"Token request was empty and not found in cache.",[Er]:"The logout request was null or undefined.",[Or]:'code_challenge_method passed is invalid. Valid values are "plain" and "S256".',[Pr]:"Both params: code_challenge and code_challenge_method are to be passed if to be sent in the request",[Rr]:"Invalid cloudDiscoveryMetadata provided. Must be a stringified JSON object containing tenant_discovery_endpoint and metadata fields",[_r]:"Invalid authorityMetadata provided. Must by a stringified JSON object containing authorization_endpoint, token_endpoint, issuer fields.",[Mr]:"The provided authority is not a trusted authority. Please include this authority in the knownAuthorities config parameter.",[Nr]:"Missing sshJwk in SSH certificate request. A stringified JSON Web Key is required when using the SSH authentication scheme.",[xr]:"Missing sshKid in SSH certificate request. A string that uniquely identifies the public SSH key is required when using the SSH authentication scheme.",[qr]:"Unable to find an authentication header containing server nonce. Either the Authentication-Info or WWW-Authenticate headers must be present in order to obtain a server nonce.",[Lr]:"Invalid authentication header provided",[Hr]:"Cannot set OIDCOptions parameter. Please change the protocol mode to OIDC or use a non-Microsoft authority.",[jr]:"Cannot set allowNativeBroker parameter to true when not in AAD protocol mode.",[Dr]:"Authority mismatch error. Authority provided in login request or PublicClientApplication config does not match the environment of the provided account. Please use a matching account or make an interactive request to login to this authority."};class Br extends Xe{constructor(e){super(e,Ur[e]),this.name="ClientConfigurationError",Object.setPrototypeOf(this,Br.prototype)}}function Fr(e){return new Br(e)}class Kr{static isEmptyObj(e){if(e)try{var t=JSON.parse(e);return 0===Object.keys(t).length}catch(e){}return!0}static startsWith(e,t){return 0===e.indexOf(t)}static endsWith(e,t){return e.length>=t.length&&e.lastIndexOf(t)===e.length-t.length}static queryStringToObject(e){var t={},r=e.split("&"),n=e=>decodeURIComponent(e.replace(/\+/g," "));return r.forEach(e=>{if(e.trim()){var[r,o]=e.split(/=(.+)/g,2);r&&o&&(t[n(r)]=n(o))}}),t}static trimArrayEntries(e){return e.map(e=>e.trim())}static removeEmptyStringsFromArray(e){return e.filter(e=>!!e)}static jsonParseHelper(e){try{return JSON.parse(e)}catch(e){return null}}static matchPattern(e,t){return new RegExp(e.replace(/\\/g,"\\\\").replace(/\*/g,"[^ ]*").replace(/\?/g,"\\?")).test(t)}}class zr{constructor(e){var t=e?Kr.trimArrayEntries([...e]):[],r=t?Kr.removeEmptyStringsFromArray(t):[];this.validateInputScopes(r),this.scopes=new Set,r.forEach(e=>this.scopes.add(e))}static fromString(e){var t=(e||ce.EMPTY_STRING).split(" ");return new zr(t)}static createSearchScopes(e){var t=new zr(e);return t.containsOnlyOIDCScopes()?t.removeScope(ce.OFFLINE_ACCESS_SCOPE):t.removeOIDCScopes(),t}validateInputScopes(e){if(!e||e.length<1)throw Fr(Ir)}containsScope(e){var t=this.printScopesLowerCase().split(" "),r=new zr(t);return!!e&&r.scopes.has(e.toLowerCase())}containsScopeSet(e){return!(!e||e.scopes.size<=0)&&this.scopes.size>=e.scopes.size&&e.asArray().every(e=>this.containsScope(e))}containsOnlyOIDCScopes(){var e=0;return ue.forEach(t=>{this.containsScope(t)&&(e+=1)}),this.scopes.size===e}appendScope(e){e&&this.scopes.add(e.trim())}appendScopes(e){try{e.forEach(e=>this.appendScope(e))}catch(e){throw Gt(yt)}}removeScope(e){if(!e)throw Gt(ft);this.scopes.delete(e.trim())}removeOIDCScopes(){ue.forEach(e=>{this.scopes.delete(e)})}unionScopeSets(e){if(!e)throw Gt(Ct);var t=new Set;return e.scopes.forEach(e=>t.add(e.toLowerCase())),this.scopes.forEach(e=>t.add(e.toLowerCase())),t}intersectingScopeSets(e){if(!e)throw Gt(Ct);e.containsOnlyOIDCScopes()||e.removeOIDCScopes();var t=this.unionScopeSets(e),r=e.getScopeCount(),n=this.getScopeCount();return t.size<n+r}getScopeCount(){return this.scopes.size}asArray(){var e=[];return this.scopes.forEach(t=>e.push(t)),e}printScopes(){return this.scopes?this.asArray().join(" "):ce.EMPTY_STRING}printScopesLowerCase(){return this.printScopes().toLowerCase()}}function Gr(e,t){if(!e)throw Gt(et);try{var r=t(e);return JSON.parse(r)}catch(e){throw Gt($e)}}function Vr(e){if(!e)throw Gt($e);var t=e.split(".",2);return{uid:t[0],utid:t.length<2?ce.EMPTY_STRING:t[1]}}var Wr=["isHomeTenant"],Qr=["isHomeTenant"];function Yr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Jr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Yr(Object(r),!0).forEach(function(t){Xr(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Yr(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function Xr(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Zr(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function $r(e,t){return!!e&&!!t&&e===t.split(".")[1]}function en(e,t,r,n){if(n){var{oid:o,sub:i,tid:a,name:s,tfp:c,acr:l}=n,u=a||c||l||"";return{tenantId:u,localAccountId:o||i||"",name:s,isHomeTenant:$r(u,e)}}return{tenantId:r,localAccountId:t,isHomeTenant:$r(r,e)}}function tn(e,t,r,n){var o=e;if(t){var{isHomeTenant:i}=t,a=Zr(t,Wr);o=Jr(Jr({},e),a)}if(r){var s=en(e.homeAccountId,e.localAccountId,e.tenantId,r),{isHomeTenant:c}=s,l=Zr(s,Qr);return Jr(Jr(Jr({},o),l),{},{idTokenClaims:r,idToken:n})}return o}function rn(e){return e&&(e.tid||e.tfp||e.acr)||null}class nn{generateAccountId(){return[this.homeAccountId,this.environment].join(Me).toLowerCase()}generateAccountKey(){return nn.generateAccountCacheKey({homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId})}getAccountInfo(){return{homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId,name:this.name,nativeAccountId:this.nativeAccountId,authorityType:this.authorityType,tenantProfiles:new Map((this.tenantProfiles||[]).map(e=>[e.tenantId,e]))}}isSingleTenant(){return!this.tenantProfiles}static generateAccountCacheKey(e){var t=e.homeAccountId.split(".")[1];return[e.homeAccountId,e.environment||"",t||e.tenantId||""].join(Me).toLowerCase()}static createAccount(e,t,r){var n,o,i,a,s,c,l,u,d,h=new nn;1===t.authorityType?h.authorityType="ADFS":t.protocolMode===Ge?h.authorityType="MSSTS":h.authorityType=_e,e.clientInfo&&r&&(d=Gr(e.clientInfo,r)),h.clientInfo=e.clientInfo,h.homeAccountId=e.homeAccountId,h.nativeAccountId=e.nativeAccountId;var g=e.environment||t&&t.getPreferredCache();if(!g)throw Gt(St);h.environment=g,h.realm=(null===(n=d)||void 0===n?void 0:n.utid)||rn(e.idTokenClaims)||"",h.localAccountId=(null===(o=d)||void 0===o?void 0:o.uid)||(null===(i=e.idTokenClaims)||void 0===i?void 0:i.oid)||(null===(a=e.idTokenClaims)||void 0===a?void 0:a.sub)||"";var p=(null===(s=e.idTokenClaims)||void 0===s?void 0:s.preferred_username)||(null===(c=e.idTokenClaims)||void 0===c?void 0:c.upn),m=null!==(l=e.idTokenClaims)&&void 0!==l&&l.emails?e.idTokenClaims.emails[0]:null;if(h.username=p||m||"",h.name=(null===(u=e.idTokenClaims)||void 0===u?void 0:u.name)||"",h.cloudGraphHostName=e.cloudGraphHostName,h.msGraphHost=e.msGraphHost,e.tenantProfiles)h.tenantProfiles=e.tenantProfiles;else{var v=en(e.homeAccountId,h.localAccountId,h.realm,e.idTokenClaims);h.tenantProfiles=[v]}return h}static createFromAccountInfo(e,t,r){var n,o=new nn;return o.authorityType=e.authorityType||_e,o.homeAccountId=e.homeAccountId,o.localAccountId=e.localAccountId,o.nativeAccountId=e.nativeAccountId,o.realm=e.tenantId,o.environment=e.environment,o.username=e.username,o.name=e.name,o.cloudGraphHostName=t,o.msGraphHost=r,o.tenantProfiles=Array.from((null===(n=e.tenantProfiles)||void 0===n?void 0:n.values())||[]),o}static generateHomeAccountId(e,t,r,n,o){if(1!==t&&2!==t){if(e)try{var i=Gr(e,n.base64Decode);if(i.uid&&i.utid)return"".concat(i.uid,".").concat(i.utid)}catch(e){}r.warning("No client info in response")}return(null==o?void 0:o.sub)||""}static isAccountEntity(e){return!!e&&e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("localAccountId")&&e.hasOwnProperty("username")&&e.hasOwnProperty("authorityType")}static accountInfoIsEqual(e,t,r){if(!e||!t)return!1;var n=!0;if(r){var o=e.idTokenClaims||{},i=t.idTokenClaims||{};n=o.iat===i.iat&&o.nonce===i.nonce}return e.homeAccountId===t.homeAccountId&&e.localAccountId===t.localAccountId&&e.username===t.username&&e.tenantId===t.tenantId&&e.environment===t.environment&&e.nativeAccountId===t.nativeAccountId&&n}}function on(e){return e.startsWith("#/")?e.substring(2):e.startsWith("#")||e.startsWith("?")?e.substring(1):e}function an(e){if(!e||e.indexOf("=")<0)return null;try{var t=on(e),r=Object.fromEntries(new URLSearchParams(t));if(r.code||r.error||r.error_description||r.state)return r}catch(e){throw Gt(at)}return null}class sn{get urlString(){return this._urlString}constructor(e){if(this._urlString=e,!this._urlString)throw Fr(kr);e.includes("#")||(this._urlString=sn.canonicalizeUri(e))}static canonicalizeUri(e){if(e){var t=e.toLowerCase();return Kr.endsWith(t,"?")?t=t.slice(0,-1):Kr.endsWith(t,"?/")&&(t=t.slice(0,-2)),Kr.endsWith(t,"/")||(t+="/"),t}return e}validateAsUri(){var e;try{e=this.getUrlComponents()}catch(e){throw Fr(br)}if(!e.HostNameAndPort||!e.PathSegments)throw Fr(br);if(!e.Protocol||"https:"!==e.Protocol.toLowerCase())throw Fr(wr)}static appendQueryString(e,t){return t?e.indexOf("?")<0?"".concat(e,"?").concat(t):"".concat(e,"&").concat(t):e}static removeHashFromUrl(e){return sn.canonicalizeUri(e.split("#")[0])}replaceTenantPath(e){var t=this.getUrlComponents(),r=t.PathSegments;return!e||0===r.length||r[0]!==Ie&&r[0]!==Te||(r[0]=e),sn.constructAuthorityUriFromObject(t)}getUrlComponents(){var e=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),t=this.urlString.match(e);if(!t)throw Fr(br);var r={Protocol:t[1],HostNameAndPort:t[4],AbsolutePath:t[5],QueryString:t[7]},n=r.AbsolutePath.split("/");return n=n.filter(e=>e&&e.length>0),r.PathSegments=n,r.QueryString&&r.QueryString.endsWith("/")&&(r.QueryString=r.QueryString.substring(0,r.QueryString.length-1)),r}static getDomainFromUrl(e){var t=RegExp("^([^:/?#]+://)?([^/?#]*)"),r=e.match(t);if(!r)throw Fr(br);return r[2]}static getAbsoluteUrl(e,t){if(e[0]===ce.FORWARD_SLASH){var r=new sn(t).getUrlComponents();return r.Protocol+"//"+r.HostNameAndPort+e}return e}static constructAuthorityUriFromObject(e){return new sn(e.Protocol+"//"+e.HostNameAndPort+"/"+e.PathSegments.join("/"))}static hashContainsKnownProperties(e){return!!an(e)}}var cn={"login.microsoftonline.com":{token_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.com/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.com/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/logout"},"login.chinacloudapi.cn":{token_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.chinacloudapi.cn/{tenantid}/discovery/v2.0/keys",issuer:"https://login.partner.microsoftonline.cn/{tenantid}/v2.0",authorization_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/logout"},"login.microsoftonline.us":{token_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.us/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.us/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/logout"}},ln={tenant_discovery_endpoint:"https://{canonicalAuthority}/v2.0/.well-known/openid-configuration",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},un=new Set;function dn(e,t,r,n){if(null==n||n.trace("getAliasesFromMetadata called with source: ".concat(r)),e&&t){var o=hn(t,e);if(o)return null==n||n.trace("getAliasesFromMetadata: found cloud discovery metadata in ".concat(r,", returning aliases")),o.aliases;null==n||n.trace("getAliasesFromMetadata: did not find cloud discovery metadata in ".concat(r))}return null}function hn(e,t){for(var r=0;r<e.length;r++){var n=e[r];if(n.aliases.includes(t))return n}return null}ln.metadata.forEach(e=>{e.aliases.forEach(e=>{un.add(e)})});var gn="cache_quota_exceeded",pn="cache_error_unknown",mn={[gn]:"Exceeded cache storage capacity.",[pn]:"Unexpected error occurred when using cache storage."};class vn extends Error{constructor(e,t){var r=t||(mn[e]?mn[e]:mn[pn]);super("".concat(e,": ").concat(r)),Object.setPrototypeOf(this,vn.prototype),this.name="CacheError",this.errorCode=e,this.errorMessage=r}}function fn(e){return e instanceof Error?"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name||e.message.includes("exceeded the quota")?new vn(gn):new vn(e.name,e.message):new vn(pn)}function yn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Cn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?yn(Object(r),!0).forEach(function(t){wn(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yn(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function wn(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function bn(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function kn(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){bn(i,n,o,a,s,"next",e)}function s(e){bn(i,n,o,a,s,"throw",e)}a(void 0)})}}class In{constructor(e,t,r,n){this.clientId=e,this.cryptoImpl=t,this.commonLogger=r.clone(Yt,Jt),this.staticAuthorityOptions=n}getAllAccounts(e,t){return this.buildTenantProfiles(this.getAccountsFilteredBy(t||{},e),e,t)}getAccountInfoFilteredBy(e,t){var r=this.getAllAccounts(t,e);return r.length>1?r.sort(e=>e.idTokenClaims?-1:1)[0]:1===r.length?r[0]:null}getBaseAccountInfo(e,t){var r=this.getAccountsFilteredBy(e,t);return r.length>0?r[0].getAccountInfo():null}buildTenantProfiles(e,t,r){return e.flatMap(e=>this.getTenantProfilesFromAccountEntity(e,t,null==r?void 0:r.tenantId,r))}getTenantedAccountInfoByFilter(e,t,r,n,o){var i;if(o&&!this.tenantProfileMatchesFilter(r,o))return null;var a=this.getIdToken(e,n,t,r.tenantId);return a&&(i=Xt(a.secret,this.cryptoImpl.base64Decode),!this.idTokenClaimsMatchTenantProfileFilter(i,o))?null:tn(e,r,i,null==a?void 0:a.secret)}getTenantProfilesFromAccountEntity(e,t,r,n){var o=e.getAccountInfo(),i=o.tenantProfiles||new Map,a=this.getTokenKeys();if(r){var s=i.get(r);if(!s)return[];i=new Map([[r,s]])}var c=[];return i.forEach(e=>{var r=this.getTenantedAccountInfoByFilter(o,a,e,t,n);r&&c.push(r)}),c}tenantProfileMatchesFilter(e,t){return!(t.localAccountId&&!this.matchLocalAccountIdFromTenantProfile(e,t.localAccountId)||t.name&&e.name!==t.name||void 0!==t.isHomeTenant&&e.isHomeTenant!==t.isHomeTenant)}idTokenClaimsMatchTenantProfileFilter(e,t){if(t){if(t.localAccountId&&!this.matchLocalAccountIdFromTokenClaims(e,t.localAccountId))return!1;if(t.loginHint&&!this.matchLoginHintFromTokenClaims(e,t.loginHint))return!1;if(t.username&&!this.matchUsername(e.preferred_username,t.username))return!1;if(t.name&&!this.matchName(e,t.name))return!1;if(t.sid&&!this.matchSid(e,t.sid))return!1}return!0}saveCacheRecord(e,t,r){var n=this;return kn(function*(){if(!e)throw Gt(Tt);try{e.account&&n.setAccount(e.account,t),e.idToken&&!1!==(null==r?void 0:r.idToken)&&n.setIdTokenCredential(e.idToken,t),e.accessToken&&!1!==(null==r?void 0:r.accessToken)&&(yield n.saveAccessToken(e.accessToken,t)),e.refreshToken&&!1!==(null==r?void 0:r.refreshToken)&&n.setRefreshTokenCredential(e.refreshToken,t),e.appMetadata&&n.setAppMetadata(e.appMetadata,t)}catch(e){var o;throw null===(o=n.commonLogger)||void 0===o||o.error("CacheManager.saveCacheRecord: failed"),e instanceof Xe?e:fn(e)}})()}saveAccessToken(e,t){var r=this;return kn(function*(){var n={clientId:e.clientId,credentialType:e.credentialType,environment:e.environment,homeAccountId:e.homeAccountId,realm:e.realm,tokenType:e.tokenType,requestedClaimsHash:e.requestedClaimsHash},o=r.getTokenKeys(),i=zr.fromString(e.target);o.accessToken.forEach(e=>{if(r.accessTokenKeyMatchesFilter(e,n,!1)){var o=r.getAccessTokenCredential(e,t);o&&r.credentialMatchesFilter(o,n)&&zr.fromString(o.target).intersectingScopeSets(i)&&r.removeAccessToken(e,t)}}),r.setAccessTokenCredential(e,t)})()}getAccountsFilteredBy(e,t){var r=this.getAccountKeys(),n=[];return r.forEach(r=>{var o;if(this.isAccountKey(r,e.homeAccountId)){var i=this.getAccount(r,t,this.commonLogger);if(i&&(!e.homeAccountId||this.matchHomeAccountId(i,e.homeAccountId))&&(!e.username||this.matchUsername(i.username,e.username))&&(!e.environment||this.matchEnvironment(i,e.environment))&&(!e.realm||this.matchRealm(i,e.realm))&&(!e.nativeAccountId||this.matchNativeAccountId(i,e.nativeAccountId))&&(!e.authorityType||this.matchAuthorityType(i,e.authorityType))){var a={localAccountId:null==e?void 0:e.localAccountId,name:null==e?void 0:e.name},s=null===(o=i.tenantProfiles)||void 0===o?void 0:o.filter(e=>this.tenantProfileMatchesFilter(e,a));s&&0===s.length||n.push(i)}}}),n}isAccountKey(e,t,r){return!(e.split(Me).length<3||t&&!e.toLowerCase().includes(t.toLowerCase())||r&&!e.toLowerCase().includes(r.toLowerCase()))}isCredentialKey(e){if(e.split(Me).length<6)return!1;var t=e.toLowerCase();if(-1===t.indexOf(Ne.ID_TOKEN.toLowerCase())&&-1===t.indexOf(Ne.ACCESS_TOKEN.toLowerCase())&&-1===t.indexOf(Ne.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase())&&-1===t.indexOf(Ne.REFRESH_TOKEN.toLowerCase()))return!1;if(t.indexOf(Ne.REFRESH_TOKEN.toLowerCase())>-1){var r="".concat(Ne.REFRESH_TOKEN).concat(Me).concat(this.clientId).concat(Me),n="".concat(Ne.REFRESH_TOKEN).concat(Me).concat(qe).concat(Me);if(-1===t.indexOf(r.toLowerCase())&&-1===t.indexOf(n.toLowerCase()))return!1}else if(-1===t.indexOf(this.clientId.toLowerCase()))return!1;return!0}credentialMatchesFilter(e,t){if(t.clientId&&!this.matchClientId(e,t.clientId))return!1;if(t.userAssertionHash&&!this.matchUserAssertionHash(e,t.userAssertionHash))return!1;if("string"==typeof t.homeAccountId&&!this.matchHomeAccountId(e,t.homeAccountId))return!1;if(t.environment&&!this.matchEnvironment(e,t.environment))return!1;if(t.realm&&!this.matchRealm(e,t.realm))return!1;if(t.credentialType&&!this.matchCredentialType(e,t.credentialType))return!1;if(t.familyId&&!this.matchFamilyId(e,t.familyId))return!1;if(t.target&&!this.matchTarget(e,t.target))return!1;if((t.requestedClaimsHash||e.requestedClaimsHash)&&e.requestedClaimsHash!==t.requestedClaimsHash)return!1;if(e.credentialType===Ne.ACCESS_TOKEN_WITH_AUTH_SCHEME){if(t.tokenType&&!this.matchTokenType(e,t.tokenType))return!1;if(t.tokenType===Fe.SSH&&t.keyId&&!this.matchKeyId(e,t.keyId))return!1}return!0}getAppMetadataFilteredBy(e){var t=this.getKeys(),r={};return t.forEach(t=>{if(this.isAppMetadata(t)){var n=this.getAppMetadata(t);n&&(e.environment&&!this.matchEnvironment(n,e.environment)||e.clientId&&!this.matchClientId(n,e.clientId)||(r[t]=n))}}),r}getAuthorityMetadataByAlias(e){var t=this.getAuthorityMetadataKeys(),r=null;return t.forEach(t=>{if(this.isAuthorityMetadata(t)&&-1!==t.indexOf(this.clientId)){var n=this.getAuthorityMetadata(t);n&&-1!==n.aliases.indexOf(e)&&(r=n)}}),r}removeAllAccounts(e){var t=this;return kn(function*(){var r=t.getAccountKeys(),n=[];r.forEach(r=>{n.push(t.removeAccount(r,e))}),yield Promise.all(n)})()}removeAccount(e,t){var r=this;return kn(function*(){var n=r.getAccount(e,t,r.commonLogger);n&&(yield r.removeAccountContext(n,t),r.removeItem(e,t))})()}removeAccountContext(e,t){var r=this;return kn(function*(){var n=r.getTokenKeys(),o=e.generateAccountId();n.idToken.forEach(e=>{0===e.indexOf(o)&&r.removeIdToken(e,t)}),n.accessToken.forEach(e=>{0===e.indexOf(o)&&r.removeAccessToken(e,t)}),n.refreshToken.forEach(e=>{0===e.indexOf(o)&&r.removeRefreshToken(e,t)}),r.getKeys().forEach(e=>{e.includes(o)&&r.removeItem(e,t)})})()}updateOutdatedCachedAccount(e,t,r,n){if(t&&t.isSingleTenant()){var o;null===(o=this.commonLogger)||void 0===o||o.verbose("updateOutdatedCachedAccount: Found a single-tenant (outdated) account entity in the cache, migrating to multi-tenant account entity");var i=this.getAccountKeys().filter(e=>e.startsWith(t.homeAccountId)),a=[];i.forEach(e=>{var t=this.getCachedAccountEntity(e,r);t&&a.push(t)});var s=a.find(e=>$r(e.realm,e.homeAccountId))||a[0];s.tenantProfiles=a.map(e=>({tenantId:e.realm,localAccountId:e.localAccountId,name:e.name,isHomeTenant:$r(e.realm,e.homeAccountId)}));var c=In.toObject(new nn,Cn({},s)),l=c.generateAccountKey();return i.forEach(t=>{t!==l&&this.removeOutdatedAccount(e,r)}),this.setAccount(c,r),null==n||n.verbose("Updated an outdated account entity in the cache"),c}return t}removeAccessToken(e,t){var r=this.getAccessTokenCredential(e,t);if(this.removeItem(e,t),r&&r.credentialType.toLowerCase()===Ne.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase()&&r.tokenType===Fe.POP){var n=r.keyId;n&&this.cryptoImpl.removeTokenBindingKey(n).catch(()=>{this.commonLogger.error("Binding key could not be removed")})}}removeAppMetadata(e){return this.getKeys().forEach(t=>{this.isAppMetadata(t)&&this.removeItem(t,e)}),!0}readAccountFromCache(e,t){var r=nn.generateAccountCacheKey(e);return this.getAccount(r,t,this.commonLogger)}getIdToken(e,t,r,n,o){this.commonLogger.trace("CacheManager - getIdToken called");var i={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:Ne.ID_TOKEN,clientId:this.clientId,realm:n},a=this.getIdTokensByFilter(i,t,r),s=a.size;if(s<1)return this.commonLogger.info("CacheManager:getIdToken - No token found"),null;if(s>1){var c=a;if(!n){var l=new Map;a.forEach((t,r)=>{t.realm===e.tenantId&&l.set(r,t)});var u=l.size;if(u<1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account but none match account entity tenant id, returning first result"),a.values().next().value;if(1===u)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account, defaulting to home tenant profile"),l.values().next().value;c=l}return this.commonLogger.info("CacheManager:getIdToken - Multiple matching ID tokens found, clearing them"),c.forEach((e,r)=>{this.removeIdToken(r,t)}),o&&t&&o.addFields({multiMatchedID:a.size},t),null}return this.commonLogger.info("CacheManager:getIdToken - Returning ID token"),a.values().next().value}getIdTokensByFilter(e,t,r){var n=r&&r.idToken||this.getTokenKeys().idToken,o=new Map;return n.forEach(r=>{if(this.idTokenKeyMatchesFilter(r,Cn({clientId:this.clientId},e))){var n=this.getIdTokenCredential(r,t);n&&this.credentialMatchesFilter(n,e)&&o.set(r,n)}}),o}idTokenKeyMatchesFilter(e,t){var r=e.toLowerCase();return!(t.clientId&&-1===r.indexOf(t.clientId.toLowerCase())||t.homeAccountId&&-1===r.indexOf(t.homeAccountId.toLowerCase()))}removeIdToken(e,t){this.removeItem(e,t)}removeRefreshToken(e,t){this.removeItem(e,t)}getAccessToken(e,t,r,n,o){this.commonLogger.trace("CacheManager - getAccessToken called");var i=zr.createSearchScopes(t.scopes),a=t.authenticationScheme||Fe.BEARER,s=a&&a.toLowerCase()!==Fe.BEARER.toLowerCase()?Ne.ACCESS_TOKEN_WITH_AUTH_SCHEME:Ne.ACCESS_TOKEN,c={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:s,clientId:this.clientId,realm:n||e.tenantId,target:i,tokenType:a,keyId:t.sshKid,requestedClaimsHash:t.requestedClaimsHash},l=r&&r.accessToken||this.getTokenKeys().accessToken,u=[];l.forEach(e=>{if(this.accessTokenKeyMatchesFilter(e,c,!0)){var r=this.getAccessTokenCredential(e,t.correlationId);r&&this.credentialMatchesFilter(r,c)&&u.push(r)}});var d=u.length;return d<1?(this.commonLogger.info("CacheManager:getAccessToken - No token found"),null):d>1?(this.commonLogger.info("CacheManager:getAccessToken - Multiple access tokens found, clearing them"),u.forEach(e=>{this.removeAccessToken(tr(e),t.correlationId)}),o&&t.correlationId&&o.addFields({multiMatchedAT:u.length},t.correlationId),null):(this.commonLogger.info("CacheManager:getAccessToken - Returning access token"),u[0])}accessTokenKeyMatchesFilter(e,t,r){var n=e.toLowerCase();if(t.clientId&&-1===n.indexOf(t.clientId.toLowerCase()))return!1;if(t.homeAccountId&&-1===n.indexOf(t.homeAccountId.toLowerCase()))return!1;if(t.realm&&-1===n.indexOf(t.realm.toLowerCase()))return!1;if(t.requestedClaimsHash&&-1===n.indexOf(t.requestedClaimsHash.toLowerCase()))return!1;if(t.target)for(var o=t.target.asArray(),i=0;i<o.length;i++){if(r&&!n.includes(o[i].toLowerCase()))return!1;if(!r&&n.includes(o[i].toLowerCase()))return!0}return!0}getAccessTokensByFilter(e,t){var r=this.getTokenKeys(),n=[];return r.accessToken.forEach(r=>{if(this.accessTokenKeyMatchesFilter(r,e,!0)){var o=this.getAccessTokenCredential(r,t);o&&this.credentialMatchesFilter(o,e)&&n.push(o)}}),n}getRefreshToken(e,t,r,n,o){this.commonLogger.trace("CacheManager - getRefreshToken called");var i=t?qe:void 0,a={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:Ne.REFRESH_TOKEN,clientId:this.clientId,familyId:i},s=n&&n.refreshToken||this.getTokenKeys().refreshToken,c=[];s.forEach(e=>{if(this.refreshTokenKeyMatchesFilter(e,a)){var t=this.getRefreshTokenCredential(e,r);t&&this.credentialMatchesFilter(t,a)&&c.push(t)}});var l=c.length;return l<1?(this.commonLogger.info("CacheManager:getRefreshToken - No refresh token found."),null):(l>1&&o&&r&&o.addFields({multiMatchedRT:l},r),this.commonLogger.info("CacheManager:getRefreshToken - returning refresh token"),c[0])}refreshTokenKeyMatchesFilter(e,t){var r=e.toLowerCase();return!(t.familyId&&-1===r.indexOf(t.familyId.toLowerCase())||!t.familyId&&t.clientId&&-1===r.indexOf(t.clientId.toLowerCase())||t.homeAccountId&&-1===r.indexOf(t.homeAccountId.toLowerCase()))}readAppMetadataFromCache(e){var t={environment:e,clientId:this.clientId},r=this.getAppMetadataFilteredBy(t),n=Object.keys(r).map(e=>r[e]),o=n.length;if(o<1)return null;if(o>1)throw Gt(mt);return n[0]}isAppMetadataFOCI(e){var t=this.readAppMetadataFromCache(e);return!(!t||t.familyId!==qe)}matchHomeAccountId(e,t){return!("string"!=typeof e.homeAccountId||t!==e.homeAccountId)}matchLocalAccountIdFromTokenClaims(e,t){return t===(e.oid||e.sub)}matchLocalAccountIdFromTenantProfile(e,t){return e.localAccountId===t}matchName(e,t){var r;return!(t.toLowerCase()!==(null===(r=e.name)||void 0===r?void 0:r.toLowerCase()))}matchUsername(e,t){return!(!e||"string"!=typeof e||(null==t?void 0:t.toLowerCase())!==e.toLowerCase())}matchUserAssertionHash(e,t){return!(!e.userAssertionHash||t!==e.userAssertionHash)}matchEnvironment(e,t){if(this.staticAuthorityOptions){var r=function(e,t){var r,n=e.canonicalAuthority;if(n){var o,i=new sn(n).getUrlComponents().HostNameAndPort;r=dn(i,null===(o=e.cloudDiscoveryMetadata)||void 0===o?void 0:o.metadata,He,t)||dn(i,ln.metadata,Ue,t)||e.knownAuthorities}return r||[]}(this.staticAuthorityOptions,this.commonLogger);if(r.includes(t)&&r.includes(e.environment))return!0}var n=this.getAuthorityMetadataByAlias(t);return!!(n&&n.aliases.indexOf(e.environment)>-1)}matchCredentialType(e,t){return e.credentialType&&t.toLowerCase()===e.credentialType.toLowerCase()}matchClientId(e,t){return!(!e.clientId||t!==e.clientId)}matchFamilyId(e,t){return!(!e.familyId||t!==e.familyId)}matchRealm(e,t){var r;return!((null===(r=e.realm)||void 0===r?void 0:r.toLowerCase())!==t.toLowerCase())}matchNativeAccountId(e,t){return!(!e.nativeAccountId||t!==e.nativeAccountId)}matchLoginHintFromTokenClaims(e,t){return e.login_hint===t||e.preferred_username===t||e.upn===t}matchSid(e,t){return e.sid===t}matchAuthorityType(e,t){return!(!e.authorityType||t.toLowerCase()!==e.authorityType.toLowerCase())}matchTarget(e,t){return!(e.credentialType!==Ne.ACCESS_TOKEN&&e.credentialType!==Ne.ACCESS_TOKEN_WITH_AUTH_SCHEME||!e.target)&&zr.fromString(e.target).containsScopeSet(t)}matchTokenType(e,t){return!(!e.tokenType||e.tokenType!==t)}matchKeyId(e,t){return!(!e.keyId||e.keyId!==t)}isAppMetadata(e){return-1!==e.indexOf(xe)}isAuthorityMetadata(e){return-1!==e.indexOf(Le)}generateAuthorityMetadataCacheKey(e){return"".concat(Le,"-").concat(this.clientId,"-").concat(e)}static toObject(e,t){for(var r in t)e[r]=t[r];return e}}class Tn extends In{setAccount(){throw Gt(Bt)}getAccount(){throw Gt(Bt)}getCachedAccountEntity(){throw Gt(Bt)}setIdTokenCredential(){throw Gt(Bt)}getIdTokenCredential(){throw Gt(Bt)}setAccessTokenCredential(){throw Gt(Bt)}getAccessTokenCredential(){throw Gt(Bt)}setRefreshTokenCredential(){throw Gt(Bt)}getRefreshTokenCredential(){throw Gt(Bt)}setAppMetadata(){throw Gt(Bt)}getAppMetadata(){throw Gt(Bt)}setServerTelemetry(){throw Gt(Bt)}getServerTelemetry(){throw Gt(Bt)}setAuthorityMetadata(){throw Gt(Bt)}getAuthorityMetadata(){throw Gt(Bt)}getAuthorityMetadataKeys(){throw Gt(Bt)}setThrottlingCache(){throw Gt(Bt)}getThrottlingCache(){throw Gt(Bt)}removeItem(){throw Gt(Bt)}getKeys(){throw Gt(Bt)}getAccountKeys(){throw Gt(Bt)}getTokenKeys(){throw Gt(Bt)}updateCredentialCacheKey(){throw Gt(Bt)}removeOutdatedAccount(){throw Gt(Bt)}}function Sn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function An(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Sn(Object(r),!0).forEach(function(t){En(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Sn(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function En(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function On(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function Pn(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){On(i,n,o,a,s,"next",e)}function s(e){On(i,n,o,a,s,"throw",e)}a(void 0)})}}var Rn={tokenRenewalOffsetSeconds:300,preventCorsPreflight:!1},_n={loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:se.Info,correlationId:ce.EMPTY_STRING},Mn={claimsBasedCachingEnabled:!1},Nn={sendGetRequestAsync:()=>Pn(function*(){throw Gt(Bt)})(),sendPostRequestAsync:()=>Pn(function*(){throw Gt(Bt)})()},xn={sku:ce.SKU,version:Jt,cpu:ce.EMPTY_STRING,os:ce.EMPTY_STRING},qn={clientSecret:ce.EMPTY_STRING,clientAssertion:void 0},Ln={azureCloudInstance:We,tenant:"".concat(ce.DEFAULT_COMMON_TENANT)},Hn={application:{appName:"",appVersion:""}};function jn(e){return e.authOptions.authority.options.protocolMode===Ve}var Dn={sendGetRequestAsync:()=>Promise.reject(Gt(Bt)),sendPostRequestAsync:()=>Promise.reject(Gt(Bt))},Un="acquireTokenByCode",Bn="acquireTokenByRefreshToken",Fn="acquireTokenSilent",Kn="acquireTokenSilentAsync",zn="acquireTokenPopup",Gn="acquireTokenRedirect",Vn="cryptoOptsGetPublicKeyThumbprint",Wn="cryptoOptsSignJwt",Qn="silentCacheClientAcquireToken",Yn="silentIframeClientAcquireToken",Jn="silentRefreshClientAcquireToken",Xn="ssoSilent",Zn="standardInteractionClientGetDiscoveredAuthority",$n="fetchAccountIdWithNativeBroker",eo="nativeInteractionClientAcquireToken",to="networkClientSendPostRequestAsync",ro="refreshTokenClientExecutePostToTokenEndpoint",no="authorizationCodeClientExecutePostToTokenEndpoint",oo="refreshTokenClientExecuteTokenRequest",io="refreshTokenClientAcquireToken",ao="refreshTokenClientAcquireTokenWithCachedRefreshToken",so="refreshTokenClientAcquireTokenByRefreshToken",co="refreshTokenClientCreateTokenRequestBody",lo="acquireTokenFromCache",uo="silentFlowClientAcquireCachedToken",ho="silentFlowClientGenerateResultFromCacheRecord",go="acquireTokenBySilentIframe",po="initializeBaseRequest",mo="initializeSilentRequest",vo="initializeClientApplication",fo="silentIframeClientTokenHelper",yo="silentHandlerInitiateAuthRequest",Co="silentHandlerMonitorIframeForHash",wo="silentHandlerLoadFrame",bo="silentHandlerLoadFrameSync",ko="standardInteractionClientCreateAuthCodeClient",Io="standardInteractionClientGetClientConfiguration",To="standardInteractionClientInitializeAuthorizationRequest",So="standardInteractionClientInitializeAuthorizationCodeRequest",Ao="getAuthCodeUrl",Eo="handleCodeResponseFromServer",Oo="handleCodeResponse",Po="updateTokenEndpointAuthority",Ro="authClientAcquireToken",_o="authClientExecuteTokenRequest",Mo="authClientCreateTokenRequestBody",No="authClientCreateQueryString",xo="popTokenGenerateCnf",qo="popTokenGenerateKid",Lo="handleServerTokenResponse",Ho="deserializeResponse",jo="authorityFactoryCreateDiscoveredInstance",Do="authorityResolveEndpointsAsync",Uo="authorityGetCloudDiscoveryMetadataFromNetwork",Bo="authorityUpdateCloudDiscoveryMetadata",Fo="authorityGetEndpointMetadataFromNetwork",Ko="authorityUpdateEndpointMetadata",zo="authorityUpdateMetadataWithRegionalInformation",Go="regionDiscoveryDetectRegion",Vo="regionDiscoveryGetRegionFromIMDS",Wo="regionDiscoveryGetCurrentVersion",Qo="acquireTokenByCodeAsync",Yo="handleRedirectPromise",Jo="handleNativeRedirectPromise",Xo="nativeMessageHandlerHandshake",Zo="removeHiddenIframe",$o="clearTokensAndKeysWithClaims",ei="cacheManagerGetRefreshToken",ti="generatePkceCodes",ri="generateCodeVerifier",ni="generateCodeChallengeFromVerifier",oi="sha256Digest",ii="getRandomValues",ai=(new Map([[Un,"ATByCode"],[Bn,"ATByRT"],[Fn,"ATS"],[Kn,"ATSAsync"],[zn,"ATPopup"],[Gn,"ATRedirect"],[Vn,"CryptoGetPKThumb"],[Wn,"CryptoSignJwt"],[Qn,"SltCacheClientAT"],[Yn,"SltIframeClientAT"],[Jn,"SltRClientAT"],[Xn,"SsoSlt"],[Zn,"StdIntClientGetDiscAuth"],[$n,"FetchAccIdWithNtvBroker"],[eo,"NtvIntClientAT"],["baseClientCreateTokenRequestHeaders","BaseClientCreateTReqHead"],[to,"NetClientSendPost"],[ro,"RTClientExecPost"],[no,"AuthCodeClientExecPost"],["brokerHandshake","BrokerHandshake"],["acquireTokenByRefreshTokenInBroker","ATByRTInBroker"],["acquireTokenByBroker","ATByBroker"],[oo,"RTClientExecTReq"],[io,"RTClientAT"],[ao,"RTClientATWithCachedRT"],[so,"RTClientATByRT"],[co,"RTClientCreateTReqBody"],[lo,"ATFromCache"],[uo,"SltFlowClientATCached"],[ho,"SltFlowClientGenResFromCache"],[go,"ATBySltIframe"],[po,"InitBaseReq"],[mo,"InitSltReq"],[vo,"InitClientApplication"],[fo,"SIClientTHelper"],[yo,"SHandlerInitAuthReq"],[Co,"SltHandlerMonitorIframeForHash"],[wo,"SHandlerLoadFrame"],[bo,"SHandlerLoadFrameSync"],[ko,"StdIntClientCreateAuthCodeClient"],[Io,"StdIntClientGetClientConf"],[To,"StdIntClientInitAuthReq"],[So,"StdIntClientInitAuthCodeReq"],[Ao,"GetAuthCodeUrl"],[Eo,"HandleCodeResFromServer"],[Oo,"HandleCodeResp"],[Po,"UpdTEndpointAuth"],[Ro,"AuthClientAT"],[_o,"AuthClientExecTReq"],[Mo,"AuthClientCreateTReqBody"],[No,"AuthClientCreateQueryStr"],[xo,"PopTGenCnf"],[qo,"PopTGenKid"],[Lo,"HandleServerTRes"],[Ho,"DeserializeRes"],[jo,"AuthFactCreateDiscInst"],[Do,"AuthResolveEndpointsAsync"],["authorityResolveEndpointsFromLocalSources","AuthResolveEndpointsFromLocal"],[Uo,"AuthGetCDMetaFromNet"],[Bo,"AuthUpdCDMeta"],[Fo,"AuthUpdCDMetaFromNet"],[Ko,"AuthUpdEndpointMeta"],[zo,"AuthUpdMetaWithRegInfo"],[Go,"RegDiscDetectReg"],[Vo,"RegDiscGetRegFromIMDS"],[Wo,"RegDiscGetCurrentVer"],[Qo,"ATByCodeAsync"],["getEndpointMetadataFromNetwork","GetEndpointMetaFromNet"],["getCloudDiscoveryMetadataFromNetworkMeasurement","GetCDMetaFromNet"],[Yo,"HandleRedirectPromise"],[Jo,"HandleNtvRedirectPromise"],["updateCloudDiscoveryMetadataMeasurement","UpdateCDMeta"],["usernamePasswordClientAcquireToken","UserPassClientAT"],[Xo,"NtvMsgHandlerHandshake"],["nativeGenerateAuthResult","NtvGenAuthRes"],[Zo,"RemoveHiddenIframe"],[$o,"ClearTAndKeysWithClaims"],[ei,"CacheManagerGetRT"],[ti,"GenPkceCodes"],[ri,"GenCodeVerifier"],[ni,"GenCodeChallengeFromVerifier"],[oi,"Sha256Digest"],[ii,"GetRandomValues"]]),1);new Set(["accessTokenSize","durationMs","idTokenSize","matsSilentStatus","matsHttpStatus","refreshTokenSize","queuedTimeMs","startTimeMs","status","multiMatchedAT","multiMatchedID","multiMatchedRT"]);class si{startMeasurement(){}endMeasurement(){}flushMeasurement(){return null}}class ci{generateId(){return"callback-id"}startMeasurement(e,t){return{end:()=>null,discard:()=>{},add:()=>{},increment:()=>{},event:{eventId:this.generateId(),status:ai,authority:"",libraryName:"",libraryVersion:"",clientId:"",name:e,startTimeMs:Date.now(),correlationId:t||""},measurement:new si}}startPerformanceMeasurement(){return new si}calculateQueuedTime(){return 0}addQueueMeasurement(){}setPreQueueTime(){}endMeasurement(){return null}discardMeasurements(){}removePerformanceCallback(){return!0}addPerformanceCallback(){return""}emitEvents(){}addFields(){}incrementFields(){}cacheEventByCorrelationId(){}}var li,ui="invalid_grant",di="msal",hi="msal.js.browser",gi="53ee284d-920a-4b59-9d30-a60315b26836",pi="ppnbnpeolgkicgegkbkbjmhlideopiji",mi="Handshake",vi="GetToken",fi="localStorage",yi="sessionStorage",Ci="memoryStorage",wi="request.state",bi="request.origin",ki="urlHash",Ii="request.params",Ti="interaction.status",Si="ccs.credential",Ai="request.correlationId",Ei="request.native",Oi="msal.account.keys",Pi="msal.token.keys",Ri="msal.version",_i="wrapper.sku",Mi="wrapper.version",Ni=861,xi=862;!function(e){e.Redirect="redirect",e.Popup="popup",e.Silent="silent",e.None="none"}(li||(li={}));var qi={scopes:le},Li="msal.db",Hi="".concat(Li,".keys"),ji=[0,5,4];class Di{navigateInternal(e,t){return Di.defaultNavigateWindow(e,t)}navigateExternal(e,t){return Di.defaultNavigateWindow(e,t)}static defaultNavigateWindow(e,t){return t.noHistory?window.location.replace(e):window.location.assign(e),new Promise(e=>{setTimeout(()=>{e(!0)},t.timeout)})}}class Ui extends Xe{constructor(e,t,r){super(e.errorCode,e.errorMessage,e.subError),Object.setPrototypeOf(this,Ui.prototype),this.name="NetworkError",this.error=e,this.httpStatus=t,this.responseHeaders=r}}function Bi(e,t,r){return new Ui(e,t,r)}var Fi="pkce_not_created",Ki="crypto_nonexistent",zi="empty_navigate_uri",Gi="hash_empty_error",Vi="no_state_in_hash",Wi="hash_does_not_contain_known_properties",Qi="unable_to_parse_state",Yi="state_interaction_type_mismatch",Ji="interaction_in_progress",Xi="popup_window_error",Zi="empty_window_error",$i="user_cancelled",ea="monitor_popup_timeout",ta="monitor_window_timeout",ra="redirect_in_iframe",na="block_iframe_reload",oa="block_nested_popups",ia="iframe_closed_prematurely",aa="silent_logout_unsupported",sa="no_account_error",ca="silent_prompt_value_error",la="no_token_request_cache_error",ua="unable_to_parse_token_request_cache_error",da="no_cached_authority_error",ha="auth_request_not_set_error",ga="invalid_cache_type",pa="non_browser_environment",ma="database_not_open",va="no_network_connectivity",fa="post_request_failed",ya="get_request_failed",Ca="failed_to_parse_response",wa="unable_to_load_token",ba="crypto_key_not_found",ka="auth_code_required",Ia="auth_code_or_nativeAccountId_required",Ta="spa_code_and_nativeAccountId_present",Sa="database_unavailable",Aa="unable_to_acquire_token_from_native_platform",Ea="native_handshake_timeout",Oa="native_extension_not_installed",Pa="native_connection_not_established",Ra="uninitialized_public_client_application",_a="native_prompt_not_supported",Ma="invalid_base64_string",Na="invalid_pop_token_request",xa="failed_to_build_headers",qa="failed_to_parse_headers",La="For more visit: aka.ms/msaljs/browser-errors",Ha={[Fi]:"The PKCE code challenge and verifier could not be generated.",[Ki]:"The crypto object or function is not available.",[zi]:"Navigation URI is empty. Please check stack trace for more info.",[Gi]:"Hash value cannot be processed because it is empty. Please verify that your redirectUri is not clearing the hash. ".concat(La),[Vi]:"Hash does not contain state. Please verify that the request originated from msal.",[Wi]:"Hash does not contain known properites. Please verify that your redirectUri is not changing the hash.  ".concat(La),[Qi]:"Unable to parse state. Please verify that the request originated from msal.",[Yi]:"Hash contains state but the interaction type does not match the caller.",[Ji]:"Interaction is currently in progress. Please ensure that this interaction has been completed before calling an interactive API.   ".concat(La),[Xi]:"Error opening popup window. This can happen if you are using IE or if popups are blocked in the browser.",[Zi]:"window.open returned null or undefined window object.",[$i]:"User cancelled the flow.",[ea]:"Token acquisition in popup failed due to timeout.  ".concat(La),[ta]:"Token acquisition in iframe failed due to timeout.  ".concat(La),[ra]:"Redirects are not supported for iframed or brokered applications. Please ensure you are using MSAL.js in a top frame of the window if using the redirect APIs, or use the popup APIs.",[na]:"Request was blocked inside an iframe because MSAL detected an authentication response.  ".concat(La),[oa]:"Request was blocked inside a popup because MSAL detected it was running in a popup.",[ia]:"The iframe being monitored was closed prematurely.",[aa]:"Silent logout not supported. Please call logoutRedirect or logoutPopup instead.",[sa]:"No account object provided to acquireTokenSilent and no active account has been set. Please call setActiveAccount or provide an account on the request.",[ca]:"The value given for the prompt value is not valid for silent requests - must be set to 'none' or 'no_session'.",[la]:"No token request found in cache.",[ua]:"The cached token request could not be parsed.",[da]:"No cached authority found.",[ha]:"Auth Request not set. Please ensure initiateAuthRequest was called from the InteractionHandler",[ga]:"Invalid cache type",[pa]:"Login and token requests are not supported in non-browser environments.",[ma]:"Database is not open!",[va]:"No network connectivity. Check your internet connection.",[fa]:"Network request failed: If the browser threw a CORS error, check that the redirectUri is registered in the Azure App Portal as type 'SPA'",[ya]:"Network request failed. Please check the network trace to determine root cause.",[Ca]:"Failed to parse network response. Check network trace.",[wa]:"Error loading token to cache.",[ba]:"Cryptographic Key or Keypair not found in browser storage.",[ka]:"An authorization code must be provided (as the `code` property on the request) to this flow.",[Ia]:"An authorization code or nativeAccountId must be provided to this flow.",[Ta]:"Request cannot contain both spa code and native account id.",[Sa]:"IndexedDB, which is required for persistent cryptographic key storage, is unavailable. This may be caused by browser privacy features which block persistent storage in third-party contexts.",[Aa]:"Unable to acquire token from native platform.  ".concat(La),[Ea]:"Timed out while attempting to establish connection to browser extension",[Oa]:"Native extension is not installed. If you think this is a mistake call the initialize function.",[Pa]:"Connection to native platform has not been established. Please install a compatible browser extension and run initialize().  ".concat(La),[Ra]:"You must call and await the initialize function before attempting to call any other MSAL API.  ".concat(La),[_a]:"The provided prompt is not supported by the native platform. This request should be routed to the web based flow.",[Ma]:"Invalid base64 encoded string.",[Na]:"Invalid PoP token request. The request should not have both a popKid value and signPopToken set to true.",[xa]:"Failed to build request headers object.",[qa]:"Failed to parse response headers"};class ja extends Xe{constructor(e,t){super(e,Ha[e],t),Object.setPrototypeOf(this,ja.prototype),this.name="BrowserAuthError"}}function Da(e,t){return new ja(e,t)}function Ua(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function Ba(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){Ua(i,n,o,a,s,"next",e)}function s(e){Ua(i,n,o,a,s,"throw",e)}a(void 0)})}}class Fa{sendGetRequestAsync(e,t){return Ba(function*(){var r,n,o=0,i=Ka(t);try{r=yield fetch(e,{method:"GET",headers:i})}catch(e){throw Da(window.navigator.onLine?ya:va)}n=za(r.headers);try{return o=r.status,{headers:n,body:yield r.json(),status:o}}catch(e){throw Bi(Da(Ca),o,n)}})()}sendPostRequestAsync(e,t){return Ba(function*(){var r,n,o=t&&t.body||"",i=Ka(t),a=0;try{r=yield fetch(e,{method:"POST",headers:i,body:o})}catch(e){throw Da(window.navigator.onLine?fa:va)}n=za(r.headers);try{return a=r.status,{headers:n,body:yield r.json(),status:a}}catch(e){throw Bi(Da(Ca),a,n)}})()}}function Ka(e){try{var t=new Headers;if(!e||!e.headers)return t;var r=e.headers;return Object.entries(r).forEach(e=>{var[r,n]=e;t.append(r,n)}),t}catch(e){throw Da(xa)}}function za(e){try{var t={};return e.forEach((e,r)=>{t[r]=e}),t}catch(e){throw Da(qa)}}function Ga(e){return encodeURIComponent(Wa(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"))}function Va(e){return Qa(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Wa(e){return Qa((new TextEncoder).encode(e))}function Qa(e){var t=Array.from(e,e=>String.fromCodePoint(e)).join("");return btoa(t)}function Ya(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function Ja(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){Ya(i,n,o,a,s,"next",e)}function s(e){Ya(i,n,o,a,s,"throw",e)}a(void 0)})}}var Xa="SHA-256",Za=new Uint8Array([1,0,1]),$a="0123456789abcdef",es=new Uint32Array(1),ts={name:"RSASSA-PKCS1-v1_5",hash:Xa,modulusLength:2048,publicExponent:Za};function rs(e,t,r){return ns.apply(this,arguments)}function ns(){return(ns=Ja(function*(e,t,r){null==t||t.addQueueMeasurement(oi,r);var n=(new TextEncoder).encode(e);return window.crypto.subtle.digest(Xa,n)})).apply(this,arguments)}function os(e){return window.crypto.getRandomValues(e)}function is(){return window.crypto.getRandomValues(es),es[0]}function as(){var e=Date.now(),t=1024*is()+(1023&is()),r=new Uint8Array(16),n=Math.trunc(t/2**30),o=t&2**30-1,i=is();r[0]=e/2**40,r[1]=e/2**32,r[2]=e/2**24,r[3]=e/65536,r[4]=e/256,r[5]=e,r[6]=112|n>>>8,r[7]=n,r[8]=128|o>>>24,r[9]=o>>>16,r[10]=o>>>8,r[11]=o,r[12]=i>>>24,r[13]=i>>>16,r[14]=i>>>8,r[15]=i;for(var a="",s=0;s<r.length;s++)a+=$a.charAt(r[s]>>>4),a+=$a.charAt(15&r[s]),3!==s&&5!==s&&7!==s&&9!==s||(a+="-");return a}function ss(){return(ss=Ja(function*(e,t){return window.crypto.subtle.generateKey(ts,e,t)})).apply(this,arguments)}function cs(e){return ls.apply(this,arguments)}function ls(){return(ls=Ja(function*(e){return window.crypto.subtle.exportKey("jwk",e)})).apply(this,arguments)}function us(){return(us=Ja(function*(e,t,r){return window.crypto.subtle.importKey("jwk",e,ts,t,r)})).apply(this,arguments)}function ds(){return(ds=Ja(function*(e,t){return window.crypto.subtle.sign(ts,e,t)})).apply(this,arguments)}function hs(e){return gs.apply(this,arguments)}function gs(){return(gs=Ja(function*(e){var t=yield rs(e);return Va(new Uint8Array(t))})).apply(this,arguments)}var ps="storage_not_supported",ms="stubbed_public_client_application_called",vs="in_mem_redirect_unavailable",fs={[ps]:"Given storage configuration option was not supported.",[ms]:"Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors",[vs]:"Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true."};class ys extends Xe{constructor(e,t){super(e,t),this.name="BrowserConfigurationAuthError",Object.setPrototypeOf(this,ys.prototype)}}function Cs(e){return new ys(e,fs[e])}function ws(){return window.parent!==window}function bs(){return"undefined"!=typeof window&&window.location?window.location.href.split("?")[0].split("#")[0]:""}function ks(){if("undefined"==typeof window)throw Da(pa)}function Is(e){if(!e)throw Da(Ra)}function Ts(e){ks(),function(){if(sn.hashContainsKnownProperties(window.location.hash)&&ws())throw Da(na)}(),function(){if("undefined"!=typeof window&&window.opener&&window.opener!==window&&"string"==typeof window.name&&0===window.name.indexOf("".concat(di,".")))throw Da(oa)}(),Is(e)}function Ss(e,t){if(Ts(e),function(e){if(ws()&&!e)throw Da(ra)}(t.system.allowRedirectInIframe),t.cache.cacheLocation===Ci&&!t.cache.storeAuthStateInCookie)throw Cs(vs)}function As(e){var t=document.createElement("link");t.rel="preconnect",t.href=new URL(e).origin,t.crossOrigin="anonymous",document.head.appendChild(t),window.setTimeout(()=>{try{document.head.removeChild(t)}catch(e){}},1e4)}function Es(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Os(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Es(Object(r),!0).forEach(function(t){Ps(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Es(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function Ps(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Rs=1e4,_s="3.30.0";function Ms(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Ns(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class xs{static loggerCallback(e,t){switch(e){case se.Error:return void console.error(t);case se.Info:return void console.info(t);case se.Verbose:return void console.debug(t);case se.Warning:return void console.warn(t);default:return void console.log(t)}}constructor(e){var t,r,n;this.browserEnvironment="undefined"!=typeof window,this.config=function(e,t){var{auth:r,cache:n,system:o,telemetry:i}=e,a={clientId:ce.EMPTY_STRING,authority:"".concat(ce.DEFAULT_AUTHORITY),knownAuthorities:[],cloudDiscoveryMetadata:ce.EMPTY_STRING,authorityMetadata:ce.EMPTY_STRING,redirectUri:"undefined"!=typeof window?bs():"",postLogoutRedirectUri:ce.EMPTY_STRING,navigateToLoginRequestUrl:!0,clientCapabilities:[],protocolMode:Ge,OIDCOptions:{serverResponseType:Pe.FRAGMENT,defaultScopes:[ce.OPENID_SCOPE,ce.PROFILE_SCOPE,ce.OFFLINE_ACCESS_SCOPE]},azureCloudOptions:{azureCloudInstance:We,tenant:ce.EMPTY_STRING},skipAuthorityMetadataCache:!1,supportsNestedAppAuth:!1,instanceAware:!1},s={cacheLocation:yi,temporaryCacheLocation:yi,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!(!n||n.cacheLocation!==fi),claimsBasedCachingEnabled:!1},c={loggerCallback:()=>{},logLevel:se.Info,piiLoggingEnabled:!1},l=Os(Os({},Rn),{},{loggerOptions:c,networkClient:t?new Fa:Dn,navigationClient:new Di,loadFrameTimeout:0,windowHashTimeout:(null==o?void 0:o.loadFrameTimeout)||6e4,iframeHashTimeout:(null==o?void 0:o.loadFrameTimeout)||Rs,navigateFrameWait:0,redirectNavigationTimeout:3e4,asyncPopups:!1,allowRedirectInIframe:!1,allowNativeBroker:!1,nativeBrokerHandshakeTimeout:(null==o?void 0:o.nativeBrokerHandshakeTimeout)||2e3,pollIntervalMilliseconds:30}),u=Os(Os(Os({},l),o),{},{loggerOptions:(null==o?void 0:o.loggerOptions)||c}),d={application:{appName:ce.EMPTY_STRING,appVersion:ce.EMPTY_STRING},client:new ci};if((null==r?void 0:r.protocolMode)!==Ve&&null!=r&&r.OIDCOptions&&new ze(u.loggerOptions).warning(JSON.stringify(Fr(Hr))),null!=r&&r.protocolMode&&r.protocolMode!==Ge&&null!=u&&u.allowNativeBroker)throw Fr(jr);return{auth:Os(Os(Os({},a),r),{},{OIDCOptions:Os(Os({},a.OIDCOptions),null==r?void 0:r.OIDCOptions)}),cache:Os(Os({},s),n),system:u,telemetry:Os(Os({},d),i)}}(e,this.browserEnvironment);try{n=window[yi]}catch(e){}var o=null===(t=n)||void 0===t?void 0:t.getItem("msal.browser.log.level"),i=null===(r=n)||void 0===r||null===(r=r.getItem("msal.browser.log.pii"))||void 0===r?void 0:r.toLowerCase(),a="true"===i||"false"!==i&&void 0,s=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ms(Object(r),!0).forEach(function(t){Ns(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ms(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},this.config.system.loggerOptions),c=o&&Object.keys(se).includes(o)?se[o]:void 0;c&&(s.loggerCallback=xs.loggerCallback,s.logLevel=c),void 0!==a&&(s.piiLoggingEnabled=a),this.logger=new ze(s,"@azure/msal-browser",_s),this.available=!1}getConfig(){return this.config}getLogger(){return this.logger}isAvailable(){return this.available}isBrowserEnvironment(){return this.browserEnvironment}}function qs(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}class Ls extends xs{getModuleName(){return Ls.MODULE_NAME}getId(){return Ls.ID}initialize(){var e,t=this;return(e=function*(){return t.available="undefined"!=typeof window,t.available},function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){qs(i,n,o,a,s,"next",e)}function s(e){qs(i,n,o,a,s,"throw",e)}a(void 0)})})()}}Ls.MODULE_NAME="",Ls.ID="StandardOperatingContext";var Hs="missing_kid_error",js="missing_alg_error",Ds={[Hs]:"The JOSE Header for the requested JWT, JWS or JWK object requires a keyId to be configured as the 'kid' header claim. No 'kid' value was provided.",[js]:"The JOSE Header for the requested JWT, JWS or JWK object requires an algorithm to be specified as the 'alg' header claim. No 'alg' value was provided."};class Us extends Xe{constructor(e,t){super(e,t),this.name="JoseHeaderError",Object.setPrototypeOf(this,Us.prototype)}}function Bs(e){return new Us(e,Ds[e])}class Fs{constructor(e){this.typ=e.typ,this.alg=e.alg,this.kid=e.kid}static getShrHeaderString(e){if(!e.kid)throw Bs(Hs);if(!e.alg)throw Bs(js);var t=new Fs({typ:e.typ||"pop",kid:e.kid,alg:e.alg});return JSON.stringify(t)}}function Ks(e){return(new TextDecoder).decode(function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw Da(Ma)}var r=atob(t);return Uint8Array.from(r,e=>e.codePointAt(0)||0)}(e))}function zs(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function Gs(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){zs(i,n,o,a,s,"next",e)}function s(e){zs(i,n,o,a,s,"throw",e)}a(void 0)})}}class Vs{constructor(){this.dbName=Li,this.version=1,this.tableName=Hi,this.dbOpen=!1}open(){var e=this;return Gs(function*(){return new Promise((t,r)=>{var n=window.indexedDB.open(e.dbName,e.version);n.addEventListener("upgradeneeded",t=>{t.target.result.createObjectStore(e.tableName)}),n.addEventListener("success",r=>{var n=r;e.db=n.target.result,e.dbOpen=!0,t()}),n.addEventListener("error",()=>r(Da(Sa)))})})()}closeConnection(){var e=this.db;e&&this.dbOpen&&(e.close(),this.dbOpen=!1)}validateDbIsOpen(){var e=this;return Gs(function*(){if(!e.dbOpen)return e.open()})()}getItem(e){var t=this;return Gs(function*(){return yield t.validateDbIsOpen(),new Promise((r,n)=>{if(!t.db)return n(Da(ma));var o=t.db.transaction([t.tableName],"readonly").objectStore(t.tableName).get(e);o.addEventListener("success",e=>{var n=e;t.closeConnection(),r(n.target.result)}),o.addEventListener("error",e=>{t.closeConnection(),n(e)})})})()}setItem(e,t){var r=this;return Gs(function*(){return yield r.validateDbIsOpen(),new Promise((n,o)=>{if(!r.db)return o(Da(ma));var i=r.db.transaction([r.tableName],"readwrite").objectStore(r.tableName).put(t,e);i.addEventListener("success",()=>{r.closeConnection(),n()}),i.addEventListener("error",e=>{r.closeConnection(),o(e)})})})()}removeItem(e){var t=this;return Gs(function*(){return yield t.validateDbIsOpen(),new Promise((r,n)=>{if(!t.db)return n(Da(ma));var o=t.db.transaction([t.tableName],"readwrite").objectStore(t.tableName).delete(e);o.addEventListener("success",()=>{t.closeConnection(),r()}),o.addEventListener("error",e=>{t.closeConnection(),n(e)})})})()}getKeys(){var e=this;return Gs(function*(){return yield e.validateDbIsOpen(),new Promise((t,r)=>{if(!e.db)return r(Da(ma));var n=e.db.transaction([e.tableName],"readonly").objectStore(e.tableName).getAllKeys();n.addEventListener("success",r=>{var n=r;e.closeConnection(),t(n.target.result)}),n.addEventListener("error",t=>{e.closeConnection(),r(t)})})})()}containsKey(e){var t=this;return Gs(function*(){return yield t.validateDbIsOpen(),new Promise((r,n)=>{if(!t.db)return n(Da(ma));var o=t.db.transaction([t.tableName],"readonly").objectStore(t.tableName).count(e);o.addEventListener("success",e=>{var n=e;t.closeConnection(),r(1===n.target.result)}),o.addEventListener("error",e=>{t.closeConnection(),n(e)})})})()}deleteDatabase(){var e=this;return Gs(function*(){return e.db&&e.dbOpen&&e.closeConnection(),new Promise((e,t)=>{var r=window.indexedDB.deleteDatabase(Li),n=setTimeout(()=>t(!1),200);r.addEventListener("success",()=>(clearTimeout(n),e(!0))),r.addEventListener("blocked",()=>(clearTimeout(n),e(!0))),r.addEventListener("error",()=>(clearTimeout(n),t(!1)))})})()}}class Ws{constructor(){this.cache=new Map}getItem(e){return this.cache.get(e)||null}setItem(e,t){this.cache.set(e,t)}removeItem(e){this.cache.delete(e)}getKeys(){var e=[];return this.cache.forEach((t,r)=>{e.push(r)}),e}containsKey(e){return this.cache.has(e)}clear(){this.cache.clear()}}function Qs(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function Ys(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){Qs(i,n,o,a,s,"next",e)}function s(e){Qs(i,n,o,a,s,"throw",e)}a(void 0)})}}class Js{constructor(e){this.inMemoryCache=new Ws,this.indexedDBCache=new Vs,this.logger=e}handleDatabaseAccessError(e){if(!(e instanceof ja&&e.errorCode===Sa))throw e;this.logger.error("Could not access persistent storage. This may be caused by browser privacy features which block persistent storage in third-party contexts.")}getItem(e){var t=this;return Ys(function*(){var r=t.inMemoryCache.getItem(e);if(!r)try{return t.logger.verbose("Queried item not found in in-memory cache, now querying persistent storage."),yield t.indexedDBCache.getItem(e)}catch(e){t.handleDatabaseAccessError(e)}return r})()}setItem(e,t){var r=this;return Ys(function*(){r.inMemoryCache.setItem(e,t);try{yield r.indexedDBCache.setItem(e,t)}catch(e){r.handleDatabaseAccessError(e)}})()}removeItem(e){var t=this;return Ys(function*(){t.inMemoryCache.removeItem(e);try{yield t.indexedDBCache.removeItem(e)}catch(e){t.handleDatabaseAccessError(e)}})()}getKeys(){var e=this;return Ys(function*(){var t=e.inMemoryCache.getKeys();if(0===t.length)try{return e.logger.verbose("In-memory cache is empty, now querying persistent storage."),yield e.indexedDBCache.getKeys()}catch(t){e.handleDatabaseAccessError(t)}return t})()}containsKey(e){var t=this;return Ys(function*(){var r=t.inMemoryCache.containsKey(e);if(!r)try{return t.logger.verbose("Key not found in in-memory cache, now querying persistent storage."),yield t.indexedDBCache.containsKey(e)}catch(e){t.handleDatabaseAccessError(e)}return r})()}clearInMemory(){this.logger.verbose("Deleting in-memory keystore"),this.inMemoryCache.clear(),this.logger.verbose("In-memory keystore deleted")}clearPersistent(){var e=this;return Ys(function*(){try{e.logger.verbose("Deleting persistent keystore");var t=yield e.indexedDBCache.deleteDatabase();return t&&e.logger.verbose("Persistent keystore deleted"),t}catch(t){return e.handleDatabaseAccessError(t),!1}})()}}function Xs(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Zs(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Xs(Object(r),!0).forEach(function(t){$s(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Xs(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function $s(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ec(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function tc(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){ec(i,n,o,a,s,"next",e)}function s(e){ec(i,n,o,a,s,"throw",e)}a(void 0)})}}class rc{constructor(e,t,r){this.logger=e,function(e){if(!window)throw Da(pa);if(!window.crypto)throw Da(Ki);if(!e&&!window.crypto.subtle)throw Da(Ki,"crypto_subtle_undefined")}(null!=r&&r),this.cache=new Js(this.logger),this.performanceClient=t}createNewGuid(){return as()}base64Encode(e){return Wa(e)}base64Decode(e){return Ks(e)}base64UrlEncode(e){return Ga(e)}encodeKid(e){return this.base64UrlEncode(JSON.stringify({kid:e}))}getPublicKeyThumbprint(e){var t=this;return tc(function*(){var r,n=null===(r=t.performanceClient)||void 0===r?void 0:r.startMeasurement(Vn,e.correlationId),o=yield function(e,t){return ss.apply(this,arguments)}(rc.EXTRACTABLE,rc.POP_KEY_USAGES),i=yield cs(o.publicKey),a=nc({e:i.e,kty:i.kty,n:i.n}),s=yield t.hashString(a),c=yield cs(o.privateKey),l=yield function(e,t,r){return us.apply(this,arguments)}(c,!1,["sign"]);return yield t.cache.setItem(s,{privateKey:l,publicKey:o.publicKey,requestMethod:e.resourceRequestMethod,requestUri:e.resourceRequestUri}),n&&n.end({success:!0}),s})()}removeTokenBindingKey(e){var t=this;return tc(function*(){return yield t.cache.removeItem(e),!(yield t.cache.containsKey(e))})()}clearKeystore(){var e=this;return tc(function*(){e.cache.clearInMemory();try{return yield e.cache.clearPersistent(),!0}catch(t){return t instanceof Error?e.logger.error("Clearing keystore failed with error: ".concat(t.message)):e.logger.error("Clearing keystore failed with unknown error"),!1}})()}signJwt(e,t,r,n){var o=this;return tc(function*(){var i,a=null===(i=o.performanceClient)||void 0===i?void 0:i.startMeasurement(Wn,n),s=yield o.cache.getItem(t);if(!s)throw Da(ba);var c=yield cs(s.publicKey),l=nc(c),u=Ga(JSON.stringify({kid:t})),d=Ga(Fs.getShrHeaderString(Zs(Zs({},null==r?void 0:r.header),{},{alg:c.alg,kid:u})));e.cnf={jwk:JSON.parse(l)};var h=Ga(JSON.stringify(e)),g="".concat(d,".").concat(h),p=(new TextEncoder).encode(g),m=yield function(e,t){return ds.apply(this,arguments)}(s.privateKey,p),v=Va(new Uint8Array(m)),f="".concat(g,".").concat(v);return a&&a.end({success:!0}),f})()}hashString(e){return tc(function*(){return hs(e)})()}}function nc(e){return JSON.stringify(e,Object.keys(e).sort())}rc.POP_KEY_USAGES=["sign","verify"],rc.EXTRACTABLE=!0;var oc=(e,t,r,n,o)=>function(){r.trace("Executing function ".concat(t));var i=null==n?void 0:n.startMeasurement(t,o);if(o){var a=t+"CallCount";null==n||n.incrementFields({[a]:1},o)}try{var s=e(...arguments);return null==i||i.end({success:!0}),r.trace("Returning result from ".concat(t)),s}catch(e){r.trace("Error occurred in ".concat(t));try{r.trace(JSON.stringify(e))}catch(e){r.trace("Unable to print error message.")}throw null==i||i.end({success:!1},e),e}},ic=(e,t,r,n,o)=>function(){r.trace("Executing function ".concat(t));var i=null==n?void 0:n.startMeasurement(t,o);if(o){var a=t+"CallCount";null==n||n.incrementFields({[a]:1},o)}return null==n||n.setPreQueueTime(t,o),e(...arguments).then(e=>(r.trace("Returning result from ".concat(t)),null==i||i.end({success:!0}),e)).catch(e=>{r.trace("Error occurred in ".concat(t));try{r.trace(JSON.stringify(e))}catch(e){r.trace("Unable to print error message.")}throw null==i||i.end({success:!1},e),e})};function ac(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function sc(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){ac(i,n,o,a,s,"next",e)}function s(e){ac(i,n,o,a,s,"throw",e)}a(void 0)})}}class cc{constructor(e,t,r,n){this.networkInterface=e,this.logger=t,this.performanceClient=r,this.correlationId=n}detectRegion(e,t){var r=this;return sc(function*(){var n;null===(n=r.performanceClient)||void 0===n||n.addQueueMeasurement(Go,r.correlationId);var o=e;if(o)t.region_source="3";else{var i=cc.IMDS_OPTIONS;try{var a=yield ic(r.getRegionFromIMDS.bind(r),Vo,r.logger,r.performanceClient,r.correlationId)(ce.IMDS_VERSION,i);if(200===a.status&&(o=a.body,t.region_source="4"),400===a.status){var s=yield ic(r.getCurrentVersion.bind(r),Wo,r.logger,r.performanceClient,r.correlationId)(i);if(!s)return t.region_source="1",null;var c=yield ic(r.getRegionFromIMDS.bind(r),Vo,r.logger,r.performanceClient,r.correlationId)(s,i);200===c.status&&(o=c.body,t.region_source="4")}}catch(e){return t.region_source="1",null}}return o||(t.region_source="1"),o||null})()}getRegionFromIMDS(e,t){var r=this;return sc(function*(){var n;return null===(n=r.performanceClient)||void 0===n||n.addQueueMeasurement(Vo,r.correlationId),r.networkInterface.sendGetRequestAsync("".concat(ce.IMDS_ENDPOINT,"?api-version=").concat(e,"&format=text"),t,ce.IMDS_TIMEOUT)})()}getCurrentVersion(e){var t=this;return sc(function*(){var r;null===(r=t.performanceClient)||void 0===r||r.addQueueMeasurement(Wo,t.correlationId);try{var n=yield t.networkInterface.sendGetRequestAsync("".concat(ce.IMDS_ENDPOINT,"?format=json"),e);return 400===n.status&&n.body&&n.body["newest-versions"]&&n.body["newest-versions"].length>0?n.body["newest-versions"][0]:null}catch(e){return null}})()}}function lc(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function uc(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?lc(Object(r),!0).forEach(function(t){dc(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):lc(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function dc(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function hc(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function gc(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){hc(i,n,o,a,s,"next",e)}function s(e){hc(i,n,o,a,s,"throw",e)}a(void 0)})}}cc.IMDS_OPTIONS={headers:{Metadata:"true"}};class pc{constructor(e,t,r,n,o,i,a,s){this.canonicalAuthority=e,this._canonicalAuthority.validateAsUri(),this.networkInterface=t,this.cacheManager=r,this.authorityOptions=n,this.regionDiscoveryMetadata={region_used:void 0,region_source:void 0,region_outcome:void 0},this.logger=o,this.performanceClient=a,this.correlationId=i,this.managedIdentity=s||!1,this.regionDiscovery=new cc(t,this.logger,this.performanceClient,this.correlationId)}getAuthorityType(e){if(e.HostNameAndPort.endsWith(ce.CIAM_AUTH_URL))return 3;var t=e.PathSegments;if(t.length)switch(t[0].toLowerCase()){case ce.ADFS:return 1;case ce.DSTS:return 2}return 0}get authorityType(){return this.getAuthorityType(this.canonicalAuthorityUrlComponents)}get protocolMode(){return this.authorityOptions.protocolMode}get options(){return this.authorityOptions}get canonicalAuthority(){return this._canonicalAuthority.urlString}set canonicalAuthority(e){this._canonicalAuthority=new sn(e),this._canonicalAuthority.validateAsUri(),this._canonicalAuthorityUrlComponents=null}get canonicalAuthorityUrlComponents(){return this._canonicalAuthorityUrlComponents||(this._canonicalAuthorityUrlComponents=this._canonicalAuthority.getUrlComponents()),this._canonicalAuthorityUrlComponents}get hostnameAndPort(){return this.canonicalAuthorityUrlComponents.HostNameAndPort.toLowerCase()}get tenant(){return this.canonicalAuthorityUrlComponents.PathSegments[0]}get authorizationEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.authorization_endpoint);throw Gt(nt)}get tokenEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint);throw Gt(nt)}get deviceCodeEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint.replace("/token","/devicecode"));throw Gt(nt)}get endSessionEndpoint(){if(this.discoveryComplete()){if(!this.metadata.end_session_endpoint)throw Gt(Lt);return this.replacePath(this.metadata.end_session_endpoint)}throw Gt(nt)}get selfSignedJwtAudience(){if(this.discoveryComplete())return this.replacePath(this.metadata.issuer);throw Gt(nt)}get jwksUri(){if(this.discoveryComplete())return this.replacePath(this.metadata.jwks_uri);throw Gt(nt)}canReplaceTenant(e){return 1===e.PathSegments.length&&!pc.reservedTenantDomains.has(e.PathSegments[0])&&0===this.getAuthorityType(e)&&this.protocolMode===Ge}replaceTenant(e){return e.replace(/{tenant}|{tenantid}/g,this.tenant)}replacePath(e){var t=e,r=new sn(this.metadata.canonical_authority).getUrlComponents(),n=r.PathSegments;return this.canonicalAuthorityUrlComponents.PathSegments.forEach((e,o)=>{var i=n[o];if(0===o&&this.canReplaceTenant(r)){var a=new sn(this.metadata.authorization_endpoint).getUrlComponents().PathSegments[0];i!==a&&(this.logger.verbose("Replacing tenant domain name ".concat(i," with id ").concat(a)),i=a)}e!==i&&(t=t.replace("/".concat(i,"/"),"/".concat(e,"/")))}),this.replaceTenant(t)}get defaultOpenIdConfigurationEndpoint(){var e=this.hostnameAndPort;return this.canonicalAuthority.endsWith("v2.0/")||1===this.authorityType||this.protocolMode!==Ge&&!this.isAliasOfKnownMicrosoftAuthority(e)?"".concat(this.canonicalAuthority,".well-known/openid-configuration"):"".concat(this.canonicalAuthority,"v2.0/.well-known/openid-configuration")}discoveryComplete(){return!!this.metadata}resolveEndpointsAsync(){var e=this;return gc(function*(){var t,r;null===(t=e.performanceClient)||void 0===t||t.addQueueMeasurement(Do,e.correlationId);var n=e.getCurrentMetadataEntity(),o=yield ic(e.updateCloudDiscoveryMetadata.bind(e),Bo,e.logger,e.performanceClient,e.correlationId)(n);e.canonicalAuthority=e.canonicalAuthority.replace(e.hostnameAndPort,n.preferred_network);var i=yield ic(e.updateEndpointMetadata.bind(e),Ko,e.logger,e.performanceClient,e.correlationId)(n);e.updateCachedMetadata(n,o,{source:i}),null===(r=e.performanceClient)||void 0===r||r.addFields({cloudDiscoverySource:o,authorityEndpointSource:i},e.correlationId)})()}getCurrentMetadataEntity(){var e=this.cacheManager.getAuthorityMetadataByAlias(this.hostnameAndPort);return e||(e={aliases:[],preferred_cache:this.hostnameAndPort,preferred_network:this.hostnameAndPort,canonical_authority:this.canonicalAuthority,authorization_endpoint:"",token_endpoint:"",end_session_endpoint:"",issuer:"",aliasesFromNetwork:!1,endpointsFromNetwork:!1,expiresAt:pr(),jwks_uri:""}),e}updateCachedMetadata(e,t,r){t!==je&&(null==r?void 0:r.source)!==je&&(e.expiresAt=pr(),e.canonical_authority=this.canonicalAuthority);var n=this.cacheManager.generateAuthorityMetadataCacheKey(e.preferred_cache);this.cacheManager.setAuthorityMetadata(n,e),this.metadata=e}updateEndpointMetadata(e){var t=this;return gc(function*(){var r;null===(r=t.performanceClient)||void 0===r||r.addQueueMeasurement(Ko,t.correlationId);var n=t.updateEndpointMetadataFromLocalSources(e);if(n){var o;if(n.source===Ue&&null!==(o=t.authorityOptions.azureRegionConfiguration)&&void 0!==o&&o.azureRegion&&n.metadata){var i=yield ic(t.updateMetadataWithRegionalInformation.bind(t),zo,t.logger,t.performanceClient,t.correlationId)(n.metadata);mr(e,i,!1),e.canonical_authority=t.canonicalAuthority}return n.source}var a,s=yield ic(t.getEndpointMetadataFromNetwork.bind(t),Fo,t.logger,t.performanceClient,t.correlationId)();if(s)return null!==(a=t.authorityOptions.azureRegionConfiguration)&&void 0!==a&&a.azureRegion&&(s=yield ic(t.updateMetadataWithRegionalInformation.bind(t),zo,t.logger,t.performanceClient,t.correlationId)(s)),mr(e,s,!0),De;throw Gt(it,t.defaultOpenIdConfigurationEndpoint)})()}updateEndpointMetadataFromLocalSources(e){this.logger.verbose("Attempting to get endpoint metadata from authority configuration");var t=this.getEndpointMetadataFromConfig();if(t)return this.logger.verbose("Found endpoint metadata in authority configuration"),mr(e,t,!1),{source:He};if(this.logger.verbose("Did not find endpoint metadata in the config... Attempting to get endpoint metadata from the hardcoded values."),this.authorityOptions.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get endpoint metadata from the network metadata cache.");else{var r=this.getEndpointMetadataFromHardcodedValues();if(r)return mr(e,r,!1),{source:Ue,metadata:r};this.logger.verbose("Did not find endpoint metadata in hardcoded values... Attempting to get endpoint metadata from the network metadata cache.")}var n=fr(e);return this.isAuthoritySameType(e)&&e.endpointsFromNetwork&&!n?(this.logger.verbose("Found endpoint metadata in the cache."),{source:je}):(n&&this.logger.verbose("The metadata entity is expired."),null)}isAuthoritySameType(e){return new sn(e.canonical_authority).getUrlComponents().PathSegments.length===this.canonicalAuthorityUrlComponents.PathSegments.length}getEndpointMetadataFromConfig(){if(this.authorityOptions.authorityMetadata)try{return JSON.parse(this.authorityOptions.authorityMetadata)}catch(e){throw Fr(_r)}return null}getEndpointMetadataFromNetwork(){var e=this;return gc(function*(){var t;null===(t=e.performanceClient)||void 0===t||t.addQueueMeasurement(Fo,e.correlationId);var r=e.defaultOpenIdConfigurationEndpoint;e.logger.verbose("Authority.getEndpointMetadataFromNetwork: attempting to retrieve OAuth endpoints from ".concat(r));try{var n=yield e.networkInterface.sendGetRequestAsync(r,{}),o=function(e){return e.hasOwnProperty("authorization_endpoint")&&e.hasOwnProperty("token_endpoint")&&e.hasOwnProperty("issuer")&&e.hasOwnProperty("jwks_uri")}(n.body);return o?n.body:(e.logger.verbose("Authority.getEndpointMetadataFromNetwork: could not parse response as OpenID configuration"),null)}catch(t){return e.logger.verbose("Authority.getEndpointMetadataFromNetwork: ".concat(t)),null}})()}getEndpointMetadataFromHardcodedValues(){return this.hostnameAndPort in cn?cn[this.hostnameAndPort]:null}updateMetadataWithRegionalInformation(e){var t=this;return gc(function*(){var r,n;null===(r=t.performanceClient)||void 0===r||r.addQueueMeasurement(zo,t.correlationId);var o=null===(n=t.authorityOptions.azureRegionConfiguration)||void 0===n?void 0:n.azureRegion;if(o){var i;if(o!==ce.AZURE_REGION_AUTO_DISCOVER_FLAG)return t.regionDiscoveryMetadata.region_outcome="2",t.regionDiscoveryMetadata.region_used=o,pc.replaceWithRegionalInformation(e,o);var a=yield ic(t.regionDiscovery.detectRegion.bind(t.regionDiscovery),Go,t.logger,t.performanceClient,t.correlationId)(null===(i=t.authorityOptions.azureRegionConfiguration)||void 0===i?void 0:i.environmentRegion,t.regionDiscoveryMetadata);if(a)return t.regionDiscoveryMetadata.region_outcome="4",t.regionDiscoveryMetadata.region_used=a,pc.replaceWithRegionalInformation(e,a);t.regionDiscoveryMetadata.region_outcome="5"}return e})()}updateCloudDiscoveryMetadata(e){var t=this;return gc(function*(){var r;null===(r=t.performanceClient)||void 0===r||r.addQueueMeasurement(Bo,t.correlationId);var n=t.updateCloudDiscoveryMetadataFromLocalSources(e);if(n)return n;var o=yield ic(t.getCloudDiscoveryMetadataFromNetwork.bind(t),Uo,t.logger,t.performanceClient,t.correlationId)();if(o)return vr(e,o,!0),De;throw Fr(Mr)})()}updateCloudDiscoveryMetadataFromLocalSources(e){this.logger.verbose("Attempting to get cloud discovery metadata  from authority configuration"),this.logger.verbosePii("Known Authorities: ".concat(this.authorityOptions.knownAuthorities||ce.NOT_APPLICABLE)),this.logger.verbosePii("Authority Metadata: ".concat(this.authorityOptions.authorityMetadata||ce.NOT_APPLICABLE)),this.logger.verbosePii("Canonical Authority: ".concat(e.canonical_authority||ce.NOT_APPLICABLE));var t,r=this.getCloudDiscoveryMetadataFromConfig();if(r)return this.logger.verbose("Found cloud discovery metadata in authority configuration"),vr(e,r,!1),He;if(this.logger.verbose("Did not find cloud discovery metadata in the config... Attempting to get cloud discovery metadata from the hardcoded values."),this.options.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded cloud discovery metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get cloud discovery metadata from the network metadata cache.");else{var n=(t=this.hostnameAndPort,hn(ln.metadata,t));if(n)return this.logger.verbose("Found cloud discovery metadata from hardcoded values."),vr(e,n,!1),Ue;this.logger.verbose("Did not find cloud discovery metadata in hardcoded values... Attempting to get cloud discovery metadata from the network metadata cache.")}var o=fr(e);return this.isAuthoritySameType(e)&&e.aliasesFromNetwork&&!o?(this.logger.verbose("Found cloud discovery metadata in the cache."),je):(o&&this.logger.verbose("The metadata entity is expired."),null)}getCloudDiscoveryMetadataFromConfig(){if(3===this.authorityType)return this.logger.verbose("CIAM authorities do not support cloud discovery metadata, generate the aliases from authority host."),pc.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort);if(this.authorityOptions.cloudDiscoveryMetadata){this.logger.verbose("The cloud discovery metadata has been provided as a network response, in the config.");try{this.logger.verbose("Attempting to parse the cloud discovery metadata.");var e=hn(JSON.parse(this.authorityOptions.cloudDiscoveryMetadata).metadata,this.hostnameAndPort);if(this.logger.verbose("Parsed the cloud discovery metadata."),e)return this.logger.verbose("There is returnable metadata attached to the parsed cloud discovery metadata."),e;this.logger.verbose("There is no metadata attached to the parsed cloud discovery metadata.")}catch(e){throw this.logger.verbose("Unable to parse the cloud discovery metadata. Throwing Invalid Cloud Discovery Metadata Error."),Fr(Rr)}}return this.isInKnownAuthorities()?(this.logger.verbose("The host is included in knownAuthorities. Creating new cloud discovery metadata from the host."),pc.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)):null}getCloudDiscoveryMetadataFromNetwork(){var e=this;return gc(function*(){var t;null===(t=e.performanceClient)||void 0===t||t.addQueueMeasurement(Uo,e.correlationId);var r="".concat(ce.AAD_INSTANCE_DISCOVERY_ENDPT).concat(e.canonicalAuthority,"oauth2/v2.0/authorize"),n=null;try{var o,i,a=yield e.networkInterface.sendGetRequestAsync(r,{});if(function(e){return e.hasOwnProperty("tenant_discovery_endpoint")&&e.hasOwnProperty("metadata")}(a.body))i=(o=a.body).metadata,e.logger.verbosePii("tenant_discovery_endpoint is: ".concat(o.tenant_discovery_endpoint));else{if(!function(e){return e.hasOwnProperty("error")&&e.hasOwnProperty("error_description")}(a.body))return e.logger.error("AAD did not return a CloudInstanceDiscoveryResponse or CloudInstanceDiscoveryErrorResponse"),null;if(e.logger.warning("A CloudInstanceDiscoveryErrorResponse was returned. The cloud instance discovery network request's status code is: ".concat(a.status)),(o=a.body).error===ce.INVALID_INSTANCE)return e.logger.error("The CloudInstanceDiscoveryErrorResponse error is invalid_instance."),null;e.logger.warning("The CloudInstanceDiscoveryErrorResponse error is ".concat(o.error)),e.logger.warning("The CloudInstanceDiscoveryErrorResponse error description is ".concat(o.error_description)),e.logger.warning("Setting the value of the CloudInstanceDiscoveryMetadata (returned from the network) to []"),i=[]}e.logger.verbose("Attempting to find a match between the developer's authority and the CloudInstanceDiscoveryMetadata returned from the network request."),n=hn(i,e.hostnameAndPort)}catch(t){if(t instanceof Xe)e.logger.error("There was a network error while attempting to get the cloud discovery instance metadata.\nError: ".concat(t.errorCode,"\nError Description: ").concat(t.errorMessage));else{var s=t;e.logger.error("A non-MSALJS error was thrown while attempting to get the cloud instance discovery metadata.\nError: ".concat(s.name,"\nError Description: ").concat(s.message))}return null}return n||(e.logger.warning("The developer's authority was not found within the CloudInstanceDiscoveryMetadata returned from the network request."),e.logger.verbose("Creating custom Authority for custom domain scenario."),n=pc.createCloudDiscoveryMetadataFromHost(e.hostnameAndPort)),n})()}isInKnownAuthorities(){return this.authorityOptions.knownAuthorities.filter(e=>e&&sn.getDomainFromUrl(e).toLowerCase()===this.hostnameAndPort).length>0}static generateAuthority(e,t){var r;if(t&&t.azureCloudInstance!==We){var n=t.tenant?t.tenant:ce.DEFAULT_COMMON_TENANT;r="".concat(t.azureCloudInstance,"/").concat(n,"/")}return r||e}static createCloudDiscoveryMetadataFromHost(e){return{preferred_network:e,preferred_cache:e,aliases:[e]}}getPreferredCache(){if(this.managedIdentity)return ce.DEFAULT_AUTHORITY_HOST;if(this.discoveryComplete())return this.metadata.preferred_cache;throw Gt(nt)}isAlias(e){return this.metadata.aliases.indexOf(e)>-1}isAliasOfKnownMicrosoftAuthority(e){return un.has(e)}static isPublicCloudAuthority(e){return ce.KNOWN_PUBLIC_CLOUDS.indexOf(e)>=0}static buildRegionalAuthorityString(e,t,r){var n=new sn(e);n.validateAsUri();var o=n.getUrlComponents(),i="".concat(t,".").concat(o.HostNameAndPort);this.isPublicCloudAuthority(o.HostNameAndPort)&&(i="".concat(t,".").concat(ce.REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX));var a=sn.constructAuthorityUriFromObject(uc(uc({},n.getUrlComponents()),{},{HostNameAndPort:i})).urlString;return r?"".concat(a,"?").concat(r):a}static replaceWithRegionalInformation(e,t){var r=uc({},e);return r.authorization_endpoint=pc.buildRegionalAuthorityString(r.authorization_endpoint,t),r.token_endpoint=pc.buildRegionalAuthorityString(r.token_endpoint,t),r.end_session_endpoint&&(r.end_session_endpoint=pc.buildRegionalAuthorityString(r.end_session_endpoint,t)),r}static transformCIAMAuthority(e){var t=e,r=new sn(e).getUrlComponents();if(0===r.PathSegments.length&&r.HostNameAndPort.endsWith(ce.CIAM_AUTH_URL)){var n=r.HostNameAndPort.split(".")[0];t="".concat(t).concat(n).concat(ce.AAD_TENANT_DOMAIN_SUFFIX)}return t}}function mc(e){return e.endsWith(ce.FORWARD_SLASH)?e:"".concat(e).concat(ce.FORWARD_SLASH)}pc.reservedTenantDomains=new Set(["{tenant}","{tenantid}",Ie,Se,Te]);var vc="no_tokens_found",fc="native_account_unavailable",yc="refresh_token_expired",Cc="bad_token",wc=["interaction_required","consent_required","login_required",Cc],bc=["message_only","additional_action","basic_action","user_password_expired","consent_required","bad_token"],kc={[vc]:"No refresh token found in the cache. Please sign-in.",[fc]:"The requested account is not available in the native broker. It may have been deleted or logged out. Please sign-in again using an interactive API.",[yc]:"Refresh token has expired.",[Cc]:"Identity provider returned bad_token due to an expired or invalid refresh token. Please invoke an interactive API to resolve."};class Ic extends Xe{constructor(e,t,r,n,o,i,a,s){super(e,t,r),Object.setPrototypeOf(this,Ic.prototype),this.timestamp=n||ce.EMPTY_STRING,this.traceId=o||ce.EMPTY_STRING,this.correlationId=i||ce.EMPTY_STRING,this.claims=a||ce.EMPTY_STRING,this.name="InteractionRequiredAuthError",this.errorNo=s}}function Tc(e,t,r){var n=!!e&&wc.indexOf(e)>-1,o=!!r&&bc.indexOf(r)>-1,i=!!t&&wc.some(e=>t.indexOf(e)>-1);return n||i||o}function Sc(e){return new Ic(e,kc[e])}class Ac{static setRequestState(e,t,r){var n=Ac.generateLibraryState(e,r);return t?"".concat(n).concat(ce.RESOURCE_DELIM).concat(t):n}static generateLibraryState(e,t){if(!e)throw Gt(Et);var r={id:e.createNewGuid()};t&&(r.meta=t);var n=JSON.stringify(r);return e.base64Encode(n)}static parseRequestState(e,t){if(!e)throw Gt(Et);if(!t)throw Gt(st);try{var r=t.split(ce.RESOURCE_DELIM),n=r[0],o=r.length>1?r.slice(1).join(ce.RESOURCE_DELIM):ce.EMPTY_STRING,i=e.base64Decode(n),a=JSON.parse(i);return{userRequestState:o||ce.EMPTY_STRING,libraryState:a}}catch(e){throw Gt(st)}}}var Ec="home_account_id",Oc="UPN";class Pc{constructor(){if(!window.localStorage)throw Cs(ps)}getItem(e){return window.localStorage.getItem(e)}setItem(e,t){window.localStorage.setItem(e,t)}removeItem(e){window.localStorage.removeItem(e)}getKeys(){return Object.keys(window.localStorage)}containsKey(e){return window.localStorage.hasOwnProperty(e)}}class Rc{constructor(){if(!window.sessionStorage)throw Cs(ps)}getItem(e){return window.sessionStorage.getItem(e)}setItem(e,t){window.sessionStorage.setItem(e,t)}removeItem(e){window.sessionStorage.removeItem(e)}getKeys(){return Object.keys(window.sessionStorage)}containsKey(e){return window.sessionStorage.hasOwnProperty(e)}}function _c(e,t){if(!t)return null;try{return Ac.parseRequestState(e,t).libraryState.meta}catch(e){throw Gt(st)}}class Mc{getItem(e){for(var t="".concat(encodeURIComponent(e)),r=document.cookie.split(";"),n=0;n<r.length;n++){var o=r[n],[i,...a]=decodeURIComponent(o).trim().split("="),s=a.join("=");if(i===t)return s}return""}setItem(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o="".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(t),";path=/;SameSite=Lax;");if(r){var i=function(e){var t=new Date;return new Date(t.getTime()+864e5*e).toUTCString()}(r);o+="expires=".concat(i,";")}n&&(o+="Secure;"),document.cookie=o}removeItem(e){this.setItem(e,"",-1)}getKeys(){var e=document.cookie.split(";"),t=[];return e.forEach(e=>{var r=decodeURIComponent(e).trim().split("=");t.push(r[0])}),t}containsKey(e){return this.getKeys().includes(e)}}function Nc(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function xc(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){Nc(i,n,o,a,s,"next",e)}function s(e){Nc(i,n,o,a,s,"throw",e)}a(void 0)})}}class qc extends In{constructor(e,t,r,n,o,i){super(e,r,n,o),this.cacheConfig=t,this.logger=n,this.internalStorage=new Ws,this.browserStorage=this.setupBrowserStorage(this.cacheConfig.cacheLocation),this.temporaryCacheStorage=this.setupBrowserStorage(this.cacheConfig.temporaryCacheLocation),this.cookieStorage=new Mc,t.cacheMigrationEnabled&&(this.migrateCacheEntries(),this.createKeyMaps()),this.performanceClient=i}setupBrowserStorage(e){try{switch(e){case fi:return new Pc;case yi:return new Rc}}catch(e){this.logger.error(e)}return this.cacheConfig.cacheLocation=Ci,new Ws}migrateCacheEntries(){var e=this.browserStorage.getItem(Ri);e&&this.logger.info("MSAL.js was last initialized with version ".concat(e)),e!==_s&&this.browserStorage.setItem(Ri,_s);var t="".concat(ce.CACHE_PREFIX,".").concat(ve),r="".concat(ce.CACHE_PREFIX,".").concat(fe),n="".concat(ce.CACHE_PREFIX,".").concat(Ce),o="".concat(ce.CACHE_PREFIX,".").concat(we),i=[this.browserStorage.getItem(t),this.browserStorage.getItem(r),this.browserStorage.getItem(n),this.browserStorage.getItem(o)];[ve,fe,Ce,we].forEach((e,t)=>{var r=i[t];r&&this.setTemporaryCache(e,r,!0)})}createKeyMaps(){this.logger.trace("BrowserCacheManager - createKeyMaps called.");var e=this.cryptoImpl.createNewGuid(),t=this.getItem(Oi),r=this.getItem("".concat(Pi,".").concat(this.clientId));t&&r?this.logger.verbose("BrowserCacheManager:createKeyMaps - account and token key maps already exist, skipping migration."):this.browserStorage.getKeys().forEach(t=>{if(this.isCredentialKey(t)){var r=this.getItem(t);if(r){var n=this.validateAndParseJson(r);if(n&&n.hasOwnProperty("credentialType"))switch(n.credentialType){case Ne.ID_TOKEN:if(sr(n)){this.logger.trace("BrowserCacheManager:createKeyMaps - idToken found, saving key to token key map"),this.logger.tracePii("BrowserCacheManager:createKeyMaps - idToken with key: ".concat(t," found, saving key to token key map"));var o=n,i=this.updateCredentialCacheKey(t,o,e);return void this.addTokenKey(i,Ne.ID_TOKEN,e)}this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching idToken schema with value containing idToken credentialType field but value failed IdTokenEntity validation, skipping."),this.logger.tracePii("BrowserCacheManager:createKeyMaps - failed idToken validation on key: ".concat(t));break;case Ne.ACCESS_TOKEN:case Ne.ACCESS_TOKEN_WITH_AUTH_SCHEME:if(ar(n)){this.logger.trace("BrowserCacheManager:createKeyMaps - accessToken found, saving key to token key map"),this.logger.tracePii("BrowserCacheManager:createKeyMaps - accessToken with key: ".concat(t," found, saving key to token key map"));var a=n,s=this.updateCredentialCacheKey(t,a,e);return void this.addTokenKey(s,Ne.ACCESS_TOKEN,e)}this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching accessToken schema with value containing accessToken credentialType field but value failed AccessTokenEntity validation, skipping."),this.logger.tracePii("BrowserCacheManager:createKeyMaps - failed accessToken validation on key: ".concat(t));break;case Ne.REFRESH_TOKEN:if(cr(n)){this.logger.trace("BrowserCacheManager:createKeyMaps - refreshToken found, saving key to token key map"),this.logger.tracePii("BrowserCacheManager:createKeyMaps - refreshToken with key: ".concat(t," found, saving key to token key map"));var c=n,l=this.updateCredentialCacheKey(t,c,e);return void this.addTokenKey(l,Ne.REFRESH_TOKEN,e)}this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching refreshToken schema with value containing refreshToken credentialType field but value failed RefreshTokenEntity validation, skipping."),this.logger.tracePii("BrowserCacheManager:createKeyMaps - failed refreshToken validation on key: ".concat(t))}}}if(this.isAccountKey(t)){var u=this.getItem(t);if(u){var d=this.validateAndParseJson(u);d&&nn.isAccountEntity(d)&&(this.logger.trace("BrowserCacheManager:createKeyMaps - account found, saving key to account key map"),this.logger.tracePii("BrowserCacheManager:createKeyMaps - account with key: ".concat(t," found, saving key to account key map")),this.addAccountKeyToMap(t,e))}}})}validateAndParseJson(e){try{var t=JSON.parse(e);return t&&"object"==typeof t?t:null}catch(e){return null}}getItem(e){return this.browserStorage.getItem(e)}setItem(e,t,r){for(var n=[],o=0;o<=20;o++)try{this.browserStorage.setItem(e,t),o>0&&this.removeAccessTokenKeys(n.slice(0,o),r);break}catch(a){var i=fn(a);if(!(i.errorCode===gn&&o<20))throw i;if(n.length||(n=e==="".concat(Pi,".").concat(this.clientId)?JSON.parse(t).accessToken:this.getTokenKeys().accessToken),n.length<=o)throw i;this.removeAccessToken(n[o],r,!1)}}getAccount(e,t,r){this.logger.trace("BrowserCacheManager.getAccount called");var n=this.getCachedAccountEntity(e,t);return this.updateOutdatedCachedAccount(e,n,t,r)}getCachedAccountEntity(e,t){var r=this.getItem(e);if(!r)return this.removeAccountKeyFromMap(e,t),null;var n=this.validateAndParseJson(r);return n&&nn.isAccountEntity(n)?In.toObject(new nn,n):null}setAccount(e,t){this.logger.trace("BrowserCacheManager.setAccount called");var r=e.generateAccountKey();e.lastUpdatedAt=Date.now().toString(),this.setItem(r,JSON.stringify(e),t),this.addAccountKeyToMap(r,t)}getAccountKeys(){this.logger.trace("BrowserCacheManager.getAccountKeys called");var e=this.getItem(Oi);return e?JSON.parse(e):(this.logger.verbose("BrowserCacheManager.getAccountKeys - No account keys found"),[])}addAccountKeyToMap(e,t){this.logger.trace("BrowserCacheManager.addAccountKeyToMap called"),this.logger.tracePii("BrowserCacheManager.addAccountKeyToMap called with key: ".concat(e));var r=this.getAccountKeys();-1===r.indexOf(e)?(r.push(e),this.setItem(Oi,JSON.stringify(r),t),this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key added")):this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key already exists in map")}removeAccountKeyFromMap(e,t){this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap called"),this.logger.tracePii("BrowserCacheManager.removeAccountKeyFromMap called with key: ".concat(e));var r=this.getAccountKeys(),n=r.indexOf(e);if(n>-1){if(r.splice(n,1),0===r.length)return void this.removeItem(Oi);this.setItem(Oi,JSON.stringify(r),t),this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap account key removed")}else this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap key not found in existing map")}removeAccount(e,t){var r=()=>super.removeAccount,n=this;return xc(function*(){r().call(n,e,t),n.removeAccountKeyFromMap(e,t)})()}removeOutdatedAccount(e,t){this.removeItem(e),this.removeAccountKeyFromMap(e,t)}removeIdToken(e,t){super.removeIdToken(e,t),this.removeTokenKey(e,Ne.ID_TOKEN,t)}removeAccessToken(e,t){var r,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super.removeAccessToken(e,t),null===(r=this.performanceClient)||void 0===r||r.incrementFields({accessTokensRemoved:1},t),n&&this.removeTokenKey(e,Ne.ACCESS_TOKEN,t)}removeAccessTokenKeys(e,t){this.logger.trace("removeAccessTokenKey called");var r=this.getTokenKeys(),n=0;if(e.forEach(e=>{var t=r.accessToken.indexOf(e);t>-1&&(r.accessToken.splice(t,1),n++)}),n>0)return this.logger.info("removed ".concat(n," accessToken keys from tokenKeys map")),void this.setTokenKeys(r,t)}removeRefreshToken(e,t){super.removeRefreshToken(e,t),this.removeTokenKey(e,Ne.REFRESH_TOKEN,t)}getTokenKeys(){this.logger.trace("BrowserCacheManager.getTokenKeys called");var e=this.getItem("".concat(Pi,".").concat(this.clientId));if(e){var t=this.validateAndParseJson(e);if(t&&t.hasOwnProperty("idToken")&&t.hasOwnProperty("accessToken")&&t.hasOwnProperty("refreshToken"))return t;this.logger.error("BrowserCacheManager.getTokenKeys - Token keys found but in an unknown format. Returning empty key map.")}else this.logger.verbose("BrowserCacheManager.getTokenKeys - No token keys found");return{idToken:[],accessToken:[],refreshToken:[]}}setTokenKeys(e,t){0!==e.idToken.length||0!==e.accessToken.length||0!==e.refreshToken.length?this.setItem("".concat(Pi,".").concat(this.clientId),JSON.stringify(e),t):this.removeItem("".concat(Pi,".").concat(this.clientId))}addTokenKey(e,t,r){this.logger.trace("BrowserCacheManager addTokenKey called");var n=this.getTokenKeys();switch(t){case Ne.ID_TOKEN:-1===n.idToken.indexOf(e)&&(this.logger.info("BrowserCacheManager: addTokenKey - idToken added to map"),n.idToken.push(e));break;case Ne.ACCESS_TOKEN:var o=n.accessToken.indexOf(e);-1!==o&&n.accessToken.splice(o,1),this.logger.trace("access token ".concat(-1===o?"added to":"updated in"," map")),n.accessToken.push(e);break;case Ne.REFRESH_TOKEN:-1===n.refreshToken.indexOf(e)&&(this.logger.info("BrowserCacheManager: addTokenKey - refreshToken added to map"),n.refreshToken.push(e));break;default:throw this.logger.error("BrowserCacheManager:addTokenKey - CredentialType provided invalid. CredentialType: ".concat(t)),Gt(Ot)}this.setTokenKeys(n,r)}removeTokenKey(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.getTokenKeys();switch(this.logger.trace("BrowserCacheManager removeTokenKey called"),t){case Ne.ID_TOKEN:this.logger.infoPii("BrowserCacheManager: removeTokenKey - attempting to remove idToken with key: ".concat(e," from map"));var o=n.idToken.indexOf(e);o>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - idToken removed from map"),n.idToken.splice(o,1)):this.logger.info("BrowserCacheManager: removeTokenKey - idToken does not exist in map. Either it was previously removed or it was never added.");break;case Ne.ACCESS_TOKEN:this.logger.infoPii("BrowserCacheManager: removeTokenKey - attempting to remove accessToken with key: ".concat(e," from map"));var i=n.accessToken.indexOf(e);i>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - accessToken removed from map"),n.accessToken.splice(i,1)):this.logger.info("BrowserCacheManager: removeTokenKey - accessToken does not exist in map. Either it was previously removed or it was never added.");break;case Ne.REFRESH_TOKEN:this.logger.infoPii("BrowserCacheManager: removeTokenKey - attempting to remove refreshToken with key: ".concat(e," from map"));var a=n.refreshToken.indexOf(e);a>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken removed from map"),n.refreshToken.splice(a,1)):this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken does not exist in map. Either it was previously removed or it was never added.");break;default:throw this.logger.error("BrowserCacheManager:removeTokenKey - CredentialType provided invalid. CredentialType: ".concat(t)),Gt(Ot)}this.setTokenKeys(n,r)}getIdTokenCredential(e,t){var r=this.getItem(e);if(!r)return this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeIdToken(e,t),null;var n=this.validateAndParseJson(r);return n&&sr(n)?(this.logger.trace("BrowserCacheManager.getIdTokenCredential: cache hit"),n):(this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),null)}setIdTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setIdTokenCredential called");var r=tr(e);e.lastUpdatedAt=Date.now().toString(),this.setItem(r,JSON.stringify(e),t),this.addTokenKey(r,Ne.ID_TOKEN,t)}getAccessTokenCredential(e,t){var r=this.getItem(e);if(!r)return this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(e,Ne.ACCESS_TOKEN,t),null;var n=this.validateAndParseJson(r);return n&&ar(n)?(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: cache hit"),n):(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),null)}setAccessTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setAccessTokenCredential called");var r=tr(e);e.lastUpdatedAt=Date.now().toString(),this.setItem(r,JSON.stringify(e),t),this.addTokenKey(r,Ne.ACCESS_TOKEN,t)}getRefreshTokenCredential(e,t){var r=this.getItem(e);if(!r)return this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(e,Ne.REFRESH_TOKEN,t),null;var n=this.validateAndParseJson(r);return n&&cr(n)?(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: cache hit"),n):(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),null)}setRefreshTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setRefreshTokenCredential called");var r=tr(e);e.lastUpdatedAt=Date.now().toString(),this.setItem(r,JSON.stringify(e),t),this.addTokenKey(r,Ne.REFRESH_TOKEN,t)}getAppMetadata(e){var t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null;var r,n=this.validateAndParseJson(t);return n&&((r=n)&&0===e.indexOf(xe)&&r.hasOwnProperty("clientId")&&r.hasOwnProperty("environment"))?(this.logger.trace("BrowserCacheManager.getAppMetadata: cache hit"),n):(this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null)}setAppMetadata(e,t){this.logger.trace("BrowserCacheManager.setAppMetadata called");var r=function(e){var{environment:t,clientId:r}=e;return[xe,t,r].join(Me).toLowerCase()}(e);this.setItem(r,JSON.stringify(e),t)}getServerTelemetry(e){var t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null;var r,n,o,i=this.validateAndParseJson(t);return i&&(r=i,n=0===e.indexOf(Be.CACHE_KEY),o=!0,r&&(o=r.hasOwnProperty("failedRequests")&&r.hasOwnProperty("errors")&&r.hasOwnProperty("cacheHits")),n&&o)?(this.logger.trace("BrowserCacheManager.getServerTelemetry: cache hit"),i):(this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null)}setServerTelemetry(e,t,r){this.logger.trace("BrowserCacheManager.setServerTelemetry called"),this.setItem(e,JSON.stringify(t),r)}getAuthorityMetadata(e){var t=this.internalStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAuthorityMetadata: called, no cache hit"),null;var r=this.validateAndParseJson(t);return r&&function(e,t){return!!t&&0===e.indexOf(Le)&&t.hasOwnProperty("aliases")&&t.hasOwnProperty("preferred_cache")&&t.hasOwnProperty("preferred_network")&&t.hasOwnProperty("canonical_authority")&&t.hasOwnProperty("authorization_endpoint")&&t.hasOwnProperty("token_endpoint")&&t.hasOwnProperty("issuer")&&t.hasOwnProperty("aliasesFromNetwork")&&t.hasOwnProperty("endpointsFromNetwork")&&t.hasOwnProperty("expiresAt")&&t.hasOwnProperty("jwks_uri")}(e,r)?(this.logger.trace("BrowserCacheManager.getAuthorityMetadata: cache hit"),r):null}getAuthorityMetadataKeys(){return this.internalStorage.getKeys().filter(e=>this.isAuthorityMetadata(e))}setWrapperMetadata(e,t){this.internalStorage.setItem(_i,e),this.internalStorage.setItem(Mi,t)}getWrapperMetadata(){return[this.internalStorage.getItem(_i)||ce.EMPTY_STRING,this.internalStorage.getItem(Mi)||ce.EMPTY_STRING]}setAuthorityMetadata(e,t){this.logger.trace("BrowserCacheManager.setAuthorityMetadata called"),this.internalStorage.setItem(e,JSON.stringify(t))}getActiveAccount(e){var t=this.generateCacheKey(ke),r=this.getItem(t);if(!r){this.logger.trace("BrowserCacheManager.getActiveAccount: No active account filters cache schema found, looking for legacy schema");var n=this.generateCacheKey(be),o=this.getItem(n);if(!o)return this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null;var i=this.getAccountInfoFilteredBy({localAccountId:o},e);return i?(this.logger.trace("BrowserCacheManager.getActiveAccount: Legacy active account cache schema found"),this.logger.trace("BrowserCacheManager.getActiveAccount: Adding active account filters cache schema"),this.setActiveAccount(i,e),i):null}var a=this.validateAndParseJson(r);return a?(this.logger.trace("BrowserCacheManager.getActiveAccount: Active account filters schema found"),this.getAccountInfoFilteredBy({homeAccountId:a.homeAccountId,localAccountId:a.localAccountId,tenantId:a.tenantId},e)):(this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null)}setActiveAccount(e,t){var r=this.generateCacheKey(ke),n=this.generateCacheKey(be);if(e){this.logger.verbose("setActiveAccount: Active account set");var o={homeAccountId:e.homeAccountId,localAccountId:e.localAccountId,tenantId:e.tenantId,lastUpdatedAt:Date.now().toString()};this.setItem(r,JSON.stringify(o),t),this.setItem(n,e.localAccountId,t)}else this.logger.verbose("setActiveAccount: No account passed, active account not set"),this.browserStorage.removeItem(r),this.browserStorage.removeItem(n)}getThrottlingCache(e){var t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null;var r=this.validateAndParseJson(t);return r&&function(e,t){var r=!1;e&&(r=0===e.indexOf(Ke));var n=!0;return t&&(n=t.hasOwnProperty("throttleTime")),r&&n}(e,r)?(this.logger.trace("BrowserCacheManager.getThrottlingCache: cache hit"),r):(this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null)}setThrottlingCache(e,t,r){this.logger.trace("BrowserCacheManager.setThrottlingCache called"),this.setItem(e,JSON.stringify(t),r)}getTemporaryCache(e,t){var r=t?this.generateCacheKey(e):e;if(this.cacheConfig.storeAuthStateInCookie){var n=this.cookieStorage.getItem(r);if(n)return this.logger.trace("BrowserCacheManager.getTemporaryCache: storeAuthStateInCookies set to true, retrieving from cookies"),n}var o=this.temporaryCacheStorage.getItem(r);if(!o){if(this.cacheConfig.cacheLocation===fi){var i=this.browserStorage.getItem(r);if(i)return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item found in local storage"),i}return this.logger.trace("BrowserCacheManager.getTemporaryCache: No cache item found in local storage"),null}return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item returned"),o}setTemporaryCache(e,t,r){var n=r?this.generateCacheKey(e):e;this.temporaryCacheStorage.setItem(n,t),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.setTemporaryCache: storeAuthStateInCookie set to true, setting item cookie"),this.cookieStorage.setItem(n,t,void 0,this.cacheConfig.secureCookies))}removeItem(e){this.browserStorage.removeItem(e)}removeTemporaryItem(e){this.temporaryCacheStorage.removeItem(e),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.removeItem: storeAuthStateInCookie is true, clearing item cookie"),this.cookieStorage.removeItem(e))}getKeys(){return this.browserStorage.getKeys()}clear(e){var t=this;return xc(function*(){yield t.removeAllAccounts(e),t.removeAppMetadata(e),t.temporaryCacheStorage.getKeys().forEach(e=>{-1===e.indexOf(ce.CACHE_PREFIX)&&-1===e.indexOf(t.clientId)||t.removeTemporaryItem(e)}),t.browserStorage.getKeys().forEach(e=>{-1===e.indexOf(ce.CACHE_PREFIX)&&-1===e.indexOf(t.clientId)||t.browserStorage.removeItem(e)}),t.internalStorage.clear()})()}clearTokensAndKeysWithClaims(e,t){var r=this;return xc(function*(){e.addQueueMeasurement($o,t);var n=r.getTokenKeys(),o=0;n.accessToken.forEach(e=>{var n=r.getAccessTokenCredential(e,t);null!=n&&n.requestedClaimsHash&&e.includes(n.requestedClaimsHash.toLowerCase())&&(r.removeAccessToken(e,t),o++)}),o>0&&r.logger.warning("".concat(o," access tokens with claims in the cache keys have been removed from the cache."))})()}generateCacheKey(e){return this.validateAndParseJson(e)?JSON.stringify(e):Kr.startsWith(e,ce.CACHE_PREFIX)||Kr.startsWith(e,ye)?e:"".concat(ce.CACHE_PREFIX,".").concat(this.clientId,".").concat(e)}generateAuthorityKey(e){var{libraryState:{id:t}}=Ac.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey("".concat("authority",".").concat(t))}generateNonceKey(e){var{libraryState:{id:t}}=Ac.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey("".concat("nonce.id_token",".").concat(t))}generateStateKey(e){var{libraryState:{id:t}}=Ac.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey("".concat(wi,".").concat(t))}getCachedAuthority(e){var t=this.generateStateKey(e),r=this.getTemporaryCache(t);if(!r)return null;var n=this.generateAuthorityKey(r);return this.getTemporaryCache(n)}updateCacheEntries(e,t,r,n,o){this.logger.trace("BrowserCacheManager.updateCacheEntries called");var i=this.generateStateKey(e);this.setTemporaryCache(i,e,!1);var a=this.generateNonceKey(e);this.setTemporaryCache(a,t,!1);var s=this.generateAuthorityKey(e);if(this.setTemporaryCache(s,r,!1),o){var c={credential:o.homeAccountId,type:Ec};this.setTemporaryCache(Si,JSON.stringify(c),!0)}else if(n){var l={credential:n,type:Oc};this.setTemporaryCache(Si,JSON.stringify(l),!0)}}resetRequestCache(e){this.logger.trace("BrowserCacheManager.resetRequestCache called"),e&&(this.temporaryCacheStorage.getKeys().forEach(t=>{-1!==t.indexOf(e)&&this.removeTemporaryItem(t)}),this.removeTemporaryItem(this.generateStateKey(e)),this.removeTemporaryItem(this.generateNonceKey(e)),this.removeTemporaryItem(this.generateAuthorityKey(e))),this.removeTemporaryItem(this.generateCacheKey(Ii)),this.removeTemporaryItem(this.generateCacheKey(bi)),this.removeTemporaryItem(this.generateCacheKey(ki)),this.removeTemporaryItem(this.generateCacheKey(Ai)),this.removeTemporaryItem(this.generateCacheKey(Si)),this.removeTemporaryItem(this.generateCacheKey(Ei)),this.setInteractionInProgress(!1)}cleanRequestByState(e){if(this.logger.trace("BrowserCacheManager.cleanRequestByState called"),e){var t=this.generateStateKey(e),r=this.temporaryCacheStorage.getItem(t);this.logger.infoPii("BrowserCacheManager.cleanRequestByState: Removing temporary cache items for state: ".concat(r)),this.resetRequestCache(r||ce.EMPTY_STRING)}}cleanRequestByInteractionType(e){this.logger.trace("BrowserCacheManager.cleanRequestByInteractionType called"),this.temporaryCacheStorage.getKeys().forEach(t=>{if(-1!==t.indexOf(wi)){var r=this.temporaryCacheStorage.getItem(t);if(r){var n=_c(this.cryptoImpl,r);n&&n.interactionType===e&&(this.logger.infoPii("BrowserCacheManager.cleanRequestByInteractionType: Removing temporary cache items for state: ".concat(r)),this.resetRequestCache(r))}}}),this.setInteractionInProgress(!1)}cacheCodeRequest(e){this.logger.trace("BrowserCacheManager.cacheCodeRequest called");var t=Wa(JSON.stringify(e));this.setTemporaryCache(Ii,t,!0)}getCachedRequest(e){this.logger.trace("BrowserCacheManager.getCachedRequest called");var t,r=this.getTemporaryCache(Ii,!0);if(!r)throw Da(la);try{t=JSON.parse(Ks(r))}catch(e){throw this.logger.errorPii("Attempted to parse: ".concat(r)),this.logger.error("Parsing cached token request threw with error: ".concat(e)),Da(ua)}if(this.removeTemporaryItem(this.generateCacheKey(Ii)),!t.authority){var n=this.generateAuthorityKey(e),o=this.getTemporaryCache(n);if(!o)throw Da(da);t.authority=o}return t}getCachedNativeRequest(){this.logger.trace("BrowserCacheManager.getCachedNativeRequest called");var e=this.getTemporaryCache(Ei,!0);return e?this.validateAndParseJson(e)||(this.logger.error("BrowserCacheManager.getCachedNativeRequest: Unable to parse native request"),null):(this.logger.trace("BrowserCacheManager.getCachedNativeRequest: No cached native request found"),null)}isInteractionInProgress(e){var t=this.getInteractionInProgress();return e?t===this.clientId:!!t}getInteractionInProgress(){var e="".concat(ce.CACHE_PREFIX,".").concat(Ti);return this.getTemporaryCache(e,!1)}setInteractionInProgress(e){var t="".concat(ce.CACHE_PREFIX,".").concat(Ti);if(e){if(this.getInteractionInProgress())throw Da(Ji);this.setTemporaryCache(t,this.clientId,!1)}else e||this.getInteractionInProgress()!==this.clientId||this.removeTemporaryItem(t)}getLegacyLoginHint(){var e=this.getTemporaryCache(ye);e&&(this.browserStorage.removeItem(ye),this.logger.verbose("Cached ADAL id token retrieved."));var t=this.getTemporaryCache(ve,!0);t&&(this.browserStorage.removeItem(this.generateCacheKey(ve)),this.logger.verbose("Cached MSAL.js v1 id token retrieved"));var r=t||e;if(r){var n=Xt(r,Ks);if(n.preferred_username)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 preferred_username as loginHint"),n.preferred_username;if(n.upn)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 upn as loginHint"),n.upn;this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, however, no account hint claim found. Enable preferred_username or upn id token claim to get SSO.")}return null}updateCredentialCacheKey(e,t,r){var n=tr(t);if(e!==n){var o=this.getItem(e);if(o)return this.browserStorage.removeItem(e),this.setItem(n,o,r),this.logger.verbose("Updated an outdated ".concat(t.credentialType," cache key")),n;this.logger.error("Attempted to update an outdated ".concat(t.credentialType," cache key but no item matching the outdated key was found in storage"))}return e}hydrateCache(e,t){var r=this;return xc(function*(){var n,o,i,a,s=rr(null===(n=e.account)||void 0===n?void 0:n.homeAccountId,null===(o=e.account)||void 0===o?void 0:o.environment,e.idToken,r.clientId,e.tenantId);t.claims&&(a=yield r.cryptoImpl.hashString(t.claims));var c={idToken:s,accessToken:nr(null===(i=e.account)||void 0===i?void 0:i.homeAccountId,e.account.environment,e.accessToken,r.clientId,e.tenantId,e.scopes.join(" "),e.expiresOn?e.expiresOn.getTime()/1e3:0,e.extExpiresOn?e.extExpiresOn.getTime()/1e3:0,Ks,void 0,e.tokenType,void 0,t.sshKid,t.claims,a)};return r.saveCacheRecord(c,e.correlationId)})()}saveCacheRecord(e,t,r){var n=()=>super.saveCacheRecord,o=this;return xc(function*(){try{yield n().call(o,e,t,r)}catch(e){if(e instanceof vn&&o.performanceClient&&t)try{var i=o.getTokenKeys();o.performanceClient.addFields({cacheRtCount:i.refreshToken.length,cacheIdCount:i.idToken.length,cacheAtCount:i.accessToken.length},t)}catch(e){}throw e}})()}}var Lc="msal:initializeEnd",Hc="msal:loginStart",jc="msal:loginSuccess",Dc="msal:loginFailure",Uc="msal:acquireTokenStart",Bc="msal:acquireTokenSuccess",Fc="msal:acquireTokenFailure",Kc="msal:acquireTokenByCodeFailure",zc="msal:handleRedirectEnd",Gc="msal:popupOpened",Vc="msal:logoutStart",Wc="msal:logoutSuccess",Qc="msal:logoutFailure",Yc="msal:logoutEnd";class Jc{constructor(e){this.eventCallbacks=new Map,this.logger=e||new ze({})}addEventCallback(e,t,r){if("undefined"!=typeof window){var n=r||as();return this.eventCallbacks.has(n)?(this.logger.error("Event callback with id: ".concat(n," is already registered. Please provide a unique id or remove the existing callback and try again.")),null):(this.eventCallbacks.set(n,[e,t||[]]),this.logger.verbose("Event callback registered with id: ".concat(n)),n)}return null}removeEventCallback(e){this.eventCallbacks.delete(e),this.logger.verbose("Event callback ".concat(e," removed."))}emitEvent(e,t,r,n){if("undefined"!=typeof window){var o={eventType:e,interactionType:t||null,payload:r||null,error:n||null,timestamp:Date.now()};this.eventCallbacks.forEach((t,r)=>{var[n,i]=t;(0===i.length||i.includes(e))&&(this.logger.verbose("Emitting event to callback ".concat(r,": ").concat(e)),n.apply(null,[o]))})}}}class Xc extends Xe{constructor(e,t,r,n,o){super(e,t,r),this.name="ServerError",this.errorNo=n,this.status=o,Object.setPrototypeOf(this,Xc.prototype)}}class Zc{static generateThrottlingStorageKey(e){return"".concat(Ke,".").concat(JSON.stringify(e))}static preProcess(e,t,r){var n=Zc.generateThrottlingStorageKey(t),o=e.getThrottlingCache(n);if(o){var i;if(o.throttleTime<Date.now())return void e.removeItem(n,r);throw new Xc((null===(i=o.errorCodes)||void 0===i?void 0:i.join(" "))||ce.EMPTY_STRING,o.errorMessage,o.subError)}}static postProcess(e,t,r,n){if(Zc.checkResponseStatus(r)||Zc.checkResponseForRetryAfter(r)){var o={throttleTime:Zc.calculateThrottleTime(parseInt(r.headers[he])),error:r.body.error,errorCodes:r.body.error_codes,errorMessage:r.body.error_description,subError:r.body.suberror};e.setThrottlingCache(Zc.generateThrottlingStorageKey(t),o,n)}}static checkResponseStatus(e){return 429===e.status||e.status>=500&&e.status<600}static checkResponseForRetryAfter(e){return!!e.headers&&e.headers.hasOwnProperty(he)&&(e.status<200||e.status>=300)}static calculateThrottleTime(e){var t=e<=0?0:e,r=Date.now()/1e3;return Math.floor(1e3*Math.min(r+(t||60),r+3600))}static removeThrottle(e,t,r,n){var o={clientId:t,authority:r.authority,scopes:r.scopes,homeAccountIdentifier:n,claims:r.claims,authenticationScheme:r.authenticationScheme,resourceRequestMethod:r.resourceRequestMethod,resourceRequestUri:r.resourceRequestUri,shrClaims:r.shrClaims,sshKid:r.sshKid},i=this.generateThrottlingStorageKey(o);e.removeItem(i,r.correlationId)}}var $c="client_id",el="redirect_uri",tl="response_type",rl="token_type",nl="req_cnf",ol="return_spa_code",il="x-client-xtra-sku",al="brk_client_id",sl="brk_redirect_uri";class cl{static validateRedirectUri(e){if(!e)throw Fr(yr)}static validatePrompt(e){var t=[];for(var r in Ee)t.push(Ee[r]);if(t.indexOf(e)<0)throw Fr(Tr)}static validateClaims(e){try{JSON.parse(e)}catch(e){throw Fr(Sr)}}static validateCodeChallengeParams(e,t){if(!e||!t)throw Fr(Pr);this.validateCodeChallengeMethod(t)}static validateCodeChallengeMethod(e){if([Oe.PLAIN,Oe.S256].indexOf(e)<0)throw Fr(Or)}}class ll{constructor(e,t){this.parameters=new Map,this.performanceClient=t,this.correlationId=e}addResponseTypeCode(){this.parameters.set(tl,encodeURIComponent(ce.CODE_RESPONSE_TYPE))}addResponseTypeForTokenAndIdToken(){this.parameters.set(tl,encodeURIComponent("".concat(ce.TOKEN_RESPONSE_TYPE," ").concat(ce.ID_TOKEN_RESPONSE_TYPE)))}addResponseMode(e){this.parameters.set("response_mode",encodeURIComponent(e||Re.QUERY))}addNativeBroker(){this.parameters.set("nativebroker",encodeURIComponent("1"))}addScopes(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:le;!t||r.includes("openid")||e.includes("openid")||r.push("openid");var n=t?[...e||[],...r]:e||[],o=new zr(n);this.parameters.set("scope",encodeURIComponent(o.printScopes()))}addClientId(e){this.parameters.set($c,encodeURIComponent(e))}addRedirectUri(e){cl.validateRedirectUri(e),this.parameters.set(el,encodeURIComponent(e))}addPostLogoutRedirectUri(e){cl.validateRedirectUri(e),this.parameters.set("post_logout_redirect_uri",encodeURIComponent(e))}addIdTokenHint(e){this.parameters.set("id_token_hint",encodeURIComponent(e))}addDomainHint(e){this.parameters.set("domain_hint",encodeURIComponent(e))}addLoginHint(e){this.parameters.set("login_hint",encodeURIComponent(e))}addCcsUpn(e){this.parameters.set(ge,encodeURIComponent("UPN:".concat(e)))}addCcsOid(e){this.parameters.set(ge,encodeURIComponent("Oid:".concat(e.uid,"@").concat(e.utid)))}addSid(e){this.parameters.set("sid",encodeURIComponent(e))}addClaims(e,t){var r=this.addClientCapabilitiesToClaims(e,t);cl.validateClaims(r),this.parameters.set("claims",encodeURIComponent(r))}addCorrelationId(e){this.parameters.set("client-request-id",encodeURIComponent(e))}addLibraryInfo(e){this.parameters.set("x-client-SKU",e.sku),this.parameters.set("x-client-VER",e.version),e.os&&this.parameters.set("x-client-OS",e.os),e.cpu&&this.parameters.set("x-client-CPU",e.cpu)}addApplicationTelemetry(e){null!=e&&e.appName&&this.parameters.set("x-app-name",e.appName),null!=e&&e.appVersion&&this.parameters.set("x-app-ver",e.appVersion)}addPrompt(e){cl.validatePrompt(e),this.parameters.set("".concat("prompt"),encodeURIComponent(e))}addState(e){e&&this.parameters.set("state",encodeURIComponent(e))}addNonce(e){this.parameters.set("nonce",encodeURIComponent(e))}addCodeChallengeParams(e,t){if(cl.validateCodeChallengeParams(e,t),!e||!t)throw Fr(Pr);this.parameters.set("code_challenge",encodeURIComponent(e)),this.parameters.set("code_challenge_method",encodeURIComponent(t))}addAuthorizationCode(e){this.parameters.set("code",encodeURIComponent(e))}addDeviceCode(e){this.parameters.set("device_code",encodeURIComponent(e))}addRefreshToken(e){this.parameters.set("refresh_token",encodeURIComponent(e))}addCodeVerifier(e){this.parameters.set("code_verifier",encodeURIComponent(e))}addClientSecret(e){this.parameters.set("client_secret",encodeURIComponent(e))}addClientAssertion(e){e&&this.parameters.set("client_assertion",encodeURIComponent(e))}addClientAssertionType(e){e&&this.parameters.set("client_assertion_type",encodeURIComponent(e))}addOboAssertion(e){this.parameters.set("assertion",encodeURIComponent(e))}addRequestTokenUse(e){this.parameters.set("requested_token_use",encodeURIComponent(e))}addGrantType(e){this.parameters.set("grant_type",encodeURIComponent(e))}addClientInfo(){this.parameters.set("client_info","1")}addExtraQueryParameters(e){Object.entries(e).forEach(e=>{var[t,r]=e;!this.parameters.has(t)&&r&&this.parameters.set(t,r)})}addClientCapabilitiesToClaims(e,t){var r;if(e)try{r=JSON.parse(e)}catch(e){throw Fr(Sr)}else r={};return t&&t.length>0&&(r.hasOwnProperty(Ae)||(r[Ae]={}),r[Ae].xms_cc={values:t}),JSON.stringify(r)}addUsername(e){this.parameters.set("username",encodeURIComponent(e))}addPassword(e){this.parameters.set("password",encodeURIComponent(e))}addPopToken(e){e&&(this.parameters.set(rl,Fe.POP),this.parameters.set(nl,encodeURIComponent(e)))}addSshJwk(e){e&&(this.parameters.set(rl,Fe.SSH),this.parameters.set(nl,encodeURIComponent(e)))}addServerTelemetry(e){this.parameters.set("x-client-current-telemetry",e.generateCurrentRequestHeaderValue()),this.parameters.set("x-client-last-telemetry",e.generateLastRequestHeaderValue())}addThrottling(){this.parameters.set("x-ms-lib-capability","retry-after, h429")}addLogoutHint(e){this.parameters.set("logout_hint",encodeURIComponent(e))}addBrokerParameters(e){var t={};t[al]=e.brokerClientId,t[sl]=e.brokerRedirectUri,this.addExtraQueryParameters(t)}createQueryString(){var e=new Array;return this.parameters.forEach((t,r)=>{e.push("".concat(r,"=").concat(t))}),function(e,t,r){if(t){var n=e.get($c);n&&e.has(al)&&(null==r||r.addFields({embeddedClientId:n,embeddedRedirectUri:e.get(el)},t))}}(this.parameters,this.correlationId,this.performanceClient),e.join("&")}}function ul(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function dl(e,t,r,n,o,i,a){return hl.apply(this,arguments)}function hl(){var e;return e=function*(e,t,r,n,o,i,a){null==a||a.addQueueMeasurement(jo,i);var s=pc.transformCIAMAuthority(mc(e)),c=new pc(s,t,r,n,o,i,a);try{return yield ic(c.resolveEndpointsAsync.bind(c),Do,o,a,i)(),c}catch(e){throw Gt(nt)}},hl=function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){ul(i,n,o,a,s,"next",e)}function s(e){ul(i,n,o,a,s,"throw",e)}a(void 0)})},hl.apply(this,arguments)}function gl(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function pl(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){gl(i,n,o,a,s,"next",e)}function s(e){gl(i,n,o,a,s,"throw",e)}a(void 0)})}}class ml{constructor(e,t){this.config=function(e){var t,{authOptions:r,systemOptions:n,loggerOptions:o,cacheOptions:i,storageInterface:a,networkInterface:s,cryptoInterface:c,clientCredentials:l,libraryInfo:u,telemetry:d,serverTelemetryManager:h,persistencePlugin:g,serializableCache:p}=e,m=An(An({},_n),o);return{authOptions:(t=r,An({clientCapabilities:[],azureCloudOptions:Ln,skipAuthorityMetadataCache:!1,instanceAware:!1},t)),systemOptions:An(An({},Rn),n),loggerOptions:m,cacheOptions:An(An({},Mn),i),storageInterface:a||new Tn(r.clientId,Qt,new ze(m)),networkInterface:s||Nn,cryptoInterface:c||Qt,clientCredentials:l||qn,libraryInfo:An(An({},xn),u),telemetry:An(An({},Hn),d),serverTelemetryManager:h||null,persistencePlugin:g||null,serializableCache:p||null}}(e),this.logger=new ze(this.config.loggerOptions,Yt,Jt),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}createTokenRequestHeaders(e){var t={};if(t[de]=ce.URL_FORM_CONTENT_TYPE,!this.config.systemOptions.preventCorsPreflight&&e)switch(e.type){case Ec:try{var r=Vr(e.credential);t[ge]="Oid:".concat(r.uid,"@").concat(r.utid)}catch(e){this.logger.verbose("Could not parse home account ID for CCS Header: "+e)}break;case Oc:t[ge]="UPN: ".concat(e.credential)}return t}executePostToTokenEndpoint(e,t,r,n,o,i){var a=this;return pl(function*(){var s;i&&(null===(s=a.performanceClient)||void 0===s||s.addQueueMeasurement(i,o));var c=yield a.sendPostRequest(n,e,{body:t,headers:r},o);return a.config.serverTelemetryManager&&c.status<500&&429!==c.status&&a.config.serverTelemetryManager.clearTelemetryCache(),c})()}sendPostRequest(e,t,r,n){var o=this;return pl(function*(){var i;Zc.preProcess(o.cacheManager,e,n);try{var a,s,c=(i=yield ic(o.networkClient.sendPostRequestAsync.bind(o.networkClient),to,o.logger,o.performanceClient,n)(t,r)).headers||{};null===(a=o.performanceClient)||void 0===a||a.addFields({refreshTokenSize:(null===(s=i.body.refresh_token)||void 0===s?void 0:s.length)||0,httpVerToken:c[me]||"",requestId:c[pe]||""},n)}catch(e){if(e instanceof Ui){var l,u=e.responseHeaders;throw u&&(null===(l=o.performanceClient)||void 0===l||l.addFields({httpVerToken:u[me]||"",requestId:u[pe]||"",contentTypeHeader:u[de]||void 0,contentLengthHeader:u["Content-Length"]||void 0,httpStatus:e.httpStatus},n)),e.error}throw e instanceof Xe?e:Gt(ot)}return Zc.postProcess(o.cacheManager,e,i,n),i})()}updateAuthority(e,t){var r=this;return pl(function*(){var n;null===(n=r.performanceClient)||void 0===n||n.addQueueMeasurement(Po,t);var o="https://".concat(e,"/").concat(r.authority.tenant,"/"),i=yield dl(o,r.networkClient,r.cacheManager,r.authority.options,r.logger,t,r.performanceClient);r.authority=i})()}createTokenQueryParameters(e){var t=new ll(e.correlationId,this.performanceClient);return e.embeddedClientId&&t.addBrokerParameters({brokerClientId:this.config.authOptions.clientId,brokerRedirectUri:this.config.authOptions.redirectUri}),e.tokenQueryParameters&&t.addExtraQueryParameters(e.tokenQueryParameters),t.addCorrelationId(e.correlationId),t.createQueryString()}}function vl(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function fl(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function yl(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function Cl(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){yl(i,n,o,a,s,"next",e)}function s(e){yl(i,n,o,a,s,"throw",e)}a(void 0)})}}class wl{constructor(e,t){this.cryptoUtils=e,this.performanceClient=t}generateCnf(e,t){var r=this;return Cl(function*(){var n;null===(n=r.performanceClient)||void 0===n||n.addQueueMeasurement(xo,e.correlationId);var o=yield ic(r.generateKid.bind(r),xo,t,r.performanceClient,e.correlationId)(e),i=r.cryptoUtils.base64UrlEncode(JSON.stringify(o));return{kid:o.kid,reqCnfString:i}})()}generateKid(e){var t=this;return Cl(function*(){var r;return null===(r=t.performanceClient)||void 0===r||r.addQueueMeasurement(qo,e.correlationId),{kid:yield t.cryptoUtils.getPublicKeyThumbprint(e),xms_ksl:"sw"}})()}signPopToken(e,t,r){var n=this;return Cl(function*(){return n.signPayload(e,t,r)})()}signPayload(e,t,r,n){var o=this;return Cl(function*(){var{resourceRequestMethod:i,resourceRequestUri:a,shrClaims:s,shrNonce:c,shrOptions:l}=r,u=a?new sn(a):void 0,d=null==u?void 0:u.getUrlComponents();return o.cryptoUtils.signJwt(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?vl(Object(r),!0).forEach(function(t){fl(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vl(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({at:e,ts:$t(),m:null==i?void 0:i.toUpperCase(),u:null==d?void 0:d.HostNameAndPort,nonce:c||o.cryptoUtils.createNewGuid(),p:null==d?void 0:d.AbsolutePath,q:null!=d&&d.QueryString?[[],d.QueryString]:void 0,client_claims:s||void 0},n),t,l,r.correlationId)})()}}class bl{constructor(e,t){this.cache=e,this.hasChanged=t}get cacheHasChanged(){return this.hasChanged}get tokenCache(){return this.cache}}function kl(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function Il(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){kl(i,n,o,a,s,"next",e)}function s(e){kl(i,n,o,a,s,"throw",e)}a(void 0)})}}class Tl{constructor(e,t,r,n,o,i,a){this.clientId=e,this.cacheStorage=t,this.cryptoObj=r,this.logger=n,this.serializableCache=o,this.persistencePlugin=i,this.performanceClient=a}validateServerAuthorizationCodeResponse(e,t){if(!e.state||!t)throw e.state?Gt(lt,"Cached State"):Gt(lt,"Server State");var r,n;try{r=decodeURIComponent(e.state)}catch(t){throw Gt(st,e.state)}try{n=decodeURIComponent(t)}catch(t){throw Gt(st,e.state)}if(r!==n)throw Gt(ct);if(e.error||e.error_description||e.suberror){var o=function(e){var t,r,n=null===(t=e.error_uri)||void 0===t?void 0:t.lastIndexOf("code=");return n&&n>=0?null===(r=e.error_uri)||void 0===r?void 0:r.substring(n+5):void 0}(e);if(Tc(e.error,e.error_description,e.suberror))throw new Ic(e.error||"",e.error_description,e.suberror,e.timestamp||"",e.trace_id||"",e.correlation_id||"",e.claims||"",o);throw new Xc(e.error||"",e.error_description,e.suberror,o)}}validateTokenResponse(e,t){if(e.error||e.error_description||e.suberror){var r,n="Error(s): ".concat(e.error_codes||ce.NOT_AVAILABLE," - Timestamp: ").concat(e.timestamp||ce.NOT_AVAILABLE," - Description: ").concat(e.error_description||ce.NOT_AVAILABLE," - Correlation ID: ").concat(e.correlation_id||ce.NOT_AVAILABLE," - Trace ID: ").concat(e.trace_id||ce.NOT_AVAILABLE),o=null!==(r=e.error_codes)&&void 0!==r&&r.length?e.error_codes[0]:void 0,i=new Xc(e.error,n,e.suberror,o,e.status);if(t&&e.status&&e.status>=500&&e.status<=599)return void this.logger.warning("executeTokenRequest:validateTokenResponse - AAD is currently unavailable and the access token is unable to be refreshed.\n".concat(i));if(t&&e.status&&e.status>=400&&e.status<=499)return void this.logger.warning("executeTokenRequest:validateTokenResponse - AAD is currently available but is unable to refresh the access token.\n".concat(i));if(Tc(e.error,e.error_description,e.suberror))throw new Ic(e.error,e.error_description,e.suberror,e.timestamp||ce.EMPTY_STRING,e.trace_id||ce.EMPTY_STRING,e.correlation_id||ce.EMPTY_STRING,e.claims||ce.EMPTY_STRING,o);throw i}}handleServerTokenResponse(e,t,r,n,o,i,a,s,c){var l=this;return Il(function*(){var u,d,h;if(null===(u=l.performanceClient)||void 0===u||u.addQueueMeasurement(Lo,e.correlation_id),e.id_token){if(d=Xt(e.id_token||ce.EMPTY_STRING,l.cryptoObj.base64Decode),o&&o.nonce&&d.nonce!==o.nonce)throw Gt(ut);if(n.maxAge||0===n.maxAge){var g=d.auth_time;if(!g)throw Gt(dt);Zt(g,n.maxAge)}}l.homeAccountIdentifier=nn.generateHomeAccountId(e.client_info||ce.EMPTY_STRING,t.authorityType,l.logger,l.cryptoObj,d),o&&o.state&&(h=Ac.parseRequestState(l.cryptoObj,o.state)),e.key_id=e.key_id||n.sshKid||void 0;var p,m=l.generateCacheRecord(e,t,r,n,d,i,o);try{if(l.persistencePlugin&&l.serializableCache&&(l.logger.verbose("Persistence enabled, calling beforeCacheAccess"),p=new bl(l.serializableCache,!0),yield l.persistencePlugin.beforeCacheAccess(p)),a&&!s&&m.account){var v=m.account.generateAccountKey();if(!l.cacheStorage.getAccount(v,n.correlationId,l.logger))return l.logger.warning("Account used to refresh tokens not in persistence, refreshed tokens will not be stored in the cache"),yield Tl.generateAuthenticationResult(l.cryptoObj,t,m,!1,n,d,h,void 0,c)}yield l.cacheStorage.saveCacheRecord(m,n.correlationId,n.storeInCache)}finally{l.persistencePlugin&&l.serializableCache&&p&&(l.logger.verbose("Persistence enabled, calling afterCacheAccess"),yield l.persistencePlugin.afterCacheAccess(p))}return Tl.generateAuthenticationResult(l.cryptoObj,t,m,!1,n,d,h,e,c)})()}generateCacheRecord(e,t,r,n,o,i,a){var s=t.getPreferredCache();if(!s)throw Gt(St);var c,l,u=rn(o);e.id_token&&o&&(c=rr(this.homeAccountIdentifier,s,e.id_token,this.clientId,u||""),l=Sl(this.cacheStorage,t,this.homeAccountIdentifier,this.cryptoObj.base64Decode,n.correlationId,o,e.client_info,s,u,a,void 0,this.logger));var d=null;if(e.access_token){var h=e.scope?zr.fromString(e.scope):new zr(n.scopes||[]),g=("string"==typeof e.expires_in?parseInt(e.expires_in,10):e.expires_in)||0,p=("string"==typeof e.ext_expires_in?parseInt(e.ext_expires_in,10):e.ext_expires_in)||0,m=("string"==typeof e.refresh_in?parseInt(e.refresh_in,10):e.refresh_in)||void 0,v=r+g,f=v+p,y=m&&m>0?r+m:void 0;d=nr(this.homeAccountIdentifier,s,e.access_token,this.clientId,u||t.tenant||"",h.printScopes(),v,f,this.cryptoObj.base64Decode,y,e.token_type,i,e.key_id,n.claims,n.requestedClaimsHash)}var C,w=null;e.refresh_token&&(e.refresh_token_expires_in&&(C=r+("string"==typeof e.refresh_token_expires_in?parseInt(e.refresh_token_expires_in,10):e.refresh_token_expires_in)),w=or(this.homeAccountIdentifier,s,e.refresh_token,this.clientId,e.foci,i,C));var b=null;return e.foci&&(b={clientId:this.clientId,environment:s,familyId:e.foci}),{account:l,idToken:c,accessToken:d,refreshToken:w,appMetadata:b}}static generateAuthenticationResult(e,t,r,n,o,i,a,s,c){return Il(function*(){var l,u,d,h,g,p,m,v=ce.EMPTY_STRING,f=[],y=null,C=ce.EMPTY_STRING;if(r.accessToken){if(r.accessToken.tokenType!==Fe.POP||o.popKid)v=r.accessToken.secret;else{var w=new wl(e),{secret:b,keyId:k}=r.accessToken;if(!k)throw Gt(Ht);v=yield w.signPopToken(b,k,o)}f=zr.fromString(r.accessToken.target).asArray(),y=new Date(1e3*Number(r.accessToken.expiresOn)),p=new Date(1e3*Number(r.accessToken.extendedExpiresOn)),r.accessToken.refreshOn&&(m=new Date(1e3*Number(r.accessToken.refreshOn)))}r.appMetadata&&(C=r.appMetadata.familyId===qe?qe:"");var I=(null==i?void 0:i.oid)||(null==i?void 0:i.sub)||"",T=(null==i?void 0:i.tid)||"";null!=s&&s.spa_accountid&&r.account&&(r.account.nativeAccountId=null==s?void 0:s.spa_accountid);var S=r.account?tn(r.account.getAccountInfo(),void 0,i,null===(l=r.idToken)||void 0===l?void 0:l.secret):null;return{authority:t.canonicalAuthority,uniqueId:I,tenantId:T,scopes:f,account:S,idToken:(null==r||null===(u=r.idToken)||void 0===u?void 0:u.secret)||"",idTokenClaims:i||{},accessToken:v,fromCache:n,expiresOn:y,extExpiresOn:p,refreshOn:m,correlationId:o.correlationId,requestId:c||ce.EMPTY_STRING,familyId:C,tokenType:(null===(d=r.accessToken)||void 0===d?void 0:d.tokenType)||ce.EMPTY_STRING,state:a?a.userRequestState:ce.EMPTY_STRING,cloudGraphHostName:(null===(h=r.account)||void 0===h?void 0:h.cloudGraphHostName)||ce.EMPTY_STRING,msGraphHost:(null===(g=r.account)||void 0===g?void 0:g.msGraphHost)||ce.EMPTY_STRING,code:null==s?void 0:s.spa_code,fromNativeBroker:!1}})()}}function Sl(e,t,r,n,o,i,a,s,c,l,u,d){null==d||d.verbose("setCachedAccount called");var h=e.getAccountKeys().find(e=>e.startsWith(r)),g=null;h&&(g=e.getAccount(h,o,d));var p=g||nn.createAccount({homeAccountId:r,idTokenClaims:i,clientInfo:a,environment:s,cloudGraphHostName:null==l?void 0:l.cloud_graph_host_name,msGraphHost:null==l?void 0:l.msgraph_host,nativeAccountId:u},t,n),m=p.tenantProfiles||[],v=c||p.realm;if(v&&!m.find(e=>e.tenantId===v)){var f=en(r,p.localAccountId,v,i);m.push(f)}return p.tenantProfiles=m,p}function Al(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function El(e,t,r){return Ol.apply(this,arguments)}function Ol(){var e;return e=function*(e,t,r){return"string"==typeof e?e:e({clientId:t,tokenEndpoint:r})},Ol=function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){Al(i,n,o,a,s,"next",e)}function s(e){Al(i,n,o,a,s,"throw",e)}a(void 0)})},Ol.apply(this,arguments)}function Pl(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function Rl(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){Pl(i,n,o,a,s,"next",e)}function s(e){Pl(i,n,o,a,s,"throw",e)}a(void 0)})}}class _l extends ml{constructor(e,t){var r;super(e,t),this.includeRedirectUri=!0,this.oidcDefaultScopes=null===(r=this.config.authOptions.authority.options.OIDCOptions)||void 0===r?void 0:r.defaultScopes}getAuthCodeUrl(e){var t=this;return Rl(function*(){var r;null===(r=t.performanceClient)||void 0===r||r.addQueueMeasurement(Ao,e.correlationId);var n=yield ic(t.createAuthCodeUrlQueryString.bind(t),No,t.logger,t.performanceClient,e.correlationId)(e);return sn.appendQueryString(t.authority.authorizationEndpoint,n)})()}acquireToken(e,t){var r=this;return Rl(function*(){var n,o;if(null===(n=r.performanceClient)||void 0===n||n.addQueueMeasurement(Ro,e.correlationId),!e.code)throw Gt(vt);var i=$t(),a=yield ic(r.executeTokenRequest.bind(r),_o,r.logger,r.performanceClient,e.correlationId)(r.authority,e),s=null===(o=a.headers)||void 0===o?void 0:o[pe],c=new Tl(r.config.authOptions.clientId,r.cacheManager,r.cryptoUtils,r.logger,r.config.serializableCache,r.config.persistencePlugin,r.performanceClient);return c.validateTokenResponse(a.body),ic(c.handleServerTokenResponse.bind(c),Lo,r.logger,r.performanceClient,e.correlationId)(a.body,r.authority,i,e,t,void 0,void 0,void 0,s)})()}handleFragmentResponse(e,t){if(new Tl(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,null,null).validateServerAuthorizationCodeResponse(e,t),!e.code)throw Gt(xt);return e}getLogoutUri(e){if(!e)throw Fr(Er);var t=this.createLogoutUrlQueryString(e);return sn.appendQueryString(this.authority.endSessionEndpoint,t)}executeTokenRequest(e,t){var r=this;return Rl(function*(){var n,o;null===(n=r.performanceClient)||void 0===n||n.addQueueMeasurement(_o,t.correlationId);var i=r.createTokenQueryParameters(t),a=sn.appendQueryString(e.tokenEndpoint,i),s=yield ic(r.createTokenRequestBody.bind(r),Mo,r.logger,r.performanceClient,t.correlationId)(t),c=void 0;if(t.clientInfo)try{var l=Gr(t.clientInfo,r.cryptoUtils.base64Decode);c={credential:"".concat(l.uid).concat(".").concat(l.utid),type:Ec}}catch(e){r.logger.verbose("Could not parse client info for CCS Header: "+e)}var u=r.createTokenRequestHeaders(c||t.ccsCredential),d={clientId:(null===(o=t.tokenBodyParameters)||void 0===o?void 0:o.clientId)||r.config.authOptions.clientId,authority:e.canonicalAuthority,scopes:t.scopes,claims:t.claims,authenticationScheme:t.authenticationScheme,resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,sshKid:t.sshKid};return ic(r.executePostToTokenEndpoint.bind(r),no,r.logger,r.performanceClient,t.correlationId)(a,s,u,d,t.correlationId,no)})()}createTokenRequestBody(e){var t=this;return Rl(function*(){var r,n;null===(r=t.performanceClient)||void 0===r||r.addQueueMeasurement(Mo,e.correlationId);var o=new ll(e.correlationId,t.performanceClient);if(o.addClientId(e.embeddedClientId||(null===(n=e.tokenBodyParameters)||void 0===n?void 0:n[$c])||t.config.authOptions.clientId),t.includeRedirectUri?o.addRedirectUri(e.redirectUri):cl.validateRedirectUri(e.redirectUri),o.addScopes(e.scopes,!0,t.oidcDefaultScopes),o.addAuthorizationCode(e.code),o.addLibraryInfo(t.config.libraryInfo),o.addApplicationTelemetry(t.config.telemetry.application),o.addThrottling(),t.serverTelemetryManager&&!jn(t.config)&&o.addServerTelemetry(t.serverTelemetryManager),e.codeVerifier&&o.addCodeVerifier(e.codeVerifier),t.config.clientCredentials.clientSecret&&o.addClientSecret(t.config.clientCredentials.clientSecret),t.config.clientCredentials.clientAssertion){var i=t.config.clientCredentials.clientAssertion;o.addClientAssertion(yield El(i.assertion,t.config.authOptions.clientId,e.resourceRequestUri)),o.addClientAssertionType(i.assertionType)}if(o.addGrantType("authorization_code"),o.addClientInfo(),e.authenticationScheme===Fe.POP){var a,s=new wl(t.cryptoUtils,t.performanceClient);a=e.popKid?t.cryptoUtils.encodeKid(e.popKid):(yield ic(s.generateCnf.bind(s),xo,t.logger,t.performanceClient,e.correlationId)(e,t.logger)).reqCnfString,o.addPopToken(a)}else if(e.authenticationScheme===Fe.SSH){if(!e.sshJwk)throw Fr(Nr);o.addSshJwk(e.sshJwk)}(!Kr.isEmptyObj(e.claims)||t.config.authOptions.clientCapabilities&&t.config.authOptions.clientCapabilities.length>0)&&o.addClaims(e.claims,t.config.authOptions.clientCapabilities);var c=void 0;if(e.clientInfo)try{var l=Gr(e.clientInfo,t.cryptoUtils.base64Decode);c={credential:"".concat(l.uid).concat(".").concat(l.utid),type:Ec}}catch(e){t.logger.verbose("Could not parse client info for CCS Header: "+e)}else c=e.ccsCredential;if(t.config.systemOptions.preventCorsPreflight&&c)switch(c.type){case Ec:try{var u=Vr(c.credential);o.addCcsOid(u)}catch(e){t.logger.verbose("Could not parse home account ID for CCS Header: "+e)}break;case Oc:o.addCcsUpn(c.credential)}return e.embeddedClientId&&o.addBrokerParameters({brokerClientId:t.config.authOptions.clientId,brokerRedirectUri:t.config.authOptions.redirectUri}),e.tokenBodyParameters&&o.addExtraQueryParameters(e.tokenBodyParameters),!e.enableSpaAuthorizationCode||e.tokenBodyParameters&&e.tokenBodyParameters[ol]||o.addExtraQueryParameters({[ol]:"1"}),o.createQueryString()})()}createAuthCodeUrlQueryString(e){var t=this;return Rl(function*(){var r,n,o=e.correlationId||t.config.cryptoInterface.createNewGuid();null===(r=t.performanceClient)||void 0===r||r.addQueueMeasurement(No,o);var i=new ll(o,t.performanceClient);i.addClientId(e.embeddedClientId||(null===(n=e.extraQueryParameters)||void 0===n?void 0:n[$c])||t.config.authOptions.clientId);var a=[...e.scopes||[],...e.extraScopesToConsent||[]];if(i.addScopes(a,!0,t.oidcDefaultScopes),i.addRedirectUri(e.redirectUri),i.addCorrelationId(o),i.addResponseMode(e.responseMode),i.addResponseTypeCode(),i.addLibraryInfo(t.config.libraryInfo),jn(t.config)||i.addApplicationTelemetry(t.config.telemetry.application),i.addClientInfo(),e.codeChallenge&&e.codeChallengeMethod&&i.addCodeChallengeParams(e.codeChallenge,e.codeChallengeMethod),e.prompt&&i.addPrompt(e.prompt),e.domainHint&&i.addDomainHint(e.domainHint),e.prompt!==Ee.SELECT_ACCOUNT)if(e.sid&&e.prompt===Ee.NONE)t.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from request"),i.addSid(e.sid);else if(e.account){var s=t.extractAccountSid(e.account),c=t.extractLoginHint(e.account);if(c&&e.domainHint&&(t.logger.warning('AuthorizationCodeClient.createAuthCodeUrlQueryString: "domainHint" param is set, skipping opaque "login_hint" claim. Please consider not passing domainHint'),c=null),c){t.logger.verbose("createAuthCodeUrlQueryString: login_hint claim present on account"),i.addLoginHint(c);try{var l=Vr(e.account.homeAccountId);i.addCcsOid(l)}catch(e){t.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(s&&e.prompt===Ee.NONE){t.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from account"),i.addSid(s);try{var u=Vr(e.account.homeAccountId);i.addCcsOid(u)}catch(e){t.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(e.loginHint)t.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from request"),i.addLoginHint(e.loginHint),i.addCcsUpn(e.loginHint);else if(e.account.username){t.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from account"),i.addLoginHint(e.account.username);try{var d=Vr(e.account.homeAccountId);i.addCcsOid(d)}catch(e){t.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}}else e.loginHint&&(t.logger.verbose("createAuthCodeUrlQueryString: No account, adding login_hint from request"),i.addLoginHint(e.loginHint),i.addCcsUpn(e.loginHint));else t.logger.verbose("createAuthCodeUrlQueryString: Prompt is select_account, ignoring account hints");if(e.nonce&&i.addNonce(e.nonce),e.state&&i.addState(e.state),(e.claims||t.config.authOptions.clientCapabilities&&t.config.authOptions.clientCapabilities.length>0)&&i.addClaims(e.claims,t.config.authOptions.clientCapabilities),e.embeddedClientId&&i.addBrokerParameters({brokerClientId:t.config.authOptions.clientId,brokerRedirectUri:t.config.authOptions.redirectUri}),t.addExtraQueryParams(e,i),e.nativeBroker&&(i.addNativeBroker(),e.authenticationScheme===Fe.POP)){var h,g=new wl(t.cryptoUtils);h=e.popKid?t.cryptoUtils.encodeKid(e.popKid):(yield ic(g.generateCnf.bind(g),xo,t.logger,t.performanceClient,e.correlationId)(e,t.logger)).reqCnfString,i.addPopToken(h)}return i.createQueryString()})()}createLogoutUrlQueryString(e){var t=new ll(e.correlationId,this.performanceClient);return e.postLogoutRedirectUri&&t.addPostLogoutRedirectUri(e.postLogoutRedirectUri),e.correlationId&&t.addCorrelationId(e.correlationId),e.idTokenHint&&t.addIdTokenHint(e.idTokenHint),e.state&&t.addState(e.state),e.logoutHint&&t.addLogoutHint(e.logoutHint),this.addExtraQueryParams(e,t),t.createQueryString()}addExtraQueryParams(e,t){!(e.extraQueryParameters&&e.extraQueryParameters.hasOwnProperty("instance_aware"))&&this.config.authOptions.instanceAware&&(e.extraQueryParameters=e.extraQueryParameters||{},e.extraQueryParameters.instance_aware="true"),e.extraQueryParameters&&t.addExtraQueryParameters(e.extraQueryParameters)}extractAccountSid(e){var t;return(null===(t=e.idTokenClaims)||void 0===t?void 0:t.sid)||null}extractLoginHint(e){var t;return(null===(t=e.idTokenClaims)||void 0===t?void 0:t.login_hint)||null}}class Ml{constructor(e,t){this.cacheOutcome="0",this.cacheManager=t,this.apiId=e.apiId,this.correlationId=e.correlationId,this.wrapperSKU=e.wrapperSKU||ce.EMPTY_STRING,this.wrapperVer=e.wrapperVer||ce.EMPTY_STRING,this.telemetryCacheKey=Be.CACHE_KEY+Me+e.clientId}generateCurrentRequestHeaderValue(){var e="".concat(this.apiId).concat(Be.VALUE_SEPARATOR).concat(this.cacheOutcome),t=[this.wrapperSKU,this.wrapperVer],r=this.getNativeBrokerErrorCode();null!=r&&r.length&&t.push("broker_error=".concat(r));var n=t.join(Be.VALUE_SEPARATOR),o=[e,this.getRegionDiscoveryFields()].join(Be.VALUE_SEPARATOR);return[Be.SCHEMA_VERSION,o,n].join(Be.CATEGORY_SEPARATOR)}generateLastRequestHeaderValue(){var e=this.getLastRequests(),t=Ml.maxErrorsToSend(e),r=e.failedRequests.slice(0,2*t).join(Be.VALUE_SEPARATOR),n=e.errors.slice(0,t).join(Be.VALUE_SEPARATOR),o=e.errors.length,i=[o,t<o?Be.OVERFLOW_TRUE:Be.OVERFLOW_FALSE].join(Be.VALUE_SEPARATOR);return[Be.SCHEMA_VERSION,e.cacheHits,r,n,i].join(Be.CATEGORY_SEPARATOR)}cacheFailedRequest(e){var t=this.getLastRequests();t.errors.length>=Be.MAX_CACHED_ERRORS&&(t.failedRequests.shift(),t.failedRequests.shift(),t.errors.shift()),t.failedRequests.push(this.apiId,this.correlationId),e instanceof Error&&e&&e.toString()?e instanceof Xe?e.subError?t.errors.push(e.subError):e.errorCode?t.errors.push(e.errorCode):t.errors.push(e.toString()):t.errors.push(e.toString()):t.errors.push(Be.UNKNOWN_ERROR),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t,this.correlationId)}incrementCacheHits(){var e=this.getLastRequests();return e.cacheHits+=1,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e,this.correlationId),e.cacheHits}getLastRequests(){return this.cacheManager.getServerTelemetry(this.telemetryCacheKey)||{failedRequests:[],errors:[],cacheHits:0}}clearTelemetryCache(){var e=this.getLastRequests(),t=Ml.maxErrorsToSend(e);if(t===e.errors.length)this.cacheManager.removeItem(this.telemetryCacheKey,this.correlationId);else{var r={failedRequests:e.failedRequests.slice(2*t),errors:e.errors.slice(t),cacheHits:0};this.cacheManager.setServerTelemetry(this.telemetryCacheKey,r,this.correlationId)}}static maxErrorsToSend(e){var t,r=0,n=0,o=e.errors.length;for(t=0;t<o;t++){var i=e.failedRequests[2*t]||ce.EMPTY_STRING,a=e.failedRequests[2*t+1]||ce.EMPTY_STRING,s=e.errors[t]||ce.EMPTY_STRING;if(!((n+=i.toString().length+a.toString().length+s.length+3)<Be.MAX_LAST_HEADER_BYTES))break;r+=1}return r}getRegionDiscoveryFields(){var e=[];return e.push(this.regionUsed||ce.EMPTY_STRING),e.push(this.regionSource||ce.EMPTY_STRING),e.push(this.regionOutcome||ce.EMPTY_STRING),e.join(",")}updateRegionDiscoveryMetadata(e){this.regionUsed=e.region_used,this.regionSource=e.region_source,this.regionOutcome=e.region_outcome}setCacheOutcome(e){this.cacheOutcome=e}setNativeBrokerErrorCode(e){var t=this.getLastRequests();t.nativeBrokerErrorCode=e,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t,this.correlationId)}getNativeBrokerErrorCode(){return this.getLastRequests().nativeBrokerErrorCode}clearNativeBrokerErrorCode(){var e=this.getLastRequests();delete e.nativeBrokerErrorCode,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e,this.correlationId)}static makeExtraSkuString(e){return function(e){var{skus:t,libraryName:r,libraryVersion:n,extensionName:o,extensionVersion:i}=e,a=new Map([[0,[r,n]],[2,[o,i]]]),s=[];if(null!=t&&t.length){if((s=t.split(",")).length<4)return t}else s=Array.from({length:4},()=>"|");return a.forEach((e,t)=>{var r,n;2===e.length&&null!==(r=e[0])&&void 0!==r&&r.length&&null!==(n=e[1])&&void 0!==n&&n.length&&function(e){var{skuArr:t,index:r,skuName:n,skuVersion:o}=e;r>=t.length||(t[r]=[n,o].join("|"))}({skuArr:s,index:t,skuName:e[0],skuVersion:e[1]})}),s.join(",")}(e)}}function Nl(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function xl(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){Nl(i,n,o,a,s,"next",e)}function s(e){Nl(i,n,o,a,s,"throw",e)}a(void 0)})}}class ql{constructor(e,t,r,n,o,i,a,s,c){this.config=e,this.browserStorage=t,this.browserCrypto=r,this.networkClient=this.config.system.networkClient,this.eventHandler=o,this.navigationClient=i,this.nativeMessageHandler=s,this.correlationId=c||as(),this.logger=n.clone(hi,_s,this.correlationId),this.performanceClient=a}clearCacheOnLogout(e){var t=this;return xl(function*(){if(e){nn.accountInfoIsEqual(e,t.browserStorage.getActiveAccount(t.correlationId),!1)&&(t.logger.verbose("Setting active account to null"),t.browserStorage.setActiveAccount(null,t.correlationId));try{yield t.browserStorage.removeAccount(nn.generateAccountCacheKey(e),t.correlationId),t.logger.verbose("Cleared cache items belonging to the account provided in the logout request.")}catch(e){t.logger.error("Account provided in logout request was not found. Local cache unchanged.")}}else try{t.logger.verbose("No account provided in logout request, clearing all cache items.",t.correlationId),yield t.browserStorage.clear(t.correlationId),yield t.browserCrypto.clearKeystore()}catch(e){t.logger.error("Attempted to clear all MSAL cache items and failed. Local cache unchanged.")}})()}getRedirectUri(e){this.logger.verbose("getRedirectUri called");var t=e||this.config.auth.redirectUri;return sn.getAbsoluteUrl(t,bs())}initializeServerTelemetryManager(e,t){this.logger.verbose("initializeServerTelemetryManager called");var r={clientId:this.config.auth.clientId,correlationId:this.correlationId,apiId:e,forceRefresh:t||!1,wrapperSKU:this.browserStorage.getWrapperMetadata()[0],wrapperVer:this.browserStorage.getWrapperMetadata()[1]};return new Ml(r,this.browserStorage)}getDiscoveredAuthority(e){var t=this;return xl(function*(){var{account:r}=e,n=e.requestExtraQueryParameters&&e.requestExtraQueryParameters.hasOwnProperty("instance_aware")?e.requestExtraQueryParameters.instance_aware:void 0;t.performanceClient.addQueueMeasurement(Zn,t.correlationId);var o={protocolMode:t.config.auth.protocolMode,OIDCOptions:t.config.auth.OIDCOptions,knownAuthorities:t.config.auth.knownAuthorities,cloudDiscoveryMetadata:t.config.auth.cloudDiscoveryMetadata,authorityMetadata:t.config.auth.authorityMetadata,skipAuthorityMetadataCache:t.config.auth.skipAuthorityMetadataCache},i=e.requestAuthority||t.config.auth.authority,a=null!=n&&n.length?"true"===n:t.config.auth.instanceAware,s=r&&a?t.config.auth.authority.replace(sn.getDomainFromUrl(i),r.environment):i,c=pc.generateAuthority(s,e.requestAzureCloudOptions||t.config.auth.azureCloudOptions),l=yield ic(dl,jo,t.logger,t.performanceClient,t.correlationId)(c,t.config.system.networkClient,t.browserStorage,o,t.logger,t.correlationId,t.performanceClient);if(r&&!l.isAlias(r.environment))throw Fr(Dr);return l})()}}function Ll(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function Hl(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){Ll(i,n,o,a,s,"next",e)}function s(e){Ll(i,n,o,a,s,"throw",e)}a(void 0)})}}function jl(e,t,r){return Dl.apply(this,arguments)}function Dl(){return(Dl=Hl(function*(e,t,r){e.addQueueMeasurement(ti,r);var n=oc(Ul,ri,t,e,r)(e,t,r);return{verifier:n,challenge:yield ic(Bl,ni,t,e,r)(n,e,t,r)}})).apply(this,arguments)}function Ul(e,t,r){try{var n=new Uint8Array(32);return oc(os,ii,t,e,r)(n),Va(n)}catch(e){throw Da(Fi)}}function Bl(e,t,r,n){return Fl.apply(this,arguments)}function Fl(){return(Fl=Hl(function*(e,t,r,n){t.addQueueMeasurement(ni,n);try{var o=yield ic(rs,oi,r,t,n)(e,t,n);return Va(new Uint8Array(o))}catch(e){throw Da(Fi)}})).apply(this,arguments)}function Kl(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function zl(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Kl(Object(r),!0).forEach(function(t){Gl(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Kl(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function Gl(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Vl(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function Wl(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){Vl(i,n,o,a,s,"next",e)}function s(e){Vl(i,n,o,a,s,"throw",e)}a(void 0)})}}function Ql(e,t,r,n){return Yl.apply(this,arguments)}function Yl(){return(Yl=Wl(function*(e,t,r,n){r.addQueueMeasurement(po,e.correlationId);var o=e.authority||t.auth.authority,i=[...e&&e.scopes||[]],a=zl(zl({},e),{},{correlationId:e.correlationId,authority:o,scopes:i});if(a.authenticationScheme){if(a.authenticationScheme===Fe.SSH){if(!e.sshJwk)throw Fr(Nr);if(!e.sshKid)throw Fr(xr)}n.verbose('Authentication Scheme set to "'.concat(a.authenticationScheme,'" as configured in Auth request'))}else a.authenticationScheme=Fe.BEARER,n.verbose('Authentication Scheme wasn\'t explicitly set in request, defaulting to "Bearer" request');return t.cache.claimsBasedCachingEnabled&&e.claims&&!Kr.isEmptyObj(e.claims)&&(a.requestedClaimsHash=yield hs(e.claims)),a})).apply(this,arguments)}function Jl(e,t,r,n,o){return Xl.apply(this,arguments)}function Xl(){return(Xl=Wl(function*(e,t,r,n,o){n.addQueueMeasurement(mo,e.correlationId);var i=yield ic(Ql,po,o,n,e.correlationId)(e,r,n,o);return zl(zl(zl({},e),i),{},{account:t,forceRefresh:e.forceRefresh||!1})})).apply(this,arguments)}function Zl(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function $l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Zl(Object(r),!0).forEach(function(t){eu(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Zl(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function eu(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function tu(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function ru(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){tu(i,n,o,a,s,"next",e)}function s(e){tu(i,n,o,a,s,"throw",e)}a(void 0)})}}class nu extends ql{initializeAuthorizationCodeRequest(e){var t=this;return ru(function*(){t.performanceClient.addQueueMeasurement(So,t.correlationId);var r=yield ic(jl,ti,t.logger,t.performanceClient,t.correlationId)(t.performanceClient,t.logger,t.correlationId),n=$l($l({},e),{},{redirectUri:e.redirectUri,code:ce.EMPTY_STRING,codeVerifier:r.verifier});return e.codeChallenge=r.challenge,e.codeChallengeMethod=ce.S256_CODE_CHALLENGE_METHOD,n})()}initializeLogoutRequest(e){this.logger.verbose("initializeLogoutRequest called",null==e?void 0:e.correlationId);var t=$l({correlationId:this.correlationId||as()},e);if(e)if(e.logoutHint)this.logger.verbose("logoutHint has already been set in logoutRequest");else if(e.account){var r=this.getLogoutHintFromIdTokenClaims(e.account);r&&(this.logger.verbose("Setting logoutHint to login_hint ID Token Claim value for the account provided"),t.logoutHint=r)}else this.logger.verbose("logoutHint was not set and account was not passed into logout request, logoutHint will not be set");else this.logger.verbose("logoutHint will not be set since no logout request was configured");return e&&null===e.postLogoutRedirectUri?this.logger.verbose("postLogoutRedirectUri passed as null, not setting post logout redirect uri",t.correlationId):e&&e.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to uri set on logout request",t.correlationId),t.postLogoutRedirectUri=sn.getAbsoluteUrl(e.postLogoutRedirectUri,bs())):null===this.config.auth.postLogoutRedirectUri?this.logger.verbose("postLogoutRedirectUri configured as null and no uri set on request, not passing post logout redirect",t.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to configured uri",t.correlationId),t.postLogoutRedirectUri=sn.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,bs())):(this.logger.verbose("Setting postLogoutRedirectUri to current page",t.correlationId),t.postLogoutRedirectUri=sn.getAbsoluteUrl(bs(),bs())),t}getLogoutHintFromIdTokenClaims(e){var t=e.idTokenClaims;if(t){if(t.login_hint)return t.login_hint;this.logger.verbose("The ID Token Claims tied to the provided account do not contain a login_hint claim, logoutHint will not be added to logout request")}else this.logger.verbose("The provided account does not contain ID Token Claims, logoutHint will not be added to logout request");return null}createAuthCodeClient(e){var t=this;return ru(function*(){t.performanceClient.addQueueMeasurement(ko,t.correlationId);var r=yield ic(t.getClientConfiguration.bind(t),Io,t.logger,t.performanceClient,t.correlationId)(e);return new _l(r,t.performanceClient)})()}getClientConfiguration(e){var t=this;return ru(function*(){var{serverTelemetryManager:r,requestAuthority:n,requestAzureCloudOptions:o,requestExtraQueryParameters:i,account:a}=e;t.performanceClient.addQueueMeasurement(Io,t.correlationId);var s=yield ic(t.getDiscoveredAuthority.bind(t),Zn,t.logger,t.performanceClient,t.correlationId)({requestAuthority:n,requestAzureCloudOptions:o,requestExtraQueryParameters:i,account:a}),c=t.config.system.loggerOptions;return{authOptions:{clientId:t.config.auth.clientId,authority:s,clientCapabilities:t.config.auth.clientCapabilities,redirectUri:t.config.auth.redirectUri},systemOptions:{tokenRenewalOffsetSeconds:t.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:c.loggerCallback,piiLoggingEnabled:c.piiLoggingEnabled,logLevel:c.logLevel,correlationId:t.correlationId},cacheOptions:{claimsBasedCachingEnabled:t.config.cache.claimsBasedCachingEnabled},cryptoInterface:t.browserCrypto,networkInterface:t.networkClient,storageInterface:t.browserStorage,serverTelemetryManager:r,libraryInfo:{sku:hi,version:_s,cpu:ce.EMPTY_STRING,os:ce.EMPTY_STRING},telemetry:t.config.telemetry}})()}initializeAuthorizationRequest(e,t){var r=this;return ru(function*(){r.performanceClient.addQueueMeasurement(To,r.correlationId);var n=r.getRedirectUri(e.redirectUri),o={interactionType:t},i=Ac.setRequestState(r.browserCrypto,e&&e.state||ce.EMPTY_STRING,o),a=yield ic(Ql,po,r.logger,r.performanceClient,r.correlationId)($l($l({},e),{},{correlationId:r.correlationId}),r.config,r.performanceClient,r.logger),s=$l($l({},a),{},{redirectUri:n,state:i,nonce:e.nonce||as(),responseMode:r.config.auth.OIDCOptions.serverResponseType});if(e.loginHint||e.sid)return s;var c=e.account||r.browserStorage.getActiveAccount(r.correlationId);if(c&&(r.logger.verbose("Setting validated request account",r.correlationId),r.logger.verbosePii("Setting validated request account: ".concat(c.homeAccountId),r.correlationId),s.account=c),!s.loginHint&&!c){var l=r.browserStorage.getLegacyLoginHint();l&&(s.loginHint=l)}return s})()}}var ou="user_switch",iu={[ou]:"User attempted to switch accounts in the native broker, which is not allowed. All new accounts must sign-in through the standard web flow first, please try again."};class au extends Xe{constructor(e,t,r){super(e,t),Object.setPrototypeOf(this,au.prototype),this.name="NativeAuthError",this.ext=r}}function su(e){return!(!e.ext||!e.ext.status||"PERSISTENT_ERROR"!==e.ext.status&&"DISABLED"!==e.ext.status)||!(!e.ext||!e.ext.error||-2147186943!==e.ext.error)||"ContentError"===e.errorCode}function cu(e,t,r){if(r&&r.status)switch(r.status){case"ACCOUNT_UNAVAILABLE":return Sc(fc);case"USER_INTERACTION_REQUIRED":return new Ic(e,t);case"USER_CANCEL":return Da($i);case"NO_NETWORK":return Da(va)}return new au(e,iu[e]||t,r)}function lu(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function uu(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?lu(Object(r),!0).forEach(function(t){du(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):lu(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function du(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function hu(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function gu(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){hu(i,n,o,a,s,"next",e)}function s(e){hu(i,n,o,a,s,"throw",e)}a(void 0)})}}class pu extends ml{constructor(e,t){super(e,t)}acquireToken(e){var t=this;return gu(function*(){var r,n;null===(r=t.performanceClient)||void 0===r||r.addQueueMeasurement(io,e.correlationId);var o=$t(),i=yield ic(t.executeTokenRequest.bind(t),oo,t.logger,t.performanceClient,e.correlationId)(e,t.authority),a=null===(n=i.headers)||void 0===n?void 0:n[pe],s=new Tl(t.config.authOptions.clientId,t.cacheManager,t.cryptoUtils,t.logger,t.config.serializableCache,t.config.persistencePlugin);return s.validateTokenResponse(i.body),ic(s.handleServerTokenResponse.bind(s),Lo,t.logger,t.performanceClient,e.correlationId)(i.body,t.authority,o,e,void 0,void 0,!0,e.forceCache,a)})()}acquireTokenByRefreshToken(e){var t=this;return gu(function*(){var r;if(!e)throw Fr(Ar);if(null===(r=t.performanceClient)||void 0===r||r.addQueueMeasurement(so,e.correlationId),!e.account)throw Gt(It);if(t.cacheManager.isAppMetadataFOCI(e.account.environment))try{return yield ic(t.acquireTokenWithCachedRefreshToken.bind(t),ao,t.logger,t.performanceClient,e.correlationId)(e,!0)}catch(r){var n=r instanceof Ic&&r.errorCode===vc,o=r instanceof Xc&&"invalid_grant"===r.errorCode&&"client_mismatch"===r.subError;if(n||o)return ic(t.acquireTokenWithCachedRefreshToken.bind(t),ao,t.logger,t.performanceClient,e.correlationId)(e,!1);throw r}return ic(t.acquireTokenWithCachedRefreshToken.bind(t),ao,t.logger,t.performanceClient,e.correlationId)(e,!1)})()}acquireTokenWithCachedRefreshToken(e,t){var r=this;return gu(function*(){var n;null===(n=r.performanceClient)||void 0===n||n.addQueueMeasurement(ao,e.correlationId);var o=oc(r.cacheManager.getRefreshToken.bind(r.cacheManager),ei,r.logger,r.performanceClient,e.correlationId)(e.account,t,e.correlationId,void 0,r.performanceClient);if(!o)throw Sc(vc);if(o.expiresOn&&er(o.expiresOn,e.refreshTokenExpirationOffsetSeconds||300))throw Sc(yc);var i=uu(uu({},e),{},{refreshToken:o.secret,authenticationScheme:e.authenticationScheme||Fe.BEARER,ccsCredential:{credential:e.account.homeAccountId,type:Ec}});try{return yield ic(r.acquireToken.bind(r),io,r.logger,r.performanceClient,e.correlationId)(i)}catch(t){if(t instanceof Ic&&t.subError===Cc){r.logger.verbose("acquireTokenWithRefreshToken: bad refresh token, removing from cache");var a=tr(o);r.cacheManager.removeRefreshToken(a,e.correlationId)}throw t}})()}executeTokenRequest(e,t){var r=this;return gu(function*(){var n,o;null===(n=r.performanceClient)||void 0===n||n.addQueueMeasurement(oo,e.correlationId);var i=r.createTokenQueryParameters(e),a=sn.appendQueryString(t.tokenEndpoint,i),s=yield ic(r.createTokenRequestBody.bind(r),co,r.logger,r.performanceClient,e.correlationId)(e),c=r.createTokenRequestHeaders(e.ccsCredential),l={clientId:(null===(o=e.tokenBodyParameters)||void 0===o?void 0:o.clientId)||r.config.authOptions.clientId,authority:t.canonicalAuthority,scopes:e.scopes,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid};return ic(r.executePostToTokenEndpoint.bind(r),ro,r.logger,r.performanceClient,e.correlationId)(a,s,c,l,e.correlationId,ro)})()}createTokenRequestBody(e){var t=this;return gu(function*(){var r,n,o;null===(r=t.performanceClient)||void 0===r||r.addQueueMeasurement(co,e.correlationId);var i=e.correlationId,a=new ll(i,t.performanceClient);if(a.addClientId(e.embeddedClientId||(null===(n=e.tokenBodyParameters)||void 0===n?void 0:n[$c])||t.config.authOptions.clientId),e.redirectUri&&a.addRedirectUri(e.redirectUri),a.addScopes(e.scopes,!0,null===(o=t.config.authOptions.authority.options.OIDCOptions)||void 0===o?void 0:o.defaultScopes),a.addGrantType("refresh_token"),a.addClientInfo(),a.addLibraryInfo(t.config.libraryInfo),a.addApplicationTelemetry(t.config.telemetry.application),a.addThrottling(),t.serverTelemetryManager&&!jn(t.config)&&a.addServerTelemetry(t.serverTelemetryManager),a.addRefreshToken(e.refreshToken),t.config.clientCredentials.clientSecret&&a.addClientSecret(t.config.clientCredentials.clientSecret),t.config.clientCredentials.clientAssertion){var s=t.config.clientCredentials.clientAssertion;a.addClientAssertion(yield El(s.assertion,t.config.authOptions.clientId,e.resourceRequestUri)),a.addClientAssertionType(s.assertionType)}if(e.authenticationScheme===Fe.POP){var c,l=new wl(t.cryptoUtils,t.performanceClient);c=e.popKid?t.cryptoUtils.encodeKid(e.popKid):(yield ic(l.generateCnf.bind(l),xo,t.logger,t.performanceClient,e.correlationId)(e,t.logger)).reqCnfString,a.addPopToken(c)}else if(e.authenticationScheme===Fe.SSH){if(!e.sshJwk)throw Fr(Nr);a.addSshJwk(e.sshJwk)}if((!Kr.isEmptyObj(e.claims)||t.config.authOptions.clientCapabilities&&t.config.authOptions.clientCapabilities.length>0)&&a.addClaims(e.claims,t.config.authOptions.clientCapabilities),t.config.systemOptions.preventCorsPreflight&&e.ccsCredential)switch(e.ccsCredential.type){case Ec:try{var u=Vr(e.ccsCredential.credential);a.addCcsOid(u)}catch(e){t.logger.verbose("Could not parse home account ID for CCS Header: "+e)}break;case Oc:a.addCcsUpn(e.ccsCredential.credential)}return e.embeddedClientId&&a.addBrokerParameters({brokerClientId:t.config.authOptions.clientId,brokerRedirectUri:t.config.authOptions.redirectUri}),e.tokenBodyParameters&&a.addExtraQueryParameters(e.tokenBodyParameters),a.createQueryString()})()}}function mu(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function vu(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?mu(Object(r),!0).forEach(function(t){fu(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mu(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function fu(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function yu(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function Cu(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){yu(i,n,o,a,s,"next",e)}function s(e){yu(i,n,o,a,s,"throw",e)}a(void 0)})}}class wu extends ml{constructor(e,t){super(e,t)}acquireToken(e){var t=this;return Cu(function*(){try{var r,[n,o]=yield t.acquireCachedToken(vu(vu({},e),{},{scopes:null!==(r=e.scopes)&&void 0!==r&&r.length?e.scopes:[...le]}));return"4"===o&&(t.logger.info("SilentFlowClient:acquireCachedToken - Cached access token's refreshOn property has been exceeded'. It's not expired, but must be refreshed."),new pu(t.config,t.performanceClient).acquireTokenByRefreshToken(e).catch(()=>{})),n}catch(r){if(r instanceof zt&&r.errorCode===_t)return new pu(t.config,t.performanceClient).acquireTokenByRefreshToken(e);throw r}})()}acquireCachedToken(e){var t=this;return Cu(function*(){var r;null===(r=t.performanceClient)||void 0===r||r.addQueueMeasurement(uo,e.correlationId);var n="0";if(e.forceRefresh||!t.config.cacheOptions.claimsBasedCachingEnabled&&!Kr.isEmptyObj(e.claims))throw t.setCacheOutcome("1",e.correlationId),Gt(_t);if(!e.account)throw Gt(It);var o,i=e.account.tenantId||function(e){var t,r=null===(t=new sn(e).getUrlComponents().PathSegments.slice(-1)[0])||void 0===t?void 0:t.toLowerCase();switch(r){case Ie:case Te:case Se:return;default:return r}}(e.authority),a=t.cacheManager.getTokenKeys(),s=t.cacheManager.getAccessToken(e.account,e,a,i,t.performanceClient);if(!s)throw t.setCacheOutcome("2",e.correlationId),Gt(_t);if(o=s.cachedAt,Number(o)>$t()||er(s.expiresOn,t.config.systemOptions.tokenRenewalOffsetSeconds))throw t.setCacheOutcome("3",e.correlationId),Gt(_t);s.refreshOn&&er(s.refreshOn,0)&&(n="4");var c=e.authority||t.authority.getPreferredCache(),l={account:t.cacheManager.readAccountFromCache(e.account,e.correlationId),accessToken:s,idToken:t.cacheManager.getIdToken(e.account,e.correlationId,a,i,t.performanceClient),refreshToken:null,appMetadata:t.cacheManager.readAppMetadataFromCache(c)};return t.setCacheOutcome(n,e.correlationId),t.config.serverTelemetryManager&&t.config.serverTelemetryManager.incrementCacheHits(),[yield ic(t.generateResultFromCacheRecord.bind(t),ho,t.logger,t.performanceClient,e.correlationId)(l,e),n]})()}setCacheOutcome(e,t){var r,n;null===(r=this.serverTelemetryManager)||void 0===r||r.setCacheOutcome(e),null===(n=this.performanceClient)||void 0===n||n.addFields({cacheOutcome:e},t),"0"!==e&&this.logger.info("Token refresh is required due to cache outcome: ".concat(e))}generateResultFromCacheRecord(e,t){var r=this;return Cu(function*(){var n,o;if(null===(n=r.performanceClient)||void 0===n||n.addQueueMeasurement(ho,t.correlationId),e.idToken&&(o=Xt(e.idToken.secret,r.config.cryptoInterface.base64Decode)),t.maxAge||0===t.maxAge){var i,a=null===(i=o)||void 0===i?void 0:i.auth_time;if(!a)throw Gt(dt);Zt(a,t.maxAge)}return Tl.generateAuthenticationResult(r.cryptoUtils,r.authority,e,!0,t,o)})()}}function bu(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}class ku extends nu{acquireToken(e){var t,r=this;return(t=function*(){r.performanceClient.addQueueMeasurement(Qn,e.correlationId);var t=r.initializeServerTelemetryManager(61),n=yield ic(r.getClientConfiguration.bind(r),Io,r.logger,r.performanceClient,r.correlationId)({serverTelemetryManager:t,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,account:e.account}),o=new wu(n,r.performanceClient);r.logger.verbose("Silent auth client created");try{var i=(yield ic(o.acquireCachedToken.bind(o),uo,r.logger,r.performanceClient,e.correlationId)(e))[0];return r.performanceClient.addFields({fromCache:!0},e.correlationId),i}catch(e){throw e instanceof ja&&e.errorCode===ba&&r.logger.verbose("Signing keypair for bound access token not found. Refreshing bound access token and generating a new crypto keypair."),e}},function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function a(e){bu(i,n,o,a,s,"next",e)}function s(e){bu(i,n,o,a,s,"throw",e)}a(void 0)})})()}logout(e){this.logger.verbose("logoutRedirect called");var t=this.initializeLogoutRequest(e);return this.clearCacheOnLogout(null==t?void 0:t.account)}}var Iu=["prompt"],Tu=["scopes"];function Su(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function Au(e){if(null==e)throw new TypeError("Cannot destructure "+e)}function Eu(){return Eu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Eu.apply(null,arguments)}function Ou(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function Pu(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){Ou(i,n,o,a,s,"next",e)}function s(e){Ou(i,n,o,a,s,"throw",e)}a(void 0)})}}function Ru(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function _u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ru(Object(r),!0).forEach(function(t){Mu(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ru(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function Mu(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Nu extends ql{constructor(e,t,r,n,o,i,a,s,c,l,u,d){var h;super(e,t,r,n,o,i,s,c,d),this.apiId=a,this.accountId=l,this.nativeMessageHandler=c,this.nativeStorageManager=u,this.silentCacheClient=new ku(e,this.nativeStorageManager,r,n,o,i,s,c,d),this.serverTelemetryManager=this.initializeServerTelemetryManager(this.apiId);var g=this.nativeMessageHandler.getExtensionId()===pi?"chrome":null!==(h=this.nativeMessageHandler.getExtensionId())&&void 0!==h&&h.length?"unknown":void 0;this.skus=Ml.makeExtraSkuString({libraryName:hi,libraryVersion:_s,extensionName:g,extensionVersion:this.nativeMessageHandler.getExtensionVersion()})}addRequestSKUs(e){e.extraParameters=_u(_u({},e.extraParameters),{},{[il]:this.skus})}acquireToken(e){var t=this;return Pu(function*(){t.performanceClient.addQueueMeasurement(eo,e.correlationId),t.logger.trace("NativeInteractionClient - acquireToken called.");var r=t.performanceClient.startMeasurement(eo,e.correlationId),n=$t();try{var o=yield t.initializeNativeRequest(e);try{var i=yield t.acquireTokensFromCache(t.accountId,o);return r.end({success:!0,isNativeBroker:!1,fromCache:!0}),i}catch(e){t.logger.info("MSAL internal Cache does not contain tokens, proceed to make a native call")}var a=Eu({},(Au(o),o)),s={method:vi,request:a},c=yield t.nativeMessageHandler.sendMessage(s),l=t.validateNativeResponse(c);return yield t.handleNativeResponse(l,o,n).then(e=>(r.end({success:!0,isNativeBroker:!0,requestId:e.requestId}),t.serverTelemetryManager.clearNativeBrokerErrorCode(),e)).catch(e=>{throw r.end({success:!1,errorCode:e.errorCode,subErrorCode:e.subError,isNativeBroker:!0}),e})}catch(e){throw e instanceof au&&t.serverTelemetryManager.setNativeBrokerErrorCode(e.errorCode),e}})()}createSilentCacheRequest(e,t){return{authority:e.authority,correlationId:this.correlationId,scopes:zr.fromString(e.scope).asArray(),account:t,forceRefresh:!1}}acquireTokensFromCache(e,t){var r=this;return Pu(function*(){if(!e)throw r.logger.warning("NativeInteractionClient:acquireTokensFromCache - No nativeAccountId provided"),Gt(At);var n=r.browserStorage.getBaseAccountInfo({nativeAccountId:e},t.correlationId);if(!n)throw Gt(At);try{var o=r.createSilentCacheRequest(t,n),i=yield r.silentCacheClient.acquireToken(o),a=_u(_u({},n),{},{idTokenClaims:null==i?void 0:i.idTokenClaims,idToken:null==i?void 0:i.idToken});return _u(_u({},i),{},{account:a})}catch(e){throw e}})()}acquireTokenRedirect(e,t){var r=this;return Pu(function*(){r.logger.trace("NativeInteractionClient - acquireTokenRedirect called.");var n=Eu({},(Au(e),e));delete n.onRedirectNavigate;var o=yield r.initializeNativeRequest(n),i={method:vi,request:o};try{var a=yield r.nativeMessageHandler.sendMessage(i);r.validateNativeResponse(a)}catch(e){if(e instanceof au&&(r.serverTelemetryManager.setNativeBrokerErrorCode(e.errorCode),su(e)))throw e}r.browserStorage.setTemporaryCache(Ei,JSON.stringify(o),!0);var s={apiId:Ni,timeout:r.config.system.redirectNavigationTimeout,noHistory:!1},c=r.config.auth.navigateToLoginRequestUrl?window.location.href:r.getRedirectUri(e.redirectUri);t.end({success:!0}),yield r.navigationClient.navigateExternal(c,s)})()}handleRedirectPromise(e,t){var r=this;return Pu(function*(){if(r.logger.trace("NativeInteractionClient - handleRedirectPromise called."),!r.browserStorage.isInteractionInProgress(!0))return r.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;var n=r.browserStorage.getCachedNativeRequest();if(!n)return r.logger.verbose("NativeInteractionClient - handleRedirectPromise called but there is no cached request, returning null."),e&&t&&(null==e||e.addFields({errorCode:"no_cached_request"},t)),null;var{prompt:o}=n,i=Su(n,Iu);o&&r.logger.verbose("NativeInteractionClient - handleRedirectPromise called and prompt was included in the original request, removing prompt from cached request to prevent second interaction with native broker window."),r.browserStorage.removeItem(r.browserStorage.generateCacheKey(Ei));var a={method:vi,request:i},s=$t();try{r.logger.verbose("NativeInteractionClient - handleRedirectPromise sending message to native broker.");var c=yield r.nativeMessageHandler.sendMessage(a);r.validateNativeResponse(c);var l=r.handleNativeResponse(c,i,s);r.browserStorage.setInteractionInProgress(!1);var u=yield l;return r.serverTelemetryManager.clearNativeBrokerErrorCode(),u}catch(e){throw r.browserStorage.setInteractionInProgress(!1),e}})()}logout(){return this.logger.trace("NativeInteractionClient - logout called."),Promise.reject("Logout not implemented yet")}handleNativeResponse(e,t,r){var n=this;return Pu(function*(){var o;n.logger.trace("NativeInteractionClient - handleNativeResponse called.");var i=Xt(e.id_token,Ks),a=n.createHomeAccountIdentifier(e,i);if(a!==(null===(o=n.browserStorage.getAccountInfoFilteredBy({nativeAccountId:t.accountId},n.correlationId))||void 0===o?void 0:o.homeAccountId)&&e.account.id!==t.accountId)throw cu(ou);var s=yield n.getDiscoveredAuthority({requestAuthority:t.authority}),c=Sl(n.browserStorage,s,a,Ks,n.correlationId,i,e.client_info,void 0,i.tid,void 0,e.account.id,n.logger),l=yield n.generateAuthenticationResult(e,t,i,c,s.canonicalAuthority,r);return n.cacheAccount(c),n.cacheNativeTokens(e,t,a,i,e.access_token,l.tenantId,r),l})()}createHomeAccountIdentifier(e,t){return nn.generateHomeAccountId(e.client_info||ce.EMPTY_STRING,0,this.logger,this.browserCrypto,t)}generateScopes(e,t){return e.scope?zr.fromString(e.scope):zr.fromString(t.scope)}generatePopAccessToken(e,t){var r=this;return Pu(function*(){if(t.tokenType===Fe.POP&&t.signPopToken){if(e.shr)return r.logger.trace("handleNativeServerResponse: SHR is enabled in native layer"),e.shr;var n=new wl(r.browserCrypto),o={resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,shrNonce:t.shrNonce};if(!t.keyId)throw Gt(Ht);return n.signPopToken(e.access_token,t.keyId,o)}return e.access_token})()}generateAuthenticationResult(e,t,r,n,o,i){var a=this;return Pu(function*(){var s=a.addTelemetryFromNativeResponse(e),c=e.scope?zr.fromString(e.scope):zr.fromString(t.scope),l=e.account.properties||{},u=l.UID||r.oid||r.sub||ce.EMPTY_STRING,d=l.TenantId||r.tid||ce.EMPTY_STRING,h=tn(n.getAccountInfo(),void 0,r,e.id_token);h.nativeAccountId!==e.account.id&&(h.nativeAccountId=e.account.id);var g=yield a.generatePopAccessToken(e,t),p=t.tokenType===Fe.POP?Fe.POP:Fe.BEARER;return{authority:o,uniqueId:u,tenantId:d,scopes:c.asArray(),account:h,idToken:e.id_token,idTokenClaims:r,accessToken:g,fromCache:!!s&&a.isResponseFromCache(s),expiresOn:new Date(1e3*Number(i+e.expires_in)),tokenType:p,correlationId:a.correlationId,state:e.state,fromNativeBroker:!0}})()}cacheAccount(e){this.browserStorage.setAccount(e,this.correlationId),this.browserStorage.removeAccountContext(e,this.correlationId).catch(e=>{this.logger.error("Error occurred while removing account context from browser storage. ".concat(e))})}cacheNativeTokens(e,t,r,n,o,i,a){var s=rr(r,t.authority,e.id_token||"",t.clientId,n.tid||""),c=a+(t.tokenType===Fe.POP?ce.SHR_NONCE_VALIDITY:("string"==typeof e.expires_in?parseInt(e.expires_in,10):e.expires_in)||0),l=this.generateScopes(e,t),u={idToken:s,accessToken:nr(r,t.authority,o,t.clientId,n.tid||i,l.printScopes(),c,0,Ks,void 0,t.tokenType,void 0,t.keyId)};this.nativeStorageManager.saveCacheRecord(u,t.correlationId,t.storeInCache)}addTelemetryFromNativeResponse(e){var t=this.getMATSFromResponse(e);return t?(this.performanceClient.addFields({extensionId:this.nativeMessageHandler.getExtensionId(),extensionVersion:this.nativeMessageHandler.getExtensionVersion(),matsBrokerVersion:t.broker_version,matsAccountJoinOnStart:t.account_join_on_start,matsAccountJoinOnEnd:t.account_join_on_end,matsDeviceJoin:t.device_join,matsPromptBehavior:t.prompt_behavior,matsApiErrorCode:t.api_error_code,matsUiVisible:t.ui_visible,matsSilentCode:t.silent_code,matsSilentBiSubCode:t.silent_bi_sub_code,matsSilentMessage:t.silent_message,matsSilentStatus:t.silent_status,matsHttpStatus:t.http_status,matsHttpEventCount:t.http_event_count},this.correlationId),t):null}validateNativeResponse(e){if(e.hasOwnProperty("access_token")&&e.hasOwnProperty("id_token")&&e.hasOwnProperty("client_info")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scope")&&e.hasOwnProperty("expires_in"))return e;throw Ze(Qe,"Response missing expected properties.")}getMATSFromResponse(e){if(e.properties.MATS)try{return JSON.parse(e.properties.MATS)}catch(e){this.logger.error("NativeInteractionClient - Error parsing MATS telemetry, returning null instead")}return null}isResponseFromCache(e){return void 0===e.is_cached?(this.logger.verbose("NativeInteractionClient - MATS telemetry does not contain field indicating if response was served from cache. Returning false."),!1):!!e.is_cached}initializeNativeRequest(e){var t=this;return Pu(function*(){t.logger.trace("NativeInteractionClient - initializeNativeRequest called");var r=e.authority||t.config.auth.authority;e.account&&(yield t.getDiscoveredAuthority({requestAuthority:r,requestAzureCloudOptions:e.azureCloudOptions,account:e.account}));var n=new sn(r);n.validateAsUri();var{scopes:o}=e,i=Su(e,Tu),a=new zr(o||[]);a.appendScopes(le);var s=_u(_u({},i),{},{accountId:t.accountId,clientId:t.config.auth.clientId,authority:n.urlString,scope:a.printScopes(),redirectUri:t.getRedirectUri(e.redirectUri),prompt:(()=>{switch(t.apiId){case 863:case 61:return t.logger.trace("initializeNativeRequest: silent request sets prompt to none"),Ee.NONE}if(e.prompt)switch(e.prompt){case Ee.NONE:case Ee.CONSENT:case Ee.LOGIN:return t.logger.trace("initializeNativeRequest: prompt is compatible with native flow"),e.prompt;default:throw t.logger.trace("initializeNativeRequest: prompt = ".concat(e.prompt," is not compatible with native flow")),Da(_a)}else t.logger.trace("initializeNativeRequest: prompt was not provided")})(),correlationId:t.correlationId,tokenType:e.authenticationScheme,windowTitleSubstring:document.title,extraParameters:_u(_u({},e.extraQueryParameters),e.tokenQueryParameters),extendedExpiryToken:!1,keyId:e.popKid});if(s.signPopToken&&e.popKid)throw Da(Na);if(t.handleExtraBrokerParams(s),s.extraParameters=s.extraParameters||{},s.extraParameters.telemetry="MATS",e.authenticationScheme===Fe.POP){var c,l={resourceRequestUri:e.resourceRequestUri,resourceRequestMethod:e.resourceRequestMethod,shrClaims:e.shrClaims,shrNonce:e.shrNonce},u=new wl(t.browserCrypto);if(s.keyId)c=t.browserCrypto.base64UrlEncode(JSON.stringify({kid:s.keyId})),s.signPopToken=!1;else{var d=yield ic(u.generateCnf.bind(u),xo,t.logger,t.performanceClient,e.correlationId)(l,t.logger);c=d.reqCnfString,s.keyId=d.kid,s.signPopToken=!0}s.reqCnf=c}return t.addRequestSKUs(s),s})()}handleExtraBrokerParams(e){var t,r=e.extraParameters&&e.extraParameters.hasOwnProperty(al)&&e.extraParameters.hasOwnProperty(sl)&&e.extraParameters.hasOwnProperty($c);if(e.embeddedClientId||r){var n="",o=e.redirectUri;e.embeddedClientId?(e.redirectUri=this.config.auth.redirectUri,n=e.embeddedClientId):e.extraParameters&&(e.redirectUri=e.extraParameters[sl],n=e.extraParameters[$c]),e.extraParameters={child_client_id:n,child_redirect_uri:o},null===(t=this.performanceClient)||void 0===t||t.addFields({embeddedClientId:n,embeddedRedirectUri:o},e.correlationId)}}}function xu(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function qu(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){xu(i,n,o,a,s,"next",e)}function s(e){xu(i,n,o,a,s,"throw",e)}a(void 0)})}}class Lu{constructor(e,t,r,n){this.logger=e,this.handshakeTimeoutMs=t,this.extensionId=n,this.resolvers=new Map,this.handshakeResolvers=new Map,this.messageChannel=new MessageChannel,this.windowListener=this.onWindowMessage.bind(this),this.performanceClient=r,this.handshakeEvent=r.startMeasurement(Xo)}sendMessage(e){var t=this;return qu(function*(){t.logger.trace("NativeMessageHandler - sendMessage called.");var r={channel:gi,extensionId:t.extensionId,responseId:as(),body:e};return t.logger.trace("NativeMessageHandler - Sending request to browser extension"),t.logger.tracePii("NativeMessageHandler - Sending request to browser extension: ".concat(JSON.stringify(r))),t.messageChannel.port1.postMessage(r),new Promise((e,n)=>{t.resolvers.set(r.responseId,{resolve:e,reject:n})})})()}static createProvider(e,t,r){return qu(function*(){e.trace("NativeMessageHandler - createProvider called.");try{var n=new Lu(e,t,r,pi);return yield n.sendHandshakeRequest(),n}catch(n){var o=new Lu(e,t,r);return yield o.sendHandshakeRequest(),o}})()}sendHandshakeRequest(){var e=this;return qu(function*(){e.logger.trace("NativeMessageHandler - sendHandshakeRequest called."),window.addEventListener("message",e.windowListener,!1);var t={channel:gi,extensionId:e.extensionId,responseId:as(),body:{method:mi}};return e.handshakeEvent.add({extensionId:e.extensionId,extensionHandshakeTimeoutMs:e.handshakeTimeoutMs}),e.messageChannel.port1.onmessage=t=>{e.onChannelMessage(t)},window.postMessage(t,window.origin,[e.messageChannel.port2]),new Promise((r,n)=>{e.handshakeResolvers.set(t.responseId,{resolve:r,reject:n}),e.timeoutId=window.setTimeout(()=>{window.removeEventListener("message",e.windowListener,!1),e.messageChannel.port1.close(),e.messageChannel.port2.close(),e.handshakeEvent.end({extensionHandshakeTimedOut:!0,success:!1}),n(Da(Ea)),e.handshakeResolvers.delete(t.responseId)},e.handshakeTimeoutMs)})})()}onWindowMessage(e){if(this.logger.trace("NativeMessageHandler - onWindowMessage called"),e.source===window){var t=e.data;if(t.channel&&t.channel===gi&&(!t.extensionId||t.extensionId===this.extensionId)&&t.body.method===mi){var r=this.handshakeResolvers.get(t.responseId);if(!r)return void this.logger.trace("NativeMessageHandler.onWindowMessage - resolver can't be found for request ".concat(t.responseId));this.logger.verbose(t.extensionId?"Extension with id: ".concat(t.extensionId," not installed"):"No extension installed"),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1),this.handshakeEvent.end({success:!1,extensionInstalled:!1}),r.reject(Da(Oa))}}}onChannelMessage(e){this.logger.trace("NativeMessageHandler - onChannelMessage called.");var t=e.data,r=this.resolvers.get(t.responseId),n=this.handshakeResolvers.get(t.responseId);try{var o=t.body.method;if("Response"===o){if(!r)return;var i=t.body.response;if(this.logger.trace("NativeMessageHandler - Received response from browser extension"),this.logger.tracePii("NativeMessageHandler - Received response from browser extension: ".concat(JSON.stringify(i))),"Success"!==i.status)r.reject(cu(i.code,i.description,i.ext));else{if(!i.result)throw Ze(Qe,"Event does not contain result.");i.result.code&&i.result.description?r.reject(cu(i.result.code,i.result.description,i.result.ext)):r.resolve(i.result)}this.resolvers.delete(t.responseId)}else if("HandshakeResponse"===o){if(!n)return void this.logger.trace("NativeMessageHandler.onChannelMessage - resolver can't be found for request ".concat(t.responseId));clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=t.extensionId,this.extensionVersion=t.body.version,this.logger.verbose("NativeMessageHandler - Received HandshakeResponse from extension: ".concat(this.extensionId)),this.handshakeEvent.end({extensionInstalled:!0,success:!0}),n.resolve(),this.handshakeResolvers.delete(t.responseId)}}catch(t){this.logger.error("Error parsing response from WAM Extension"),this.logger.errorPii("Error parsing response from WAM Extension: ".concat(t)),this.logger.errorPii("Unable to parse ".concat(e)),r?r.reject(t):n&&n.reject(t)}}getExtensionId(){return this.extensionId}getExtensionVersion(){return this.extensionVersion}static isNativeAvailable(e,t,r,n){if(t.trace("isNativeAvailable called"),!e.system.allowNativeBroker)return t.trace("isNativeAvailable: allowNativeBroker is not enabled, returning false"),!1;if(!r)return t.trace("isNativeAvailable: WAM extension provider is not initialized, returning false"),!1;if(n)switch(n){case Fe.BEARER:case Fe.POP:return t.trace("isNativeAvailable: authenticationScheme is supported, returning true"),!0;default:return t.trace("isNativeAvailable: authenticationScheme is not supported, returning false"),!1}return!0}}function Hu(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function ju(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){Hu(i,n,o,a,s,"next",e)}function s(e){Hu(i,n,o,a,s,"throw",e)}a(void 0)})}}class Du{constructor(e,t,r,n,o){this.authModule=e,this.browserStorage=t,this.authCodeRequest=r,this.logger=n,this.performanceClient=o}handleCodeResponse(e,t){var r=this;return ju(function*(){var n;r.performanceClient.addQueueMeasurement(Oo,t.correlationId);try{n=r.authModule.handleFragmentResponse(e,t.state)}catch(e){throw e instanceof Xc&&e.subError===$i?Da($i):e}return ic(r.handleCodeResponseFromServer.bind(r),Eo,r.logger,r.performanceClient,t.correlationId)(n,t)})()}handleCodeResponseFromServer(e,t){var r=arguments,n=this;return ju(function*(){var o=!(r.length>2&&void 0!==r[2])||r[2];if(n.performanceClient.addQueueMeasurement(Eo,t.correlationId),n.logger.trace("InteractionHandler.handleCodeResponseFromServer called"),n.authCodeRequest.code=e.code,e.cloud_instance_host_name&&(yield ic(n.authModule.updateAuthority.bind(n.authModule),Po,n.logger,n.performanceClient,t.correlationId)(e.cloud_instance_host_name,t.correlationId)),o&&(e.nonce=t.nonce||void 0),e.state=t.state,e.client_info)n.authCodeRequest.clientInfo=e.client_info;else{var i=n.createCcsCredentials(t);i&&(n.authCodeRequest.ccsCredential=i)}return yield ic(n.authModule.acquireToken.bind(n.authModule),Ro,n.logger,n.performanceClient,t.correlationId)(n.authCodeRequest,e)})()}createCcsCredentials(e){return e.account?{credential:e.account.homeAccountId,type:Ec}:e.loginHint?{credential:e.loginHint,type:Oc}:null}}function Uu(e,t,r){var n=an(e);if(!n)throw on(e)?(r.error("A ".concat(t," is present in the iframe but it does not contain known properties. It's likely that the ").concat(t," has been replaced by code running on the redirectUri page.")),r.errorPii("The ".concat(t," detected is: ").concat(e)),Da(Wi)):(r.error("The request has returned to the redirectUri but a ".concat(t," is not present. It's likely that the ").concat(t," has been removed or the page has been redirected by code running on the redirectUri page.")),Da(Gi));return n}function Bu(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Fu(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Bu(Object(r),!0).forEach(function(t){Ku(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Bu(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function Ku(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function zu(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function Gu(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){zu(i,n,o,a,s,"next",e)}function s(e){zu(i,n,o,a,s,"throw",e)}a(void 0)})}}class Vu extends nu{constructor(e,t,r,n,o,i,a,s,c,l){super(e,t,r,n,o,i,a,c,l),this.unloadWindow=this.unloadWindow.bind(this),this.nativeStorage=s}acquireToken(e){try{var t,r={popupName:this.generatePopupName(e.scopes||le,e.authority||this.config.auth.authority),popupWindowAttributes:e.popupWindowAttributes||{},popupWindowParent:null!==(t=e.popupWindowParent)&&void 0!==t?t:window};return this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true, acquiring token"),this.acquireTokenPopupAsync(e,r)):(this.logger.verbose("asyncPopup set to false, opening popup before acquiring token"),r.popup=this.openSizedPopup("about:blank",r),this.acquireTokenPopupAsync(e,r))}catch(e){return Promise.reject(e)}}logout(e){try{var t;this.logger.verbose("logoutPopup called");var r=this.initializeLogoutRequest(e),n={popupName:this.generateLogoutPopupName(r),popupWindowAttributes:(null==e?void 0:e.popupWindowAttributes)||{},popupWindowParent:null!==(t=null==e?void 0:e.popupWindowParent)&&void 0!==t?t:window},o=e&&e.authority,i=e&&e.mainWindowRedirectUri;return this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true"),this.logoutPopupAsync(r,n,o,i)):(this.logger.verbose("asyncPopup set to false, opening popup"),n.popup=this.openSizedPopup("about:blank",n),this.logoutPopupAsync(r,n,o,i))}catch(e){return Promise.reject(e)}}acquireTokenPopupAsync(e,t){var r=this;return Gu(function*(){r.logger.verbose("acquireTokenPopupAsync called");var n=r.initializeServerTelemetryManager(xi),o=yield ic(r.initializeAuthorizationRequest.bind(r),To,r.logger,r.performanceClient,r.correlationId)(e,li.Popup);As(o.authority);try{var i,a=yield ic(r.initializeAuthorizationCodeRequest.bind(r),So,r.logger,r.performanceClient,r.correlationId)(o),s=yield ic(r.createAuthCodeClient.bind(r),ko,r.logger,r.performanceClient,r.correlationId)({serverTelemetryManager:n,requestAuthority:o.authority,requestAzureCloudOptions:o.azureCloudOptions,requestExtraQueryParameters:o.extraQueryParameters,account:o.account}),c=Lu.isNativeAvailable(r.config,r.logger,r.nativeMessageHandler,e.authenticationScheme);c&&(i=r.performanceClient.startMeasurement($n,e.correlationId));var l=yield s.getAuthCodeUrl(Fu(Fu({},o),{},{nativeBroker:c})),u=new Du(s,r.browserStorage,a,r.logger,r.performanceClient),d=r.initiateAuthRequest(l,t);r.eventHandler.emitEvent(Gc,li.Popup,{popupWindow:d},null);var h=yield r.monitorPopupForHash(d,t.popupWindowParent),g=oc(Uu,Ho,r.logger,r.performanceClient,r.correlationId)(h,r.config.auth.OIDCOptions.serverResponseType,r.logger);if(Zc.removeThrottle(r.browserStorage,r.config.auth.clientId,a),g.accountId){if(r.logger.verbose("Account id found in hash, calling WAM for token"),i&&i.end({success:!0,isNativeBroker:!0}),!r.nativeMessageHandler)throw Da(Pa);var p=new Nu(r.config,r.browserStorage,r.browserCrypto,r.logger,r.eventHandler,r.navigationClient,xi,r.performanceClient,r.nativeMessageHandler,g.accountId,r.nativeStorage,o.correlationId),{userRequestState:m}=Ac.parseRequestState(r.browserCrypto,o.state);return yield p.acquireToken(Fu(Fu({},o),{},{state:m,prompt:void 0}))}return yield u.handleCodeResponse(g,o)}catch(e){var v;throw null===(v=t.popup)||void 0===v||v.close(),e instanceof Xe&&(e.setCorrelationId(r.correlationId),n.cacheFailedRequest(e)),e}})()}logoutPopupAsync(e,t,r,n){var o=this;return Gu(function*(){o.logger.verbose("logoutPopupAsync called"),o.eventHandler.emitEvent(Vc,li.Popup,e);var i=o.initializeServerTelemetryManager(962);try{yield o.clearCacheOnLogout(e.account);var a=yield ic(o.createAuthCodeClient.bind(o),ko,o.logger,o.performanceClient,o.correlationId)({serverTelemetryManager:i,requestAuthority:r,account:e.account||void 0});try{a.authority.endSessionEndpoint}catch(r){var s;if(null!==(s=e.account)&&void 0!==s&&s.homeAccountId&&e.postLogoutRedirectUri&&a.authority.protocolMode===Ve){var c,l;if(o.browserStorage.removeAccount(null===(c=e.account)||void 0===c?void 0:c.homeAccountId,o.correlationId),o.eventHandler.emitEvent(Wc,li.Popup,e),n){var u={apiId:962,timeout:o.config.system.redirectNavigationTimeout,noHistory:!1},d=sn.getAbsoluteUrl(n,bs());yield o.navigationClient.navigateInternal(d,u)}return void(null===(l=t.popup)||void 0===l||l.close())}}var h=a.getLogoutUri(e);o.eventHandler.emitEvent(Wc,li.Popup,e);var g=o.openPopup(h,t);if(o.eventHandler.emitEvent(Gc,li.Popup,{popupWindow:g},null),yield o.monitorPopupForHash(g,t.popupWindowParent).catch(()=>{}),n){var p={apiId:962,timeout:o.config.system.redirectNavigationTimeout,noHistory:!1},m=sn.getAbsoluteUrl(n,bs());o.logger.verbose("Redirecting main window to url specified in the request"),o.logger.verbosePii("Redirecting main window to: ".concat(m)),yield o.navigationClient.navigateInternal(m,p)}else o.logger.verbose("No main window navigation requested")}catch(e){var v;throw null===(v=t.popup)||void 0===v||v.close(),e instanceof Xe&&(e.setCorrelationId(o.correlationId),i.cacheFailedRequest(e)),o.browserStorage.setInteractionInProgress(!1),o.eventHandler.emitEvent(Qc,li.Popup,null,e),o.eventHandler.emitEvent(Yc,li.Popup),e}o.eventHandler.emitEvent(Yc,li.Popup)})()}initiateAuthRequest(e,t){if(e)return this.logger.infoPii("Navigate to: ".concat(e)),this.openPopup(e,t);throw this.logger.error("Navigate url is empty"),Da(zi)}monitorPopupForHash(e,t){return new Promise((t,r)=>{this.logger.verbose("PopupHandler.monitorPopupForHash - polling started");var n=setInterval(()=>{if(e.closed)return this.logger.error("PopupHandler.monitorPopupForHash - window closed"),clearInterval(n),void r(Da($i));var o="";try{o=e.location.href}catch(e){}if(o&&"about:blank"!==o){clearInterval(n);var i="",a=this.config.auth.OIDCOptions.serverResponseType;e&&(i=a===Pe.QUERY?e.location.search:e.location.hash),this.logger.verbose("PopupHandler.monitorPopupForHash - popup window is on same origin as caller"),t(i)}},this.config.system.pollIntervalMilliseconds)}).finally(()=>{this.cleanPopup(e,t)})}openPopup(e,t){try{var r;if(t.popup?(r=t.popup,this.logger.verbosePii("Navigating popup window to: ".concat(e)),r.location.assign(e)):void 0===t.popup&&(this.logger.verbosePii("Opening popup window to: ".concat(e)),r=this.openSizedPopup(e,t)),!r)throw Da(Zi);return r.focus&&r.focus(),this.currentWindow=r,t.popupWindowParent.addEventListener("beforeunload",this.unloadWindow),r}catch(e){throw this.logger.error("error opening popup "+e.message),this.browserStorage.setInteractionInProgress(!1),Da(Xi)}}openSizedPopup(e,t){var r,n,o,i,{popupName:a,popupWindowAttributes:s,popupWindowParent:c}=t,l=c.screenLeft?c.screenLeft:c.screenX,u=c.screenTop?c.screenTop:c.screenY,d=c.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,h=c.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,g=null===(r=s.popupSize)||void 0===r?void 0:r.width,p=null===(n=s.popupSize)||void 0===n?void 0:n.height,m=null===(o=s.popupPosition)||void 0===o?void 0:o.top,v=null===(i=s.popupPosition)||void 0===i?void 0:i.left;return(!g||g<0||g>d)&&(this.logger.verbose("Default popup window width used. Window width not configured or invalid."),g=483),(!p||p<0||p>h)&&(this.logger.verbose("Default popup window height used. Window height not configured or invalid."),p=600),(!m||m<0||m>h)&&(this.logger.verbose("Default popup window top position used. Window top not configured or invalid."),m=Math.max(0,h/2-300+u)),(!v||v<0||v>d)&&(this.logger.verbose("Default popup window left position used. Window left not configured or invalid."),v=Math.max(0,d/2-241.5+l)),c.open(e,a,"width=".concat(g,", height=").concat(p,", top=").concat(m,", left=").concat(v,", scrollbars=yes"))}unloadWindow(e){this.browserStorage.cleanRequestByInteractionType(li.Popup),this.currentWindow&&this.currentWindow.close(),e.preventDefault()}cleanPopup(e,t){e.close(),t.removeEventListener("beforeunload",this.unloadWindow),this.browserStorage.setInteractionInProgress(!1)}generatePopupName(e,t){return"".concat(di,".").concat(this.config.auth.clientId,".").concat(e.join("-"),".").concat(t,".").concat(this.correlationId)}generateLogoutPopupName(e){var t=e.account&&e.account.homeAccountId;return"".concat(di,".").concat(this.config.auth.clientId,".").concat(t,".").concat(this.correlationId)}}function Wu(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function Qu(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){Wu(i,n,o,a,s,"next",e)}function s(e){Wu(i,n,o,a,s,"throw",e)}a(void 0)})}}class Yu{constructor(e,t,r,n,o){this.authModule=e,this.browserStorage=t,this.authCodeRequest=r,this.logger=n,this.performanceClient=o}initiateAuthRequest(e,t){var r=this;return Qu(function*(){if(r.logger.verbose("RedirectHandler.initiateAuthRequest called"),e){t.redirectStartPage&&(r.logger.verbose("RedirectHandler.initiateAuthRequest: redirectStartPage set, caching start page"),r.browserStorage.setTemporaryCache(bi,t.redirectStartPage,!0)),r.browserStorage.setTemporaryCache(Ai,r.authCodeRequest.correlationId,!0),r.browserStorage.cacheCodeRequest(r.authCodeRequest),r.logger.infoPii("RedirectHandler.initiateAuthRequest: Navigate to: ".concat(e));var n={apiId:Ni,timeout:t.redirectTimeout,noHistory:!1};return"function"==typeof t.onRedirectNavigate?(r.logger.verbose("RedirectHandler.initiateAuthRequest: Invoking onRedirectNavigate callback"),!1!==t.onRedirectNavigate(e)?(r.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate did not return false, navigating"),void(yield t.navigationClient.navigateExternal(e,n))):void r.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate returned false, stopping navigation")):(r.logger.verbose("RedirectHandler.initiateAuthRequest: Navigating window to navigate url"),void(yield t.navigationClient.navigateExternal(e,n)))}throw r.logger.info("RedirectHandler.initiateAuthRequest: Navigate url is empty"),Da(zi)})()}handleCodeResponse(e,t){var r=this;return Qu(function*(){r.logger.verbose("RedirectHandler.handleCodeResponse called"),r.browserStorage.setInteractionInProgress(!1);var n,o=r.browserStorage.generateStateKey(t),i=r.browserStorage.getTemporaryCache(o);if(!i)throw Gt(lt,"Cached State");try{n=r.authModule.handleFragmentResponse(e,i)}catch(e){throw e instanceof Xc&&e.subError===$i?Da($i):e}var a=r.browserStorage.generateNonceKey(i),s=r.browserStorage.getTemporaryCache(a);if(r.authCodeRequest.code=n.code,n.cloud_instance_host_name&&(yield ic(r.authModule.updateAuthority.bind(r.authModule),Po,r.logger,r.performanceClient,r.authCodeRequest.correlationId)(n.cloud_instance_host_name,r.authCodeRequest.correlationId)),n.nonce=s||void 0,n.state=i,n.client_info)r.authCodeRequest.clientInfo=n.client_info;else{var c=r.checkCcsCredentials();c&&(r.authCodeRequest.ccsCredential=c)}var l=yield r.authModule.acquireToken(r.authCodeRequest,n);return r.browserStorage.cleanRequestByState(t),l})()}checkCcsCredentials(){var e=this.browserStorage.getTemporaryCache(Si,!0);if(e)try{return JSON.parse(e)}catch(t){this.authModule.logger.error("Cache credential could not be parsed"),this.authModule.logger.errorPii("Cache credential could not be parsed: ".concat(e))}return null}}function Ju(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Xu(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ju(Object(r),!0).forEach(function(t){Zu(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ju(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function Zu(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function $u(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function ed(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){$u(i,n,o,a,s,"next",e)}function s(e){$u(i,n,o,a,s,"throw",e)}a(void 0)})}}class td extends nu{constructor(e,t,r,n,o,i,a,s,c,l){super(e,t,r,n,o,i,a,c,l),this.nativeStorage=s}acquireToken(e){var t=this;return ed(function*(){var r=yield ic(t.initializeAuthorizationRequest.bind(t),To,t.logger,t.performanceClient,t.correlationId)(e,li.Redirect);t.browserStorage.updateCacheEntries(r.state,r.nonce,r.authority,r.loginHint||"",r.account||null);var n=t.initializeServerTelemetryManager(Ni),o=e=>{e.persisted&&(t.logger.verbose("Page was restored from back/forward cache. Clearing temporary cache."),t.browserStorage.cleanRequestByState(r.state),t.eventHandler.emitEvent("msal:restoreFromBFCache",li.Redirect))};try{var i=yield ic(t.initializeAuthorizationCodeRequest.bind(t),So,t.logger,t.performanceClient,t.correlationId)(r),a=yield ic(t.createAuthCodeClient.bind(t),ko,t.logger,t.performanceClient,t.correlationId)({serverTelemetryManager:n,requestAuthority:r.authority,requestAzureCloudOptions:r.azureCloudOptions,requestExtraQueryParameters:r.extraQueryParameters,account:r.account}),s=new Yu(a,t.browserStorage,i,t.logger,t.performanceClient),c=yield a.getAuthCodeUrl(Xu(Xu({},r),{},{nativeBroker:Lu.isNativeAvailable(t.config,t.logger,t.nativeMessageHandler,e.authenticationScheme)})),l=t.getRedirectStartPage(e.redirectStartPage);return t.logger.verbosePii("Redirect start page: ".concat(l)),window.addEventListener("pageshow",o),yield s.initiateAuthRequest(c,{navigationClient:t.navigationClient,redirectTimeout:t.config.system.redirectNavigationTimeout,redirectStartPage:l,onRedirectNavigate:e.onRedirectNavigate||t.config.auth.onRedirectNavigate})}catch(e){throw e instanceof Xe&&(e.setCorrelationId(t.correlationId),n.cacheFailedRequest(e)),window.removeEventListener("pageshow",o),t.browserStorage.cleanRequestByState(r.state),e}})()}handleRedirectPromise(){var e=arguments,t=this;return ed(function*(){var r,n,o=e.length>0&&void 0!==e[0]?e[0]:"",i=e.length>1?e[1]:void 0,a=t.initializeServerTelemetryManager(865);try{if(!t.browserStorage.isInteractionInProgress(!0))return t.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;var[s,c]=t.getRedirectResponse(o||"");if(!s)return t.logger.info("handleRedirectPromise did not detect a response as a result of a redirect. Cleaning temporary cache."),t.browserStorage.cleanRequestByInteractionType(li.Redirect),"back_forward"!==function(){if("undefined"!=typeof window&&void 0!==window.performance&&"function"==typeof window.performance.getEntriesByType){var e=window.performance.getEntriesByType("navigation"),t=e.length?e[0]:void 0;return null==t?void 0:t.type}}()?i.event.errorCode="no_server_response":t.logger.verbose("Back navigation event detected. Muting no_server_response error"),null;var l=t.browserStorage.getTemporaryCache(bi,!0)||ce.EMPTY_STRING;if(sn.removeHashFromUrl(l)===sn.removeHashFromUrl(window.location.href)&&t.config.auth.navigateToLoginRequestUrl)return t.logger.verbose("Current page is loginRequestUrl, handling response"),l.indexOf("#")>-1&&((n=l.split("#")).shift(),window.location.hash=n.length>0?n.join("#"):""),yield t.handleResponse(s,a);if(!t.config.auth.navigateToLoginRequestUrl)return t.logger.verbose("NavigateToLoginRequestUrl set to false, handling response"),yield t.handleResponse(s,a);if(!ws()||t.config.system.allowRedirectInIframe){t.browserStorage.setTemporaryCache(ki,c,!0);var u={apiId:865,timeout:t.config.system.redirectNavigationTimeout,noHistory:!0},d=!0;if(l&&"null"!==l)t.logger.verbose("Navigating to loginRequestUrl: ".concat(l)),d=yield t.navigationClient.navigateInternal(l,u);else{var h=(r=new sn(window.location.href).getUrlComponents(),"".concat(r.Protocol,"//").concat(r.HostNameAndPort,"/"));t.browserStorage.setTemporaryCache(bi,h,!0),t.logger.warning("Unable to get valid login request url from cache, redirecting to home page"),d=yield t.navigationClient.navigateInternal(h,u)}if(!d)return yield t.handleResponse(s,a)}return null}catch(e){throw e instanceof Xe&&(e.setCorrelationId(t.correlationId),a.cacheFailedRequest(e)),t.browserStorage.cleanRequestByInteractionType(li.Redirect),e}})()}getRedirectResponse(e){this.logger.verbose("getRedirectResponseHash called");var t=e;t||(t=this.config.auth.OIDCOptions.serverResponseType===Pe.QUERY?window.location.search:window.location.hash);var r,n=an(t);if(n){try{!function(e,t,r){if(!e.state)throw Da(Vi);var n=_c(t,e.state);if(!n)throw Da(Qi);if(n.interactionType!==r)throw Da(Yi)}(n,this.browserCrypto,li.Redirect)}catch(e){return e instanceof Xe&&this.logger.error("Interaction type validation failed due to ".concat(e.errorCode,": ").concat(e.errorMessage)),[null,""]}return(r=window).location.hash="","function"==typeof r.history.replaceState&&r.history.replaceState(null,"","".concat(r.location.origin).concat(r.location.pathname).concat(r.location.search)),this.logger.verbose("Hash contains known properties, returning response hash"),[n,t]}var o=this.browserStorage.getTemporaryCache(ki,!0);return this.browserStorage.removeItem(this.browserStorage.generateCacheKey(ki)),o&&(n=an(o))?(this.logger.verbose("Hash does not contain known properties, returning cached hash"),[n,o]):[null,""]}handleResponse(e,t){var r=this;return ed(function*(){var n=e.state;if(!n)throw Da(Vi);var o=r.browserStorage.getCachedRequest(n);if(r.logger.verbose("handleResponse called, retrieved cached request"),e.accountId){if(r.logger.verbose("Account id found in hash, calling WAM for token"),!r.nativeMessageHandler)throw Da(Pa);var i=new Nu(r.config,r.browserStorage,r.browserCrypto,r.logger,r.eventHandler,r.navigationClient,xi,r.performanceClient,r.nativeMessageHandler,e.accountId,r.nativeStorage,o.correlationId),{userRequestState:a}=Ac.parseRequestState(r.browserCrypto,n);return i.acquireToken(Xu(Xu({},o),{},{state:a,prompt:void 0})).finally(()=>{r.browserStorage.cleanRequestByState(n)})}var s=r.browserStorage.getCachedAuthority(n);if(!s)throw Da(da);var c=yield ic(r.createAuthCodeClient.bind(r),ko,r.logger,r.performanceClient,r.correlationId)({serverTelemetryManager:t,requestAuthority:s});return Zc.removeThrottle(r.browserStorage,r.config.auth.clientId,o),new Yu(c,r.browserStorage,o,r.logger,r.performanceClient).handleCodeResponse(e,n)})()}logout(e){var t=this;return ed(function*(){t.logger.verbose("logoutRedirect called");var r=t.initializeLogoutRequest(e),n=t.initializeServerTelemetryManager(961);try{t.eventHandler.emitEvent(Vc,li.Redirect,e),yield t.clearCacheOnLogout(r.account);var o={apiId:961,timeout:t.config.system.redirectNavigationTimeout,noHistory:!1},i=yield ic(t.createAuthCodeClient.bind(t),ko,t.logger,t.performanceClient,t.correlationId)({serverTelemetryManager:n,requestAuthority:e&&e.authority,requestExtraQueryParameters:null==e?void 0:e.extraQueryParameters,account:e&&e.account||void 0});if(i.authority.protocolMode===Ve)try{i.authority.endSessionEndpoint}catch(e){var a,s;if(null!==(a=r.account)&&void 0!==a&&a.homeAccountId)return t.browserStorage.removeAccount(null===(s=r.account)||void 0===s?void 0:s.homeAccountId,t.correlationId),void t.eventHandler.emitEvent(Wc,li.Redirect,r)}var c=i.getLogoutUri(r);if(t.eventHandler.emitEvent(Wc,li.Redirect,r),!e||"function"!=typeof e.onRedirectNavigate)return t.browserStorage.getInteractionInProgress()||t.browserStorage.setInteractionInProgress(!0),void(yield t.navigationClient.navigateExternal(c,o));if(!1!==e.onRedirectNavigate(c))return t.logger.verbose("Logout onRedirectNavigate did not return false, navigating"),t.browserStorage.getInteractionInProgress()||t.browserStorage.setInteractionInProgress(!0),void(yield t.navigationClient.navigateExternal(c,o));t.browserStorage.setInteractionInProgress(!1),t.logger.verbose("Logout onRedirectNavigate returned false, stopping navigation")}catch(e){throw e instanceof Xe&&(e.setCorrelationId(t.correlationId),n.cacheFailedRequest(e)),t.eventHandler.emitEvent(Qc,li.Redirect,null,e),t.eventHandler.emitEvent(Yc,li.Redirect),e}t.eventHandler.emitEvent(Yc,li.Redirect)})()}getRedirectStartPage(e){var t=e||window.location.href;return sn.getAbsoluteUrl(t,bs())}}function rd(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function nd(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){rd(i,n,o,a,s,"next",e)}function s(e){rd(i,n,o,a,s,"throw",e)}a(void 0)})}}function od(e,t,r,n,o){return id.apply(this,arguments)}function id(){return(id=nd(function*(e,t,r,n,o){if(t.addQueueMeasurement(yo,n),!e)throw r.info("Navigate url is empty"),Da(zi);return o?ic(cd,wo,r,t,n)(e,o,t,n):oc(ld,bo,r,t,n)(e)})).apply(this,arguments)}function ad(e,t,r,n,o,i,a){return sd.apply(this,arguments)}function sd(){return(sd=nd(function*(e,t,r,n,o,i,a){return n.addQueueMeasurement(Co,i),new Promise((n,i)=>{t<Rs&&o.warning("system.loadFrameTimeout or system.iframeHashTimeout set to lower (".concat(t,"ms) than the default (").concat(Rs,"ms). This may result in timeouts."));var s=window.setTimeout(()=>{window.clearInterval(c),i(Da(ta))},t),c=window.setInterval(()=>{var t="",r=e.contentWindow;try{t=r?r.location.href:""}catch(e){}if(t&&"about:blank"!==t){var o="";r&&(o=a===Pe.QUERY?r.location.search:r.location.hash),window.clearTimeout(s),window.clearInterval(c),n(o)}},r)}).finally(()=>{oc(dd,Zo,o,n,i)(e)})})).apply(this,arguments)}function cd(e,t,r,n){return r.addQueueMeasurement(wo,n),new Promise((r,n)=>{var o=ud();window.setTimeout(()=>{o?(o.src=e,r(o)):n("Unable to load iframe")},t)})}function ld(e){var t=ud();return t.src=e,t}function ud(){var e=document.createElement("iframe");return e.className="msalSilentIframe",e.style.visibility="hidden",e.style.position="absolute",e.style.width=e.style.height="0",e.style.border="0",e.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),document.body.appendChild(e),e}function dd(e){document.body===e.parentNode&&document.body.removeChild(e)}function hd(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function gd(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?hd(Object(r),!0).forEach(function(t){pd(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hd(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function pd(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function md(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function vd(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){md(i,n,o,a,s,"next",e)}function s(e){md(i,n,o,a,s,"throw",e)}a(void 0)})}}class fd extends nu{constructor(e,t,r,n,o,i,a,s,c,l,u){super(e,t,r,n,o,i,s,l,u),this.apiId=a,this.nativeStorage=c}acquireToken(e){var t=this;return vd(function*(){t.performanceClient.addQueueMeasurement(Yn,e.correlationId),e.loginHint||e.sid||e.account&&e.account.username||t.logger.warning("No user hint provided. The authorization server may need more information to complete this request.");var r=gd({},e);r.prompt?r.prompt!==Ee.NONE&&r.prompt!==Ee.NO_SESSION&&(t.logger.warning("SilentIframeClient. Replacing invalid prompt ".concat(r.prompt," with ").concat(Ee.NONE)),r.prompt=Ee.NONE):r.prompt=Ee.NONE;var n=yield ic(t.initializeAuthorizationRequest.bind(t),To,t.logger,t.performanceClient,e.correlationId)(r,li.Silent);As(n.authority);var o,i=t.initializeServerTelemetryManager(t.apiId);try{return o=yield ic(t.createAuthCodeClient.bind(t),ko,t.logger,t.performanceClient,e.correlationId)({serverTelemetryManager:i,requestAuthority:n.authority,requestAzureCloudOptions:n.azureCloudOptions,requestExtraQueryParameters:n.extraQueryParameters,account:n.account}),yield ic(t.silentTokenHelper.bind(t),fo,t.logger,t.performanceClient,e.correlationId)(o,n)}catch(n){if(n instanceof Xe&&(n.setCorrelationId(t.correlationId),i.cacheFailedRequest(n)),!(o&&n instanceof Xe&&n.errorCode===ui))throw n;t.performanceClient.addFields({retryError:n.errorCode},t.correlationId);var a=yield ic(t.initializeAuthorizationRequest.bind(t),To,t.logger,t.performanceClient,e.correlationId)(r,li.Silent);return yield ic(t.silentTokenHelper.bind(t),fo,t.logger,t.performanceClient,t.correlationId)(o,a)}})()}logout(){return Promise.reject(Da(aa))}silentTokenHelper(e,t){var r=this;return vd(function*(){var n=t.correlationId;r.performanceClient.addQueueMeasurement(fo,n);var o=yield ic(r.initializeAuthorizationCodeRequest.bind(r),So,r.logger,r.performanceClient,n)(t),i=yield ic(e.getAuthCodeUrl.bind(e),Ao,r.logger,r.performanceClient,n)(gd(gd({},t),{},{nativeBroker:Lu.isNativeAvailable(r.config,r.logger,r.nativeMessageHandler,t.authenticationScheme)})),a=new Du(e,r.browserStorage,o,r.logger,r.performanceClient),s=yield ic(od,yo,r.logger,r.performanceClient,n)(i,r.performanceClient,r.logger,n,r.config.system.navigateFrameWait),c=r.config.auth.OIDCOptions.serverResponseType,l=yield ic(ad,Co,r.logger,r.performanceClient,n)(s,r.config.system.iframeHashTimeout,r.config.system.pollIntervalMilliseconds,r.performanceClient,r.logger,n,c),u=oc(Uu,Ho,r.logger,r.performanceClient,r.correlationId)(l,c,r.logger);if(u.accountId){if(r.logger.verbose("Account id found in hash, calling WAM for token"),!r.nativeMessageHandler)throw Da(Pa);var d=new Nu(r.config,r.browserStorage,r.browserCrypto,r.logger,r.eventHandler,r.navigationClient,r.apiId,r.performanceClient,r.nativeMessageHandler,u.accountId,r.browserStorage,n),{userRequestState:h}=Ac.parseRequestState(r.browserCrypto,t.state);return ic(d.acquireToken.bind(d),eo,r.logger,r.performanceClient,n)(gd(gd({},t),{},{state:h,prompt:t.prompt||Ee.NONE}))}return ic(a.handleCodeResponse.bind(a),Oo,r.logger,r.performanceClient,n)(u,t)})()}}function yd(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Cd(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?yd(Object(r),!0).forEach(function(t){wd(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yd(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function wd(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function bd(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function kd(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){bd(i,n,o,a,s,"next",e)}function s(e){bd(i,n,o,a,s,"throw",e)}a(void 0)})}}class Id extends nu{acquireToken(e){var t=this;return kd(function*(){t.performanceClient.addQueueMeasurement(Jn,e.correlationId);var r=yield ic(Ql,po,t.logger,t.performanceClient,e.correlationId)(e,t.config,t.performanceClient,t.logger),n=Cd(Cd({},e),r);e.redirectUri&&(n.redirectUri=t.getRedirectUri(e.redirectUri));var o=t.initializeServerTelemetryManager(61),i=yield t.createRefreshTokenClient({serverTelemetryManager:o,authorityUrl:n.authority,azureCloudOptions:n.azureCloudOptions,account:n.account});return ic(i.acquireTokenByRefreshToken.bind(i),so,t.logger,t.performanceClient,e.correlationId)(n).catch(e=>{throw e.setCorrelationId(t.correlationId),o.cacheFailedRequest(e),e})})()}logout(){return Promise.reject(Da(aa))}createRefreshTokenClient(e){var t=this;return kd(function*(){var r=yield ic(t.getClientConfiguration.bind(t),Io,t.logger,t.performanceClient,t.correlationId)({serverTelemetryManager:e.serverTelemetryManager,requestAuthority:e.authorityUrl,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account});return new pu(r,t.performanceClient)})()}}class Td{constructor(e,t,r,n){this.isBrowserEnvironment="undefined"!=typeof window,this.config=e,this.storage=t,this.logger=r,this.cryptoObj=n}loadExternalTokens(e,t,r){if(!this.isBrowserEnvironment)throw Da(pa);var n=e.correlationId||as(),o=t.id_token?Xt(t.id_token,Ks):void 0,i={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},a=e.authority?new pc(pc.generateAuthority(e.authority,e.azureCloudOptions),this.config.system.networkClient,this.storage,i,this.logger,e.correlationId||as()):void 0,s=this.loadAccount(e,r.clientInfo||t.client_info||"",n,o,a),c=this.loadIdToken(t,s.homeAccountId,s.environment,s.realm,n),l=this.loadAccessToken(e,t,s.homeAccountId,s.environment,s.realm,r,n),u=this.loadRefreshToken(t,s.homeAccountId,s.environment,n);return this.generateAuthenticationResult(e,{account:s,idToken:c,accessToken:l,refreshToken:u},o,a)}loadAccount(e,t,r,n,o){if(this.logger.verbose("TokenCache - loading account"),e.account){var i=nn.createFromAccountInfo(e.account);return this.storage.setAccount(i,r),i}if(!o||!t&&!n)throw this.logger.error("TokenCache - if an account is not provided on the request, authority and either clientInfo or idToken must be provided instead."),Da(wa);var a=nn.generateHomeAccountId(t,o.authorityType,this.logger,this.cryptoObj,n),s=null==n?void 0:n.tid,c=Sl(this.storage,o,a,Ks,r,n,t,o.hostnameAndPort,s,void 0,void 0,this.logger);return this.storage.setAccount(c,r),c}loadIdToken(e,t,r,n,o){if(!e.id_token)return this.logger.verbose("TokenCache - no id token found in response"),null;this.logger.verbose("TokenCache - loading id token");var i=rr(t,r,e.id_token,this.config.auth.clientId,n);return this.storage.setIdTokenCredential(i,o),i}loadAccessToken(e,t,r,n,o,i,a){if(!t.access_token)return this.logger.verbose("TokenCache - no access token found in response"),null;if(!t.expires_in)return this.logger.error("TokenCache - no expiration set on the access token. Cannot add it to the cache."),null;if(!(t.scope||e.scopes&&e.scopes.length))return this.logger.error("TokenCache - scopes not specified in the request or response. Cannot add token to the cache."),null;this.logger.verbose("TokenCache - loading access token");var s=t.scope?zr.fromString(t.scope):new zr(e.scopes),c=i.expiresOn||t.expires_in+(new Date).getTime()/1e3,l=i.extendedExpiresOn||(t.ext_expires_in||t.expires_in)+(new Date).getTime()/1e3,u=nr(r,n,t.access_token,this.config.auth.clientId,o,s.printScopes(),c,l,Ks);return this.storage.setAccessTokenCredential(u,a),u}loadRefreshToken(e,t,r,n){if(!e.refresh_token)return this.logger.verbose("TokenCache - no refresh token found in response"),null;this.logger.verbose("TokenCache - loading refresh token");var o=or(t,r,e.refresh_token,this.config.auth.clientId,e.foci,void 0,e.refresh_token_expires_in);return this.storage.setRefreshTokenCredential(o,n),o}generateAuthenticationResult(e,t,r,n){var o,i,a,s,c="",l=[],u=null;null!=t&&t.accessToken&&(c=t.accessToken.secret,l=zr.fromString(t.accessToken.target).asArray(),u=new Date(1e3*Number(t.accessToken.expiresOn)),s=new Date(1e3*Number(t.accessToken.extendedExpiresOn)));var d=t.account;return{authority:n?n.canonicalAuthority:"",uniqueId:t.account.localAccountId,tenantId:t.account.realm,scopes:l,account:d.getAccountInfo(),idToken:(null===(o=t.idToken)||void 0===o?void 0:o.secret)||"",idTokenClaims:r||{},accessToken:c,fromCache:!0,expiresOn:u,correlationId:e.correlationId||"",requestId:"",extExpiresOn:s,familyId:(null===(i=t.refreshToken)||void 0===i?void 0:i.familyId)||"",tokenType:(null==t||null===(a=t.accessToken)||void 0===a?void 0:a.tokenType)||"",state:e.state||"",cloudGraphHostName:d.cloudGraphHostName||"",msGraphHost:d.msGraphHost||"",fromNativeBroker:!1}}}class Sd extends _l{constructor(e){super(e),this.includeRedirectUri=!1}}function Ad(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Ed(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ad(Object(r),!0).forEach(function(t){Od(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ad(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function Od(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Pd(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}class Rd extends nu{constructor(e,t,r,n,o,i,a,s,c,l){super(e,t,r,n,o,i,s,c,l),this.apiId=a}acquireToken(e){var t,r=this;return(t=function*(){if(!e.code)throw Da(ka);var t=yield ic(r.initializeAuthorizationRequest.bind(r),To,r.logger,r.performanceClient,e.correlationId)(e,li.Silent),n=r.initializeServerTelemetryManager(r.apiId);try{var o=Ed(Ed({},t),{},{code:e.code}),i=yield ic(r.getClientConfiguration.bind(r),Io,r.logger,r.performanceClient,e.correlationId)({serverTelemetryManager:n,requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account}),a=new Sd(i);r.logger.verbose("Auth code client created");var s=new Du(a,r.browserStorage,o,r.logger,r.performanceClient);return yield ic(s.handleCodeResponseFromServer.bind(s),Eo,r.logger,r.performanceClient,e.correlationId)({code:e.code,msgraph_host:e.msGraphHost,cloud_graph_host_name:e.cloudGraphHostName,cloud_instance_host_name:e.cloudInstanceHostName},t,!1)}catch(e){throw e instanceof Xe&&(e.setCorrelationId(r.correlationId),n.cacheFailedRequest(e)),e}},function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function a(e){Pd(i,n,o,a,s,"next",e)}function s(e){Pd(i,n,o,a,s,"throw",e)}a(void 0)})})()}logout(){return Promise.reject(Da(aa))}}function _d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Md(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_d(Object(r),!0).forEach(function(t){Nd(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_d(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function Nd(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function xd(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function qd(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){xd(i,n,o,a,s,"next",e)}function s(e){xd(i,n,o,a,s,"throw",e)}a(void 0)})}}function Ld(e){var t=null==e?void 0:e.idTokenClaims;return null!=t&&t.tfp||null!=t&&t.acr?"B2C":null!=t&&t.tid?"9188040d-6c67-4c5b-b112-36a304b66dad"===(null==t?void 0:t.tid)?"MSA":"AAD":void 0}function Hd(e,t){try{Ts(e)}catch(e){throw t.end({success:!1},e),e}}class jd{constructor(e){var t,r;this.operatingContext=e,this.isBrowserEnvironment=this.operatingContext.isBrowserEnvironment(),this.config=e.getConfig(),this.initialized=!1,this.logger=this.operatingContext.getLogger(),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.config.telemetry.client,this.browserCrypto=this.isBrowserEnvironment?new rc(this.logger,this.performanceClient):Qt,this.eventHandler=new Jc(this.logger),this.browserStorage=this.isBrowserEnvironment?new qc(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,function(e){var t=e.cloudDiscoveryMetadata,r=void 0;if(t)try{r=JSON.parse(t)}catch(e){throw Fr(Rr)}return{canonicalAuthority:e.authority?mc(e.authority):void 0,knownAuthorities:e.knownAuthorities,cloudDiscoveryMetadata:r}}(this.config.auth),this.performanceClient):(t=this.config.auth.clientId,r=this.logger,new qc(t,{cacheLocation:Ci,temporaryCacheLocation:Ci,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1},Qt,r));var n={cacheLocation:Ci,temporaryCacheLocation:Ci,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};this.nativeInternalStorage=new qc(this.config.auth.clientId,n,this.browserCrypto,this.logger,void 0,this.performanceClient),this.tokenCache=new Td(this.config,this.browserStorage,this.logger,this.browserCrypto),this.activeSilentTokenRequests=new Map,this.trackPageVisibility=this.trackPageVisibility.bind(this),this.trackPageVisibilityWithMeasurement=this.trackPageVisibilityWithMeasurement.bind(this),this.listeningToStorageEvents=!1,this.handleAccountCacheChange=this.handleAccountCacheChange.bind(this)}static createController(e,t){return qd(function*(){var r=new jd(e);return yield r.initialize(t),r})()}trackPageVisibility(e){e&&(this.logger.info("Perf: Visibility change detected"),this.performanceClient.incrementFields({visibilityChangeCount:1},e))}initialize(e){var t=this;return qd(function*(){if(t.logger.trace("initialize called"),t.initialized)t.logger.info("initialize has already been called, exiting early.");else{if(!t.isBrowserEnvironment)return t.logger.info("in non-browser environment, exiting early."),t.initialized=!0,void t.eventHandler.emitEvent(Lc);var r=(null==e?void 0:e.correlationId)||t.getRequestCorrelationId(),n=t.config.system.allowNativeBroker,o=t.performanceClient.startMeasurement(vo,r);if(t.eventHandler.emitEvent("msal:initializeStart"),n)try{t.nativeExtensionProvider=yield Lu.createProvider(t.logger,t.config.system.nativeBrokerHandshakeTimeout,t.performanceClient)}catch(e){t.logger.verbose(e)}t.config.cache.claimsBasedCachingEnabled||(t.logger.verbose("Claims-based caching is disabled. Clearing the previous cache with claims"),yield ic(t.browserStorage.clearTokensAndKeysWithClaims.bind(t.browserStorage),$o,t.logger,t.performanceClient,r)(t.performanceClient,r)),t.initialized=!0,t.eventHandler.emitEvent(Lc),o.end({allowNativeBroker:n,success:!0})}})()}handleRedirectPromise(e){var t=this;return qd(function*(){if(t.logger.verbose("handleRedirectPromise called"),Is(t.initialized),t.isBrowserEnvironment){var r=e||"",n=t.redirectResponse.get(r);return void 0===n?(n=t.handleRedirectPromiseInternal(e),t.redirectResponse.set(r,n),t.logger.verbose("handleRedirectPromise has been called for the first time, storing the promise")):t.logger.verbose("handleRedirectPromise has been called previously, returning the result from the first call"),n}return t.logger.verbose("handleRedirectPromise returns null, not browser environment"),null})()}handleRedirectPromiseInternal(e){var t=this;return qd(function*(){var r,n=t.getAllAccounts(),o=t.browserStorage.getCachedNativeRequest(),i=o&&Lu.isNativeAvailable(t.config,t.logger,t.nativeExtensionProvider)&&t.nativeExtensionProvider&&!e,a=i?null==o?void 0:o.correlationId:t.browserStorage.getTemporaryCache(Ai,!0)||"",s=t.performanceClient.startMeasurement(Gn,a);if(t.eventHandler.emitEvent("msal:handleRedirectStart",li.Redirect),i&&t.nativeExtensionProvider){t.logger.trace("handleRedirectPromise - acquiring token from native platform");var c=new Nu(t.config,t.browserStorage,t.browserCrypto,t.logger,t.eventHandler,t.navigationClient,865,t.performanceClient,t.nativeExtensionProvider,o.accountId,t.nativeInternalStorage,o.correlationId);r=ic(c.handleRedirectPromise.bind(c),Jo,t.logger,t.performanceClient,s.event.correlationId)(t.performanceClient,s.event.correlationId)}else{t.logger.trace("handleRedirectPromise - acquiring token from web flow");var l=t.createRedirectClient(a);r=ic(l.handleRedirectPromise.bind(l),Yo,t.logger,t.performanceClient,s.event.correlationId)(e,s)}return r.then(e=>(e?(n.length<t.getAllAccounts().length?(t.eventHandler.emitEvent(jc,li.Redirect,e),t.logger.verbose("handleRedirectResponse returned result, login success")):(t.eventHandler.emitEvent(Bc,li.Redirect,e),t.logger.verbose("handleRedirectResponse returned result, acquire token success")),s.end({success:!0,accountType:Ld(e.account)})):s.event.errorCode?s.end({success:!1}):s.discard(),t.eventHandler.emitEvent(zc,li.Redirect),e)).catch(e=>{var r=e;throw n.length>0?t.eventHandler.emitEvent(Fc,li.Redirect,null,r):t.eventHandler.emitEvent(Dc,li.Redirect,null,r),t.eventHandler.emitEvent(zc,li.Redirect),s.end({success:!1},r),e})})()}acquireTokenRedirect(e){var t=this;return qd(function*(){var r=t.getRequestCorrelationId(e);t.logger.verbose("acquireTokenRedirect called",r);var n=t.performanceClient.startMeasurement("acquireTokenPreRedirect",r);n.add({accountType:Ld(e.account),scenarioId:e.scenarioId});var o=e.onRedirectNavigate;if(o)e.onRedirectNavigate=e=>{var t="function"==typeof o?o(e):void 0;return!1!==t?n.end({success:!0}):n.discard(),t};else{var i=t.config.auth.onRedirectNavigate;t.config.auth.onRedirectNavigate=e=>{var t="function"==typeof i?i(e):void 0;return!1!==t?n.end({success:!0}):n.discard(),t}}var a=t.getAllAccounts().length>0;try{var s;return Ss(t.initialized,t.config),t.browserStorage.setInteractionInProgress(!0),a?t.eventHandler.emitEvent(Uc,li.Redirect,e):t.eventHandler.emitEvent(Hc,li.Redirect,e),s=t.nativeExtensionProvider&&t.canUseNative(e)?new Nu(t.config,t.browserStorage,t.browserCrypto,t.logger,t.eventHandler,t.navigationClient,Ni,t.performanceClient,t.nativeExtensionProvider,t.getNativeAccountId(e),t.nativeInternalStorage,r).acquireTokenRedirect(e,n).catch(n=>{if(n instanceof au&&su(n))return t.nativeExtensionProvider=void 0,t.createRedirectClient(r).acquireToken(e);if(n instanceof Ic)return t.logger.verbose("acquireTokenRedirect - Resolving interaction required error thrown by native broker by falling back to web flow"),t.createRedirectClient(r).acquireToken(e);throw t.browserStorage.setInteractionInProgress(!1),n}):t.createRedirectClient(r).acquireToken(e),yield s}catch(e){throw n.end({success:!1},e),a?t.eventHandler.emitEvent(Fc,li.Redirect,null,e):t.eventHandler.emitEvent(Dc,li.Redirect,null,e),e}})()}acquireTokenPopup(e){var t=this.getRequestCorrelationId(e),r=this.performanceClient.startMeasurement(zn,t);r.add({scenarioId:e.scenarioId,accountType:Ld(e.account)});try{this.logger.verbose("acquireTokenPopup called",t),Hd(this.initialized,r),this.browserStorage.setInteractionInProgress(!0)}catch(e){return Promise.reject(e)}var n=this.getAllAccounts();return n.length>0?this.eventHandler.emitEvent(Uc,li.Popup,e):this.eventHandler.emitEvent(Hc,li.Popup,e),(this.canUseNative(e)?this.acquireTokenNative(Md(Md({},e),{},{correlationId:t}),xi).then(e=>(this.browserStorage.setInteractionInProgress(!1),r.end({success:!0,isNativeBroker:!0,accountType:Ld(e.account)}),e)).catch(r=>{if(r instanceof au&&su(r))return this.nativeExtensionProvider=void 0,this.createPopupClient(t).acquireToken(e);if(r instanceof Ic)return this.logger.verbose("acquireTokenPopup - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createPopupClient(t).acquireToken(e);throw this.browserStorage.setInteractionInProgress(!1),r}):this.createPopupClient(t).acquireToken(e)).then(e=>(n.length<this.getAllAccounts().length?this.eventHandler.emitEvent(jc,li.Popup,e):this.eventHandler.emitEvent(Bc,li.Popup,e),r.end({success:!0,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length,accountType:Ld(e.account)}),e)).catch(e=>(n.length>0?this.eventHandler.emitEvent(Fc,li.Popup,null,e):this.eventHandler.emitEvent(Dc,li.Popup,null,e),r.end({success:!1},e),Promise.reject(e)))}trackPageVisibilityWithMeasurement(){var e=this.ssoSilentMeasurement||this.acquireTokenByCodeAsyncMeasurement;e&&(this.logger.info("Perf: Visibility change detected in ",e.event.name),e.increment({visibilityChangeCount:1}))}ssoSilent(e){var t=this;return qd(function*(){var r,n,o=t.getRequestCorrelationId(e),i=Md(Md({},e),{},{prompt:e.prompt,correlationId:o});return t.ssoSilentMeasurement=t.performanceClient.startMeasurement(Xn,o),null===(r=t.ssoSilentMeasurement)||void 0===r||r.add({scenarioId:e.scenarioId,accountType:Ld(e.account)}),Hd(t.initialized,t.ssoSilentMeasurement),null===(n=t.ssoSilentMeasurement)||void 0===n||n.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",t.trackPageVisibilityWithMeasurement),t.logger.verbose("ssoSilent called",o),t.eventHandler.emitEvent("msal:ssoSilentStart",li.Silent,i),(t.canUseNative(i)?t.acquireTokenNative(i,863).catch(e=>{if(e instanceof au&&su(e))return t.nativeExtensionProvider=void 0,t.createSilentIframeClient(i.correlationId).acquireToken(i);throw e}):t.createSilentIframeClient(i.correlationId).acquireToken(i)).then(e=>{var r;return t.eventHandler.emitEvent("msal:ssoSilentSuccess",li.Silent,e),null===(r=t.ssoSilentMeasurement)||void 0===r||r.end({success:!0,isNativeBroker:e.fromNativeBroker,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length,accountType:Ld(e.account)}),e}).catch(e=>{var r;throw t.eventHandler.emitEvent("msal:ssoSilentFailure",li.Silent,null,e),null===(r=t.ssoSilentMeasurement)||void 0===r||r.end({success:!1},e),e}).finally(()=>{document.removeEventListener("visibilitychange",t.trackPageVisibilityWithMeasurement)})})()}acquireTokenByCode(e){var t=this;return qd(function*(){var r=t.getRequestCorrelationId(e);t.logger.trace("acquireTokenByCode called",r);var n=t.performanceClient.startMeasurement(Un,r);Hd(t.initialized,n),t.eventHandler.emitEvent("msal:acquireTokenByCodeStart",li.Silent,e),n.add({scenarioId:e.scenarioId});try{if(e.code&&e.nativeAccountId)throw Da(Ta);if(e.code){var o=e.code,i=t.hybridAuthCodeResponses.get(o);return i?(t.logger.verbose("Existing acquireTokenByCode request found",r),n.discard()):(t.logger.verbose("Initiating new acquireTokenByCode request",r),i=t.acquireTokenByCodeAsync(Md(Md({},e),{},{correlationId:r})).then(e=>(t.eventHandler.emitEvent("msal:acquireTokenByCodeSuccess",li.Silent,e),t.hybridAuthCodeResponses.delete(o),n.end({success:!0,isNativeBroker:e.fromNativeBroker,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length,accountType:Ld(e.account)}),e)).catch(e=>{throw t.hybridAuthCodeResponses.delete(o),t.eventHandler.emitEvent(Kc,li.Silent,null,e),n.end({success:!1},e),e}),t.hybridAuthCodeResponses.set(o,i)),yield i}if(e.nativeAccountId){if(t.canUseNative(e,e.nativeAccountId)){var a=yield t.acquireTokenNative(Md(Md({},e),{},{correlationId:r}),866,e.nativeAccountId).catch(e=>{throw e instanceof au&&su(e)&&(t.nativeExtensionProvider=void 0),e});return n.end({accountType:Ld(a.account),success:!0}),a}throw Da(Aa)}throw Da(Ia)}catch(e){throw t.eventHandler.emitEvent(Kc,li.Silent,null,e),n.end({success:!1},e),e}})()}acquireTokenByCodeAsync(e){var t=this;return qd(function*(){var r;t.logger.trace("acquireTokenByCodeAsync called",e.correlationId),t.acquireTokenByCodeAsyncMeasurement=t.performanceClient.startMeasurement(Qo,e.correlationId),null===(r=t.acquireTokenByCodeAsyncMeasurement)||void 0===r||r.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",t.trackPageVisibilityWithMeasurement);var n=t.createSilentAuthCodeClient(e.correlationId);return yield n.acquireToken(e).then(e=>{var r;return null===(r=t.acquireTokenByCodeAsyncMeasurement)||void 0===r||r.end({success:!0,fromCache:e.fromCache,isNativeBroker:e.fromNativeBroker}),e}).catch(e=>{var r;throw null===(r=t.acquireTokenByCodeAsyncMeasurement)||void 0===r||r.end({success:!1},e),e}).finally(()=>{document.removeEventListener("visibilitychange",t.trackPageVisibilityWithMeasurement)})})()}acquireTokenFromCache(e,t){var r=this;return qd(function*(){switch(r.performanceClient.addQueueMeasurement(lo,e.correlationId),t){case 0:case 1:case 2:var n=r.createSilentCacheClient(e.correlationId);return ic(n.acquireToken.bind(n),Qn,r.logger,r.performanceClient,e.correlationId)(e);default:throw Gt(_t)}})()}acquireTokenByRefreshToken(e,t){var r=this;return qd(function*(){switch(r.performanceClient.addQueueMeasurement(Bn,e.correlationId),t){case 0:case 2:case 3:case 4:var n=r.createSilentRefreshClient(e.correlationId);return ic(n.acquireToken.bind(n),Jn,r.logger,r.performanceClient,e.correlationId)(e);default:throw Gt(_t)}})()}acquireTokenBySilentIframe(e){var t=this;return qd(function*(){t.performanceClient.addQueueMeasurement(go,e.correlationId);var r=t.createSilentIframeClient(e.correlationId);return ic(r.acquireToken.bind(r),Yn,t.logger,t.performanceClient,e.correlationId)(e)})()}logout(e){var t=this;return qd(function*(){var r=t.getRequestCorrelationId(e);return t.logger.warning("logout API is deprecated and will be removed in msal-browser v3.0.0. Use logoutRedirect instead.",r),t.logoutRedirect(Md({correlationId:r},e))})()}logoutRedirect(e){var t=this;return qd(function*(){var r=t.getRequestCorrelationId(e);return Ss(t.initialized,t.config),t.browserStorage.setInteractionInProgress(!0),t.createRedirectClient(r).logout(e)})()}logoutPopup(e){try{var t=this.getRequestCorrelationId(e);return Ts(this.initialized),this.browserStorage.setInteractionInProgress(!0),this.createPopupClient(t).logout(e)}catch(e){return Promise.reject(e)}}clearCache(e){var t=this;return qd(function*(){if(t.isBrowserEnvironment){var r=t.getRequestCorrelationId(e);return t.createSilentCacheClient(r).logout(e)}t.logger.info("in non-browser environment, returning early.")})()}getAllAccounts(e){var t=this.getRequestCorrelationId();return function(e,t,r,n,o){return e.verbose("getAllAccounts called"),r?t.getAllAccounts(n,o):[]}(this.logger,this.browserStorage,this.isBrowserEnvironment,t,e)}getAccount(e){var t=this.getRequestCorrelationId();return function(e,t,r,n){if(t.trace("getAccount called"),0===Object.keys(e).length)return t.warning("getAccount: No accountFilter provided"),null;var o=r.getAccountInfoFilteredBy(e,n);return o?(t.verbose("getAccount: Account matching provided filter found, returning"),o):(t.verbose("getAccount: No matching account found, returning null"),null)}(e,this.logger,this.browserStorage,t)}getAccountByUsername(e){var t=this.getRequestCorrelationId();return function(e,t,r,n){if(t.trace("getAccountByUsername called"),!e)return t.warning("getAccountByUsername: No username provided"),null;var o=r.getAccountInfoFilteredBy({username:e},n);return o?(t.verbose("getAccountByUsername: Account matching username found, returning"),t.verbosePii("getAccountByUsername: Returning signed-in accounts matching username: ".concat(e)),o):(t.verbose("getAccountByUsername: No matching account found, returning null"),null)}(e,this.logger,this.browserStorage,t)}getAccountByHomeId(e){var t=this.getRequestCorrelationId();return function(e,t,r,n){if(t.trace("getAccountByHomeId called"),!e)return t.warning("getAccountByHomeId: No homeAccountId provided"),null;var o=r.getAccountInfoFilteredBy({homeAccountId:e},n);return o?(t.verbose("getAccountByHomeId: Account matching homeAccountId found, returning"),t.verbosePii("getAccountByHomeId: Returning signed-in accounts matching homeAccountId: ".concat(e)),o):(t.verbose("getAccountByHomeId: No matching account found, returning null"),null)}(e,this.logger,this.browserStorage,t)}getAccountByLocalId(e){var t=this.getRequestCorrelationId();return function(e,t,r,n){if(t.trace("getAccountByLocalId called"),!e)return t.warning("getAccountByLocalId: No localAccountId provided"),null;var o=r.getAccountInfoFilteredBy({localAccountId:e},n);return o?(t.verbose("getAccountByLocalId: Account matching localAccountId found, returning"),t.verbosePii("getAccountByLocalId: Returning signed-in accounts matching localAccountId: ".concat(e)),o):(t.verbose("getAccountByLocalId: No matching account found, returning null"),null)}(e,this.logger,this.browserStorage,t)}setActiveAccount(e){var t=this.getRequestCorrelationId();!function(e,t,r){t.setActiveAccount(e,r)}(e,this.browserStorage,t)}getActiveAccount(){var e=this.getRequestCorrelationId();return function(e,t){return e.getActiveAccount(t)}(this.browserStorage,e)}hydrateCache(e,t){var r=this;return qd(function*(){r.logger.verbose("hydrateCache called");var n=nn.createFromAccountInfo(e.account,e.cloudGraphHostName,e.msGraphHost);return r.browserStorage.setAccount(n,e.correlationId),e.fromNativeBroker?(r.logger.verbose("Response was from native broker, storing in-memory"),r.nativeInternalStorage.hydrateCache(e,t)):r.browserStorage.hydrateCache(e,t)})()}acquireTokenNative(e,t,r){var n=this;return qd(function*(){if(n.logger.trace("acquireTokenNative called"),!n.nativeExtensionProvider)throw Da(Pa);return new Nu(n.config,n.browserStorage,n.browserCrypto,n.logger,n.eventHandler,n.navigationClient,t,n.performanceClient,n.nativeExtensionProvider,r||n.getNativeAccountId(e),n.nativeInternalStorage,e.correlationId).acquireToken(e)})()}canUseNative(e,t){if(this.logger.trace("canUseNative called"),!Lu.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme))return this.logger.trace("canUseNative: isNativeAvailable returned false, returning false"),!1;if(e.prompt)switch(e.prompt){case Ee.NONE:case Ee.CONSENT:case Ee.LOGIN:this.logger.trace("canUseNative: prompt is compatible with native flow");break;default:return this.logger.trace("canUseNative: prompt = ".concat(e.prompt," is not compatible with native flow, returning false")),!1}return!(!t&&!this.getNativeAccountId(e)&&(this.logger.trace("canUseNative: nativeAccountId is not available, returning false"),1))}getNativeAccountId(e){var t=e.account||this.getAccount({loginHint:e.loginHint,sid:e.sid})||this.getActiveAccount();return t&&t.nativeAccountId||""}createPopupClient(e){return new Vu(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createRedirectClient(e){return new td(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentIframeClient(e){return new fd(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,863,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentCacheClient(e){return new ku(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentRefreshClient(e){return new Id(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentAuthCodeClient(e){return new Rd(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,866,this.performanceClient,this.nativeExtensionProvider,e)}addEventCallback(e,t){return this.eventHandler.addEventCallback(e,t)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){return ks(),this.performanceClient.addPerformanceCallback(e)}removePerformanceCallback(e){return this.performanceClient.removePerformanceCallback(e)}enableAccountStorageEvents(){"undefined"!=typeof window&&(this.listeningToStorageEvents?this.logger.verbose("Account storage listener already registered."):(this.logger.verbose("Adding account storage listener."),this.listeningToStorageEvents=!0,window.addEventListener("storage",this.handleAccountCacheChange)))}disableAccountStorageEvents(){"undefined"!=typeof window&&(this.listeningToStorageEvents?(this.logger.verbose("Removing account storage listener."),window.removeEventListener("storage",this.handleAccountCacheChange),this.listeningToStorageEvents=!1):this.logger.verbose("No account storage listener registered."))}handleAccountCacheChange(e){try{var t;null!==(t=e.key)&&void 0!==t&&t.includes(ke)&&this.eventHandler.emitEvent("msal:activeAccountChanged");var r=e.newValue||e.oldValue;if(!r)return;var n=JSON.parse(r);if("object"!=typeof n||!nn.isAccountEntity(n))return;var o=In.toObject(new nn,n).getAccountInfo();!e.oldValue&&e.newValue?(this.logger.info("Account was added to cache in a different window"),this.eventHandler.emitEvent("msal:accountAdded",void 0,o)):!e.newValue&&e.oldValue&&(this.logger.info("Account was removed from cache in a different window"),this.eventHandler.emitEvent("msal:accountRemoved",void 0,o))}catch(e){return}}getTokenCache(){return this.tokenCache}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){this.browserStorage.setWrapperMetadata(e,t)}setNavigationClient(e){this.navigationClient=e}getConfiguration(){return this.config}getPerformanceClient(){return this.performanceClient}isBrowserEnv(){return this.isBrowserEnvironment}getRequestCorrelationId(e){return null!=e&&e.correlationId?e.correlationId:this.isBrowserEnvironment?as():ce.EMPTY_STRING}loginRedirect(e){var t=this;return qd(function*(){var r=t.getRequestCorrelationId(e);return t.logger.verbose("loginRedirect called",r),t.acquireTokenRedirect(Md({correlationId:r},e||qi))})()}loginPopup(e){var t=this.getRequestCorrelationId(e);return this.logger.verbose("loginPopup called",t),this.acquireTokenPopup(Md({correlationId:t},e||qi))}acquireTokenSilent(e){var t=this;return qd(function*(){var r=t.getRequestCorrelationId(e),n=t.performanceClient.startMeasurement(Fn,r);n.add({cacheLookupPolicy:e.cacheLookupPolicy,scenarioId:e.scenarioId}),Hd(t.initialized,n),t.logger.verbose("acquireTokenSilent called",r);var o=e.account||t.getActiveAccount();if(!o)throw Da(sa);n.add({accountType:Ld(o)});var i={clientId:t.config.auth.clientId,authority:e.authority||ce.EMPTY_STRING,scopes:e.scopes,homeAccountIdentifier:o.homeAccountId,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid,shrOptions:e.shrOptions},a=JSON.stringify(i),s=t.activeSilentTokenRequests.get(a);if(void 0===s){t.logger.verbose("acquireTokenSilent called for the first time, storing active request",r);var c=ic(t.acquireTokenSilentAsync.bind(t),Kn,t.logger,t.performanceClient,r)(Md(Md({},e),{},{correlationId:r}),o).then(r=>(t.activeSilentTokenRequests.delete(a),n.end({success:!0,fromCache:r.fromCache,isNativeBroker:r.fromNativeBroker,cacheLookupPolicy:e.cacheLookupPolicy,accessTokenSize:r.accessToken.length,idTokenSize:r.idToken.length}),r)).catch(e=>{throw t.activeSilentTokenRequests.delete(a),n.end({success:!1},e),e});return t.activeSilentTokenRequests.set(a,c),Md(Md({},yield c),{},{state:e.state})}return t.logger.verbose("acquireTokenSilent has been called previously, returning the result from the first call",r),n.discard(),Md(Md({},yield s),{},{state:e.state})})()}acquireTokenSilentAsync(e,t){var r=this;return qd(function*(){var n=()=>r.trackPageVisibility(e.correlationId);r.performanceClient.addQueueMeasurement(Kn,e.correlationId),r.eventHandler.emitEvent(Uc,li.Silent,e),e.correlationId&&r.performanceClient.incrementFields({visibilityChangeCount:0},e.correlationId),document.addEventListener("visibilitychange",n);var o=yield ic(Jl,mo,r.logger,r.performanceClient,e.correlationId)(e,t,r.config,r.performanceClient,r.logger),i=e.cacheLookupPolicy||0,a=r.acquireTokenSilentNoIframe(o,i).catch(function(){var e=qd(function*(e){var t=function(e,t){var r=!(e instanceof Ic&&e.subError!==Cc),n=e.errorCode===ui||e.errorCode===_t,o=r&&n||e.errorCode===vc||e.errorCode===yc,i=ji.includes(t);return o&&i}(e,i);if(t){if(r.activeIframeRequest){if(5!==i){var[n,a]=r.activeIframeRequest;r.logger.verbose("Iframe request is already in progress, awaiting resolution for request with correlationId: ".concat(a),o.correlationId);var s=r.performanceClient.startMeasurement("awaitConcurrentIframe",o.correlationId);s.add({awaitIframeCorrelationId:a});var c=yield n;if(s.end({success:c}),c)return r.logger.verbose("Parallel iframe request with correlationId: ".concat(a," succeeded. Retrying cache and/or RT redemption"),o.correlationId),r.acquireTokenSilentNoIframe(o,i);throw r.logger.info("Iframe request with correlationId: ".concat(a," failed. Interaction is required.")),e}return r.logger.warning("Another iframe request is currently in progress and CacheLookupPolicy is set to Skip. This may result in degraded performance and/or reliability for both calls. Please consider changing the CacheLookupPolicy to take advantage of request queuing and token cache.",o.correlationId),ic(r.acquireTokenBySilentIframe.bind(r),go,r.logger,r.performanceClient,o.correlationId)(o)}var l;return r.activeIframeRequest=[new Promise(e=>{l=e}),o.correlationId],r.logger.verbose("Refresh token expired/invalid or CacheLookupPolicy is set to Skip, attempting acquire token by iframe.",o.correlationId),ic(r.acquireTokenBySilentIframe.bind(r),go,r.logger,r.performanceClient,o.correlationId)(o).then(e=>(l(!0),e)).catch(e=>{throw l(!1),e}).finally(()=>{r.activeIframeRequest=void 0})}throw e});return function(t){return e.apply(this,arguments)}}());return a.then(t=>(r.eventHandler.emitEvent(Bc,li.Silent,t),e.correlationId&&r.performanceClient.addFields({fromCache:t.fromCache,isNativeBroker:t.fromNativeBroker},e.correlationId),t)).catch(e=>{throw r.eventHandler.emitEvent(Fc,li.Silent,null,e),e}).finally(()=>{document.removeEventListener("visibilitychange",n)})})()}acquireTokenSilentNoIframe(e,t){var r=this;return qd(function*(){return Lu.isNativeAvailable(r.config,r.logger,r.nativeExtensionProvider,e.authenticationScheme)&&e.account.nativeAccountId?(r.logger.verbose("acquireTokenSilent - attempting to acquire token from native platform"),r.acquireTokenNative(e,61).catch(function(){var e=qd(function*(e){if(e instanceof au&&su(e))throw r.logger.verbose("acquireTokenSilent - native platform unavailable, falling back to web flow"),r.nativeExtensionProvider=void 0,Gt(_t);throw e});return function(t){return e.apply(this,arguments)}}())):(r.logger.verbose("acquireTokenSilent - attempting to acquire token from web flow"),ic(r.acquireTokenFromCache.bind(r),lo,r.logger,r.performanceClient,e.correlationId)(e,t).catch(n=>{if(1===t)throw n;return r.eventHandler.emitEvent("msal:acquireTokenFromNetworkStart",li.Silent,e),ic(r.acquireTokenByRefreshToken.bind(r),Bn,r.logger,r.performanceClient,e.correlationId)(e,t)}))})()}}function Dd(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function Ud(){return(e=function*(e,t){var r=new Ls(e);return yield r.initialize(),jd.createController(r,t)},Ud=function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){Dd(i,n,o,a,s,"next",e)}function s(e){Dd(i,n,o,a,s,"throw",e)}a(void 0)})}).apply(this,arguments);var e}function Bd(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function Fd(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){Bd(i,n,o,a,s,"next",e)}function s(e){Bd(i,n,o,a,s,"throw",e)}a(void 0)})}}class Kd{static createPublicClientApplication(e){return Fd(function*(){var t=yield function(e,t){return Ud.apply(this,arguments)}(e);return new Kd(e,t)})()}constructor(e,t){this.controller=t||new jd(new Ls(e))}initialize(e){var t=this;return Fd(function*(){return t.controller.initialize(e)})()}acquireTokenPopup(e){var t=this;return Fd(function*(){return t.controller.acquireTokenPopup(e)})()}acquireTokenRedirect(e){return this.controller.acquireTokenRedirect(e)}acquireTokenSilent(e){return this.controller.acquireTokenSilent(e)}acquireTokenByCode(e){return this.controller.acquireTokenByCode(e)}addEventCallback(e,t){return this.controller.addEventCallback(e,t)}removeEventCallback(e){return this.controller.removeEventCallback(e)}addPerformanceCallback(e){return this.controller.addPerformanceCallback(e)}removePerformanceCallback(e){return this.controller.removePerformanceCallback(e)}enableAccountStorageEvents(){this.controller.enableAccountStorageEvents()}disableAccountStorageEvents(){this.controller.disableAccountStorageEvents()}getAccount(e){return this.controller.getAccount(e)}getAccountByHomeId(e){return this.controller.getAccountByHomeId(e)}getAccountByLocalId(e){return this.controller.getAccountByLocalId(e)}getAccountByUsername(e){return this.controller.getAccountByUsername(e)}getAllAccounts(e){return this.controller.getAllAccounts(e)}handleRedirectPromise(e){return this.controller.handleRedirectPromise(e)}loginPopup(e){return this.controller.loginPopup(e)}loginRedirect(e){return this.controller.loginRedirect(e)}logout(e){return this.controller.logout(e)}logoutRedirect(e){return this.controller.logoutRedirect(e)}logoutPopup(e){return this.controller.logoutPopup(e)}ssoSilent(e){return this.controller.ssoSilent(e)}getTokenCache(){return this.controller.getTokenCache()}getLogger(){return this.controller.getLogger()}setLogger(e){this.controller.setLogger(e)}setActiveAccount(e){this.controller.setActiveAccount(e)}getActiveAccount(){return this.controller.getActiveAccount()}initializeWrapperLibrary(e,t){return this.controller.initializeWrapperLibrary(e,t)}setNavigationClient(e){this.controller.setNavigationClient(e)}getConfiguration(){return this.controller.getConfiguration()}hydrateCache(e,t){var r=this;return Fd(function*(){return r.controller.hydrateCache(e,t)})()}clearCache(e){return this.controller.clearCache(e)}}var zd="170c98e1-d486-4355-bcbe-170454e0207c",Gd="a221a95e-6abc-4434-aecc-e48338a1b2f2",Vd="https://spaarkedev1.crm.dynamics.com",Wd={auth:{clientId:zd,authority:"https://login.microsoftonline.com/".concat(Gd),redirectUri:Vd,navigateToLoginRequestUrl:!1},cache:{cacheLocation:"sessionStorage",storeAuthStateInCookie:!1},system:{loggerOptions:{loggerCallback:(e,t,r)=>{if(!r)switch(e){case se.Error:console.error("[MSAL] ".concat(t));break;case se.Warning:console.warn("[MSAL] ".concat(t));break;case se.Info:console.info("[MSAL] ".concat(t));break;case se.Verbose:console.debug("[MSAL] ".concat(t))}},logLevel:se.Warning}}},Qd={scopes:["api://1e40baad-e065-4aea-a8d4-4b7ab273458c/user_impersonation"],loginHint:void 0},Yd=function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,s)}c((n=n.apply(e,t||[])).next())})};class Jd{constructor(){this.msalInstance=null,this.currentAccount=null,this.isInitialized=!1}static getInstance(){return Jd.instance||(Jd.instance=new Jd),Jd.instance}initialize(){return Yd(this,void 0,void 0,function*(){if(this.isInitialized)console.warn("[MsalAuthProvider] Already initialized, skipping");else{console.info("[MsalAuthProvider] Initializing MSAL...");try{!function(){var e=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;if(!e.test(zd))throw new Error('[MSAL Config] Invalid CLIENT_ID: "'.concat(zd,'"'));if(!e.test(Gd))throw new Error('[MSAL Config] Invalid TENANT_ID: "'.concat(Gd,'"'));if(!Vd.startsWith("https://")||!Vd.includes(".dynamics.com"))throw new Error('[MSAL Config] Invalid REDIRECT_URI: "'.concat(Vd,'"'));console.info("[MSAL Config] Configuration validation passed")}(),this.msalInstance=new Kd(Wd),yield this.msalInstance.initialize();var e=yield this.msalInstance.handleRedirectPromise();if(e&&(this.currentAccount=e.account),!this.currentAccount){var t=this.msalInstance.getAllAccounts();t.length>0&&(this.currentAccount=t[0],console.info("[MsalAuthProvider] Active account found: ".concat(this.currentAccount.username)))}this.isInitialized=!0,console.info("[MsalAuthProvider] Initialization complete")}catch(e){throw console.error("[MsalAuthProvider] Initialization failed",e),new Error("MSAL initialization failed: ".concat(e instanceof Error?e.message:String(e)))}}})}isAuthenticated(){return null!==this.currentAccount}getAccessToken(e){return Yd(this,void 0,void 0,function*(){var t=null!=e?e:Qd.scopes;return this.getToken(t)})}getToken(e){return Yd(this,void 0,void 0,function*(){if(!this.isInitialized||!this.msalInstance)throw new Error("MSAL not initialized. Call initialize() first.");if(!e||0===e.length)throw new Error("Scopes parameter is required and must not be empty.");var t=this.getCachedToken(e);if(t)return t;console.info("[MsalAuthProvider] Acquiring token for scopes: ".concat(e.join(", ")));try{var r=yield this.acquireTokenSilent(e);return console.info("[MsalAuthProvider] Token acquired successfully via silent flow"),r.expiresOn&&this.setCachedToken(r.accessToken,r.expiresOn,e),r.accessToken}catch(t){if(t instanceof Ic){console.warn("[MsalAuthProvider] Silent token acquisition failed, falling back to popup...");try{var n=yield this.acquireTokenPopup(e);return console.info("[MsalAuthProvider] Token acquired successfully via popup"),n.expiresOn&&this.setCachedToken(n.accessToken,n.expiresOn,e),n.accessToken}catch(e){throw console.error("[MsalAuthProvider] Popup token acquisition failed",e),new Error("Failed to acquire token via popup: ".concat(e instanceof Error?e.message:"Unknown error"))}}throw console.error("[MsalAuthProvider] Token acquisition failed",t),new Error("Failed to acquire token: ".concat(t instanceof Error?t.message:"Unknown error"))}})}clearCache(){console.info("[MsalAuthProvider] Clearing token cache");try{for(var e=[],t=0;t<sessionStorage.length;t++){var r=sessionStorage.key(t);(null==r?void 0:r.startsWith(Jd.CACHE_KEY_PREFIX))&&e.push(r)}e.forEach(e=>sessionStorage.removeItem(e))}catch(e){console.warn("[MsalAuthProvider] Failed to clear sessionStorage cache",e)}this.currentAccount=null,console.info("[MsalAuthProvider] Token cache cleared")}acquireTokenSilent(e){return Yd(this,void 0,void 0,function*(){if(!this.msalInstance)throw new Error("MSAL instance not initialized");if(this.currentAccount){var t={scopes:e,account:this.currentAccount};try{return yield this.msalInstance.acquireTokenSilent(t)}catch(e){console.debug("[MsalAuthProvider] acquireTokenSilent failed, trying ssoSilent")}}var r={scopes:e},n=yield this.msalInstance.ssoSilent(r);return n.account&&(this.currentAccount=n.account),n})}acquireTokenPopup(e){return Yd(this,void 0,void 0,function*(){var t;if(!this.msalInstance)throw new Error("MSAL instance not initialized");var r={scopes:e,loginHint:null===(t=this.currentAccount)||void 0===t?void 0:t.username};try{var n=yield this.msalInstance.acquireTokenPopup(r);return n.account&&(this.currentAccount=n.account),n}catch(e){if(e instanceof Error){if(e.message.includes("user_cancelled")||e.message.includes("popup_window_closed"))throw new Error("Authentication cancelled by user");if(e.message.includes("popup_window_error")||e.message.includes("BrowserAuthError"))throw new Error("Popup blocked. Please allow popups for this site and try again.")}throw e}})}getCachedToken(e){try{var t=this.getCacheKey(e),r=sessionStorage.getItem(t);if(!r)return null;var n=JSON.parse(r);return Date.now()>=n.expiresAt-Jd.EXPIRATION_BUFFER_MS?(this.removeCachedToken(e),null):this.scopesMatch(n.scopes,e)?n.token:null}catch(e){return console.warn("[MsalAuthProvider] Failed to read cached token",e),null}}setCachedToken(e,t,r){try{var n=this.getCacheKey(r),o={token:e,expiresAt:t.getTime(),scopes:r};sessionStorage.setItem(n,JSON.stringify(o))}catch(e){console.warn("[MsalAuthProvider] Failed to cache token",e)}}removeCachedToken(e){try{var t=this.getCacheKey(e);sessionStorage.removeItem(t)}catch(e){console.warn("[MsalAuthProvider] Failed to remove cached token",e)}}getCacheKey(e){var t=e.slice().sort();return Jd.CACHE_KEY_PREFIX+t.join(",")}scopesMatch(e,t){if(e.length!==t.length)return!1;var r=e.slice().sort(),n=t.slice().sort();return r.every((e,t)=>e===n[t])}}Jd.CACHE_KEY_PREFIX="msal.semantic.token.",Jd.EXPIRATION_BUFFER_MS=3e5;var Xd=function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,s)}c((n=n.apply(e,t||[])).next())})};class Zd{constructor(e,t){this.apiBaseUrl=e.replace(/\/$/,""),this.authProvider=t}search(e){return Xd(this,void 0,void 0,function*(){var t,r,n="".concat(this.apiBaseUrl,"/api/ai/search");try{var o=yield this.authProvider.getAccessToken();if(!o)throw this.createError("Authentication required. Please sign in.","AUTH_REQUIRED",!0);var i=this.transformRequest(e);console.log("[SemanticSearchApiService] API request:",{endpoint:n,pcfRequest:e,apiRequest:i});var a=yield fetch(n,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o)},body:JSON.stringify(i)});if(!a.ok)return yield this.handleHttpError(a);var s=yield a.json();return console.log("[SemanticSearchApiService] API response:",{totalCount:s.totalCount,resultsCount:null!==(r=null===(t=s.results)||void 0===t?void 0:t.length)&&void 0!==r?r:0,metadata:s.metadata}),this.validateResponse(s)}catch(e){if(this.isSearchError(e))throw e;if(e instanceof TypeError&&e.message.includes("fetch"))throw this.createError("Unable to connect to the search service. Please check your connection.","NETWORK_ERROR",!0);throw this.createError("An unexpected error occurred while searching.","UNKNOWN_ERROR",!0)}})}handleHttpError(e){return Xd(this,void 0,void 0,function*(){var t,r,n="Search failed",o="HTTP_".concat(e.status),i=!1;try{var a=yield e.json();n=null!==(r=null!==(t=a.message)&&void 0!==t?t:a.error)&&void 0!==r?r:n,a.code&&(o=a.code)}catch(t){n=e.statusText||n}switch(e.status){case 400:throw this.createError("Invalid search request. Please modify your query.",o,!1);case 401:throw this.createError("Your session has expired. Please sign in again.","AUTH_EXPIRED",!0);case 403:throw this.createError("You do not have permission to perform this search.","FORBIDDEN",!1);case 404:throw this.createError("Search service not found. Please contact support.","NOT_FOUND",!1);case 429:throw this.createError("Too many requests. Please wait a moment and try again.","RATE_LIMITED",!0);case 500:case 502:case 503:case 504:throw i=!0,this.createError("The search service is temporarily unavailable. Please try again.",o,i);default:throw this.createError(n,o,i)}})}validateResponse(e){var t,r;if(!e||"object"!=typeof e)throw this.createError("Invalid response from search service.","INVALID_RESPONSE",!0);var n=e;if(!Array.isArray(n.results))throw this.createError("Invalid response format from search service.","INVALID_RESPONSE",!0);return{results:n.results,totalCount:null!==(t=n.totalCount)&&void 0!==t?t:n.results.length,metadata:null!==(r=n.metadata)&&void 0!==r?r:{searchTimeMs:0,query:""}}}createError(e,t,r){return{message:e,code:t,retryable:r}}isSearchError(e){return"object"==typeof e&&null!==e&&"message"in e&&"retryable"in e}transformRequest(e){var t,r,n,o,i,a;switch(e.scope){case"matter":case"project":case"invoice":case"account":case"contact":o="entity",i=e.scope,a=null!==(t=e.scopeId)&&void 0!==t?t:void 0;break;case"all":o="all";break;case"custom":o="documentIds";break;default:o=e.scope}return{query:e.query,scope:o,entityType:i,entityId:a,filters:e.filters?{documentTypes:e.filters.documentTypes,matterTypes:e.filters.matterTypes,fileTypes:e.filters.fileTypes,dateFrom:null===(r=e.filters.dateRange)||void 0===r?void 0:r.from,dateTo:null===(n=e.filters.dateRange)||void 0===n?void 0:n.to}:void 0,options:e.options?{top:e.options.limit,skip:e.options.offset,includeHighlights:e.options.includeHighlights}:void 0}}}var $d=function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,s)}c((n=n.apply(e,t||[])).next())})},eh=3e5,th=[{key:"pdf",label:"PDF"},{key:"doc",label:"Word (DOC)"},{key:"docx",label:"Word (DOCX)"},{key:"xls",label:"Excel (XLS)"},{key:"xlsx",label:"Excel (XLSX)"},{key:"ppt",label:"PowerPoint (PPT)"},{key:"pptx",label:"PowerPoint (PPTX)"},{key:"txt",label:"Text (TXT)"},{key:"msg",label:"Email (MSG)"},{key:"eml",label:"Email (EML)"}];class rh{constructor(){this.cache=new Map}getDocumentTypeOptions(){return $d(this,arguments,void 0,function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"sprk_document",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"sprk_documenttype";return function*(){return e.getOptionSetValues(t,r)}()})}getMatterTypeOptions(){return $d(this,arguments,void 0,function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"sprk_mattertype_refs",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"sprk_mattertypename";return function*(){return e.getLookupOptions(t,r)}()})}getFileTypeOptions(){return $d(this,void 0,void 0,function*(){return th})}getOptionSetValues(e,t){return $d(this,void 0,void 0,function*(){var r="".concat(e,".").concat(t),n=this.cache.get(r);if(n&&Date.now()-n.timestamp<eh)return n.options;try{if("undefined"==typeof Xrm||!Xrm.WebApi)return console.warn("Xrm.WebApi not available, returning empty options"),[];var o=(yield this.fetchOptionSetMetadata(e,t)).Options.map(e=>{var t,r;return{key:e.Value.toString(),label:null!==(r=null===(t=e.Label.UserLocalizedLabel)||void 0===t?void 0:t.Label)&&void 0!==r?r:"Value ".concat(e.Value)}});return o.sort((e,t)=>e.label.localeCompare(t.label)),this.cache.set(r,{options:o,timestamp:Date.now()}),o}catch(r){return console.error("Failed to fetch optionset ".concat(e,".").concat(t,":"),r),n?n.options:[]}})}getLookupOptions(e,t){return $d(this,void 0,void 0,function*(){var r="lookup:".concat(e),n=this.cache.get(r);if(n&&Date.now()-n.timestamp<eh)return n.options;try{var o=this.getClientUrl(),i=e.endsWith("s")?e.slice(0,-1):e,a="".concat(i,"id"),s="".concat(o,"/api/data/v9.2/").concat(e,"?$select=").concat(a,",").concat(t,"&$filter=statecode eq 0&$orderby=").concat(t," asc"),c=yield fetch(s,{headers:{Accept:"application/json","OData-MaxVersion":"4.0","OData-Version":"4.0"}});if(404===c.status)return console.info("Lookup entity ".concat(e," not found")),[];if(!c.ok)throw new Error("Failed to fetch lookup options: ".concat(c.status));var l=((yield c.json()).value||[]).map(e=>{var r=e[a],n=e[t];return{key:"string"==typeof r?r:"",label:"string"==typeof n?n:"Unknown"}});return this.cache.set(r,{options:l,timestamp:Date.now()}),l}catch(t){return console.error("Failed to fetch lookup options from ".concat(e,":"),t),n?n.options:[]}})}fetchOptionSetMetadata(e,t){return $d(this,void 0,void 0,function*(){return this.fetchMetadataDirectly(e,t)})}fetchMetadataDirectly(e,t){return $d(this,void 0,void 0,function*(){var r=this.getClientUrl(),n="".concat(r,"/api/data/v9.2/EntityDefinitions(LogicalName='").concat(e,"')/Attributes(LogicalName='").concat(t,"')/Microsoft.Dynamics.CRM.PicklistAttributeMetadata?$expand=OptionSet($select=Options)"),o=yield fetch(n,{headers:{Accept:"application/json","OData-MaxVersion":"4.0","OData-Version":"4.0"}});if(404===o.status)return console.info("Optionset ".concat(e,".").concat(t," not found (entity or attribute may not exist yet)")),{Options:[]};if(!o.ok)throw new Error("Failed to fetch metadata: ".concat(o.status));var i=yield o.json();return i.OptionSet&&Array.isArray(i.OptionSet.Options)?{Options:i.OptionSet.Options}:Array.isArray(i.Options)?{Options:i.Options}:{Options:[]}})}getClientUrl(){var e;return"undefined"!=typeof Xrm&&(null===(e=Xrm.Utility)||void 0===e?void 0:e.getGlobalContext)?Xrm.Utility.getGlobalContext().getClientUrl():window.location.origin}clearCache(){this.cache.clear()}}var nh,oh=function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,s)}c((n=n.apply(e,t||[])).next())})};!function(e){e[e.NewTab=1]="NewTab",e[e.Modal=2]="Modal"}(nh||(nh={}));var ih={width:80,height:80,unit:"%"};class ah{openFile(e){e?window.open(e,"_blank","noopener,noreferrer"):console.warn("NavigationService.openFile: No file URL provided")}openRecordModal(e){return oh(this,arguments,void 0,function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ih;return function*(){var n=t.getEntityLogicalName(e),o=t.getRecordId(e);n&&o?yield t.navigateToRecord(n,o,nh.Modal,r):console.warn("NavigationService.openRecordModal: Missing entity name or record ID",{entityName:n,recordId:o})}()})}openRecordNewTab(e){return oh(this,void 0,void 0,function*(){var t=this.getEntityLogicalName(e),r=this.getRecordId(e);t&&r?yield this.navigateToRecord(t,r,nh.NewTab):console.warn("NavigationService.openRecordNewTab: Missing entity name or record ID",{entityName:t,recordId:r})})}viewAllResults(e,t,r,n){return oh(this,arguments,void 0,function(e,t,r,n){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"sprk_semanticsearchpage";return function*(){var i,a,s;if("undefined"!=typeof Xrm&&(null===(i=Xrm.Navigation)||void 0===i?void 0:i.navigateTo))try{var c={pageType:"custom",name:o,entityName:"matter"===t&&r?"sprk_matter":void 0,recordId:"matter"===t&&r?r:void 0},l={query:e,scope:t,scopeId:r||"",documentTypes:n.documentTypes.join(","),matterTypes:n.matterTypes.join(","),fileTypes:n.fileTypes.join(","),dateFrom:(null===(a=n.dateRange)||void 0===a?void 0:a.from)||"",dateTo:(null===(s=n.dateRange)||void 0===s?void 0:s.to)||""};encodeURIComponent(JSON.stringify(l)),yield Xrm.Navigation.navigateTo(c,{target:1})}catch(e){console.error("NavigationService.viewAllResults: Navigation failed",e)}else console.warn("NavigationService.viewAllResults: Xrm.Navigation not available")}()})}navigateToRecord(e,t,r,n){return oh(this,void 0,void 0,function*(){var o,i,a,s,c;if("undefined"==typeof Xrm||!(null===(o=Xrm.Navigation)||void 0===o?void 0:o.navigateTo))return console.warn("NavigationService: Xrm.Navigation not available, falling back to URL navigation"),void this.fallbackNavigate(e,t,r);try{var l={pageType:"entityrecord",entityName:e,entityId:t},u=r===nh.Modal?{target:2,width:{value:null!==(i=null==n?void 0:n.width)&&void 0!==i?i:80,unit:null!==(a=null==n?void 0:n.unit)&&void 0!==a?a:"%"},height:{value:null!==(s=null==n?void 0:n.height)&&void 0!==s?s:80,unit:null!==(c=null==n?void 0:n.unit)&&void 0!==c?c:"%"}}:{target:1};yield Xrm.Navigation.navigateTo(l,u)}catch(n){console.error("NavigationService: Navigation failed",n),this.fallbackNavigate(e,t,r)}})}fallbackNavigate(e,t,r){var n=this.getClientUrl(),o="".concat(n,"/main.aspx?etn=").concat(e,"&id=").concat(t,"&pagetype=entityrecord");nh.NewTab,window.open(o,"_blank","noopener,noreferrer")}getEntityLogicalName(e){if(e.entityLogicalName)return e.entityLogicalName;if(e.recordUrl){var t=e.recordUrl.match(/etn=([^&]+)/);if(t)return t[1]}return"sprk_document"}getRecordId(e){if(e.recordId)return e.recordId;if(e.documentId)return e.documentId;if(e.recordUrl){var t=e.recordUrl.match(/id=([^&]+)/);if(t)return t[1]}}getClientUrl(){var e;return"undefined"!=typeof Xrm&&(null===(e=Xrm.Utility)||void 0===e?void 0:e.getGlobalContext)?Xrm.Utility.getGlobalContext().getClientUrl():window.location.origin}}var sh=function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,s)}c((n=n.apply(e,t||[])).next())})},ch=null;var lh=(0,n.makeStyles)({container:{display:"flex",flexDirection:"column",gap:n.tokens.spacingVerticalM},header:{display:"flex",justifyContent:"space-between",alignItems:"center"},title:{fontWeight:n.tokens.fontWeightSemibold},filterSection:{display:"flex",flexDirection:"column",gap:n.tokens.spacingVerticalXS},clearButton:{minWidth:"auto"}}),uh={documentTypes:[],matterTypes:[],dateRange:null,fileTypes:[]},dh=e=>{var{filters:t,searchScope:o,onFiltersChange:i,disabled:a}=e,s=lh(),{documentTypeOptions:c,matterTypeOptions:l,fileTypeOptions:u,isLoading:d}=function(){var[e,t]=(0,r.useState)({documentTypes:[],matterTypes:[],fileTypes:[],isLoading:!0,error:null}),n=(0,r.useMemo)(()=>(ch||(ch=new rh),ch),[]),o=()=>sh(this,void 0,void 0,function*(){t(e=>Object.assign(Object.assign({},e),{isLoading:!0,error:null}));try{var[e,r,o]=yield Promise.all([n.getDocumentTypeOptions(),n.getMatterTypeOptions(),n.getFileTypeOptions()]);t({documentTypes:e,matterTypes:r,fileTypes:o,isLoading:!1,error:null})}catch(e){console.error("Failed to fetch filter options:",e),t(e=>Object.assign(Object.assign({},e),{isLoading:!1,error:"Failed to load filter options"}))}});return(0,r.useEffect)(()=>{o()},[]),{documentTypeOptions:e.documentTypes,matterTypeOptions:e.matterTypes,fileTypeOptions:e.fileTypes,isLoading:e.isLoading,error:e.error,refresh:()=>sh(this,void 0,void 0,function*(){n.clearCache(),yield o()})}}(),h=t.documentTypes.length>0||t.matterTypes.length>0||null!==t.dateRange||t.fileTypes.length>0,g=(0,r.useCallback)(()=>{i(uh)},[i]),p=(0,r.useCallback)(e=>{i(Object.assign(Object.assign({},t),{documentTypes:e}))},[t,i]),m=(0,r.useCallback)(e=>{i(Object.assign(Object.assign({},t),{matterTypes:e}))},[t,i]),v=(0,r.useCallback)(e=>{i(Object.assign(Object.assign({},t),{fileTypes:e}))},[t,i]),f=(0,r.useCallback)(e=>{i(Object.assign(Object.assign({},t),{dateRange:e}))},[t,i]),y="matter"!==o;return r.createElement("div",{className:s.container},r.createElement("div",{className:s.header},r.createElement(n.Text,{className:s.title},"Filters"),h&&r.createElement(n.Button,{className:s.clearButton,appearance:"subtle",size:"small",icon:r.createElement(Y,null),onClick:g,disabled:a},"Clear")),r.createElement(n.Divider,null),r.createElement("div",{className:s.filterSection},r.createElement(X,{label:"Document Type",options:c,selectedKeys:t.documentTypes,onSelectionChange:p,disabled:a||d,multiSelect:!0})),y&&r.createElement("div",{className:s.filterSection},r.createElement(X,{label:"Matter Type",options:l,selectedKeys:t.matterTypes,onSelectionChange:m,disabled:a||d,multiSelect:!0})),r.createElement("div",{className:s.filterSection},r.createElement(ne,{label:"Date Range",value:t.dateRange,onChange:f,disabled:a})),r.createElement("div",{className:s.filterSection},r.createElement(X,{label:"File Type",options:u,selectedKeys:t.fileTypes,onSelectionChange:v,disabled:a||d,multiSelect:!0})))},hh=z("DocumentRegular","1em",["M6 2a2 2 0 0 0-2 2v12c0 1.1.9 2 2 2h8a2 2 0 0 0 2-2V7.41c0-.4-.16-.78-.44-1.06l-3.91-3.91A1.5 1.5 0 0 0 10.59 2H6ZM5 4a1 1 0 0 1 1-1h4v3.5c0 .83.67 1.5 1.5 1.5H15v8a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V4Zm9.8 3h-3.3a.5.5 0 0 1-.5-.5V3.2L14.8 7Z"]),gh=z("DocumentPdfRegular","1em",["M3 12a2 2 0 1 1 0 4H2v1.5a.5.5 0 0 1-1 0v-5c0-.28.22-.5.5-.5H3Zm-1 3h1a1 1 0 1 0 0-2H2v2Zm6-3a2 2 0 0 1 2 2v2a2 2 0 0 1-2 2H6.5a.5.5 0 0 1-.5-.5v-5c0-.28.22-.5.5-.5H8Zm-1 5h1a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1H7v4Zm7.1-4.99a.5.5 0 0 1 0 .98L14 13h-2v1.5h1.5a.5.5 0 0 1 0 1H12v2a.5.5 0 0 1-1 0v-5c0-.28.22-.5.5-.5H14l.1.01ZM10.6 2c.4 0 .78.16 1.06.44l3.91 3.91c.28.28.44.67.44 1.06V16a2 2 0 0 1-2 2h-1.09c.06-.16.09-.32.09-.5V17h1a1 1 0 0 0 1-1v-2.39a1.49 1.49 0 0 0 0-2.23V8h-3.5A1.5 1.5 0 0 1 10 6.5V3H6a1 1 0 0 0-1 1v7.63a2.74 2.74 0 0 0-1-.52V4c0-1.1.9-2 2-2h4.59ZM11 6.5c0 .28.22.5.5.5h3.3L11 3.2v3.3Z"]),ph=z("Document20Regular","20",["M6 2a2 2 0 0 0-2 2v12c0 1.1.9 2 2 2h8a2 2 0 0 0 2-2V7.41c0-.4-.16-.78-.44-1.06l-3.91-3.91A1.5 1.5 0 0 0 10.59 2H6ZM5 4a1 1 0 0 1 1-1h4v3.5c0 .83.67 1.5 1.5 1.5H15v8a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V4Zm9.8 3h-3.3a.5.5 0 0 1-.5-.5V3.2L14.8 7Z"]),mh=z("FolderOpenRegular","1em",["M3 5.5v6.6l1.5-2.6A3 3 0 0 1 7.1 8H15v-.5c0-.83-.67-1.5-1.5-1.5h-4a.5.5 0 0 1-.35-.15l-1.71-1.7A.5.5 0 0 0 7.09 4H4.5C3.67 4 3 4.67 3 5.5Zm1.28 10.48.22.02h9.4a2 2 0 0 0 1.73-1l2.17-3.75A1.5 1.5 0 0 0 16.5 9H7.1a2 2 0 0 0-1.73 1L3.2 13.75a1.5 1.5 0 0 0 1.08 2.23ZM2 14.46V5.5A2.5 2.5 0 0 1 4.5 3h2.59c.4 0 .78.16 1.06.44L9.7 5h3.79A2.5 2.5 0 0 1 16 7.5V8h.5a2.5 2.5 0 0 1 2.16 3.75L16.5 15.5a3 3 0 0 1-2.6 1.5H4.5a2.54 2.54 0 0 1-1.62-.6A2.5 2.5 0 0 1 2 14.46Z"],{flipInRtl:!0}),vh=z("OpenRegular","1em",["M6 4a2 2 0 0 0-2 2v8c0 1.1.9 2 2 2h8a2 2 0 0 0 2-2v-2.5a.5.5 0 0 1 1 0V14a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V6a3 3 0 0 1 3-3h2.5a.5.5 0 0 1 0 1H6Zm5-.5c0-.28.22-.5.5-.5h5c.28 0 .5.22.5.5v5a.5.5 0 0 1-1 0V4.7l-4.15 4.15a.5.5 0 0 1-.7-.7L15.29 4H11.5a.5.5 0 0 1-.5-.5Z"]),fh=(0,n.makeStyles)({badge:{minWidth:"48px",justifyContent:"center"},high:{backgroundColor:n.tokens.colorPaletteGreenBackground2,color:n.tokens.colorPaletteGreenForeground2},medium:{backgroundColor:n.tokens.colorPaletteYellowBackground2,color:n.tokens.colorPaletteYellowForeground2},low:{backgroundColor:n.tokens.colorNeutralBackground3,color:n.tokens.colorNeutralForeground3}});function yh(e){var t=100*e;return t>=80||t>=60?"filled":"tint"}var Ch=e=>{var{score:t}=e,o=fh(),i=Math.round(100*t),a=function(e,t){var r=100*e;return r>=80?t.high:r>=60?t.medium:t.low}(t,o);return r.createElement(n.Tooltip,{content:"Relevance score",relationship:"label"},r.createElement(n.Badge,{className:"".concat(o.badge," ").concat(a),appearance:yh(t),size:"medium"},i,"%"))},wh=(0,n.makeStyles)({container:{display:"flex",flexDirection:"column",gap:n.tokens.spacingVerticalXS},snippet:{fontSize:n.tokens.fontSizeBase200,color:n.tokens.colorNeutralForeground2,lineHeight:n.tokens.lineHeightBase200},highlight:{backgroundColor:n.tokens.colorPaletteYellowBackground2,color:n.tokens.colorNeutralForeground1,fontWeight:n.tokens.fontWeightSemibold,padding:"0 2px",borderRadius:n.tokens.borderRadiusSmall},ellipsis:{color:n.tokens.colorNeutralForeground3,margin:"0 ".concat(n.tokens.spacingHorizontalXS)}}),bh=e=>{var{text:t,maxLength:o=200}=e,i=wh(),a=(0,r.useMemo)(()=>{if(!t)return null;var e=function(e){var t=e.replace(/<em>/gi,"{{EM_OPEN}}").replace(/<\/em>/gi,"{{EM_CLOSE}}");return(t=t.replace(/<[^>]*>/g,"")).replace(/\{\{EM_OPEN\}\}/g,"<em>").replace(/\{\{EM_CLOSE\}\}/g,"</em>")}(t),n=function(e,t){var r=e.replace(/<[^>]*>/g,"");if(r.length<=t)return e;for(var n=t;n>0&&" "!==r[n];)n--;0===n&&(n=t);var o=n/r.length,i=Math.floor(e.length*o);return e.slice(0,i)+"..."}(e,o);return function(e,t){for(var n,o=[],i=/<em>(.*?)<\/em>/gi,a=0,s=0;null!==(n=i.exec(e));){if(n.index>a){var c=e.slice(a,n.index);o.push(r.createElement("span",{key:"text-".concat(s++)},c))}o.push(r.createElement("span",{key:"highlight-".concat(s++),className:t.highlight},n[1])),a=n.index+n[0].length}return a<e.length&&o.push(r.createElement("span",{key:"text-".concat(s++)},e.slice(a))),o}(n,i)},[t,o,i]);return t?r.createElement("div",{className:i.container},r.createElement(n.Text,{className:i.snippet},a)):null},kh=(0,n.makeStyles)({card:{cursor:"pointer","&:hover":{backgroundColor:n.tokens.colorNeutralBackground1Hover}},cardCompact:{padding:n.tokens.spacingVerticalS},header:{display:"flex",alignItems:"flex-start",gap:n.tokens.spacingHorizontalM},icon:{fontSize:"24px",color:n.tokens.colorBrandForeground1,flexShrink:0},titleGroup:{flex:1,minWidth:0},title:{fontWeight:n.tokens.fontWeightSemibold,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},metadata:{display:"flex",flexWrap:"wrap",gap:n.tokens.spacingHorizontalS,marginTop:n.tokens.spacingVerticalXS},metaItem:{color:n.tokens.colorNeutralForeground2,fontSize:n.tokens.fontSizeBase200},metaSeparator:{color:n.tokens.colorNeutralForeground3},snippet:{marginTop:n.tokens.spacingVerticalS,paddingLeft:"calc(24px + ".concat(n.tokens.spacingHorizontalM,")")},actions:{display:"flex",gap:n.tokens.spacingHorizontalS,marginTop:n.tokens.spacingVerticalS,paddingLeft:"calc(24px + ".concat(n.tokens.spacingHorizontalM,")")},badge:{flexShrink:0}});function Ih(e){switch(e.toLowerCase()){case"pdf":return r.createElement(gh,null);case"doc":case"docx":return r.createElement(hh,null);default:return r.createElement(ph,null)}}function Th(e){if(!e)return"";try{var t=new Date(e);return isNaN(t.getTime())?"":t.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}catch(e){return""}}var Sh=e=>{var{result:t,onClick:o,onOpenFile:i,onOpenRecord:a,compactMode:s}=e,c=kh(),l=(0,r.useCallback)(e=>{e.target.closest("button")||o()},[o]),u=(0,r.useCallback)(e=>{e.stopPropagation(),i()},[i]),d=(0,r.useCallback)(()=>{a(!0)},[a]),h=(0,r.useCallback)(()=>{a(!1)},[a]),g=s?"".concat(c.card," ").concat(c.cardCompact):c.card;return r.createElement(n.Card,{className:g,onClick:l},r.createElement(n.CardHeader,{image:Ih(t.fileType),header:r.createElement("div",{className:c.titleGroup},r.createElement(n.Text,{className:c.title,block:!0},t.name),r.createElement("div",{className:c.metadata},r.createElement(n.Text,{className:c.metaItem},t.documentType),t.matterName&&r.createElement(r.Fragment,null,r.createElement(n.Text,{className:c.metaSeparator},"|"),r.createElement(n.Text,{className:c.metaItem},t.matterName)),r.createElement(n.Text,{className:c.metaSeparator},"|"),r.createElement(n.Text,{className:c.metaItem},Th(t.createdAt)))),action:r.createElement("div",{className:c.badge},r.createElement(Ch,{score:t.combinedScore}))}),!s&&t.highlights.length>0&&r.createElement("div",{className:c.snippet},r.createElement(bh,{text:t.highlights[0],maxLength:200})),r.createElement("div",{className:c.actions},r.createElement(n.Button,{appearance:"subtle",size:"small",icon:r.createElement(mh,null),onClick:u},"Open File"),r.createElement(n.Menu,null,r.createElement(n.MenuTrigger,{disableButtonEnhancement:!0},r.createElement(n.Button,{appearance:"subtle",size:"small",icon:r.createElement(vh,null)},"Open Record")),r.createElement(n.MenuPopover,null,r.createElement(n.MenuList,null,r.createElement(n.MenuItem,{onClick:d},"Open in Dialog"),r.createElement(n.MenuItem,{onClick:h},"Open in New Tab"))))))};var Ah={documentTypes:[],matterTypes:[],dateRange:null,fileTypes:[]};var Eh=function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,s)}c((n=n.apply(e,t||[])).next())})},Oh={limit:20,offset:0,includeHighlights:!0};var Ph=(0,n.makeStyles)({container:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:n.tokens.spacingHorizontalM,paddingBottom:n.tokens.spacingVerticalS,borderBottom:"1px solid ".concat(n.tokens.colorNeutralStroke2)},resultCount:{color:n.tokens.colorNeutralForeground2,fontSize:n.tokens.fontSizeBase200},scrollContainer:{flex:1,overflowY:"auto",padding:n.tokens.spacingHorizontalM},resultsList:{display:"flex",flexDirection:"column",gap:n.tokens.spacingVerticalM},sentinel:{height:"1px",width:"100%"},loadingMore:{display:"flex",justifyContent:"center",alignItems:"center",padding:n.tokens.spacingVerticalM,gap:n.tokens.spacingHorizontalS},domCapMessage:{padding:n.tokens.spacingVerticalM,textAlign:"center",backgroundColor:n.tokens.colorNeutralBackground2,borderRadius:n.tokens.borderRadiusMedium}}),Rh=200,_h=e=>{var{results:t,isLoading:o,isLoadingMore:i,hasMore:a,totalCount:s,onLoadMore:c,onResultClick:l,onOpenFile:u,onOpenRecord:d,onViewAll:h,compactMode:g}=e,p=Ph(),m=t.length>=Rh,v=Math.min(t.length,Rh),{sentinelRef:f}=function(e){var{onLoadMore:t,isLoading:n,hasMore:o,threshold:i=.1,rootMargin:a="100px"}=e,s=(0,r.useRef)(null),c=(0,r.useCallback)(e=>{var[r]=e;r.isIntersecting&&!n&&o&&t()},[n,o,t]);return(0,r.useEffect)(()=>{var e=s.current;if(e){var t=new IntersectionObserver(c,{threshold:i,rootMargin:a});return t.observe(e),()=>{t.disconnect()}}},[c,i,a]),{sentinelRef:s}}({onLoadMore:c,hasMore:a&&!m,isLoading:o||i,threshold:.1,rootMargin:"100px"}),y=(0,r.useCallback)(e=>()=>l(e),[l]),C=(0,r.useCallback)(e=>()=>u(e),[u]),w=(0,r.useCallback)(e=>t=>d(e,t),[d]);return r.createElement("div",{className:p.container},r.createElement("div",{className:p.header},r.createElement(n.Text,{className:p.resultCount},o?"Searching...":0===s?"No results":m?"Showing ".concat(v," of ").concat(s," results"):t.length===s?"".concat(s," result").concat(1===s?"":"s"):"Showing ".concat(t.length," of ").concat(s," results"))),r.createElement("div",{className:p.scrollContainer},r.createElement("div",{className:p.resultsList},t.slice(0,Rh).map(e=>r.createElement(Sh,{key:e.documentId,result:e,onClick:y(e),onOpenFile:C(e),onOpenRecord:w(e),compactMode:g})),m&&s>Rh&&r.createElement("div",{className:p.domCapMessage},r.createElement(n.Text,{size:200},"Showing first ",Rh," of ",s," results."," ",r.createElement(n.Link,{onClick:h},"View all "))),i&&r.createElement("div",{className:p.loadingMore},r.createElement(n.Spinner,{size:"small"}),r.createElement(n.Text,{size:200},"Loading more results...")),a&&!m&&!i&&r.createElement("div",{ref:f,className:p.sentinel}))))},Mh=(0,n.makeStyles)({container:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:n.tokens.spacingHorizontalXXL,textAlign:"center",minHeight:"200px"},icon:{fontSize:"48px",color:n.tokens.colorNeutralForeground3,marginBottom:n.tokens.spacingVerticalL},heading:{marginBottom:n.tokens.spacingVerticalS},queryEcho:{color:n.tokens.colorNeutralForeground2,marginBottom:n.tokens.spacingVerticalL},query:{fontWeight:n.tokens.fontWeightSemibold,color:n.tokens.colorNeutralForeground1},suggestions:{marginBottom:n.tokens.spacingVerticalL,maxWidth:"400px"},suggestionsList:{listStyle:"disc",textAlign:"left",paddingLeft:n.tokens.spacingHorizontalL,color:n.tokens.colorNeutralForeground2},suggestionItem:{marginBottom:n.tokens.spacingVerticalXS},clearButton:{marginTop:n.tokens.spacingVerticalS}}),Nh=e=>{var{query:t,hasFilters:o,onClearFilters:i}=e,a=Mh();return r.createElement("div",{className:a.container},r.createElement(V,{className:a.icon}),r.createElement(n.Text,{size:500,weight:"semibold",className:a.heading},"No results found"),t&&r.createElement(n.Text,{className:a.queryEcho},"No documents matching"," ",r.createElement("span",{className:a.query},"",t,"")),r.createElement("div",{className:a.suggestions},r.createElement(n.Text,{size:300},"Try the following:"),r.createElement("ul",{className:a.suggestionsList},r.createElement("li",{className:a.suggestionItem},r.createElement(n.Text,{size:200},"Use different or fewer keywords")),r.createElement("li",{className:a.suggestionItem},r.createElement(n.Text,{size:200},"Check spelling of search terms")),o&&r.createElement("li",{className:a.suggestionItem},r.createElement(n.Text,{size:200},"Clear filters to broaden search")),r.createElement("li",{className:a.suggestionItem},r.createElement(n.Text,{size:200},"Try using more general terms")))),o&&i&&r.createElement(n.Button,{className:a.clearButton,appearance:"outline",icon:r.createElement(Y,null),onClick:i},"Clear filters"))},xh=z("ErrorCircle20Regular","20",["M10 2a8 8 0 1 1 0 16 8 8 0 0 1 0-16Zm0 1a7 7 0 1 0 0 14 7 7 0 0 0 0-14Zm0 9.5a.75.75 0 1 1 0 1.5.75.75 0 0 1 0-1.5ZM10 6a.5.5 0 0 1 .5.41V11a.5.5 0 0 1-1 .09V6.5c0-.28.22-.5.5-.5Z"]),qh=z("ArrowClockwise20Regular","20",["M4 10a6 6 0 0 1 10.47-4H12.5a.5.5 0 0 0 0 1h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-1 0v1.6a7 7 0 1 0 1.98 4.36.5.5 0 1 0-1 .08L16 10a6 6 0 0 1-12 0Z"]),Lh=(0,n.makeStyles)({container:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:n.tokens.spacingHorizontalXXL,textAlign:"center",minHeight:"200px"},icon:{fontSize:"48px",color:n.tokens.colorPaletteRedForeground1,marginBottom:n.tokens.spacingVerticalL},heading:{marginBottom:n.tokens.spacingVerticalS},message:{color:n.tokens.colorNeutralForeground2,marginBottom:n.tokens.spacingVerticalL,maxWidth:"400px"},retryButton:{marginTop:n.tokens.spacingVerticalS},messageBar:{maxWidth:"500px",width:"100%"}}),Hh=e=>{var{message:t,retryable:o,onRetry:i}=e,a=Lh(),s=((e,t)=>e.toLowerCase().includes("network")||e.toLowerCase().includes("failed to fetch")||e.toLowerCase().includes("connection")?"Unable to connect to the server. Please check your internet connection and try again.":e.toLowerCase().includes("401")||e.toLowerCase().includes("unauthorized")||e.toLowerCase().includes("authentication")?"Your session has expired. Please sign in again to continue.":e.toLowerCase().includes("403")||e.toLowerCase().includes("forbidden")||e.toLowerCase().includes("permission")?"You don't have permission to access this resource.":e.toLowerCase().includes("500")||e.toLowerCase().includes("server error")||e.toLowerCase().includes("internal")?"The server encountered an error. Please try again in a few moments.":e.toLowerCase().includes("timeout")||e.toLowerCase().includes("timed out")?"The request took too long to complete. Please try again.":t?"Something went wrong. Please try again.":"An error occurred. If this problem persists, please contact support.")(t,o);return r.createElement("div",{className:a.container},r.createElement(xh,{className:a.icon}),r.createElement(n.Text,{size:500,weight:"semibold",className:a.heading},"Something went wrong"),r.createElement(n.Text,{className:a.message},s),o&&r.createElement(n.Button,{className:a.retryButton,appearance:"primary",icon:r.createElement(qh,null),onClick:i},"Try Again"))},jh=(0,n.makeStyles)({root:Object.assign(Object.assign({display:"flex",flexDirection:"column",height:"100%",backgroundColor:n.tokens.colorNeutralBackground1,color:n.tokens.colorNeutralForeground1,fontFamily:n.tokens.fontFamilyBase},n.shorthands.borderRadius(n.tokens.borderRadiusMedium)),n.shorthands.overflow("hidden")),rootCompact:{maxHeight:"400px"},header:Object.assign(Object.assign(Object.assign({display:"flex",flexDirection:"column"},n.shorthands.padding(n.tokens.spacingHorizontalM)),{backgroundColor:n.tokens.colorNeutralBackground2}),n.shorthands.borderBottom(n.tokens.strokeWidthThin,"solid",n.tokens.colorNeutralStroke1)),content:Object.assign({display:"flex",flex:1},n.shorthands.overflow("hidden")),sidebar:Object.assign(Object.assign(Object.assign(Object.assign({width:"250px",flexShrink:0},n.shorthands.padding(n.tokens.spacingHorizontalM)),{backgroundColor:n.tokens.colorNeutralBackground3}),n.shorthands.borderRight(n.tokens.strokeWidthThin,"solid",n.tokens.colorNeutralStroke1)),{overflowY:"auto"}),main:Object.assign({flex:1,display:"flex",flexDirection:"column"},n.shorthands.overflow("hidden")),footer:Object.assign(Object.assign(Object.assign({display:"flex",justifyContent:"center"},n.shorthands.padding(n.tokens.spacingHorizontalS)),{backgroundColor:n.tokens.colorNeutralBackground2}),n.shorthands.borderTop(n.tokens.strokeWidthThin,"solid",n.tokens.colorNeutralStroke1)),centeredState:Object.assign({flex:1,display:"flex",alignItems:"center",justifyContent:"center"},n.shorthands.padding(n.tokens.spacingHorizontalL)),versionFooter:Object.assign(Object.assign(Object.assign(Object.assign({display:"flex",justifyContent:"flex-end"},n.shorthands.padding(n.tokens.spacingHorizontalXS,n.tokens.spacingHorizontalM)),{backgroundColor:n.tokens.colorNeutralBackground2}),n.shorthands.borderTop(n.tokens.strokeWidthThin,"solid",n.tokens.colorNeutralStroke1)),{fontSize:n.tokens.fontSizeBase100,color:n.tokens.colorNeutralForeground4})}),Dh=e=>{var t,o,i,a,s,c,u,d,h,g,p,m,v,f,{context:y,notifyOutputChanged:C,onDocumentSelect:w}=e,b=jh(),k=null===(o=null===(t=y.parameters.showFilters)||void 0===t?void 0:t.raw)||void 0===o||o,I=null!==(a=null===(i=y.parameters.compactMode)||void 0===i?void 0:i.raw)&&void 0!==a&&a,T=null!==(c=null===(s=y.parameters.placeholder)||void 0===s?void 0:s.raw)&&void 0!==c?c:"Search documents...",S=null!==(d=null===(u=y.parameters.apiBaseUrl)||void 0===u?void 0:u.raw)&&void 0!==d?d:"",A=y.page,E=null!==(h=null==A?void 0:A.entityId)&&void 0!==h?h:null,O=null!==(g=null==A?void 0:A.entityTypeName)&&void 0!==g?g:null;console.log("[SemanticSearchControl] Page context detection:",{pageContext:A,pageEntityId:E,pageEntityTypeName:O,fullContext:y});var P=null!==(m=null===(p=y.parameters.searchScope)||void 0===p?void 0:p.raw)&&void 0!==m?m:"all",R=null!==(f=null===(v=y.parameters.scopeId)||void 0===v?void 0:v.raw)&&void 0!==f?f:null,_=(e=>{var t;return e&&null!==(t={sprk_matter:"matter",sprk_project:"project",sprk_invoice:"invoice",account:"account",contact:"contact"}[e.toLowerCase()])&&void 0!==t?t:null})(O),M=E&&_?_:P,N=null!=E?E:R;console.log("[SemanticSearchControl] Scope determination:",{detectedEntityType:_,configuredScope:P,parameterScopeId:R,finalSearchScope:M,finalScopeId:N});var[x,q]=(0,r.useState)(""),[L,H]=(0,r.useState)(!1),j=(0,r.useMemo)(()=>Jd.getInstance(),[]),D=(0,r.useMemo)(()=>new Zd(S,j),[S,j]),U=(0,r.useMemo)(()=>new ah,[]),[B,F]=(0,r.useState)(!1),[K,z]=(0,r.useState)(null);(0,r.useEffect)(()=>{var e,t,r,n;e=void 0,t=void 0,n=function*(){try{yield j.initialize(),F(!0)}catch(e){console.error("[SemanticSearchControl] MSAL initialization failed:",e),z(e instanceof Error?e.message:"Authentication initialization failed")}},new((r=void 0)||(r=Promise))(function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,s)}c((n=n.apply(e,t||[])).next())})},[j]);var{filters:G,setFilters:V,clearFilters:W,hasActiveFilters:Y}=function(){var[e,t]=(0,r.useState)(Ah),n=(0,r.useCallback)(e=>{t(t=>Object.assign(Object.assign({},t),{documentTypes:e}))},[]),o=(0,r.useCallback)(e=>{t(t=>Object.assign(Object.assign({},t),{matterTypes:e}))},[]),i=(0,r.useCallback)(e=>{t(t=>Object.assign(Object.assign({},t),{fileTypes:e}))},[]),a=(0,r.useCallback)(e=>{t(t=>Object.assign(Object.assign({},t),{dateRange:e}))},[]),s=(0,r.useCallback)(e=>{t(e)},[]),c=(0,r.useCallback)(()=>{t(Ah)},[]),l=(0,r.useMemo)(()=>e.documentTypes.length>0||e.matterTypes.length>0||e.fileTypes.length>0||null!==e.dateRange,[e]);return{filters:e,setDocumentTypes:n,setMatterTypes:o,setFileTypes:i,setDateRange:a,setFilters:s,clearFilters:c,hasActiveFilters:l}}(),{results:J,totalCount:X,isLoading:Z,isLoadingMore:$,error:ee,hasMore:te,query:re,search:ne,loadMore:oe,reset:ie}=function(e,t,n){var[o,i]=(0,r.useState)([]),[a,s]=(0,r.useState)(0),[c,l]=(0,r.useState)("idle"),[u,d]=(0,r.useState)(null),[h,g]=(0,r.useState)(""),p=(0,r.useRef)({documentTypes:[],matterTypes:[],dateRange:null,fileTypes:[]}),m=o.length<a,v="loading"===c,f="loadingMore"===c,y=(0,r.useCallback)((r,o)=>Eh(this,void 0,void 0,function*(){if(!r.trim())return i([]),s(0),l("idle"),d(null),void g("");g(r),p.current=o,l("loading"),d(null),i([]),s(0);try{var a=yield e.search({query:r,scope:t,scopeId:n,filters:o,options:Object.assign(Object.assign({},Oh),{offset:0})});i(a.results),s(a.totalCount),l("success")}catch(e){d(e),l("error")}}),[e,t,n]),C=(0,r.useCallback)(()=>Eh(this,void 0,void 0,function*(){if("loading"!==c&&"loadingMore"!==c&&m&&h.trim()){l("loadingMore");try{var r=yield e.search({query:h,scope:t,scopeId:n,filters:p.current,options:Object.assign(Object.assign({},Oh),{offset:o.length})});i(e=>[...e,...r.results]),s(r.totalCount),l("success")}catch(e){d(e),l("error")}}}),[e,t,n,h,o.length,c,m]),w=(0,r.useCallback)(()=>{i([]),s(0),l("idle"),d(null),g(""),p.current={documentTypes:[],matterTypes:[],dateRange:null,fileTypes:[]}},[]);return{results:o,totalCount:a,state:c,isLoading:v,isLoadingMore:f,error:u,hasMore:m,query:h,search:y,loadMore:C,reset:w}}(D,M,N),ae=(0,r.useCallback)(()=>{B?x.trim()&&(H(!0),ne(x,G)):console.warn("[SemanticSearchControl] Cannot search - auth not initialized")},[x,G,ne,B]),se=(0,r.useCallback)(e=>{V(e),re.trim()&&L&&ne(re,e)},[V,re,L,ne]),ce=(0,r.useCallback)(()=>{re.trim()&&ne(re,G)},[re,G,ne]),le=(0,r.useCallback)(e=>{w(e.documentId),C()},[w,C]),ue=(0,r.useCallback)(e=>{U.openFile(e.fileUrl)},[U]),de=(0,r.useCallback)((e,t)=>{t?U.openRecordModal(e):U.openRecordNewTab(e)},[U]),he=(0,r.useCallback)(()=>{U.viewAllResults(re,M,N,G)},[U,re,M,N,G]),ge=I?"".concat(b.root," ").concat(b.rootCompact):b.root;return r.createElement("div",{className:ge},r.createElement("div",{className:b.header},r.createElement(Q,{value:x,placeholder:T,disabled:Z,onValueChange:q,onSearch:ae})),r.createElement("div",{className:b.content},k&&!I&&r.createElement("div",{className:b.sidebar},r.createElement(dh,{filters:G,searchScope:M,scopeId:N,onFiltersChange:se,disabled:Z})),r.createElement("div",{className:b.main},K?r.createElement("div",{className:b.centeredState},r.createElement(Hh,{message:K,retryable:!1,onRetry:()=>window.location.reload()})):B?Z&&0===J.length?r.createElement("div",{className:b.centeredState},r.createElement(l,{count:I?3:5})):ee?r.createElement("div",{className:b.centeredState},r.createElement(Hh,{message:ee.message,retryable:ee.retryable,onRetry:ce})):L&&0===J.length&&!Z?r.createElement("div",{className:b.centeredState},r.createElement(Nh,{query:re,hasFilters:Y})):J.length>0?r.createElement(_h,{results:J,isLoading:Z,isLoadingMore:$,hasMore:te,totalCount:X,onLoadMore:oe,onResultClick:le,onOpenFile:ue,onOpenRecord:de,onViewAll:he,compactMode:I}):r.createElement("div",{className:b.centeredState},r.createElement(n.Text,null,"Enter a search query to find documents")):r.createElement("div",{className:b.centeredState},r.createElement(l,{count:I?3:5})))),I&&J.length>0&&r.createElement("div",{className:b.footer},r.createElement(n.Link,{onClick:he},"View all ",X," results ")),r.createElement("div",{className:b.versionFooter},r.createElement(n.Text,{size:100},"v1.0.22  Built 2026-01-26")))};class Uh{constructor(){this._theme=n.webLightTheme}init(e,t,r){this.notifyOutputChanged=t,this._context=e,this._theme=a(e),this._cleanupThemeListener=function(e,t){var r=()=>e(i(t));window.addEventListener(o,r);var n=null;try{(n=window.matchMedia("(prefers-color-scheme: dark)")).addEventListener("change",r)}catch(e){}return()=>{window.removeEventListener(o,r),n&&n.removeEventListener("change",r)}}(e=>{this._theme=e?n.webDarkTheme:n.webLightTheme,this.notifyOutputChanged()},e)}updateView(e){this._context=e,this._theme=a(e);var t={context:e,notifyOutputChanged:this.notifyOutputChanged,onDocumentSelect:this.handleDocumentSelect.bind(this)},o=r.createElement(Dh,t);return r.createElement(n.FluentProvider,{theme:this._theme},o)}handleDocumentSelect(e){this.selectedDocumentId=e,this.notifyOutputChanged()}getOutputs(){return{selectedDocumentId:this.selectedDocumentId}}destroy(){var e;null===(e=this._cleanupThemeListener)||void 0===e||e.call(this)}}pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad=t})();
if (window.ComponentFramework && window.ComponentFramework.registerControl) {
	ComponentFramework.registerControl('Sprk.SemanticSearchControl', pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad.SemanticSearchControl);
} else {
	var Sprk = Sprk || {};
	Sprk.SemanticSearchControl = pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad.SemanticSearchControl;
	pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad = undefined;
}