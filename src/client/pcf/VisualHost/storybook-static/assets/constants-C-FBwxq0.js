import{r as m}from"./index-D4H_InIO.js";const w=m.createContext(void 0),K={targetDocument:typeof document=="object"?document:void 0,dir:"ltr"},U=w.Provider;function I(){var t;return(t=m.useContext(w))!==null&&t!==void 0?t:K}function H(...t){"use no memo";const e=m.useCallback(s=>{e.current=s;for(const i of t)typeof i=="function"?i(s):i&&(i.current=s)},[...t]);return e}var O=typeof WeakRef<"u",E=class{constructor(t){O&&typeof t=="object"?this._weakRef=new WeakRef(t):this._instance=t}deref(){var t,e;let s;return this._weakRef?(s=(t=this._weakRef)==null?void 0:t.deref(),s||delete this._weakRef):(s=this._instance,(e=s==null?void 0:s.isDisposed)!=null&&e.call(s)&&delete this._instance),s}},g="keyborg:focusin",F="keyborg:focusout";function L(t){const e=t.HTMLElement,s=e.prototype.focus;let i=!1;return e.prototype.focus=function(){i=!0},t.document.createElement("button").focus(),e.prototype.focus=s,i}var v=!1;function S(t){const e=t.focus;e.__keyborgNativeFocus?e.__keyborgNativeFocus.call(t):t.focus()}function R(t){const e=t;v||(v=L(e));const s=e.HTMLElement.prototype.focus;if(s.__keyborgNativeFocus)return;e.HTMLElement.prototype.focus=b;const i=new Set,o=r=>{const u=r.target;if(!u)return;const n=new CustomEvent(F,{cancelable:!0,bubbles:!0,composed:!0,detail:{originalEvent:r}});u.dispatchEvent(n)},d=r=>{const u=r.target;if(!u)return;let n=r.composedPath()[0];const l=new Set;for(;n;)n.nodeType===Node.DOCUMENT_FRAGMENT_NODE?(l.add(n),n=n.host):n=n.parentNode;for(const c of i){const a=c.deref();(!a||!l.has(a))&&(i.delete(c),a&&(a.removeEventListener("focusin",d,!0),a.removeEventListener("focusout",o,!0)))}h(u,r.relatedTarget||void 0)},h=(r,u,n)=>{var l;const c=r.shadowRoot;if(c){for(const p of i)if(p.deref()===c)return;c.addEventListener("focusin",d,!0),c.addEventListener("focusout",o,!0),i.add(new E(c));return}const a={relatedTarget:u,originalEvent:n},T=new CustomEvent(g,{cancelable:!0,bubbles:!0,composed:!0,detail:a});T.details=a,(v||f.lastFocusedProgrammatically)&&(a.isFocusedProgrammatically=r===((l=f.lastFocusedProgrammatically)==null?void 0:l.deref()),f.lastFocusedProgrammatically=void 0),r.dispatchEvent(T)},f=e.__keyborgData={focusInHandler:d,focusOutHandler:o,shadowTargets:i};e.document.addEventListener("focusin",e.__keyborgData.focusInHandler,!0),e.document.addEventListener("focusout",e.__keyborgData.focusOutHandler,!0);function b(){const r=e.__keyborgData;return r&&(r.lastFocusedProgrammatically=new E(this)),s.apply(this,arguments)}let _=e.document.activeElement;for(;_&&_.shadowRoot;)h(_),_=_.shadowRoot.activeElement;b.__keyborgNativeFocus=s}function M(t){const e=t,s=e.HTMLElement.prototype,i=s.focus.__keyborgNativeFocus,o=e.__keyborgData;if(o){e.document.removeEventListener("focusin",o.focusInHandler,!0),e.document.removeEventListener("focusout",o.focusOutHandler,!0);for(const d of o.shadowTargets){const h=d.deref();h&&(h.removeEventListener("focusin",o.focusInHandler,!0),h.removeEventListener("focusout",o.focusOutHandler,!0))}o.shadowTargets.clear(),delete e.__keyborgData}i&&(s.focus=i)}var D=500,N=0,W=class{constructor(t,e){this._isNavigatingWithKeyboard_DO_NOT_USE=!1,this._onFocusIn=i=>{if(this._isMouseOrTouchUsedTimer||this.isNavigatingWithKeyboard)return;const o=i.detail;o.relatedTarget&&(o.isFocusedProgrammatically||o.isFocusedProgrammatically===void 0||(this.isNavigatingWithKeyboard=!0))},this._onMouseDown=i=>{i.buttons===0||i.clientX===0&&i.clientY===0&&i.screenX===0&&i.screenY===0||this._onMouseOrTouch()},this._onMouseOrTouch=()=>{const i=this._win;i&&(this._isMouseOrTouchUsedTimer&&i.clearTimeout(this._isMouseOrTouchUsedTimer),this._isMouseOrTouchUsedTimer=i.setTimeout(()=>{delete this._isMouseOrTouchUsedTimer},1e3)),this.isNavigatingWithKeyboard=!1},this._onKeyDown=i=>{this.isNavigatingWithKeyboard?this._shouldDismissKeyboardNavigation(i)&&this._scheduleDismiss():this._shouldTriggerKeyboardNavigation(i)&&(this.isNavigatingWithKeyboard=!0)},this.id="c"+ ++N,this._win=t;const s=t.document;if(e){const i=e.triggerKeys,o=e.dismissKeys;i!=null&&i.length&&(this._triggerKeys=new Set(i)),o!=null&&o.length&&(this._dismissKeys=new Set(o))}s.addEventListener(g,this._onFocusIn,!0),s.addEventListener("mousedown",this._onMouseDown,!0),t.addEventListener("keydown",this._onKeyDown,!0),s.addEventListener("touchstart",this._onMouseOrTouch,!0),s.addEventListener("touchend",this._onMouseOrTouch,!0),s.addEventListener("touchcancel",this._onMouseOrTouch,!0),R(t)}get isNavigatingWithKeyboard(){return this._isNavigatingWithKeyboard_DO_NOT_USE}set isNavigatingWithKeyboard(t){this._isNavigatingWithKeyboard_DO_NOT_USE!==t&&(this._isNavigatingWithKeyboard_DO_NOT_USE=t,this.update())}dispose(){const t=this._win;if(t){this._isMouseOrTouchUsedTimer&&(t.clearTimeout(this._isMouseOrTouchUsedTimer),this._isMouseOrTouchUsedTimer=void 0),this._dismissTimer&&(t.clearTimeout(this._dismissTimer),this._dismissTimer=void 0),M(t);const e=t.document;e.removeEventListener(g,this._onFocusIn,!0),e.removeEventListener("mousedown",this._onMouseDown,!0),t.removeEventListener("keydown",this._onKeyDown,!0),e.removeEventListener("touchstart",this._onMouseOrTouch,!0),e.removeEventListener("touchend",this._onMouseOrTouch,!0),e.removeEventListener("touchcancel",this._onMouseOrTouch,!0),delete this._win}}isDisposed(){return!!this._win}update(){var t,e;const s=(e=(t=this._win)==null?void 0:t.__keyborg)==null?void 0:e.refs;if(s)for(const i of Object.keys(s))y.update(s[i],this.isNavigatingWithKeyboard)}_shouldTriggerKeyboardNavigation(t){var e;if(t.key==="Tab")return!0;const s=(e=this._win)==null?void 0:e.document.activeElement,i=!this._triggerKeys||this._triggerKeys.has(t.keyCode),o=s&&(s.tagName==="INPUT"||s.tagName==="TEXTAREA"||s.isContentEditable);return i&&!o}_shouldDismissKeyboardNavigation(t){var e;return(e=this._dismissKeys)==null?void 0:e.has(t.keyCode)}_scheduleDismiss(){const t=this._win;if(t){this._dismissTimer&&(t.clearTimeout(this._dismissTimer),this._dismissTimer=void 0);const e=t.document.activeElement;this._dismissTimer=t.setTimeout(()=>{this._dismissTimer=void 0;const s=t.document.activeElement;e&&s&&e===s&&(this.isNavigatingWithKeyboard=!1)},D)}}},y=class k{constructor(e,s){this._cb=[],this._id="k"+ ++N,this._win=e;const i=e.__keyborg;i?(this._core=i.core,i.refs[this._id]=this):(this._core=new W(e,s),e.__keyborg={core:this._core,refs:{[this._id]:this}})}static create(e,s){return new k(e,s)}static dispose(e){e.dispose()}static update(e,s){e._cb.forEach(i=>i(s))}dispose(){var e;const s=(e=this._win)==null?void 0:e.__keyborg;s!=null&&s.refs[this._id]&&(delete s.refs[this._id],Object.keys(s.refs).length===0&&(s.core.dispose(),delete this._win.__keyborg)),this._cb=[],delete this._core,delete this._win}isNavigatingWithKeyboard(){var e;return!!((e=this._core)!=null&&e.isNavigatingWithKeyboard)}subscribe(e){this._cb.push(e)}unsubscribe(e){const s=this._cb.indexOf(e);s>=0&&this._cb.splice(s,1)}setVal(e){this._core&&(this._core.isNavigatingWithKeyboard=e)}};function P(t,e){return y.create(t,e)}function x(t){y.dispose(t)}/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */const A="data-fui-focus-visible",j="data-fui-focus-within";export{j as F,g as K,U as P,A as a,F as b,P as c,x as d,H as e,S as n,I as u};
