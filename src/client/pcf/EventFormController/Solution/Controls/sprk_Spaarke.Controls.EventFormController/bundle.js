/*! For license information please see bundle.js.LICENSE.txt */
var pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad;(()=>{"use strict";var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})}};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var t={};e.r(t),e.d(t,{EventFormController:()=>se});const r=Reactv16,n=ReactDOMv16,i=FluentUIReactv940;var o="undefined"==typeof window?e.g:window,l="@griffel/";function a(e,t){return o[Symbol.for(l+e)]||(o[Symbol.for(l+e)]=t),o[Symbol.for(l+e)]}var s=a("DEFINITION_LOOKUP_TABLE",{}),c="data-make-styles-bucket";function d(e,t){return"___"+function(e){var t=e.length;if(7===t)return e;for(var r=t;r<7;r++)e+="0";return e}(function(e){for(var t,r=0,n=0,i=e.length;i>=4;++n,i-=4)t=1540483477*(65535&(t=255&e.charCodeAt(n)|(255&e.charCodeAt(++n))<<8|(255&e.charCodeAt(++n))<<16|(255&e.charCodeAt(++n))<<24))+(59797*(t>>>16)<<16),r=1540483477*(65535&(t^=t>>>24))+(59797*(t>>>16)<<16)^1540483477*(65535&r)+(59797*(r>>>16)<<16);switch(i){case 3:r^=(255&e.charCodeAt(n+2))<<16;case 2:r^=(255&e.charCodeAt(n+1))<<8;case 1:r=1540483477*(65535&(r^=255&e.charCodeAt(n)))+(59797*(r>>>16)<<16)}return(((r=1540483477*(65535&(r^=r>>>13))+(59797*(r>>>16)<<16))^r>>>15)>>>0).toString(36)}(e+t))}function u(e,t){var r="",n="";for(var i in e){var o=e[i];if(0!==o){var l=Array.isArray(o),a="rtl"===t?(l?o[1]:o)+" ":(l?o[0]:o)+" ";r+=a,n+=a}else n+=i+" "}return[r.slice(0,-1),n.slice(0,-1)]}function v(e,t){var r={};for(var n in e){var[i,o]=u(e[n],t);if(""!==o){var l=d(o,t),a=l+(""===i?"":" "+i);s[l]=[e[n],t],r[n]=a}else r[n]=""}return r}var f={};function p(){for(var e=arguments,t=null,r="",n="",i=new Array(arguments.length),o=function(){var t=e[l];if("string"==typeof t&&""!==t){var o=t.indexOf("___");if(-1===o)r+=t+" ";else{var a=t.substr(o,10);o>0&&(r+=t.slice(0,o)),n+=a,i[l]=a}}},l=0;l<arguments.length;l++)o();if(""===n)return r.slice(0,-1);var a=f[n];if(void 0!==a)return r+a;for(var c=[],v=0;v<arguments.length;v++){var p=i[v];if(p){var m=s[p];m&&(c.push(m[0]),t=m[1])}}var h=Object.assign.apply(Object,[{}].concat(c)),[g,y]=u(h,t),b=d(y,t),w=b+" "+g;return f[n]=w,s[b]=[h,t],r+w}var m=r.createContext(void 0),h={},g=(m.Provider,()=>{var e={};return function(t,r){void 0===e[t.id]&&(t.insertCSSRules(r),e[t.id]=!0)}}),y=r.useInsertionEffect?r.useInsertionEffect:void 0,b=()=>{var e={};return function(t,r){y&&"undefined"!=typeof window&&window.document&&window.document.createElement?y(()=>{t.insertCSSRules(r)},[t,r]):void 0===e[t.id]&&(t.insertCSSRules(r),e[t.id]=!0)}};function w(e){return Array.isArray(e)?e:[e]}var E=["r","d","l","v","w","f","i","h","a","s","k","t","m","c"].reduce((e,t,r)=>(e[t]=r,e),{});function F(e,t,r,n){var i,o,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a="m"===e,s=null!==(i=l.m)&&void 0!==i?i:"0",d=null!==(o=l.p)&&void 0!==o?o:0,u=function(e,t,r){return("m"===e?e+t:e)+r}(e,s,d);if(!n.stylesheets[u]){var v=t&&t.createElement("style"),f=function(e,t,r,n){var i=[];if(n[c]=t,n["data-priority"]=String(r),e)for(var o in n)e.setAttribute(o,n[o]);return{elementAttributes:n,insertRule:function(t){return(null==e?void 0:e.sheet)?e.sheet.insertRule(t,e.sheet.cssRules.length):i.push(t)},element:e,bucketName:t,cssRules:()=>(null==e?void 0:e.sheet)?Array.from(e.sheet.cssRules).map(e=>e.cssText):i}}(v,e,d,Object.assign({},n.styleElementAttributes,a&&{media:s}));n.stylesheets[u]=f,(null==t?void 0:t.head)&&v&&t.head.insertBefore(v,function(e,t,r,n){var i,o,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=E[r],s=null!==(i=l.m)&&void 0!==i?i:"",d=null!==(o=l.p)&&void 0!==o?o:0,u=e=>a-E[e.getAttribute(c)],v=e.head.querySelectorAll("[".concat(c,"]"));if("m"===r){var f=e.head.querySelectorAll("[".concat(c,'="').concat(r,'"]'));f.length&&(v=f,u=e=>n.compareMediaQueries(s,e.media))}for(var p=e=>function(e,t,r){var n,i;return t+(null!==(n=r.m)&&void 0!==n?n:"")===e.getAttribute(c)+(null!==(i=e.media)&&void 0!==i?i:"")}(e,r,l)?d-Number(e.getAttribute("data-priority")):u(e),m=v.length,h=m-1;h>=0;){var g=v.item(h);if(p(g)>0)return g.nextSibling;h--}return m>0?v.item(0):t?t.nextSibling:null}(t,r,e,n,l))}return n.stylesheets[u]}function S(e,t){try{e.insertRule(t)}catch(e){}}":(".concat(["-moz-placeholder","-moz-focus-inner","-moz-focusring","-ms-input-placeholder","-moz-read-write","-moz-read-only"].join("|"),")");var _=0,N=(e,t)=>e<t?-1:e>t?1:0;function T(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"undefined"==typeof document?void 0:document,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{classNameHashSalt:r,unstable_filterCSSRule:n,insertionPoint:i,styleElementAttributes:o,compareMediaQueries:l=N}=t,a={classNameHashSalt:r,insertionCache:{},stylesheets:{},styleElementAttributes:Object.freeze(o),compareMediaQueries:l,id:"d".concat(_++),insertCSSRules(t){for(var r in t)for(var o=t[r],l=0,s=o.length;l<s;l++){var[c,d]=w(o[l]),u=F(r,e,i||null,a,d);a.insertionCache[c]||(a.insertionCache[c]=r,n?n(c)&&S(u,c):S(u,c))}}};return a}var k=r.createContext(T()),O=r.createContext("ltr");function C(e,t){var n=function(e,t){var r=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:g)(),n=null,i=null;return function(o){var{dir:l,renderer:a}=o,s="ltr"===l;return s?null===n&&(n=v(e,l)):null===i&&(i=v(e,l)),r(a,t),s?n:i}}(e,t,b);return function(){var e=r.useContext(O),t=r.useContext(k);return n({dir:e,renderer:t})}}var A=C({root:{mc9l5x:"f1w7gpdv",Bg96gwp:"fez10in"},rtl:{Bz10aip:"f13rod7r"}},{d:[".f1w7gpdv{display:inline;}",".fez10in{line-height:0;}",".f13rod7r{transform:scaleX(-1);}"]}),j=["title","primaryFill"];function x(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function P(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?x(Object(r),!0).forEach(function(t){I(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function I(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var R=C({root:{B8gzw0y:"f1dd5bof"}},{m:[["@media (forced-colors: active){.f1dd5bof{forced-color-adjust:auto;}}",{m:"(forced-colors: active)"}]]});function q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function L(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?q(Object(r),!0).forEach(function(t){V(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):q(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function V(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var H=(e,t,n,i)=>{var o="1em"===t?"20":t,l=r.forwardRef((e,l)=>{var a=R(),s=((e,t)=>{var n,{title:i,primaryFill:o="currentColor"}=e,l=P(P({},function(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}(e,j)),{},{title:void 0,fill:o}),a=A(),s=null!=(n=r.useContext(m))?n:h;return l.className=p(a.root,(null==t?void 0:t.flipInRtl)&&"rtl"===(null==s?void 0:s.textDirection)&&a.rtl,l.className),i&&(l["aria-label"]=i),l["aria-label"]||l["aria-labelledby"]?l.role="img":l["aria-hidden"]=!0,l})(e,{flipInRtl:null==i?void 0:i.flipInRtl}),c=L(L({},s),{},{className:p("fui-Icon",s.className,a.root),ref:l,width:t,height:t,viewBox:"0 0 ".concat(o," ").concat(o),xmlns:"http://www.w3.org/2000/svg"});return"string"==typeof n?r.createElement("svg",L(L({},c),{},{dangerouslySetInnerHTML:{__html:n}})):r.createElement("svg",c,...n.map(e=>r.createElement("path",{d:e,fill:c.fill})))});return l.displayName=e,l},z=H("Checkmark16Regular","16",["M13.86 3.66a.5.5 0 0 1-.02.7l-7.93 7.48a.6.6 0 0 1-.84-.02L2.4 9.1a.5.5 0 0 1 .72-.7l2.4 2.44 7.65-7.2a.5.5 0 0 1 .7.02Z"]),D=H("Dismiss16Regular","16",["m2.59 2.72.06-.07a.5.5 0 0 1 .63-.06l.07.06L8 7.29l4.65-4.64a.5.5 0 0 1 .7.7L8.71 8l4.64 4.65c.18.17.2.44.06.63l-.06.07a.5.5 0 0 1-.63.06l-.07-.06L8 8.71l-4.65 4.64a.5.5 0 0 1-.7-.7L7.29 8 2.65 3.35a.5.5 0 0 1-.06-.63l.06-.07-.06.07Z"]),B=H("Info16Regular","16",["M8.5 7.5a.5.5 0 1 0-1 0v3a.5.5 0 0 0 1 0v-3Zm.25-2a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1ZM2 8a6 6 0 1 1 12 0A6 6 0 0 1 2 8Z"]);function X(){var e,t=window.Xrm||(null===(e=window.parent)||void 0===e?void 0:e.Xrm);return(null==t?void 0:t.Page)||null}function M(e){var t=X();if(!t)return console.warn("[FieldVisibilityHandler] Xrm.Page not available - hideField"),!1;var r=t.getControl(e);if(!r)return console.warn("[FieldVisibilityHandler] Field not found on form: ".concat(e)),!1;try{return r.setVisible(!1),!0}catch(t){return console.error("[FieldVisibilityHandler] Error hiding field ".concat(e,":"),t),!1}}function Z(e){var t=X();if(!t)return console.warn("[FieldVisibilityHandler] Xrm.Page not available - setRequired"),!1;var r=t.getAttribute(e);if(!r)return console.warn("[FieldVisibilityHandler] Attribute not found: ".concat(e)),!1;try{return r.setRequiredLevel("required"),function(e){var t=X();if(!t)return console.warn("[FieldVisibilityHandler] Xrm.Page not available - showField"),!1;var r=t.getControl(e);if(!r)return console.warn("[FieldVisibilityHandler] Field not found on form: ".concat(e)),!1;try{return r.setVisible(!0),!0}catch(t){return console.error("[FieldVisibilityHandler] Error showing field ".concat(e,":"),t),!1}}(e),!0}catch(t){return console.error("[FieldVisibilityHandler] Error setting required ".concat(e,":"),t),!1}}function Q(e){var t=X();if(!t)return console.warn("[FieldVisibilityHandler] Xrm.Page not available - setOptional"),!1;var r=t.getAttribute(e);if(!r)return console.warn("[FieldVisibilityHandler] Attribute not found: ".concat(e)),!1;try{return r.setRequiredLevel("none"),!0}catch(t){return console.error("[FieldVisibilityHandler] Error setting optional ".concat(e,":"),t),!1}}var U={sprk_eventname:{visible:!0,requiredLevel:"required"},sprk_description:{visible:!0,requiredLevel:"none"},sprk_basedate:{visible:!0,requiredLevel:"none"},sprk_duedate:{visible:!0,requiredLevel:"none"},sprk_completeddate:{visible:!0,requiredLevel:"none"},scheduledstart:{visible:!0,requiredLevel:"none"},scheduledend:{visible:!0,requiredLevel:"none"},sprk_location:{visible:!0,requiredLevel:"none"},sprk_remindat:{visible:!0,requiredLevel:"none"},statecode:{visible:!0,requiredLevel:"none"},statuscode:{visible:!0,requiredLevel:"none"},sprk_priority:{visible:!0,requiredLevel:"none"},sprk_source:{visible:!0,requiredLevel:"none"},sprk_relatedevent:{visible:!0,requiredLevel:"none"},sprk_relatedeventtype:{visible:!0,requiredLevel:"none"},sprk_relatedeventoffsettype:{visible:!0,requiredLevel:"none"}};Object.keys(U);var J=[],W=!1,$="requiredFieldsValidation";function K(){var e,t=window.Xrm||(null===(e=window.parent)||void 0===e?void 0:e.Xrm);return(null==t?void 0:t.Page)||null}function G(){var e;if(W){var t=K();if(null===(e=null==t?void 0:t.data)||void 0===e?void 0:e.entity)try{t.data.entity.removeOnSave(ie),W=!1,J=[],console.log("[SaveValidationHandler] Save handler unregistered")}catch(e){console.error("[SaveValidationHandler] Failed to unregister save handler:",e)}}Y()}function Y(){var e=K();if(null==e?void 0:e.ui)try{e.ui.clearFormNotification($)}catch(e){}}function ee(e,t){var r=K();if(r){var n=r.getControl(e);if(n&&"function"==typeof n.setNotification)try{n.setNotification(t,$)}catch(t){console.warn("[SaveValidationHandler] Could not set notification on ".concat(e,":"),t)}}}function te(e){var t=K();if(t){var r=t.getControl(e);if(r&&"function"==typeof r.clearNotification)try{r.clearNotification($)}catch(e){}}}function re(e){return null==e||"string"==typeof e&&""===e.trim()||!(!Array.isArray(e)||0!==e.length)}function ne(e,t){if(t)return t;var r=K();if(r){var n=r.getControl(e);if(n&&"function"==typeof n.getLabel)try{var i=n.getLabel();if(i)return i}catch(e){}}return e.replace(/^sprk_/,"").replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}function ie(e){var t=J.filter(e=>e.isRequired&&e.isVisible);if(0!==t.length){var r=K();if(r){var n=[];for(var i of t){var o=r.getAttribute(i.fieldName);if(te(i.fieldName),o&&re(o.getValue())){var l=ne(i.fieldName,i.displayName);n.push(l),ee(i.fieldName,"".concat(l," is required"))}}if(n.length>0){if((null==e?void 0:e.getEventArgs)&&"function"==typeof e.getEventArgs){var a=e.getEventArgs();a&&"function"==typeof a.preventDefault&&a.preventDefault()}var s=1===n.length?"Please fill in required field: ".concat(n[0]):"Please fill in required fields: ".concat(n.join(", "));if(r.ui&&"function"==typeof r.ui.setFormNotification)try{r.ui.setFormNotification(s,"ERROR",$)}catch(e){console.error("[SaveValidationHandler] Failed to set form notification:",e)}console.log("[SaveValidationHandler] Save blocked - missing required fields: ".concat(n.join(", ")))}else Y(),console.log("[SaveValidationHandler] Validation passed - save proceeding")}else console.warn("[SaveValidationHandler] Xrm.Page not available during save")}else Y()}var oe=(0,i.makeStyles)({container:{display:"flex",flexDirection:"column",gap:i.tokens.spacingVerticalS,padding:i.tokens.spacingHorizontalS,fontSize:i.tokens.fontSizeBase200},header:{display:"flex",alignItems:"center",gap:i.tokens.spacingHorizontalS},badge:{marginLeft:i.tokens.spacingHorizontalXS},fieldList:{display:"flex",flexWrap:"wrap",gap:i.tokens.spacingHorizontalXS},footer:{marginTop:i.tokens.spacingVerticalS,display:"flex",justifyContent:"space-between",alignItems:"center"},versionText:{fontSize:i.tokens.fontSizeBase100,color:i.tokens.colorNeutralForeground4}}),le=e=>{var{context:t,eventTypeId:n,eventTypeName:o,onStatusChange:l,version:a}=e,s=oe(),[c,d]=r.useState(!1),[u,v]=r.useState(null),[f,p]=r.useState(null),[m,h]=r.useState(0),[g,y]=r.useState([]),[b,w]=r.useState(!1),E=r.useRef(""),F=r.useCallback(e=>{var t=[],r=Object.keys(U);for(var n of r){var i=e.requiredFields.includes(n),o=e.hiddenFields.includes(n);t.push({fieldName:n,displayName:void 0,isVisible:!o,isRequired:i&&!o})}return t},[]);return r.useEffect(()=>{var e,r,i,o,a=E.current;if(!n&&a){console.log("[EventFormController] Event Type cleared - resetting to defaults");var s=function(){var e={success:!0,rulesApplied:0,skippedFields:[],errors:[]},t=X();if(!t)return e.success=!1,e.errors.push("Xrm.Page not available"),e;for(var[r,n]of Object.entries(U))try{var i=t.getControl(r);if(!i){e.skippedFields.push(r);continue}i.setVisible(n.visible);var o=t.getAttribute(r);o&&o.setRequiredLevel(n.requiredLevel),e.rulesApplied++}catch(t){var l=t instanceof Error?t.message:String(t);e.errors.push("Error resetting ".concat(r,": ").concat(l))}return e.errors.length>0&&(e.success=!1),console.log("[FieldVisibilityHandler] Reset complete: ".concat(e.rulesApplied," fields, ").concat(e.skippedFields.length," skipped")),e}();return p(null),h(s.rulesApplied),y(s.skippedFields),w(!0),l("reset-to-defaults"),E.current="",G(),void Y()}if(!n)return p(null),h(0),y([]),w(!1),l("no-event-type"),void G();E.current=n,w(!1),e=void 0,r=void 0,o=function*(){d(!0),v(null),l("loading");try{var e=yield t.webAPI.retrieveRecord("sprk_eventtype",n,"?$select=sprk_name,sprk_requiredfields,sprk_hiddenfields"),r=e.sprk_requiredfields||"",i=e.sprk_hiddenfields||"",o={requiredFields:r?r.split(",").map(e=>e.trim()).filter(Boolean):[],hiddenFields:i?i.split(",").map(e=>e.trim()).filter(Boolean):[],optionalFields:[]};p(o);var a=function(e){var t={success:!0,rulesApplied:0,skippedFields:[],errors:[]};if(!X())return t.success=!1,t.errors.push("Xrm.Page not available"),t;if(e.optionalFields)for(var r of e.optionalFields)Q(r)?t.rulesApplied++:t.skippedFields.push(r);for(var n of e.requiredFields)Z(n)?t.rulesApplied++:t.skippedFields.push(n);for(var i of e.hiddenFields)M(i)?(Q(i),t.rulesApplied++):t.skippedFields.push(i);return t.skippedFields.length>0&&console.warn("[FieldVisibilityHandler] Skipped fields not on form: ".concat(t.skippedFields.join(", "))),console.log("[FieldVisibilityHandler] Applied ".concat(t.rulesApplied," rules, skipped ").concat(t.skippedFields.length)),t}(o);h(a.rulesApplied),y(a.skippedFields);var s=F(o);!function(e){var t;if(J=e,W)console.log("[SaveValidationHandler] Save handler rules updated");else{var r=K();if(null===(t=null==r?void 0:r.data)||void 0===t?void 0:t.entity)try{r.data.entity.addOnSave(ie),W=!0,console.log("[SaveValidationHandler] Save handler registered")}catch(e){console.error("[SaveValidationHandler] Failed to register save handler:",e)}else console.warn("[SaveValidationHandler] Xrm.Page.data.entity not available")}}(s),console.log("[EventFormController] Registered save handler with ".concat(s.filter(e=>e.isRequired).length," required fields")),a.success?l("applied-".concat(a.rulesApplied,"-rules")):(console.warn("[EventFormController] Some rules failed:",a.errors),l("partial-".concat(a.rulesApplied,"-rules")))}catch(e){console.error("[EventFormController] Error fetching config:",e),v(e instanceof Error?e.message:"Failed to load Event Type configuration"),l("error")}finally{d(!1)}},new((i=void 0)||(i=Promise))(function(t,n){function l(e){try{s(o.next(e))}catch(e){n(e)}}function a(e){try{s(o.throw(e))}catch(e){n(e)}}function s(e){var r;e.done?t(e.value):(r=e.value,r instanceof i?r:new i(function(e){e(r)})).then(l,a)}s((o=o.apply(e,r||[])).next())})},[n,F]),r.useEffect(()=>()=>{G()},[]),c?r.createElement("div",{className:s.container},r.createElement(i.Spinner,{size:"tiny",label:"Loading Event Type..."})):u?r.createElement("div",{className:s.container},r.createElement(i.MessageBar,{intent:"error"},r.createElement(i.MessageBarBody,null,u))):!n&&b?r.createElement("div",{className:s.container},r.createElement("div",{className:s.header},r.createElement(i.Text,{size:200,style:{color:i.tokens.colorNeutralForeground3}},"Fields reset to defaults"),r.createElement(i.Badge,{className:s.badge,appearance:"filled",color:"informative",icon:r.createElement(z,null)},m," fields reset")),r.createElement("div",{className:s.footer},r.createElement(i.Text,{className:s.versionText},"v",a))):n?r.createElement("div",{className:s.container},r.createElement("div",{className:s.header},r.createElement(i.Text,{weight:"semibold",size:200},o||"Event Type"),r.createElement(i.Badge,{className:s.badge,appearance:"filled",color:m>0?"success":"informative",icon:m>0?r.createElement(z,null):r.createElement(D,null)},m," rules applied"),g.length>0&&r.createElement(i.Tooltip,{content:"Fields not on form: ".concat(g.join(", ")),relationship:"label"},r.createElement(i.Badge,{className:s.badge,appearance:"outline",color:"warning",icon:r.createElement(B,null)},g.length," skipped"))),f&&r.createElement(r.Fragment,null,f.requiredFields.length>0&&r.createElement("div",null,r.createElement(i.Text,{size:100,style:{color:i.tokens.colorNeutralForeground3}},"Required: ",f.requiredFields.join(", "))),f.hiddenFields.length>0&&r.createElement("div",null,r.createElement(i.Text,{size:100,style:{color:i.tokens.colorNeutralForeground3}},"Hidden: ",f.hiddenFields.join(", ")))),r.createElement("div",{className:s.footer},r.createElement(i.Text,{className:s.versionText},"v",a))):r.createElement("div",{className:s.container},r.createElement(i.Text,{size:200,style:{color:i.tokens.colorNeutralForeground3}},"Select an Event Type to configure form fields"),r.createElement("div",{className:s.footer},r.createElement(i.Text,{className:s.versionText},"v",a)))},ae="sprk_eventtype";class se{constructor(){this.container=null,this._controlStatus="initialized",this._eventTypeFieldName=ae,this._eventTypeId="",this._eventTypeName="",this._currentRecordId="",this._isLoading=!1,this.handleStatusChange=e=>{this._controlStatus=e,this.notifyOutputChanged()}}init(e,t,r,n){var i;this.context=e,this.notifyOutputChanged=t,this.container=n,e.mode.trackContainerResize(!0);var o=null===(i=e.parameters.eventTypeFieldName)||void 0===i?void 0:i.raw;this._eventTypeFieldName=o||ae;var l=e.mode;console.log("[EventFormController] Init - contextInfo:",JSON.stringify(l.contextInfo||{})),this.fetchEventTypeFromRecord()}updateView(e){var t;this.context=e;var r=(null===(t=e.parameters.eventTypeFieldName)||void 0===t?void 0:t.raw)||ae;r!==this._eventTypeFieldName&&(this._eventTypeFieldName=r);var n=this.getEntityId();n&&n!==this._currentRecordId?(console.log("[EventFormController] Record changed from ".concat(this._currentRecordId," to ").concat(n)),this._currentRecordId=n,this.fetchEventTypeFromRecord()):this.renderComponent()}getOutputs(){return{controlStatus:this._controlStatus}}destroy(){this.container&&(n.unmountComponentAtNode(this.container),this.container=null)}getEntityId(){var e=this.context.mode.contextInfo;if(null==e?void 0:e.entityId)return String(e.entityId).replace(/[{}]/g,"");var t=this.context.page;return(null==t?void 0:t.entityId)?String(t.entityId).replace(/[{}]/g,""):""}getEntityName(){var e=this.context.mode.contextInfo;return(null==e?void 0:e.entityTypeName)?String(e.entityTypeName):"sprk_event"}fetchEventTypeFromRecord(){return e=this,t=void 0,n=function*(){var e=this.getEntityId(),t=this.getEntityName();if(console.log("[EventFormController] Fetching Event Type for ".concat(t,":").concat(e,", field: ").concat(this._eventTypeFieldName)),!e)return console.log("[EventFormController] No entity ID available - might be new record"),this._eventTypeId="",this._eventTypeName="",void this.renderComponent();this._isLoading=!0,this._currentRecordId=e,this.renderComponent();try{var r="_".concat(this._eventTypeFieldName,"_value"),n=yield this.context.webAPI.retrieveRecord(t,e,"?$select=".concat(r));console.log("[EventFormController] WebAPI result:",JSON.stringify(n));var i=n[r]||"",o=n["".concat(r,"@OData.Community.Display.V1.FormattedValue")]||"";this._eventTypeId=i?i.replace(/[{}]/g,""):"",this._eventTypeName=o,console.log("[EventFormController] Event Type: id=".concat(this._eventTypeId,", name=").concat(this._eventTypeName)),this._controlStatus=this._eventTypeId?"loaded":"no-event-type"}catch(e){console.error("[EventFormController] Error fetching Event Type:",e),this._eventTypeId="",this._eventTypeName="",this._controlStatus="error"}finally{this._isLoading=!1,this.renderComponent()}},new((r=void 0)||(r=Promise))(function(i,o){function l(e){try{s(n.next(e))}catch(e){o(e)}}function a(e){try{s(n.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(l,a)}s((n=n.apply(e,t||[])).next())});var e,t,r,n}renderComponent(){if(this.container){var e=function(e){var t,r;if(null===(t=null==e?void 0:e.fluentDesignLanguage)||void 0===t?void 0:t.isDarkTheme)return i.webDarkTheme;var n=localStorage.getItem("spaarke-theme");return"dark"===n?i.webDarkTheme:"light"===n?i.webLightTheme:(null===(r=window.matchMedia)||void 0===r?void 0:r.call(window,"(prefers-color-scheme: dark)").matches)?i.webDarkTheme:i.webLightTheme}(this.context);console.log("[EventFormController] Rendering with eventTypeId=".concat(this._eventTypeId,", eventTypeName=").concat(this._eventTypeName,", loading=").concat(this._isLoading)),n.render(r.createElement(i.FluentProvider,{theme:e,style:{height:"100%",width:"100%"}},r.createElement(le,{context:this.context,eventTypeId:this._eventTypeId,eventTypeName:this._eventTypeName,onStatusChange:this.handleStatusChange,version:"1.0.5"})),this.container)}}}pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad=t})();
if (window.ComponentFramework && window.ComponentFramework.registerControl) {
	ComponentFramework.registerControl('Spaarke.Controls.EventFormController', pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad.EventFormController);
} else {
	var Spaarke = Spaarke || {};
	Spaarke.Controls = Spaarke.Controls || {};
	Spaarke.Controls.EventFormController = pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad.EventFormController;
	pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad = undefined;
}