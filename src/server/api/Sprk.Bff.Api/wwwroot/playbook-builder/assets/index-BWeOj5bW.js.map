{"version":3,"file":"index-BWeOj5bW.js","sources":["../../node_modules/react-dom/client.js","../../src/hooks/useThemeDetection.ts","../../src/services/hostBridge.ts","../../node_modules/zustand/esm/index.mjs","../../src/stores/canvasStore.ts","../../src/hooks/useHostBridge.ts","../../src/stores/usePlaybookStore.ts","../../src/stores/scopeStore.ts","../../src/components/Nodes/BaseNode.tsx","../../src/components/Nodes/AiAnalysisNode.tsx","../../src/components/Nodes/AiCompletionNode.tsx","../../src/components/Nodes/ConditionNode.tsx","../../src/components/Nodes/DeliverOutputNode.tsx","../../src/components/Nodes/CreateTaskNode.tsx","../../src/components/Nodes/SendEmailNode.tsx","../../src/components/Nodes/WaitNode.tsx","../../src/components/Nodes/nodeTypes.ts","../../src/components/Canvas/Canvas.tsx","../../src/components/Properties/ScopeSelector.tsx","../../src/components/Properties/NodePropertiesForm.tsx","../../src/components/Properties/PropertiesPanel.tsx","../../src/components/BuilderLayout.tsx","../../src/App.tsx","../../src/main.tsx"],"sourcesContent":["'use strict';\n\nvar m = require('react-dom');\nif (process.env.NODE_ENV === 'production') {\n  exports.createRoot = m.createRoot;\n  exports.hydrateRoot = m.hydrateRoot;\n} else {\n  var i = m.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;\n  exports.createRoot = function(c, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.createRoot(c, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n  exports.hydrateRoot = function(c, h, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.hydrateRoot(c, h, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n}\n","import { useState, useEffect } from 'react';\r\n\r\n/**\r\n * Hook to detect and react to system dark mode preference.\r\n * Also listens for theme messages from parent iframe (PCF host).\r\n */\r\nexport function useThemeDetection(): boolean {\r\n  const [isDarkMode, setIsDarkMode] = useState(() => {\r\n    // Initial check for system preference\r\n    if (typeof window !== 'undefined' && window.matchMedia) {\r\n      return window.matchMedia('(prefers-color-scheme: dark)').matches;\r\n    }\r\n    return false;\r\n  });\r\n\r\n  useEffect(() => {\r\n    // Listen for system preference changes\r\n    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\r\n\r\n    const handleChange = (e: MediaQueryListEvent) => {\r\n      setIsDarkMode(e.matches);\r\n    };\r\n\r\n    mediaQuery.addEventListener('change', handleChange);\r\n\r\n    // Listen for theme messages from parent (PCF host)\r\n    const handleMessage = (event: MessageEvent) => {\r\n      if (event.data?.type === 'THEME_CHANGE') {\r\n        setIsDarkMode(event.data.isDarkMode);\r\n      }\r\n    };\r\n\r\n    window.addEventListener('message', handleMessage);\r\n\r\n    return () => {\r\n      mediaQuery.removeEventListener('change', handleChange);\r\n      window.removeEventListener('message', handleMessage);\r\n    };\r\n  }, []);\r\n\r\n  return isDarkMode;\r\n}\r\n","/**\r\n * HostBridge Service\r\n *\r\n * Handles postMessage communication between the Playbook Builder (iframe)\r\n * and the PCF Host (Dataverse form). Uses a singleton pattern to ensure\r\n * consistent message handling across the application.\r\n *\r\n * Usage:\r\n *   const bridge = HostBridge.getInstance();\r\n *   bridge.initialize();\r\n *   bridge.sendDirtyChange(true);\r\n */\r\n\r\nimport type {\r\n  HostToBuilderMessage,\r\n  BuilderToHostMessage,\r\n  InitMessage,\r\n  AuthTokenMessage,\r\n  SaveSuccessMessage,\r\n  SaveErrorMessage,\r\n  ThemeChangeMessage,\r\n} from '../types/messages';\r\n\r\n// ─────────────────────────────────────────────────────────────────────────────\r\n// Types\r\n// ─────────────────────────────────────────────────────────────────────────────\r\n\r\nexport interface HostBridgeConfig {\r\n  /** Allowed origins for postMessage security */\r\n  allowedOrigins: string[];\r\n  /** Callback when INIT is received from host */\r\n  onInit?: (payload: InitMessage['payload']) => void;\r\n  /** Callback when AUTH_TOKEN is received */\r\n  onAuthToken?: (payload: AuthTokenMessage['payload']) => void;\r\n  /** Callback when SAVE_SUCCESS is received */\r\n  onSaveSuccess?: (payload: SaveSuccessMessage['payload']) => void;\r\n  /** Callback when SAVE_ERROR is received */\r\n  onSaveError?: (payload: SaveErrorMessage['payload']) => void;\r\n  /** Callback when THEME_CHANGE is received */\r\n  onThemeChange?: (payload: ThemeChangeMessage['payload']) => void;\r\n}\r\n\r\nexport type MessageHandler<T extends HostToBuilderMessage = HostToBuilderMessage> = (\r\n  message: T\r\n) => void;\r\n\r\n// ─────────────────────────────────────────────────────────────────────────────\r\n// HostBridge Class\r\n// ─────────────────────────────────────────────────────────────────────────────\r\n\r\nexport class HostBridge {\r\n  private static instance: HostBridge | null = null;\r\n\r\n  private config: HostBridgeConfig;\r\n  private isInitialized = false;\r\n  private messageHandler: ((event: MessageEvent) => void) | null = null;\r\n\r\n  // Stored data from host\r\n  private playbookId: string = '';\r\n  private playbookName: string = '';\r\n  private canvasJson: string = '';\r\n  private authToken: string = '';\r\n  private tokenExpiresAt: number = 0;\r\n\r\n  private constructor(config: Partial<HostBridgeConfig> = {}) {\r\n    this.config = {\r\n      allowedOrigins: config.allowedOrigins ?? ['*'], // In production, restrict this\r\n      onInit: config.onInit,\r\n      onAuthToken: config.onAuthToken,\r\n      onSaveSuccess: config.onSaveSuccess,\r\n      onSaveError: config.onSaveError,\r\n      onThemeChange: config.onThemeChange,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get the singleton instance of HostBridge.\r\n   */\r\n  public static getInstance(config?: Partial<HostBridgeConfig>): HostBridge {\r\n    if (!HostBridge.instance) {\r\n      HostBridge.instance = new HostBridge(config);\r\n    } else if (config) {\r\n      // Update config if provided\r\n      Object.assign(HostBridge.instance.config, config);\r\n    }\r\n    return HostBridge.instance;\r\n  }\r\n\r\n  /**\r\n   * Reset the singleton (useful for testing).\r\n   */\r\n  public static resetInstance(): void {\r\n    if (HostBridge.instance) {\r\n      HostBridge.instance.destroy();\r\n      HostBridge.instance = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize the bridge and start listening for messages.\r\n   * Automatically sends READY to host.\r\n   */\r\n  public initialize(): void {\r\n    if (this.isInitialized) {\r\n      console.warn('[HostBridge] Already initialized');\r\n      return;\r\n    }\r\n\r\n    // Check if we're running in an iframe\r\n    if (!this.isEmbedded()) {\r\n      console.info('[HostBridge] Not running in iframe, skipping initialization');\r\n      return;\r\n    }\r\n\r\n    console.info('[HostBridge] Initializing...');\r\n\r\n    // Set up message listener\r\n    this.messageHandler = this.handleMessage.bind(this);\r\n    window.addEventListener('message', this.messageHandler);\r\n\r\n    this.isInitialized = true;\r\n\r\n    // Send READY to host\r\n    this.sendReady();\r\n\r\n    console.info('[HostBridge] Initialized and READY sent');\r\n  }\r\n\r\n  /**\r\n   * Clean up the bridge and stop listening for messages.\r\n   */\r\n  public destroy(): void {\r\n    if (this.messageHandler) {\r\n      window.removeEventListener('message', this.messageHandler);\r\n      this.messageHandler = null;\r\n    }\r\n    this.isInitialized = false;\r\n    console.info('[HostBridge] Destroyed');\r\n  }\r\n\r\n  /**\r\n   * Check if the app is running in an iframe.\r\n   */\r\n  public isEmbedded(): boolean {\r\n    try {\r\n      return window.self !== window.top;\r\n    } catch {\r\n      // Cross-origin check failed, we're definitely embedded\r\n      return true;\r\n    }\r\n  }\r\n\r\n  // ─────────────────────────────────────────────────────────────────────────\r\n  // Getters for stored data\r\n  // ─────────────────────────────────────────────────────────────────────────\r\n\r\n  public getPlaybookId(): string {\r\n    return this.playbookId;\r\n  }\r\n\r\n  public getPlaybookName(): string {\r\n    return this.playbookName;\r\n  }\r\n\r\n  public getCanvasJson(): string {\r\n    return this.canvasJson;\r\n  }\r\n\r\n  public getAuthToken(): string {\r\n    return this.authToken;\r\n  }\r\n\r\n  public isTokenExpired(): boolean {\r\n    if (!this.tokenExpiresAt) return true;\r\n    return Date.now() >= this.tokenExpiresAt;\r\n  }\r\n\r\n  // ─────────────────────────────────────────────────────────────────────────\r\n  // Send messages to host\r\n  // ─────────────────────────────────────────────────────────────────────────\r\n\r\n  private sendToHost(message: BuilderToHostMessage): void {\r\n    if (!this.isEmbedded()) {\r\n      console.debug('[HostBridge] Not embedded, message not sent:', message.type);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      window.parent.postMessage(message, '*');\r\n      console.debug('[HostBridge] Sent to host:', message.type);\r\n    } catch (error) {\r\n      console.error('[HostBridge] Failed to send message:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Send READY message to host.\r\n   */\r\n  public sendReady(): void {\r\n    this.sendToHost({ type: 'READY' });\r\n  }\r\n\r\n  /**\r\n   * Send DIRTY_CHANGE message to host.\r\n   */\r\n  public sendDirtyChange(isDirty: boolean): void {\r\n    this.sendToHost({\r\n      type: 'DIRTY_CHANGE',\r\n      payload: { isDirty },\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Send SAVE_REQUEST message to host with canvas data.\r\n   */\r\n  public sendSaveRequest(canvasJson: string): void {\r\n    this.sendToHost({\r\n      type: 'SAVE_REQUEST',\r\n      payload: { canvasJson },\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Send CANVAS_UPDATE message to host (for real-time sync).\r\n   */\r\n  public sendCanvasUpdate(canvasJson: string): void {\r\n    this.sendToHost({\r\n      type: 'CANVAS_UPDATE',\r\n      payload: { canvasJson },\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Send REQUEST_TOKEN message to host when token is expired.\r\n   */\r\n  public sendRequestToken(): void {\r\n    this.sendToHost({ type: 'REQUEST_TOKEN' });\r\n  }\r\n\r\n  // ─────────────────────────────────────────────────────────────────────────\r\n  // Handle messages from host\r\n  // ─────────────────────────────────────────────────────────────────────────\r\n\r\n  private handleMessage(event: MessageEvent): void {\r\n    // Origin validation (in production, check against specific origins)\r\n    if (this.config.allowedOrigins[0] !== '*') {\r\n      if (!this.config.allowedOrigins.includes(event.origin)) {\r\n        console.warn('[HostBridge] Ignoring message from unknown origin:', event.origin);\r\n        return;\r\n      }\r\n    }\r\n\r\n    const message = event.data;\r\n    if (!message || typeof message !== 'object' || !message.type) {\r\n      return; // Not a valid message\r\n    }\r\n\r\n    console.debug('[HostBridge] Received from host:', message.type);\r\n\r\n    switch (message.type) {\r\n      case 'INIT':\r\n        this.handleInit(message as InitMessage);\r\n        break;\r\n\r\n      case 'AUTH_TOKEN':\r\n        this.handleAuthToken(message as AuthTokenMessage);\r\n        break;\r\n\r\n      case 'SAVE_SUCCESS':\r\n        this.handleSaveSuccess(message as SaveSuccessMessage);\r\n        break;\r\n\r\n      case 'SAVE_ERROR':\r\n        this.handleSaveError(message as SaveErrorMessage);\r\n        break;\r\n\r\n      case 'THEME_CHANGE':\r\n        this.handleThemeChange(message as ThemeChangeMessage);\r\n        break;\r\n\r\n      default:\r\n        console.debug('[HostBridge] Unknown message type:', message.type);\r\n    }\r\n  }\r\n\r\n  private handleInit(message: InitMessage): void {\r\n    const { playbookId, playbookName, canvasJson, authToken } = message.payload;\r\n\r\n    this.playbookId = playbookId;\r\n    this.playbookName = playbookName;\r\n    this.canvasJson = canvasJson;\r\n    if (authToken) {\r\n      this.authToken = authToken;\r\n    }\r\n\r\n    console.info('[HostBridge] Received INIT:', {\r\n      playbookId,\r\n      playbookName,\r\n      hasCanvasJson: !!canvasJson,\r\n      hasToken: !!authToken,\r\n    });\r\n\r\n    this.config.onInit?.(message.payload);\r\n  }\r\n\r\n  private handleAuthToken(message: AuthTokenMessage): void {\r\n    const { token, expiresAt } = message.payload;\r\n\r\n    this.authToken = token;\r\n    this.tokenExpiresAt = expiresAt;\r\n\r\n    console.info('[HostBridge] Received AUTH_TOKEN, expires at:', new Date(expiresAt));\r\n\r\n    this.config.onAuthToken?.(message.payload);\r\n  }\r\n\r\n  private handleSaveSuccess(message: SaveSuccessMessage): void {\r\n    console.info('[HostBridge] Save successful at:', new Date(message.payload.timestamp));\r\n    this.config.onSaveSuccess?.(message.payload);\r\n  }\r\n\r\n  private handleSaveError(message: SaveErrorMessage): void {\r\n    console.error('[HostBridge] Save failed:', message.payload.error);\r\n    this.config.onSaveError?.(message.payload);\r\n  }\r\n\r\n  private handleThemeChange(message: ThemeChangeMessage): void {\r\n    console.info('[HostBridge] Theme changed to:', message.payload.theme);\r\n    this.config.onThemeChange?.(message.payload);\r\n  }\r\n}\r\n\r\n// Export singleton getter for convenience\r\nexport const getHostBridge = HostBridge.getInstance;\r\n","import { createStore } from 'zustand/vanilla';\nexport * from 'zustand/vanilla';\nimport ReactExports from 'react';\nimport useSyncExternalStoreExports from 'use-sync-external-store/shim/with-selector.js';\n\nconst { useDebugValue } = ReactExports;\nconst { useSyncExternalStoreWithSelector } = useSyncExternalStoreExports;\nlet didWarnAboutEqualityFn = false;\nconst identity = (arg) => arg;\nfunction useStore(api, selector = identity, equalityFn) {\n  if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\" && equalityFn && !didWarnAboutEqualityFn) {\n    console.warn(\n      \"[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937\"\n    );\n    didWarnAboutEqualityFn = true;\n  }\n  const slice = useSyncExternalStoreWithSelector(\n    api.subscribe,\n    api.getState,\n    api.getServerState || api.getInitialState,\n    selector,\n    equalityFn\n  );\n  useDebugValue(slice);\n  return slice;\n}\nconst createImpl = (createState) => {\n  if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\" && typeof createState !== \"function\") {\n    console.warn(\n      \"[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.\"\n    );\n  }\n  const api = typeof createState === \"function\" ? createStore(createState) : createState;\n  const useBoundStore = (selector, equalityFn) => useStore(api, selector, equalityFn);\n  Object.assign(useBoundStore, api);\n  return useBoundStore;\n};\nconst create = (createState) => createState ? createImpl(createState) : createImpl;\nvar react = (createState) => {\n  if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") {\n    console.warn(\n      \"[DEPRECATED] Default export is deprecated. Instead use `import { create } from 'zustand'`.\"\n    );\n  }\n  return create(createState);\n};\n\nexport { create, react as default, useStore };\n","import { create } from 'zustand';\r\nimport {\r\n  Node,\r\n  Edge,\r\n  Connection,\r\n  NodeChange,\r\n  EdgeChange,\r\n  applyNodeChanges,\r\n  applyEdgeChanges,\r\n  addEdge,\r\n  XYPosition,\r\n} from '@xyflow/react';\r\n\r\n// Node type constants\r\nexport type PlaybookNodeType = 'aiAnalysis' | 'aiCompletion' | 'condition' | 'deliverOutput' | 'createTask' | 'sendEmail' | 'wait';\r\n\r\n// Node data type for playbook nodes - index signature required by React Flow\r\nexport interface PlaybookNodeData extends Record<string, unknown> {\r\n  label: string;\r\n  type: PlaybookNodeType;\r\n  actionId?: string;\r\n  outputVariable?: string;\r\n  config?: Record<string, unknown>;\r\n  // Node configuration (maps to Dataverse fields)\r\n  timeoutSeconds?: number;\r\n  retryCount?: number;\r\n  conditionJson?: string; // For condition nodes\r\n  // Scope selections (skills, knowledge, tool)\r\n  skillIds?: string[];\r\n  knowledgeIds?: string[];\r\n  toolId?: string;\r\n}\r\n\r\n// Typed node for our application\r\nexport type PlaybookNode = Node<PlaybookNodeData, string>;\r\n\r\ninterface CanvasState {\r\n  // State\r\n  nodes: PlaybookNode[];\r\n  edges: Edge[];\r\n  selectedNodeId: string | null;\r\n  isDirty: boolean;\r\n  lastSavedJson: string | null;\r\n\r\n  // Node actions\r\n  setNodes: (nodes: PlaybookNode[]) => void;\r\n  onNodesChange: (changes: NodeChange<PlaybookNode>[]) => void;\r\n  addNode: (node: PlaybookNode) => void;\r\n  updateNode: (nodeId: string, data: Partial<PlaybookNodeData>) => void;\r\n  removeNode: (nodeId: string) => void;\r\n\r\n  // Edge actions\r\n  setEdges: (edges: Edge[]) => void;\r\n  onEdgesChange: (changes: EdgeChange[]) => void;\r\n  onConnect: (connection: Connection) => void;\r\n\r\n  // Selection\r\n  selectNode: (nodeId: string | null) => void;\r\n\r\n  // Drag and drop\r\n  onDrop: (position: XYPosition, nodeType: PlaybookNodeData['type'], label: string) => void;\r\n\r\n  // Persistence\r\n  loadFromJson: (json: string) => void;\r\n  toJson: () => string;\r\n  markSaved: () => void;\r\n  markDirty: () => void;\r\n\r\n  // Reset\r\n  reset: () => void;\r\n}\r\n\r\n// Generate unique ID for new nodes\r\nconst generateNodeId = () => `node_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n\r\n// Initial state\r\nconst initialState = {\r\n  nodes: [] as PlaybookNode[],\r\n  edges: [] as Edge[],\r\n  selectedNodeId: null as string | null,\r\n  isDirty: false,\r\n  lastSavedJson: null as string | null,\r\n};\r\n\r\n// Canvas JSON structure for persistence\r\ninterface CanvasJson {\r\n  nodes: PlaybookNode[];\r\n  edges: Edge[];\r\n  version: number;\r\n}\r\n\r\nconst CANVAS_JSON_VERSION = 1;\r\n\r\n/**\r\n * Zustand store for React Flow canvas state management.\r\n * Handles nodes, edges, selections, and drag-drop operations.\r\n */\r\nexport const useCanvasStore = create<CanvasState>((set, get) => ({\r\n  ...initialState,\r\n\r\n  // Node state setters\r\n  setNodes: (nodes) => set({ nodes, isDirty: true }),\r\n\r\n  onNodesChange: (changes) =>\r\n    set((state) => ({\r\n      nodes: applyNodeChanges(changes, state.nodes),\r\n      isDirty: true,\r\n    })),\r\n\r\n  addNode: (node) =>\r\n    set((state) => ({\r\n      nodes: [...state.nodes, node],\r\n      isDirty: true,\r\n    })),\r\n\r\n  updateNode: (nodeId, data) =>\r\n    set((state) => ({\r\n      nodes: state.nodes.map((node) =>\r\n        node.id === nodeId\r\n          ? { ...node, data: { ...node.data, ...data } }\r\n          : node\r\n      ),\r\n      isDirty: true,\r\n    })),\r\n\r\n  removeNode: (nodeId) =>\r\n    set((state) => ({\r\n      nodes: state.nodes.filter((node) => node.id !== nodeId),\r\n      edges: state.edges.filter(\r\n        (edge) => edge.source !== nodeId && edge.target !== nodeId\r\n      ),\r\n      selectedNodeId: state.selectedNodeId === nodeId ? null : state.selectedNodeId,\r\n      isDirty: true,\r\n    })),\r\n\r\n  // Edge state setters\r\n  setEdges: (edges) => set({ edges, isDirty: true }),\r\n\r\n  onEdgesChange: (changes) =>\r\n    set((state) => ({\r\n      edges: applyEdgeChanges(changes, state.edges),\r\n      isDirty: true,\r\n    })),\r\n\r\n  onConnect: (connection) =>\r\n    set((state) => ({\r\n      edges: addEdge(\r\n        {\r\n          ...connection,\r\n          type: 'smoothstep',\r\n          animated: true,\r\n        },\r\n        state.edges\r\n      ),\r\n      isDirty: true,\r\n    })),\r\n\r\n  // Selection\r\n  selectNode: (nodeId) => set({ selectedNodeId: nodeId }),\r\n\r\n  // Drag and drop handler\r\n  onDrop: (position, nodeType, label) => {\r\n    const newNode: PlaybookNode = {\r\n      id: generateNodeId(),\r\n      type: nodeType, // Uses custom node component from nodeTypes registry\r\n      position,\r\n      data: {\r\n        label,\r\n        type: nodeType,\r\n        outputVariable: `output_${nodeType}`,\r\n      },\r\n    };\r\n    get().addNode(newNode);\r\n    get().selectNode(newNode.id);\r\n  },\r\n\r\n  // Persistence\r\n  loadFromJson: (json: string) => {\r\n    try {\r\n      const data: CanvasJson = JSON.parse(json);\r\n      set({\r\n        nodes: data.nodes || [],\r\n        edges: data.edges || [],\r\n        selectedNodeId: null,\r\n        isDirty: false,\r\n        lastSavedJson: json,\r\n      });\r\n      console.info('[CanvasStore] Loaded canvas from JSON');\r\n    } catch (error) {\r\n      console.error('[CanvasStore] Failed to parse canvas JSON:', error);\r\n    }\r\n  },\r\n\r\n  toJson: () => {\r\n    const { nodes, edges } = get();\r\n    const data: CanvasJson = {\r\n      nodes,\r\n      edges,\r\n      version: CANVAS_JSON_VERSION,\r\n    };\r\n    return JSON.stringify(data);\r\n  },\r\n\r\n  markSaved: () => {\r\n    const json = get().toJson();\r\n    set({ isDirty: false, lastSavedJson: json });\r\n  },\r\n\r\n  markDirty: () => set({ isDirty: true }),\r\n\r\n  // Reset canvas\r\n  reset: () => set(initialState),\r\n}));\r\n","/**\r\n * useHostBridge Hook\r\n *\r\n * Connects the HostBridge service with the canvasStore.\r\n * Handles initialization, dirty state sync, and save operations.\r\n *\r\n * Usage:\r\n *   const { isReady, save, isDirty } = useHostBridge();\r\n */\r\n\r\nimport { useEffect, useCallback, useRef } from 'react';\r\nimport { HostBridge } from '../services/hostBridge';\r\nimport { useCanvasStore } from '../stores/canvasStore';\r\nimport type { InitMessage, SaveSuccessMessage, SaveErrorMessage } from '../types/messages';\r\n\r\ninterface UseHostBridgeOptions {\r\n  /** Callback when save is successful */\r\n  onSaveSuccess?: () => void;\r\n  /** Callback when save fails */\r\n  onSaveError?: (error: string) => void;\r\n  /** Callback when theme changes from host */\r\n  onThemeChange?: (theme: 'light' | 'dark') => void;\r\n}\r\n\r\ninterface UseHostBridgeResult {\r\n  /** Whether the bridge is initialized and ready */\r\n  isReady: boolean;\r\n  /** Whether the canvas has unsaved changes */\r\n  isDirty: boolean;\r\n  /** Whether we're running in an iframe (embedded in host) */\r\n  isEmbedded: boolean;\r\n  /** Save current canvas state to host */\r\n  save: () => void;\r\n  /** Playbook ID from host */\r\n  playbookId: string;\r\n  /** Playbook name from host */\r\n  playbookName: string;\r\n}\r\n\r\nexport function useHostBridge(options: UseHostBridgeOptions = {}): UseHostBridgeResult {\r\n  const { onSaveSuccess, onSaveError, onThemeChange } = options;\r\n\r\n  // Store selectors\r\n  const isDirty = useCanvasStore((s) => s.isDirty);\r\n  const loadFromJson = useCanvasStore((s) => s.loadFromJson);\r\n  const toJson = useCanvasStore((s) => s.toJson);\r\n  const markSaved = useCanvasStore((s) => s.markSaved);\r\n\r\n  // Bridge state refs (to avoid re-renders)\r\n  const bridgeRef = useRef<HostBridge | null>(null);\r\n  const isReadyRef = useRef(false);\r\n  const playbookIdRef = useRef('');\r\n  const playbookNameRef = useRef('');\r\n\r\n  // Track previous dirty state for change detection\r\n  const prevIsDirtyRef = useRef(isDirty);\r\n\r\n  // Handle INIT message from host\r\n  const handleInit = useCallback(\r\n    (payload: InitMessage['payload']) => {\r\n      console.info('[useHostBridge] Received INIT from host');\r\n      playbookIdRef.current = payload.playbookId;\r\n      playbookNameRef.current = payload.playbookName;\r\n\r\n      if (payload.canvasJson) {\r\n        loadFromJson(payload.canvasJson);\r\n      }\r\n\r\n      isReadyRef.current = true;\r\n    },\r\n    [loadFromJson]\r\n  );\r\n\r\n  // Handle SAVE_SUCCESS message from host\r\n  const handleSaveSuccess = useCallback(\r\n    (_payload: SaveSuccessMessage['payload']) => {\r\n      console.info('[useHostBridge] Save successful');\r\n      markSaved();\r\n      onSaveSuccess?.();\r\n    },\r\n    [markSaved, onSaveSuccess]\r\n  );\r\n\r\n  // Handle SAVE_ERROR message from host\r\n  const handleSaveError = useCallback(\r\n    (payload: SaveErrorMessage['payload']) => {\r\n      console.error('[useHostBridge] Save failed:', payload.error);\r\n      onSaveError?.(payload.error);\r\n    },\r\n    [onSaveError]\r\n  );\r\n\r\n  // Handle THEME_CHANGE message from host\r\n  const handleThemeChange = useCallback(\r\n    (payload: { theme: 'light' | 'dark' }) => {\r\n      console.info('[useHostBridge] Theme changed:', payload.theme);\r\n      onThemeChange?.(payload.theme);\r\n    },\r\n    [onThemeChange]\r\n  );\r\n\r\n  // Initialize bridge on mount\r\n  useEffect(() => {\r\n    const bridge = HostBridge.getInstance({\r\n      onInit: handleInit,\r\n      onSaveSuccess: handleSaveSuccess,\r\n      onSaveError: handleSaveError,\r\n      onThemeChange: handleThemeChange,\r\n    });\r\n\r\n    bridgeRef.current = bridge;\r\n    bridge.initialize();\r\n\r\n    return () => {\r\n      // Don't destroy on unmount - singleton persists\r\n    };\r\n  }, [handleInit, handleSaveSuccess, handleSaveError, handleThemeChange]);\r\n\r\n  // Sync dirty state changes to host\r\n  useEffect(() => {\r\n    if (prevIsDirtyRef.current !== isDirty) {\r\n      prevIsDirtyRef.current = isDirty;\r\n      bridgeRef.current?.sendDirtyChange(isDirty);\r\n    }\r\n  }, [isDirty]);\r\n\r\n  // Save function\r\n  const save = useCallback(() => {\r\n    if (!bridgeRef.current) {\r\n      console.warn('[useHostBridge] Bridge not initialized');\r\n      return;\r\n    }\r\n\r\n    const canvasJson = toJson();\r\n    bridgeRef.current.sendSaveRequest(canvasJson);\r\n    console.info('[useHostBridge] Save request sent');\r\n  }, [toJson]);\r\n\r\n  // Check if embedded (memo'd to avoid re-computation)\r\n  const isEmbedded = bridgeRef.current?.isEmbedded() ?? false;\r\n\r\n  return {\r\n    isReady: isReadyRef.current,\r\n    isDirty,\r\n    isEmbedded,\r\n    save,\r\n    playbookId: playbookIdRef.current,\r\n    playbookName: playbookNameRef.current,\r\n  };\r\n}\r\n","import { create } from 'zustand';\r\nimport type { PlaybookDefinition, PlaybookNode } from '../types';\r\n\r\ninterface PlaybookState {\r\n  // State\r\n  playbook: PlaybookDefinition | null;\r\n  selectedNodeId: string | null;\r\n  isDirty: boolean;\r\n\r\n  // Actions\r\n  setPlaybook: (playbook: PlaybookDefinition) => void;\r\n  selectNode: (nodeId: string | null) => void;\r\n  addNode: (node: PlaybookNode) => void;\r\n  updateNode: (nodeId: string, updates: Partial<PlaybookNode>) => void;\r\n  removeNode: (nodeId: string) => void;\r\n  setDirty: (isDirty: boolean) => void;\r\n}\r\n\r\n/**\r\n * Zustand store for playbook builder state management.\r\n * Handles playbook definition, node selection, and dirty state.\r\n */\r\nexport const usePlaybookStore = create<PlaybookState>((set) => ({\r\n  // Initial state\r\n  playbook: null,\r\n  selectedNodeId: null,\r\n  isDirty: false,\r\n\r\n  // Actions\r\n  setPlaybook: (playbook) => set({ playbook, isDirty: false }),\r\n\r\n  selectNode: (nodeId) => set({ selectedNodeId: nodeId }),\r\n\r\n  addNode: (node) =>\r\n    set((state) => {\r\n      if (!state.playbook) return state;\r\n      return {\r\n        playbook: {\r\n          ...state.playbook,\r\n          nodes: [...state.playbook.nodes, node],\r\n        },\r\n        isDirty: true,\r\n      };\r\n    }),\r\n\r\n  updateNode: (nodeId, updates) =>\r\n    set((state) => {\r\n      if (!state.playbook) return state;\r\n      return {\r\n        playbook: {\r\n          ...state.playbook,\r\n          nodes: state.playbook.nodes.map((node) =>\r\n            node.id === nodeId ? { ...node, ...updates } : node\r\n          ),\r\n        },\r\n        isDirty: true,\r\n      };\r\n    }),\r\n\r\n  removeNode: (nodeId) =>\r\n    set((state) => {\r\n      if (!state.playbook) return state;\r\n      return {\r\n        playbook: {\r\n          ...state.playbook,\r\n          nodes: state.playbook.nodes.filter((node) => node.id !== nodeId),\r\n        },\r\n        selectedNodeId:\r\n          state.selectedNodeId === nodeId ? null : state.selectedNodeId,\r\n        isDirty: true,\r\n      };\r\n    }),\r\n\r\n  setDirty: (isDirty) => set({ isDirty }),\r\n}));\r\n","import { create } from 'zustand';\r\nimport type { PlaybookNodeType } from './canvasStore';\r\n\r\n// Scope item types\r\nexport interface ScopeItem {\r\n  id: string;\r\n  name: string;\r\n  description?: string;\r\n}\r\n\r\nexport interface SkillItem extends ScopeItem {\r\n  category: 'extraction' | 'analysis' | 'generation' | 'classification';\r\n}\r\n\r\nexport interface KnowledgeItem extends ScopeItem {\r\n  type: 'document' | 'datasource' | 'inline';\r\n}\r\n\r\nexport interface ToolItem extends ScopeItem {\r\n  handlerType: string;\r\n}\r\n\r\n// Action type compatibility settings\r\nexport interface ActionTypeCapabilities {\r\n  allowsSkills: boolean;\r\n  allowsKnowledge: boolean;\r\n  allowsTools: boolean;\r\n}\r\n\r\n// Compatibility map by node type\r\nconst actionTypeCapabilities: Record<PlaybookNodeType, ActionTypeCapabilities> = {\r\n  aiAnalysis: { allowsSkills: true, allowsKnowledge: true, allowsTools: true },\r\n  aiCompletion: { allowsSkills: true, allowsKnowledge: true, allowsTools: true },\r\n  condition: { allowsSkills: false, allowsKnowledge: false, allowsTools: false },\r\n  deliverOutput: { allowsSkills: false, allowsKnowledge: true, allowsTools: true },\r\n  createTask: { allowsSkills: false, allowsKnowledge: false, allowsTools: false },\r\n  sendEmail: { allowsSkills: false, allowsKnowledge: true, allowsTools: false },\r\n  wait: { allowsSkills: false, allowsKnowledge: false, allowsTools: false },\r\n};\r\n\r\n// Mock skills data (will be replaced with API calls)\r\nconst mockSkills: SkillItem[] = [\r\n  { id: 'skill-1', name: 'Entity Extraction', description: 'Extract named entities from text', category: 'extraction' },\r\n  { id: 'skill-2', name: 'Key Phrase Extraction', description: 'Identify key phrases and topics', category: 'extraction' },\r\n  { id: 'skill-3', name: 'Sentiment Analysis', description: 'Analyze sentiment and tone', category: 'analysis' },\r\n  { id: 'skill-4', name: 'Document Classification', description: 'Classify document type and category', category: 'classification' },\r\n  { id: 'skill-5', name: 'Text Summarization', description: 'Generate concise summaries', category: 'generation' },\r\n  { id: 'skill-6', name: 'Risk Identification', description: 'Identify potential risks and issues', category: 'analysis' },\r\n];\r\n\r\n// Mock knowledge data (will be replaced with API calls)\r\nconst mockKnowledge: KnowledgeItem[] = [\r\n  { id: 'knowledge-1', name: 'Company Policies', description: 'Internal policy documents', type: 'document' },\r\n  { id: 'knowledge-2', name: 'Legal Templates', description: 'Standard contract templates', type: 'document' },\r\n  { id: 'knowledge-3', name: 'Customer Database', description: 'CRM customer records', type: 'datasource' },\r\n  { id: 'knowledge-4', name: 'Product Catalog', description: 'Product specifications and pricing', type: 'datasource' },\r\n  { id: 'knowledge-5', name: 'Instructions', description: 'Custom inline instructions', type: 'inline' },\r\n];\r\n\r\n// Mock tools data (will be replaced with API calls)\r\nconst mockTools: ToolItem[] = [\r\n  { id: 'tool-1', name: 'Document Analyzer', description: 'Azure AI Document Intelligence', handlerType: 'DocumentAnalyzer' },\r\n  { id: 'tool-2', name: 'Search Index', description: 'Azure AI Search integration', handlerType: 'SearchIndex' },\r\n  { id: 'tool-3', name: 'GPT-4 Completion', description: 'Azure OpenAI GPT-4 completion', handlerType: 'GptCompletion' },\r\n  { id: 'tool-4', name: 'Word Generator', description: 'Generate Word documents', handlerType: 'WordGenerator' },\r\n  { id: 'tool-5', name: 'PDF Generator', description: 'Generate PDF documents', handlerType: 'PdfGenerator' },\r\n];\r\n\r\ninterface ScopeState {\r\n  // Available scope items\r\n  skills: SkillItem[];\r\n  knowledge: KnowledgeItem[];\r\n  tools: ToolItem[];\r\n\r\n  // Loading states (for future API integration)\r\n  isLoadingSkills: boolean;\r\n  isLoadingKnowledge: boolean;\r\n  isLoadingTools: boolean;\r\n\r\n  // Get capabilities for a node type\r\n  getCapabilities: (nodeType: PlaybookNodeType) => ActionTypeCapabilities;\r\n\r\n  // Get items by IDs\r\n  getSkillsByIds: (ids: string[]) => SkillItem[];\r\n  getKnowledgeByIds: (ids: string[]) => KnowledgeItem[];\r\n  getToolById: (id: string) => ToolItem | undefined;\r\n\r\n  // Future: API fetch methods\r\n  // fetchSkills: () => Promise<void>;\r\n  // fetchKnowledge: () => Promise<void>;\r\n  // fetchTools: () => Promise<void>;\r\n}\r\n\r\n/**\r\n * Zustand store for scope selections (skills, knowledge, tools).\r\n * Uses mock data for now - will be replaced with API calls.\r\n */\r\nexport const useScopeStore = create<ScopeState>(() => ({\r\n  // Initialize with mock data\r\n  skills: mockSkills,\r\n  knowledge: mockKnowledge,\r\n  tools: mockTools,\r\n\r\n  // Loading states\r\n  isLoadingSkills: false,\r\n  isLoadingKnowledge: false,\r\n  isLoadingTools: false,\r\n\r\n  // Get capabilities for a node type\r\n  getCapabilities: (nodeType: PlaybookNodeType) => {\r\n    return actionTypeCapabilities[nodeType] || {\r\n      allowsSkills: false,\r\n      allowsKnowledge: false,\r\n      allowsTools: false,\r\n    };\r\n  },\r\n\r\n  // Get skills by IDs\r\n  getSkillsByIds: (ids: string[]) => {\r\n    return mockSkills.filter((s) => ids.includes(s.id));\r\n  },\r\n\r\n  // Get knowledge by IDs\r\n  getKnowledgeByIds: (ids: string[]) => {\r\n    return mockKnowledge.filter((k) => ids.includes(k.id));\r\n  },\r\n\r\n  // Get tool by ID\r\n  getToolById: (id: string) => {\r\n    return mockTools.find((t) => t.id === id);\r\n  },\r\n}));\r\n","import { ReactNode, memo } from 'react';\r\nimport { Handle, Position } from '@xyflow/react';\r\nimport { makeStyles, tokens, Text, mergeClasses, shorthands } from '@fluentui/react-components';\r\nimport type { PlaybookNodeData, PlaybookNodeType } from '../../stores';\r\n\r\nconst useStyles = makeStyles({\r\n  container: {\r\n    minWidth: '180px',\r\n    maxWidth: '220px',\r\n    ...shorthands.borderRadius(tokens.borderRadiusMedium),\r\n    backgroundColor: tokens.colorNeutralBackground1,\r\n    ...shorthands.border('1px', 'solid', tokens.colorNeutralStroke1),\r\n    boxShadow: tokens.shadow4,\r\n    ...shorthands.overflow('hidden'),\r\n    transitionProperty: 'box-shadow, border-color',\r\n    transitionDuration: '0.2s',\r\n    transitionTimingFunction: 'ease',\r\n  },\r\n  selected: {\r\n    ...shorthands.borderColor(tokens.colorBrandStroke1),\r\n    boxShadow: tokens.shadow16,\r\n  },\r\n  header: {\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    gap: tokens.spacingHorizontalS,\r\n    padding: `${tokens.spacingVerticalS} ${tokens.spacingHorizontalM}`,\r\n    borderBottom: `1px solid ${tokens.colorNeutralStroke2}`,\r\n  },\r\n  iconWrapper: {\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    width: '28px',\r\n    height: '28px',\r\n    borderRadius: tokens.borderRadiusSmall,\r\n    flexShrink: 0,\r\n  },\r\n  headerText: {\r\n    flex: 1,\r\n    overflow: 'hidden',\r\n  },\r\n  label: {\r\n    display: 'block',\r\n    whiteSpace: 'nowrap',\r\n    overflow: 'hidden',\r\n    textOverflow: 'ellipsis',\r\n  },\r\n  typeLabel: {\r\n    display: 'block',\r\n    color: tokens.colorNeutralForeground3,\r\n  },\r\n  body: {\r\n    padding: `${tokens.spacingVerticalS} ${tokens.spacingHorizontalM}`,\r\n  },\r\n});\r\n\r\n// Node color schemes by type\r\nexport const nodeColorSchemes: Record<PlaybookNodeType, { background: string; iconColor: string }> = {\r\n  aiAnalysis: { background: '#0078D4', iconColor: '#ffffff' },\r\n  aiCompletion: { background: '#0078D4', iconColor: '#ffffff' },\r\n  condition: { background: '#FFB900', iconColor: '#000000' },\r\n  deliverOutput: { background: '#107C10', iconColor: '#ffffff' },\r\n  createTask: { background: '#8764B8', iconColor: '#ffffff' },\r\n  sendEmail: { background: '#8764B8', iconColor: '#ffffff' },\r\n  wait: { background: '#E3008C', iconColor: '#ffffff' },\r\n};\r\n\r\nexport interface BaseNodeProps {\r\n  data: PlaybookNodeData;\r\n  selected?: boolean;\r\n  icon: ReactNode;\r\n  typeLabel: string;\r\n  children?: ReactNode;\r\n  sourceHandleCount?: number;\r\n  targetHandleCount?: number;\r\n}\r\n\r\n/**\r\n * Base node component providing common structure for all node types.\r\n * Includes header with icon/label, body content area, and connection handles.\r\n */\r\nexport const BaseNode = memo(function BaseNode({\r\n  data,\r\n  selected,\r\n  icon,\r\n  typeLabel,\r\n  children,\r\n  sourceHandleCount = 1,\r\n  targetHandleCount = 1,\r\n}: BaseNodeProps) {\r\n  const styles = useStyles();\r\n  const colorScheme = nodeColorSchemes[data.type];\r\n\r\n  return (\r\n    <div className={mergeClasses(styles.container, selected && styles.selected)}>\r\n      {/* Target handle (input) */}\r\n      {targetHandleCount > 0 && (\r\n        <Handle type=\"target\" position={Position.Top} />\r\n      )}\r\n\r\n      {/* Header */}\r\n      <div className={styles.header}>\r\n        <div\r\n          className={styles.iconWrapper}\r\n          style={{\r\n            backgroundColor: colorScheme.background,\r\n            color: colorScheme.iconColor,\r\n          }}\r\n        >\r\n          {icon}\r\n        </div>\r\n        <div className={styles.headerText}>\r\n          <Text size={300} weight=\"semibold\" className={styles.label}>\r\n            {data.label}\r\n          </Text>\r\n          <Text size={100} className={styles.typeLabel}>\r\n            {typeLabel}\r\n          </Text>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Body content */}\r\n      {children && <div className={styles.body}>{children}</div>}\r\n\r\n      {/* Source handle (output) */}\r\n      {sourceHandleCount > 0 && (\r\n        <Handle type=\"source\" position={Position.Bottom} />\r\n      )}\r\n    </div>\r\n  );\r\n});\r\n","import { memo } from 'react';\r\nimport { Text, tokens } from '@fluentui/react-components';\r\nimport { BrainCircuit20Regular } from '@fluentui/react-icons';\r\nimport { BaseNode } from './BaseNode';\r\nimport type { PlaybookNodeData } from '../../stores';\r\n\r\ninterface AiAnalysisNodeProps {\r\n  data: PlaybookNodeData;\r\n  selected?: boolean;\r\n}\r\n\r\n/**\r\n * AI Analysis node - processes data with AI and produces structured output.\r\n * Use for: document analysis, entity extraction, classification.\r\n */\r\nexport const AiAnalysisNode = memo(function AiAnalysisNode({ data, selected }: AiAnalysisNodeProps) {\r\n  return (\r\n    <BaseNode data={data} selected={selected} icon={<BrainCircuit20Regular />} typeLabel=\"AI Analysis\">\r\n      {data.outputVariable && (\r\n        <Text size={100} style={{ color: tokens.colorNeutralForeground3 }}>\r\n          Output: {data.outputVariable}\r\n        </Text>\r\n      )}\r\n    </BaseNode>\r\n  );\r\n});\r\n","import { memo } from 'react';\r\nimport { Text, tokens } from '@fluentui/react-components';\r\nimport { BrainCircuit20Regular } from '@fluentui/react-icons';\r\nimport { BaseNode } from './BaseNode';\r\nimport type { PlaybookNodeData } from '../../stores';\r\n\r\ninterface AiCompletionNodeProps {\r\n  data: PlaybookNodeData;\r\n  selected?: boolean;\r\n}\r\n\r\n/**\r\n * AI Completion node - generates text using AI completion.\r\n * Use for: drafting emails, creating summaries, generating content.\r\n */\r\nexport const AiCompletionNode = memo(function AiCompletionNode({ data, selected }: AiCompletionNodeProps) {\r\n  return (\r\n    <BaseNode data={data} selected={selected} icon={<BrainCircuit20Regular />} typeLabel=\"AI Completion\">\r\n      {data.outputVariable && (\r\n        <Text size={100} style={{ color: tokens.colorNeutralForeground3 }}>\r\n          Output: {data.outputVariable}\r\n        </Text>\r\n      )}\r\n    </BaseNode>\r\n  );\r\n});\r\n","import { memo } from 'react';\r\nimport { Handle, Position } from '@xyflow/react';\r\nimport { makeStyles, tokens, Text, mergeClasses, shorthands } from '@fluentui/react-components';\r\nimport { Branch20Regular } from '@fluentui/react-icons';\r\nimport type { PlaybookNodeData, PlaybookNodeType } from '../../stores';\r\n\r\nconst nodeColorSchemes: Record<PlaybookNodeType, { background: string; iconColor: string }> = {\r\n  aiAnalysis: { background: '#0078D4', iconColor: '#ffffff' },\r\n  aiCompletion: { background: '#0078D4', iconColor: '#ffffff' },\r\n  condition: { background: '#FFB900', iconColor: '#000000' },\r\n  deliverOutput: { background: '#107C10', iconColor: '#ffffff' },\r\n  createTask: { background: '#8764B8', iconColor: '#ffffff' },\r\n  sendEmail: { background: '#8764B8', iconColor: '#ffffff' },\r\n  wait: { background: '#E3008C', iconColor: '#ffffff' },\r\n};\r\n\r\nconst useStyles = makeStyles({\r\n  container: {\r\n    minWidth: '180px',\r\n    maxWidth: '220px',\r\n    ...shorthands.borderRadius(tokens.borderRadiusMedium),\r\n    backgroundColor: tokens.colorNeutralBackground1,\r\n    ...shorthands.border('1px', 'solid', tokens.colorNeutralStroke1),\r\n    boxShadow: tokens.shadow4,\r\n    ...shorthands.overflow('hidden'),\r\n    transitionProperty: 'box-shadow, border-color',\r\n    transitionDuration: '0.2s',\r\n    transitionTimingFunction: 'ease',\r\n  },\r\n  selected: {\r\n    ...shorthands.borderColor(tokens.colorBrandStroke1),\r\n    boxShadow: tokens.shadow16,\r\n  },\r\n  header: {\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    gap: tokens.spacingHorizontalS,\r\n    padding: `${tokens.spacingVerticalS} ${tokens.spacingHorizontalM}`,\r\n    borderBottom: `1px solid ${tokens.colorNeutralStroke2}`,\r\n  },\r\n  iconWrapper: {\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    width: '28px',\r\n    height: '28px',\r\n    borderRadius: tokens.borderRadiusSmall,\r\n    flexShrink: 0,\r\n  },\r\n  headerText: {\r\n    flex: 1,\r\n    overflow: 'hidden',\r\n  },\r\n  label: {\r\n    display: 'block',\r\n    whiteSpace: 'nowrap',\r\n    overflow: 'hidden',\r\n    textOverflow: 'ellipsis',\r\n  },\r\n  typeLabel: {\r\n    display: 'block',\r\n    color: tokens.colorNeutralForeground3,\r\n  },\r\n  branches: {\r\n    display: 'flex',\r\n    justifyContent: 'space-between',\r\n    padding: `${tokens.spacingVerticalXS} ${tokens.spacingHorizontalM}`,\r\n    borderTop: `1px solid ${tokens.colorNeutralStroke2}`,\r\n    position: 'relative',\r\n  },\r\n  branchLabel: {\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    alignItems: 'center',\r\n    gap: tokens.spacingVerticalXS,\r\n    flex: 1,\r\n  },\r\n  trueBranch: {\r\n    color: tokens.colorPaletteGreenForeground1,\r\n  },\r\n  falseBranch: {\r\n    color: tokens.colorPaletteRedForeground1,\r\n  },\r\n});\r\n\r\ninterface ConditionNodeProps {\r\n  data: PlaybookNodeData;\r\n  selected?: boolean;\r\n}\r\n\r\n/**\r\n * Condition node - branches execution flow based on a condition.\r\n * Has two outputs: true (left) and false (right).\r\n */\r\nexport const ConditionNode = memo(function ConditionNode({ data, selected }: ConditionNodeProps) {\r\n  const styles = useStyles();\r\n  const colorScheme = nodeColorSchemes[data.type];\r\n\r\n  return (\r\n    <div className={mergeClasses(styles.container, selected && styles.selected)}>\r\n      {/* Target handle (input) */}\r\n      <Handle type=\"target\" position={Position.Top} />\r\n\r\n      {/* Header */}\r\n      <div className={styles.header}>\r\n        <div\r\n          className={styles.iconWrapper}\r\n          style={{\r\n            backgroundColor: colorScheme.background,\r\n            color: colorScheme.iconColor,\r\n          }}\r\n        >\r\n          <Branch20Regular />\r\n        </div>\r\n        <div className={styles.headerText}>\r\n          <Text size={300} weight=\"semibold\" className={styles.label}>\r\n            {data.label}\r\n          </Text>\r\n          <Text size={100} className={styles.typeLabel}>\r\n            Condition\r\n          </Text>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Branch labels */}\r\n      <div className={styles.branches}>\r\n        <div className={styles.branchLabel}>\r\n          <Text size={100} weight=\"semibold\" className={styles.trueBranch}>\r\n            True\r\n          </Text>\r\n        </div>\r\n        <div className={styles.branchLabel}>\r\n          <Text size={100} weight=\"semibold\" className={styles.falseBranch}>\r\n            False\r\n          </Text>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Source handles (two outputs) */}\r\n      <Handle type=\"source\" position={Position.Bottom} id=\"true\" style={{ left: '25%' }} />\r\n      <Handle type=\"source\" position={Position.Bottom} id=\"false\" style={{ left: '75%' }} />\r\n    </div>\r\n  );\r\n});\r\n","import { memo } from 'react';\r\nimport { Text, tokens } from '@fluentui/react-components';\r\nimport { DocumentArrowRight20Regular } from '@fluentui/react-icons';\r\nimport { BaseNode } from './BaseNode';\r\nimport type { PlaybookNodeData } from '../../stores';\r\n\r\ninterface DeliverOutputNodeProps {\r\n  data: PlaybookNodeData;\r\n  selected?: boolean;\r\n}\r\n\r\n/**\r\n * Deliver Output node - outputs data to Power Apps or other consumers.\r\n * Terminal node (no output handle).\r\n */\r\nexport const DeliverOutputNode = memo(function DeliverOutputNode({ data, selected }: DeliverOutputNodeProps) {\r\n  return (\r\n    <BaseNode\r\n      data={data}\r\n      selected={selected}\r\n      icon={<DocumentArrowRight20Regular />}\r\n      typeLabel=\"Deliver Output\"\r\n      sourceHandleCount={0}\r\n    >\r\n      {data.outputVariable && (\r\n        <Text size={100} style={{ color: tokens.colorNeutralForeground3 }}>\r\n          Variable: {data.outputVariable}\r\n        </Text>\r\n      )}\r\n    </BaseNode>\r\n  );\r\n});\r\n","import { memo } from 'react';\r\nimport { Text, tokens } from '@fluentui/react-components';\r\nimport { TaskListSquareLtr20Regular } from '@fluentui/react-icons';\r\nimport { BaseNode } from './BaseNode';\r\nimport type { PlaybookNodeData } from '../../stores';\r\n\r\ninterface CreateTaskNodeProps {\r\n  data: PlaybookNodeData;\r\n  selected?: boolean;\r\n}\r\n\r\n/**\r\n * Create Task node - creates a Dataverse task record.\r\n * Use for: follow-up actions, workflow assignments.\r\n */\r\nexport const CreateTaskNode = memo(function CreateTaskNode({ data, selected }: CreateTaskNodeProps) {\r\n  return (\r\n    <BaseNode data={data} selected={selected} icon={<TaskListSquareLtr20Regular />} typeLabel=\"Create Task\">\r\n      {data.outputVariable && (\r\n        <Text size={100} style={{ color: tokens.colorNeutralForeground3 }}>\r\n          Output: {data.outputVariable}\r\n        </Text>\r\n      )}\r\n    </BaseNode>\r\n  );\r\n});\r\n","import { memo } from 'react';\r\nimport { Text, tokens } from '@fluentui/react-components';\r\nimport { Mail20Regular } from '@fluentui/react-icons';\r\nimport { BaseNode } from './BaseNode';\r\nimport type { PlaybookNodeData } from '../../stores';\r\n\r\ninterface SendEmailNodeProps {\r\n  data: PlaybookNodeData;\r\n  selected?: boolean;\r\n}\r\n\r\n/**\r\n * Send Email node - sends an email via Dataverse.\r\n * Use for: notifications, reports, automated communications.\r\n */\r\nexport const SendEmailNode = memo(function SendEmailNode({ data, selected }: SendEmailNodeProps) {\r\n  return (\r\n    <BaseNode data={data} selected={selected} icon={<Mail20Regular />} typeLabel=\"Send Email\">\r\n      {data.outputVariable && (\r\n        <Text size={100} style={{ color: tokens.colorNeutralForeground3 }}>\r\n          Output: {data.outputVariable}\r\n        </Text>\r\n      )}\r\n    </BaseNode>\r\n  );\r\n});\r\n","import { memo } from 'react';\r\nimport { Text, tokens } from '@fluentui/react-components';\r\nimport { Clock20Regular } from '@fluentui/react-icons';\r\nimport { BaseNode } from './BaseNode';\r\nimport type { PlaybookNodeData } from '../../stores';\r\n\r\ninterface WaitNodeProps {\r\n  data: PlaybookNodeData;\r\n  selected?: boolean;\r\n}\r\n\r\n/**\r\n * Wait node - pauses execution for human approval or time delay.\r\n * Use for: approval gates, human review steps, timed waits.\r\n */\r\nexport const WaitNode = memo(function WaitNode({ data, selected }: WaitNodeProps) {\r\n  return (\r\n    <BaseNode data={data} selected={selected} icon={<Clock20Regular />} typeLabel=\"Wait\">\r\n      {data.outputVariable && (\r\n        <Text size={100} style={{ color: tokens.colorNeutralForeground3 }}>\r\n          Output: {data.outputVariable}\r\n        </Text>\r\n      )}\r\n    </BaseNode>\r\n  );\r\n});\r\n","import type { ComponentType } from 'react';\r\nimport { AiAnalysisNode } from './AiAnalysisNode';\r\nimport { AiCompletionNode } from './AiCompletionNode';\r\nimport { ConditionNode } from './ConditionNode';\r\nimport { DeliverOutputNode } from './DeliverOutputNode';\r\nimport { CreateTaskNode } from './CreateTaskNode';\r\nimport { SendEmailNode } from './SendEmailNode';\r\nimport { WaitNode } from './WaitNode';\r\n\r\n/**\r\n * Node type registry for React Flow.\r\n * Maps node type strings to their React components.\r\n *\r\n * React Flow passes props like { data, selected, id, ... } to custom nodes.\r\n * Our components extract what they need (data, selected).\r\n */\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\nexport const nodeTypes: Record<string, ComponentType<any>> = {\r\n  aiAnalysis: AiAnalysisNode,\r\n  aiCompletion: AiCompletionNode,\r\n  condition: ConditionNode,\r\n  deliverOutput: DeliverOutputNode,\r\n  createTask: CreateTaskNode,\r\n  sendEmail: SendEmailNode,\r\n  wait: WaitNode,\r\n};\r\n","import { useCallback, useRef, DragEvent, CSSProperties } from 'react';\r\nimport {\r\n  ReactFlow,\r\n  Background,\r\n  Controls,\r\n  MiniMap,\r\n  BackgroundVariant,\r\n  ReactFlowInstance,\r\n  Node,\r\n  Edge,\r\n} from '@xyflow/react';\r\nimport type { PlaybookNode } from '../../stores';\r\nimport { makeStyles, tokens } from '@fluentui/react-components';\r\nimport { useCanvasStore, PlaybookNodeData, PlaybookNodeType } from '../../stores';\r\nimport { nodeTypes } from '../Nodes';\r\nimport '@xyflow/react/dist/style.css';\r\n\r\nconst useStyles = makeStyles({\r\n  container: {\r\n    width: '100%',\r\n    height: '100%',\r\n    backgroundColor: tokens.colorNeutralBackground1,\r\n  },\r\n});\r\n\r\n// CSS custom properties for React Flow theming (applied via style attribute)\r\nconst reactFlowStyle: CSSProperties = {\r\n  // @ts-expect-error CSS custom properties\r\n  '--xy-background-color': tokens.colorNeutralBackground1,\r\n  '--xy-minimap-background': tokens.colorNeutralBackground2,\r\n  '--xy-controls-background': tokens.colorNeutralBackground2,\r\n  '--xy-controls-border-color': tokens.colorNeutralStroke1,\r\n};\r\n\r\n// Node colors based on type for minimap\r\nconst nodeColorByType: Record<PlaybookNodeType, string> = {\r\n  aiAnalysis: '#0078D4',     // Blue - AI operations\r\n  aiCompletion: '#0078D4',\r\n  condition: '#FFB900',       // Yellow - Control flow\r\n  deliverOutput: '#107C10',   // Green - Delivery\r\n  createTask: '#8764B8',      // Purple - Integration\r\n  sendEmail: '#8764B8',\r\n  wait: '#E3008C',           // Magenta - Control flow\r\n};\r\n\r\n/**\r\n * Main canvas component using React Flow.\r\n * Supports node placement, edge connections, zoom/pan, and drag-drop.\r\n */\r\nexport function Canvas() {\r\n  const styles = useStyles();\r\n  const reactFlowWrapper = useRef<HTMLDivElement>(null);\r\n  const reactFlowInstance = useRef<ReactFlowInstance<PlaybookNode, Edge> | null>(null);\r\n\r\n  // Get state and actions from store\r\n  const {\r\n    nodes,\r\n    edges,\r\n    onNodesChange,\r\n    onEdgesChange,\r\n    onConnect,\r\n    selectNode,\r\n    onDrop,\r\n  } = useCanvasStore();\r\n\r\n  // Handle React Flow initialization\r\n  const onInit = useCallback((instance: ReactFlowInstance<PlaybookNode, Edge>) => {\r\n    reactFlowInstance.current = instance;\r\n  }, []);\r\n\r\n  // Handle node selection\r\n  const onNodeClick = useCallback(\r\n    (_event: React.MouseEvent, node: Node) => {\r\n      selectNode(node.id);\r\n    },\r\n    [selectNode]\r\n  );\r\n\r\n  // Handle click on canvas (deselect)\r\n  const onPaneClick = useCallback(() => {\r\n    selectNode(null);\r\n  }, [selectNode]);\r\n\r\n  // Handle drag over for drop target\r\n  const onDragOver = useCallback((event: DragEvent<HTMLDivElement>) => {\r\n    event.preventDefault();\r\n    event.dataTransfer.dropEffect = 'move';\r\n  }, []);\r\n\r\n  // Handle drop from palette\r\n  const handleDrop = useCallback(\r\n    (event: DragEvent<HTMLDivElement>) => {\r\n      event.preventDefault();\r\n\r\n      if (!reactFlowWrapper.current || !reactFlowInstance.current) return;\r\n\r\n      // Get node data from drag event\r\n      const nodeTypeData = event.dataTransfer.getData('application/reactflow');\r\n      if (!nodeTypeData) return;\r\n\r\n      try {\r\n        const { type, label } = JSON.parse(nodeTypeData) as {\r\n          type: PlaybookNodeType;\r\n          label: string;\r\n        };\r\n\r\n        // Calculate drop position in flow coordinates\r\n        const bounds = reactFlowWrapper.current.getBoundingClientRect();\r\n        const position = reactFlowInstance.current.screenToFlowPosition({\r\n          x: event.clientX - bounds.left,\r\n          y: event.clientY - bounds.top,\r\n        });\r\n\r\n        onDrop(position, type, label);\r\n      } catch (e) {\r\n        console.error('Failed to parse dropped node data:', e);\r\n      }\r\n    },\r\n    [onDrop]\r\n  );\r\n\r\n  // MiniMap node color function\r\n  const getMinimapNodeColor = useCallback((node: Node): string => {\r\n    const nodeData = node.data as PlaybookNodeData;\r\n    return nodeColorByType[nodeData.type] || tokens.colorNeutralForeground3;\r\n  }, []);\r\n\r\n  return (\r\n    <div ref={reactFlowWrapper} className={styles.container}>\r\n      <ReactFlow\r\n        nodes={nodes}\r\n        edges={edges}\r\n        nodeTypes={nodeTypes}\r\n        onNodesChange={onNodesChange}\r\n        onEdgesChange={onEdgesChange}\r\n        onConnect={onConnect}\r\n        onInit={onInit}\r\n        onNodeClick={onNodeClick}\r\n        onPaneClick={onPaneClick}\r\n        onDragOver={onDragOver}\r\n        onDrop={handleDrop}\r\n        fitView\r\n        snapToGrid\r\n        snapGrid={[16, 16]}\r\n        defaultEdgeOptions={{\r\n          type: 'smoothstep',\r\n          animated: true,\r\n        }}\r\n        style={reactFlowStyle}\r\n        proOptions={{ hideAttribution: true }}\r\n      >\r\n        <Background\r\n          variant={BackgroundVariant.Dots}\r\n          gap={16}\r\n          size={1}\r\n          color={tokens.colorNeutralStroke2}\r\n        />\r\n        <Controls\r\n          showZoom\r\n          showFitView\r\n          showInteractive\r\n          position=\"bottom-left\"\r\n        />\r\n        <MiniMap\r\n          nodeColor={getMinimapNodeColor}\r\n          nodeStrokeWidth={2}\r\n          zoomable\r\n          pannable\r\n          position=\"bottom-right\"\r\n        />\r\n      </ReactFlow>\r\n    </div>\r\n  );\r\n}\r\n","import { useCallback, useMemo } from 'react';\r\nimport {\r\n  makeStyles,\r\n  tokens,\r\n  Text,\r\n  Label,\r\n  Dropdown,\r\n  Option,\r\n  Divider,\r\n  shorthands,\r\n  Checkbox,\r\n} from '@fluentui/react-components';\r\nimport type {\r\n  DropdownProps,\r\n  OptionOnSelectData,\r\n  SelectionEvents,\r\n  CheckboxOnChangeData,\r\n} from '@fluentui/react-components';\r\nimport {\r\n  BrainCircuitRegular,\r\n  LibraryRegular,\r\n  WrenchRegular,\r\n} from '@fluentui/react-icons';\r\nimport { useCanvasStore, PlaybookNodeType } from '../../stores';\r\nimport {\r\n  useScopeStore,\r\n  SkillItem,\r\n  KnowledgeItem,\r\n  ToolItem,\r\n} from '../../stores/scopeStore';\r\n\r\nconst useStyles = makeStyles({\r\n  container: {\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    gap: tokens.spacingVerticalM,\r\n  },\r\n  section: {\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    gap: tokens.spacingVerticalS,\r\n  },\r\n  sectionHeader: {\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    gap: tokens.spacingHorizontalS,\r\n    marginBottom: tokens.spacingVerticalXS,\r\n  },\r\n  checkboxGroup: {\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    gap: tokens.spacingVerticalXS,\r\n    ...shorthands.padding(tokens.spacingVerticalS, 0),\r\n    maxHeight: '180px',\r\n    overflowY: 'auto',\r\n  },\r\n  checkboxItem: {\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n  },\r\n  itemDescription: {\r\n    color: tokens.colorNeutralForeground3,\r\n    marginLeft: '28px', // Align with checkbox label\r\n  },\r\n  emptyState: {\r\n    color: tokens.colorNeutralForeground3,\r\n    fontStyle: 'italic',\r\n  },\r\n  disabledMessage: {\r\n    color: tokens.colorNeutralForeground4,\r\n    fontStyle: 'italic',\r\n    ...shorthands.padding(tokens.spacingVerticalS),\r\n    backgroundColor: tokens.colorNeutralBackground3,\r\n    ...shorthands.borderRadius(tokens.borderRadiusMedium),\r\n  },\r\n});\r\n\r\ninterface ScopeSelectorProps {\r\n  nodeId: string;\r\n  nodeType: PlaybookNodeType;\r\n  skillIds: string[];\r\n  knowledgeIds: string[];\r\n  toolId?: string;\r\n}\r\n\r\n/**\r\n * ScopeSelector component for selecting skills, knowledge, and tools for a node.\r\n * Filters available options based on the node's action type capabilities.\r\n */\r\nexport function ScopeSelector({\r\n  nodeId,\r\n  nodeType,\r\n  skillIds,\r\n  knowledgeIds,\r\n  toolId,\r\n}: ScopeSelectorProps) {\r\n  const styles = useStyles();\r\n  const updateNode = useCanvasStore((state) => state.updateNode);\r\n\r\n  // Get capabilities and available items from scope store\r\n  const { skills, knowledge, tools, getCapabilities } = useScopeStore();\r\n  const capabilities = useMemo(() => getCapabilities(nodeType), [getCapabilities, nodeType]);\r\n\r\n  // If no capabilities are enabled, show a message\r\n  if (!capabilities.allowsSkills && !capabilities.allowsKnowledge && !capabilities.allowsTools) {\r\n    return (\r\n      <div className={styles.container}>\r\n        <Divider>Scope</Divider>\r\n        <Text className={styles.disabledMessage}>\r\n          This node type does not support scope selections.\r\n        </Text>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className={styles.container}>\r\n      <Divider>Scope</Divider>\r\n\r\n      {/* Skills Section */}\r\n      {capabilities.allowsSkills && (\r\n        <SkillsMultiSelect\r\n          skills={skills}\r\n          selectedIds={skillIds}\r\n          nodeId={nodeId}\r\n          onUpdate={updateNode}\r\n        />\r\n      )}\r\n\r\n      {/* Knowledge Section */}\r\n      {capabilities.allowsKnowledge && (\r\n        <KnowledgeMultiSelect\r\n          knowledge={knowledge}\r\n          selectedIds={knowledgeIds}\r\n          nodeId={nodeId}\r\n          onUpdate={updateNode}\r\n        />\r\n      )}\r\n\r\n      {/* Tool Section */}\r\n      {capabilities.allowsTools && (\r\n        <ToolDropdown\r\n          tools={tools}\r\n          selectedId={toolId}\r\n          nodeId={nodeId}\r\n          onUpdate={updateNode}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n// ============================================================================\r\n// Skills Multi-Select Component\r\n// ============================================================================\r\n\r\ninterface SkillsMultiSelectProps {\r\n  skills: SkillItem[];\r\n  selectedIds: string[];\r\n  nodeId: string;\r\n  onUpdate: (nodeId: string, data: Record<string, unknown>) => void;\r\n}\r\n\r\nfunction SkillsMultiSelect({ skills, selectedIds, nodeId, onUpdate }: SkillsMultiSelectProps) {\r\n  const styles = useStyles();\r\n\r\n  const handleSkillToggle = useCallback(\r\n    (skillId: string) => (_e: React.ChangeEvent<HTMLInputElement>, data: CheckboxOnChangeData) => {\r\n      const newIds = data.checked\r\n        ? [...selectedIds, skillId]\r\n        : selectedIds.filter((id) => id !== skillId);\r\n      onUpdate(nodeId, { skillIds: newIds });\r\n    },\r\n    [selectedIds, nodeId, onUpdate]\r\n  );\r\n\r\n  return (\r\n    <div className={styles.section}>\r\n      <div className={styles.sectionHeader}>\r\n        <BrainCircuitRegular />\r\n        <Label>Skills</Label>\r\n      </div>\r\n      {skills.length === 0 ? (\r\n        <Text className={styles.emptyState}>No skills available</Text>\r\n      ) : (\r\n        <div className={styles.checkboxGroup}>\r\n          {skills.map((skill) => (\r\n            <div key={skill.id} className={styles.checkboxItem}>\r\n              <Checkbox\r\n                checked={selectedIds.includes(skill.id)}\r\n                onChange={handleSkillToggle(skill.id)}\r\n                label={skill.name}\r\n              />\r\n              {skill.description && (\r\n                <Text size={100} className={styles.itemDescription}>\r\n                  {skill.description}\r\n                </Text>\r\n              )}\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n// ============================================================================\r\n// Knowledge Multi-Select Component\r\n// ============================================================================\r\n\r\ninterface KnowledgeMultiSelectProps {\r\n  knowledge: KnowledgeItem[];\r\n  selectedIds: string[];\r\n  nodeId: string;\r\n  onUpdate: (nodeId: string, data: Record<string, unknown>) => void;\r\n}\r\n\r\nfunction KnowledgeMultiSelect({ knowledge, selectedIds, nodeId, onUpdate }: KnowledgeMultiSelectProps) {\r\n  const styles = useStyles();\r\n\r\n  const handleKnowledgeToggle = useCallback(\r\n    (knowledgeId: string) => (_e: React.ChangeEvent<HTMLInputElement>, data: CheckboxOnChangeData) => {\r\n      const newIds = data.checked\r\n        ? [...selectedIds, knowledgeId]\r\n        : selectedIds.filter((id) => id !== knowledgeId);\r\n      onUpdate(nodeId, { knowledgeIds: newIds });\r\n    },\r\n    [selectedIds, nodeId, onUpdate]\r\n  );\r\n\r\n  return (\r\n    <div className={styles.section}>\r\n      <div className={styles.sectionHeader}>\r\n        <LibraryRegular />\r\n        <Label>Knowledge</Label>\r\n      </div>\r\n      {knowledge.length === 0 ? (\r\n        <Text className={styles.emptyState}>No knowledge sources available</Text>\r\n      ) : (\r\n        <div className={styles.checkboxGroup}>\r\n          {knowledge.map((item) => (\r\n            <div key={item.id} className={styles.checkboxItem}>\r\n              <Checkbox\r\n                checked={selectedIds.includes(item.id)}\r\n                onChange={handleKnowledgeToggle(item.id)}\r\n                label={item.name}\r\n              />\r\n              {item.description && (\r\n                <Text size={100} className={styles.itemDescription}>\r\n                  {item.description}\r\n                </Text>\r\n              )}\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n// ============================================================================\r\n// Tool Dropdown Component (Single Select)\r\n// ============================================================================\r\n\r\ninterface ToolDropdownProps {\r\n  tools: ToolItem[];\r\n  selectedId?: string;\r\n  nodeId: string;\r\n  onUpdate: (nodeId: string, data: Record<string, unknown>) => void;\r\n}\r\n\r\nfunction ToolDropdown({ tools, selectedId, nodeId, onUpdate }: ToolDropdownProps) {\r\n  const styles = useStyles();\r\n\r\n  const selectedTool = useMemo(\r\n    () => tools.find((t) => t.id === selectedId),\r\n    [tools, selectedId]\r\n  );\r\n\r\n  const handleToolChange: DropdownProps['onOptionSelect'] = useCallback(\r\n    (_event: SelectionEvents, data: OptionOnSelectData) => {\r\n      // data.optionValue is the tool ID or empty string for \"(None)\"\r\n      onUpdate(nodeId, { toolId: data.optionValue || undefined });\r\n    },\r\n    [nodeId, onUpdate]\r\n  );\r\n\r\n  return (\r\n    <div className={styles.section}>\r\n      <div className={styles.sectionHeader}>\r\n        <WrenchRegular />\r\n        <Label htmlFor=\"tool-dropdown\">Tool</Label>\r\n      </div>\r\n      <Dropdown\r\n        id=\"tool-dropdown\"\r\n        placeholder=\"Select a tool...\"\r\n        value={selectedTool?.name || ''}\r\n        selectedOptions={selectedId ? [selectedId] : []}\r\n        onOptionSelect={handleToolChange}\r\n      >\r\n        <Option key=\"none\" value=\"\">\r\n          (None)\r\n        </Option>\r\n        {tools.map((tool) => (\r\n          <Option key={tool.id} value={tool.id} text={tool.name}>\r\n            <div>\r\n              <Text weight=\"semibold\">{tool.name}</Text>\r\n              {tool.description && (\r\n                <Text size={100} style={{ display: 'block', color: tokens.colorNeutralForeground3 }}>\r\n                  {tool.description}\r\n                </Text>\r\n              )}\r\n            </div>\r\n          </Option>\r\n        ))}\r\n      </Dropdown>\r\n    </div>\r\n  );\r\n}\r\n","import { useCallback, useMemo } from 'react';\r\nimport {\r\n  makeStyles,\r\n  tokens,\r\n  Text,\r\n  Input,\r\n  Label,\r\n  Textarea,\r\n  SpinButton,\r\n  Badge,\r\n  Divider,\r\n  shorthands,\r\n} from '@fluentui/react-components';\r\nimport type { SpinButtonChangeEvent, SpinButtonOnChangeData } from '@fluentui/react-components';\r\nimport { useCanvasStore, PlaybookNode, PlaybookNodeData, PlaybookNodeType } from '../../stores';\r\nimport { ScopeSelector } from './ScopeSelector';\r\n\r\nconst useStyles = makeStyles({\r\n  form: {\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    gap: tokens.spacingVerticalM,\r\n  },\r\n  field: {\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    gap: tokens.spacingVerticalXS,\r\n  },\r\n  nodeType: {\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    gap: tokens.spacingHorizontalS,\r\n    marginBottom: tokens.spacingVerticalS,\r\n  },\r\n  sectionHeader: {\r\n    marginTop: tokens.spacingVerticalM,\r\n    marginBottom: tokens.spacingVerticalS,\r\n  },\r\n  readOnlyField: {\r\n    backgroundColor: tokens.colorNeutralBackground3,\r\n    ...shorthands.padding(tokens.spacingVerticalS, tokens.spacingHorizontalM),\r\n    ...shorthands.borderRadius(tokens.borderRadiusMedium),\r\n  },\r\n  conditionEditor: {\r\n    fontFamily: 'monospace',\r\n    fontSize: '12px',\r\n  },\r\n});\r\n\r\n// Human-readable labels for node types\r\nconst nodeTypeLabels: Record<PlaybookNodeType, string> = {\r\n  aiAnalysis: 'AI Analysis',\r\n  aiCompletion: 'AI Completion',\r\n  condition: 'Condition',\r\n  deliverOutput: 'Deliver Output',\r\n  createTask: 'Create Task',\r\n  sendEmail: 'Send Email',\r\n  wait: 'Wait',\r\n};\r\n\r\n// Badge colors for node types\r\nconst nodeTypeBadgeColors: Record<PlaybookNodeType, 'brand' | 'warning' | 'success' | 'important'> = {\r\n  aiAnalysis: 'brand',\r\n  aiCompletion: 'brand',\r\n  condition: 'warning',\r\n  deliverOutput: 'success',\r\n  createTask: 'important',\r\n  sendEmail: 'important',\r\n  wait: 'important',\r\n};\r\n\r\ninterface NodePropertiesFormProps {\r\n  node: PlaybookNode;\r\n}\r\n\r\n/**\r\n * Form component for editing node properties.\r\n * Auto-saves changes to the Zustand store.\r\n */\r\nexport function NodePropertiesForm({ node }: NodePropertiesFormProps) {\r\n  const styles = useStyles();\r\n  const updateNode = useCanvasStore((state) => state.updateNode);\r\n\r\n  const isConditionNode = node.data.type === 'condition';\r\n\r\n  // Create a memoized update handler\r\n  const handleUpdate = useCallback(\r\n    (field: keyof PlaybookNodeData, value: unknown) => {\r\n      updateNode(node.id, { [field]: value });\r\n    },\r\n    [node.id, updateNode]\r\n  );\r\n\r\n  // Handler for text inputs\r\n  const handleTextChange = useCallback(\r\n    (field: keyof PlaybookNodeData) =>\r\n      (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\r\n        handleUpdate(field, e.target.value);\r\n      },\r\n    [handleUpdate]\r\n  );\r\n\r\n  // Handler for spin button (number inputs)\r\n  const handleNumberChange = useCallback(\r\n    (field: keyof PlaybookNodeData) =>\r\n      (_e: SpinButtonChangeEvent, data: SpinButtonOnChangeData) => {\r\n        if (data.value !== undefined && data.value !== null) {\r\n          handleUpdate(field, data.value);\r\n        }\r\n      },\r\n    [handleUpdate]\r\n  );\r\n\r\n  // Get current values with defaults\r\n  const values = useMemo(\r\n    () => ({\r\n      label: node.data.label || '',\r\n      outputVariable: node.data.outputVariable || '',\r\n      timeoutSeconds: node.data.timeoutSeconds ?? 300,\r\n      retryCount: node.data.retryCount ?? 0,\r\n      conditionJson: node.data.conditionJson || '{\\n  \"field\": \"\",\\n  \"operator\": \"equals\",\\n  \"value\": \"\"\\n}',\r\n      skillIds: node.data.skillIds || [],\r\n      knowledgeIds: node.data.knowledgeIds || [],\r\n      toolId: node.data.toolId,\r\n    }),\r\n    [node.data]\r\n  );\r\n\r\n  return (\r\n    <div className={styles.form}>\r\n      {/* Node Type Badge (read-only) */}\r\n      <div className={styles.nodeType}>\r\n        <Text size={200} weight=\"semibold\">\r\n          Type:\r\n        </Text>\r\n        <Badge appearance=\"filled\" color={nodeTypeBadgeColors[node.data.type]}>\r\n          {nodeTypeLabels[node.data.type]}\r\n        </Badge>\r\n      </div>\r\n\r\n      {/* Basic Properties */}\r\n      <div className={styles.field}>\r\n        <Label htmlFor=\"node-label\" required>\r\n          Name\r\n        </Label>\r\n        <Input\r\n          id=\"node-label\"\r\n          value={values.label}\r\n          onChange={handleTextChange('label')}\r\n          placeholder=\"Enter node name\"\r\n        />\r\n      </div>\r\n\r\n      <div className={styles.field}>\r\n        <Label htmlFor=\"output-variable\">Output Variable</Label>\r\n        <Input\r\n          id=\"output-variable\"\r\n          value={values.outputVariable}\r\n          onChange={handleTextChange('outputVariable')}\r\n          placeholder=\"e.g., extractedEntities\"\r\n        />\r\n        <Text size={100} style={{ color: tokens.colorNeutralForeground3 }}>\r\n          Reference in other nodes as {'{{'}\r\n          {values.outputVariable || 'variableName'}\r\n          {'}}'}\r\n        </Text>\r\n      </div>\r\n\r\n      {/* Execution Settings */}\r\n      <Divider className={styles.sectionHeader}>Execution Settings</Divider>\r\n\r\n      <div className={styles.field}>\r\n        <Label htmlFor=\"timeout-seconds\">Timeout (seconds)</Label>\r\n        <SpinButton\r\n          id=\"timeout-seconds\"\r\n          value={values.timeoutSeconds}\r\n          onChange={handleNumberChange('timeoutSeconds')}\r\n          min={30}\r\n          max={3600}\r\n          step={30}\r\n        />\r\n        <Text size={100} style={{ color: tokens.colorNeutralForeground3 }}>\r\n          Maximum time before timeout (30-3600s)\r\n        </Text>\r\n      </div>\r\n\r\n      <div className={styles.field}>\r\n        <Label htmlFor=\"retry-count\">Retry Count</Label>\r\n        <SpinButton\r\n          id=\"retry-count\"\r\n          value={values.retryCount}\r\n          onChange={handleNumberChange('retryCount')}\r\n          min={0}\r\n          max={5}\r\n          step={1}\r\n        />\r\n        <Text size={100} style={{ color: tokens.colorNeutralForeground3 }}>\r\n          Number of retry attempts on failure (0-5)\r\n        </Text>\r\n      </div>\r\n\r\n      {/* Scope Selector (skills, knowledge, tools) */}\r\n      <ScopeSelector\r\n        nodeId={node.id}\r\n        nodeType={node.data.type}\r\n        skillIds={values.skillIds}\r\n        knowledgeIds={values.knowledgeIds}\r\n        toolId={values.toolId}\r\n      />\r\n\r\n      {/* Condition Editor (only for condition nodes) */}\r\n      {isConditionNode && (\r\n        <>\r\n          <Divider className={styles.sectionHeader}>Condition Expression</Divider>\r\n\r\n          <div className={styles.field}>\r\n            <Label htmlFor=\"condition-json\">Condition JSON</Label>\r\n            <Textarea\r\n              id=\"condition-json\"\r\n              className={styles.conditionEditor}\r\n              value={values.conditionJson}\r\n              onChange={handleTextChange('conditionJson')}\r\n              rows={6}\r\n              resize=\"vertical\"\r\n              placeholder='{\"field\": \"score\", \"operator\": \">=\", \"value\": 0.8}'\r\n            />\r\n            <Text size={100} style={{ color: tokens.colorNeutralForeground3 }}>\r\n              JSON expression to evaluate. True branch executes if condition passes.\r\n            </Text>\r\n          </div>\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import { makeStyles, tokens, Text, shorthands } from '@fluentui/react-components';\r\nimport { Settings20Regular } from '@fluentui/react-icons';\r\nimport { useCanvasStore } from '../../stores';\r\nimport { NodePropertiesForm } from './NodePropertiesForm';\r\n\r\nconst useStyles = makeStyles({\r\n  panel: {\r\n    width: '300px',\r\n    height: '100%',\r\n    backgroundColor: tokens.colorNeutralBackground2,\r\n    ...shorthands.borderLeft('1px', 'solid', tokens.colorNeutralStroke1),\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    ...shorthands.overflow('hidden'),\r\n  },\r\n  header: {\r\n    padding: tokens.spacingVerticalM,\r\n    ...shorthands.borderBottom('1px', 'solid', tokens.colorNeutralStroke2),\r\n    backgroundColor: tokens.colorNeutralBackground1,\r\n  },\r\n  headerTitle: {\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    gap: tokens.spacingHorizontalS,\r\n  },\r\n  content: {\r\n    flex: 1,\r\n    ...shorthands.overflow('auto'),\r\n    padding: tokens.spacingVerticalM,\r\n  },\r\n  emptyState: {\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    height: '100%',\r\n    gap: tokens.spacingVerticalM,\r\n    color: tokens.colorNeutralForeground3,\r\n    textAlign: 'center',\r\n    padding: tokens.spacingHorizontalL,\r\n  },\r\n  emptyIcon: {\r\n    fontSize: '48px',\r\n    color: tokens.colorNeutralForeground4,\r\n  },\r\n});\r\n\r\n/**\r\n * Properties panel component that shows node configuration\r\n * when a node is selected, or an empty state otherwise.\r\n */\r\nexport function PropertiesPanel() {\r\n  const styles = useStyles();\r\n  const { selectedNodeId, nodes } = useCanvasStore((state) => ({\r\n    selectedNodeId: state.selectedNodeId,\r\n    nodes: state.nodes,\r\n  }));\r\n\r\n  const selectedNode = selectedNodeId\r\n    ? nodes.find((n) => n.id === selectedNodeId)\r\n    : null;\r\n\r\n  return (\r\n    <div className={styles.panel}>\r\n      <div className={styles.header}>\r\n        <div className={styles.headerTitle}>\r\n          <Settings20Regular />\r\n          <Text weight=\"semibold\" size={400}>\r\n            Properties\r\n          </Text>\r\n        </div>\r\n      </div>\r\n\r\n      <div className={styles.content}>\r\n        {selectedNode ? (\r\n          <NodePropertiesForm node={selectedNode} />\r\n        ) : (\r\n          <div className={styles.emptyState}>\r\n            <Settings20Regular className={styles.emptyIcon} />\r\n            <Text size={300}>No node selected</Text>\r\n            <Text size={200}>\r\n              Select a node on the canvas to view and edit its properties\r\n            </Text>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import { DragEvent, useCallback } from 'react';\r\nimport { makeStyles, tokens, Text, Title1, Card, CardHeader } from '@fluentui/react-components';\r\nimport {\r\n  BrainCircuit20Regular,\r\n  Branch20Regular,\r\n  Mail20Regular,\r\n  DocumentArrowRight20Regular,\r\n  TaskListSquareLtr20Regular,\r\n} from '@fluentui/react-icons';\r\nimport { Canvas } from './Canvas';\r\nimport { PropertiesPanel } from './Properties';\r\nimport type { PlaybookNodeType } from '../stores/canvasStore';\r\n\r\nconst useStyles = makeStyles({\r\n  container: {\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    height: '100%',\r\n    width: '100%',\r\n  },\r\n  header: {\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    justifyContent: 'space-between',\r\n    padding: `${tokens.spacingVerticalM} ${tokens.spacingHorizontalL}`,\r\n    borderBottom: `1px solid ${tokens.colorNeutralStroke1}`,\r\n    backgroundColor: tokens.colorNeutralBackground2,\r\n  },\r\n  content: {\r\n    display: 'flex',\r\n    flex: 1,\r\n    overflow: 'hidden',\r\n  },\r\n  sidebar: {\r\n    width: '250px',\r\n    borderRight: `1px solid ${tokens.colorNeutralStroke1}`,\r\n    backgroundColor: tokens.colorNeutralBackground2,\r\n    padding: tokens.spacingHorizontalM,\r\n    overflowY: 'auto',\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    gap: tokens.spacingVerticalS,\r\n  },\r\n  canvas: {\r\n    flex: 1,\r\n  },\r\n  sectionTitle: {\r\n    marginBottom: tokens.spacingVerticalS,\r\n    color: tokens.colorNeutralForeground2,\r\n  },\r\n  paletteItem: {\r\n    cursor: 'grab',\r\n    '&:active': {\r\n      cursor: 'grabbing',\r\n    },\r\n  },\r\n  nodeIcon: {\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    width: '32px',\r\n    height: '32px',\r\n    borderRadius: tokens.borderRadiusMedium,\r\n    backgroundColor: tokens.colorBrandBackground,\r\n    color: tokens.colorNeutralForegroundOnBrand,\r\n  },\r\n  nodeIconAi: {\r\n    backgroundColor: '#0078D4',\r\n  },\r\n  nodeIconCondition: {\r\n    backgroundColor: '#FFB900',\r\n  },\r\n  nodeIconDelivery: {\r\n    backgroundColor: '#107C10',\r\n  },\r\n  nodeIconIntegration: {\r\n    backgroundColor: '#8764B8',\r\n  },\r\n});\r\n\r\n// Palette items available for drag-and-drop\r\nconst paletteItems: Array<{\r\n  type: PlaybookNodeType;\r\n  label: string;\r\n  icon: JSX.Element;\r\n  iconStyle: string;\r\n}> = [\r\n  { type: 'aiAnalysis', label: 'AI Analysis', icon: <BrainCircuit20Regular />, iconStyle: 'nodeIconAi' },\r\n  { type: 'aiCompletion', label: 'AI Completion', icon: <BrainCircuit20Regular />, iconStyle: 'nodeIconAi' },\r\n  { type: 'condition', label: 'Condition', icon: <Branch20Regular />, iconStyle: 'nodeIconCondition' },\r\n  { type: 'deliverOutput', label: 'Deliver Output', icon: <DocumentArrowRight20Regular />, iconStyle: 'nodeIconDelivery' },\r\n  { type: 'createTask', label: 'Create Task', icon: <TaskListSquareLtr20Regular />, iconStyle: 'nodeIconIntegration' },\r\n  { type: 'sendEmail', label: 'Send Email', icon: <Mail20Regular />, iconStyle: 'nodeIconIntegration' },\r\n];\r\n\r\n/**\r\n * Main layout for the Playbook Builder.\r\n * Consists of:\r\n * - Header with title and actions\r\n * - Left sidebar with node palette\r\n * - Center canvas with React Flow\r\n * - Right panel for node properties\r\n */\r\nexport function BuilderLayout() {\r\n  const styles = useStyles();\r\n\r\n  // Handle drag start from palette\r\n  const onDragStart = useCallback(\r\n    (event: DragEvent<HTMLDivElement>, type: PlaybookNodeType, label: string) => {\r\n      event.dataTransfer.setData('application/reactflow', JSON.stringify({ type, label }));\r\n      event.dataTransfer.effectAllowed = 'move';\r\n    },\r\n    []\r\n  );\r\n\r\n  return (\r\n    <div className={styles.container}>\r\n      {/* Header */}\r\n      <header className={styles.header}>\r\n        <Title1>Playbook Builder</Title1>\r\n      </header>\r\n\r\n      {/* Main Content */}\r\n      <div className={styles.content}>\r\n        {/* Node Palette Sidebar */}\r\n        <aside className={styles.sidebar}>\r\n          <Text className={styles.sectionTitle} weight=\"semibold\">\r\n            Node Palette\r\n          </Text>\r\n          <Text size={200} style={{ color: tokens.colorNeutralForeground3, marginBottom: tokens.spacingVerticalM }}>\r\n            Drag nodes to canvas\r\n          </Text>\r\n\r\n          {paletteItems.map((item) => (\r\n            <Card\r\n              key={item.type}\r\n              className={styles.paletteItem}\r\n              draggable\r\n              onDragStart={(e) => onDragStart(e, item.type, item.label)}\r\n            >\r\n              <CardHeader\r\n                image={\r\n                  <div className={`${styles.nodeIcon} ${styles[item.iconStyle as keyof typeof styles]}`}>\r\n                    {item.icon}\r\n                  </div>\r\n                }\r\n                header={<Text weight=\"semibold\">{item.label}</Text>}\r\n              />\r\n            </Card>\r\n          ))}\r\n        </aside>\r\n\r\n        {/* Canvas */}\r\n        <main className={styles.canvas}>\r\n          <Canvas />\r\n        </main>\r\n\r\n        {/* Properties Panel */}\r\n        <PropertiesPanel />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import { useState, useCallback, useEffect } from 'react';\r\nimport {\r\n  FluentProvider,\r\n  webLightTheme,\r\n  webDarkTheme,\r\n  makeStyles,\r\n  tokens,\r\n} from '@fluentui/react-components';\r\nimport { useThemeDetection } from './hooks/useThemeDetection';\r\nimport { useHostBridge } from './hooks/useHostBridge';\r\nimport { BuilderLayout } from './components/BuilderLayout';\r\n\r\nconst useStyles = makeStyles({\r\n  root: {\r\n    height: '100vh',\r\n    width: '100vw',\r\n    overflow: 'hidden',\r\n    backgroundColor: tokens.colorNeutralBackground1,\r\n    color: tokens.colorNeutralForeground1,\r\n  },\r\n});\r\n\r\nexport function App() {\r\n  const systemIsDarkMode = useThemeDetection();\r\n  const styles = useStyles();\r\n\r\n  // Host theme override (from PCF host via postMessage)\r\n  const [hostTheme, setHostTheme] = useState<'light' | 'dark' | null>(null);\r\n\r\n  // Handle theme changes from host\r\n  const handleThemeChange = useCallback((theme: 'light' | 'dark') => {\r\n    setHostTheme(theme);\r\n  }, []);\r\n\r\n  // Initialize host bridge (handles INIT, dirty state sync, save)\r\n  const { isEmbedded } = useHostBridge({\r\n    onThemeChange: handleThemeChange,\r\n  });\r\n\r\n  // Use host theme if embedded, otherwise use system detection\r\n  const isDarkMode = hostTheme !== null ? hostTheme === 'dark' : systemIsDarkMode;\r\n  const theme = isDarkMode ? webDarkTheme : webLightTheme;\r\n\r\n  // Log embedding status on mount\r\n  useEffect(() => {\r\n    console.info('[App] Running in', isEmbedded ? 'embedded mode (iframe)' : 'standalone mode');\r\n  }, [isEmbedded]);\r\n\r\n  return (\r\n    <FluentProvider theme={theme} className={styles.root}>\r\n      <BuilderLayout />\r\n    </FluentProvider>\r\n  );\r\n}\r\n","import { StrictMode } from 'react';\r\nimport { createRoot } from 'react-dom/client';\r\nimport { App } from './App';\r\n\r\nconst rootElement = document.getElementById('root');\r\n\r\nif (!rootElement) {\r\n  throw new Error('Failed to find the root element');\r\n}\r\n\r\ncreateRoot(rootElement).render(\r\n  <StrictMode>\r\n    <App />\r\n  </StrictMode>\r\n);\r\n"],"names":["m","require$$0","createRoot","useThemeDetection","isDarkMode","setIsDarkMode","useState","useEffect","mediaQuery","handleChange","e","handleMessage","event","_a","_HostBridge","config","__publicField","message","error","isDirty","canvasJson","playbookId","playbookName","authToken","_b","token","expiresAt","HostBridge","useDebugValue","ReactExports","useSyncExternalStoreWithSelector","useSyncExternalStoreExports","didWarnAboutEqualityFn","identity","arg","useStore","api","selector","equalityFn","__vite_import_meta_env__","slice","createImpl","createState","createStore","useBoundStore","create","generateNodeId","initialState","CANVAS_JSON_VERSION","useCanvasStore","set","get","nodes","changes","state","applyNodeChanges","node","nodeId","data","edge","edges","applyEdgeChanges","connection","addEdge","position","nodeType","label","newNode","json","useHostBridge","options","onSaveSuccess","onSaveError","onThemeChange","s","loadFromJson","toJson","markSaved","bridgeRef","useRef","isReadyRef","playbookIdRef","playbookNameRef","prevIsDirtyRef","handleInit","useCallback","payload","handleSaveSuccess","_payload","handleSaveError","handleThemeChange","bridge","save","isEmbedded","playbook","updates","actionTypeCapabilities","mockSkills","mockKnowledge","mockTools","useScopeStore","ids","k","id","t","useStyles","makeStyles","shorthands","tokens","nodeColorSchemes","BaseNode","memo","selected","icon","typeLabel","children","sourceHandleCount","targetHandleCount","styles","colorScheme","jsxs","mergeClasses","jsx","Handle","Position","Text","AiAnalysisNode","BrainCircuit20Regular","AiCompletionNode","ConditionNode","Branch20Regular","DeliverOutputNode","DocumentArrowRight20Regular","CreateTaskNode","TaskListSquareLtr20Regular","SendEmailNode","Mail20Regular","WaitNode","Clock20Regular","nodeTypes","reactFlowStyle","nodeColorByType","Canvas","reactFlowWrapper","reactFlowInstance","onNodesChange","onEdgesChange","onConnect","selectNode","onDrop","onInit","instance","onNodeClick","_event","onPaneClick","onDragOver","handleDrop","nodeTypeData","type","bounds","getMinimapNodeColor","nodeData","ReactFlow","Background","BackgroundVariant","Controls","MiniMap","ScopeSelector","skillIds","knowledgeIds","toolId","updateNode","skills","knowledge","tools","getCapabilities","capabilities","useMemo","Divider","SkillsMultiSelect","KnowledgeMultiSelect","ToolDropdown","selectedIds","onUpdate","handleSkillToggle","skillId","_e","newIds","BrainCircuitRegular","Label","skill","Checkbox","handleKnowledgeToggle","knowledgeId","LibraryRegular","item","selectedId","selectedTool","handleToolChange","WrenchRegular","Dropdown","Option","tool","nodeTypeLabels","nodeTypeBadgeColors","NodePropertiesForm","isConditionNode","handleUpdate","field","value","handleTextChange","handleNumberChange","values","Badge","Input","SpinButton","Fragment","Textarea","PropertiesPanel","selectedNodeId","selectedNode","n","Settings20Regular","paletteItems","BuilderLayout","onDragStart","Title1","Card","CardHeader","App","systemIsDarkMode","hostTheme","setHostTheme","theme","webDarkTheme","webLightTheme","FluentProvider","rootElement","StrictMode"],"mappings":"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","x_google_ignoreList":[0,3]}