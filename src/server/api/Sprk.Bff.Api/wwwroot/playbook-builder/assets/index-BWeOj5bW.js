var ie=Object.defineProperty;var re=(t,e,n)=>e in t?ie(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var k=(t,e,n)=>re(t,typeof e!="symbol"?e+"":e,n);import{m as C,a as m,t as a,j as o,b as X,T as h,B as H,c as Y,D as Q,d as Z,M as ee,C as le,e as F,f as ce,L as S,g as oe,h as de,W as ue,i as pe,O as M,k as he,I as L,S as P,l as ge,n as J,o as me,p as fe,q as ye,F as be,w as xe,r as ke}from"./fluent-vendor-CmJVTK5h.js";import{a as Ne,r as c,b as Se}from"./react-vendor-BWFb42Va.js";import{c as we,u as Ce,a as ve,b as je,d as Te,H as I,P as D,i as Ie,B as De,e as Ee,C as Be,M as Ae}from"./flow-vendor-BHHmI87s.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();var ne,$=Ne;ne=$.createRoot,$.hydrateRoot;function Re(){const[t,e]=c.useState(()=>typeof window<"u"&&window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)").matches:!1);return c.useEffect(()=>{const n=window.matchMedia("(prefers-color-scheme: dark)"),s=r=>{e(r.matches)};n.addEventListener("change",s);const i=r=>{var l;((l=r.data)==null?void 0:l.type)==="THEME_CHANGE"&&e(r.data.isDarkMode)};return window.addEventListener("message",i),()=>{n.removeEventListener("change",s),window.removeEventListener("message",i)}},[]),t}const x=class x{constructor(e={}){k(this,"config");k(this,"isInitialized",!1);k(this,"messageHandler",null);k(this,"playbookId","");k(this,"playbookName","");k(this,"canvasJson","");k(this,"authToken","");k(this,"tokenExpiresAt",0);this.config={allowedOrigins:e.allowedOrigins??["*"],onInit:e.onInit,onAuthToken:e.onAuthToken,onSaveSuccess:e.onSaveSuccess,onSaveError:e.onSaveError,onThemeChange:e.onThemeChange}}static getInstance(e){return x.instance?e&&Object.assign(x.instance.config,e):x.instance=new x(e),x.instance}static resetInstance(){x.instance&&(x.instance.destroy(),x.instance=null)}initialize(){if(this.isInitialized){console.warn("[HostBridge] Already initialized");return}if(!this.isEmbedded()){console.info("[HostBridge] Not running in iframe, skipping initialization");return}console.info("[HostBridge] Initializing..."),this.messageHandler=this.handleMessage.bind(this),window.addEventListener("message",this.messageHandler),this.isInitialized=!0,this.sendReady(),console.info("[HostBridge] Initialized and READY sent")}destroy(){this.messageHandler&&(window.removeEventListener("message",this.messageHandler),this.messageHandler=null),this.isInitialized=!1,console.info("[HostBridge] Destroyed")}isEmbedded(){try{return window.self!==window.top}catch{return!0}}getPlaybookId(){return this.playbookId}getPlaybookName(){return this.playbookName}getCanvasJson(){return this.canvasJson}getAuthToken(){return this.authToken}isTokenExpired(){return this.tokenExpiresAt?Date.now()>=this.tokenExpiresAt:!0}sendToHost(e){if(!this.isEmbedded()){console.debug("[HostBridge] Not embedded, message not sent:",e.type);return}try{window.parent.postMessage(e,"*"),console.debug("[HostBridge] Sent to host:",e.type)}catch(n){console.error("[HostBridge] Failed to send message:",n)}}sendReady(){this.sendToHost({type:"READY"})}sendDirtyChange(e){this.sendToHost({type:"DIRTY_CHANGE",payload:{isDirty:e}})}sendSaveRequest(e){this.sendToHost({type:"SAVE_REQUEST",payload:{canvasJson:e}})}sendCanvasUpdate(e){this.sendToHost({type:"CANVAS_UPDATE",payload:{canvasJson:e}})}sendRequestToken(){this.sendToHost({type:"REQUEST_TOKEN"})}handleMessage(e){if(this.config.allowedOrigins[0]!=="*"&&!this.config.allowedOrigins.includes(e.origin)){console.warn("[HostBridge] Ignoring message from unknown origin:",e.origin);return}const n=e.data;if(!(!n||typeof n!="object"||!n.type))switch(console.debug("[HostBridge] Received from host:",n.type),n.type){case"INIT":this.handleInit(n);break;case"AUTH_TOKEN":this.handleAuthToken(n);break;case"SAVE_SUCCESS":this.handleSaveSuccess(n);break;case"SAVE_ERROR":this.handleSaveError(n);break;case"THEME_CHANGE":this.handleThemeChange(n);break;default:console.debug("[HostBridge] Unknown message type:",n.type)}}handleInit(e){var l,u;const{playbookId:n,playbookName:s,canvasJson:i,authToken:r}=e.payload;this.playbookId=n,this.playbookName=s,this.canvasJson=i,r&&(this.authToken=r),console.info("[HostBridge] Received INIT:",{playbookId:n,playbookName:s,hasCanvasJson:!!i,hasToken:!!r}),(u=(l=this.config).onInit)==null||u.call(l,e.payload)}handleAuthToken(e){var i,r;const{token:n,expiresAt:s}=e.payload;this.authToken=n,this.tokenExpiresAt=s,console.info("[HostBridge] Received AUTH_TOKEN, expires at:",new Date(s)),(r=(i=this.config).onAuthToken)==null||r.call(i,e.payload)}handleSaveSuccess(e){var n,s;console.info("[HostBridge] Save successful at:",new Date(e.payload.timestamp)),(s=(n=this.config).onSaveSuccess)==null||s.call(n,e.payload)}handleSaveError(e){var n,s;console.error("[HostBridge] Save failed:",e.payload.error),(s=(n=this.config).onSaveError)==null||s.call(n,e.payload)}handleThemeChange(e){var n,s;console.info("[HostBridge] Theme changed to:",e.payload.theme),(s=(n=this.config).onThemeChange)==null||s.call(n,e.payload)}};k(x,"instance",null);let O=x;const te={},{useDebugValue:He}=Se,{useSyncExternalStoreWithSelector:Fe}=Ce;let W=!1;const ze=t=>t;function Oe(t,e=ze,n){(te?"production":void 0)!=="production"&&n&&!W&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),W=!0);const s=Fe(t.subscribe,t.getState,t.getServerState||t.getInitialState,e,n);return He(s),s}const K=t=>{(te?"production":void 0)!=="production"&&typeof t!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const e=typeof t=="function"?we(t):t,n=(s,i)=>Oe(e,s,i);return Object.assign(n,e),n},V=t=>t?K(t):K,Ve=()=>`node_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,G={nodes:[],edges:[],selectedNodeId:null,isDirty:!1,lastSavedJson:null},Me=1,w=V((t,e)=>({...G,setNodes:n=>t({nodes:n,isDirty:!0}),onNodesChange:n=>t(s=>({nodes:Te(n,s.nodes),isDirty:!0})),addNode:n=>t(s=>({nodes:[...s.nodes,n],isDirty:!0})),updateNode:(n,s)=>t(i=>({nodes:i.nodes.map(r=>r.id===n?{...r,data:{...r.data,...s}}:r),isDirty:!0})),removeNode:n=>t(s=>({nodes:s.nodes.filter(i=>i.id!==n),edges:s.edges.filter(i=>i.source!==n&&i.target!==n),selectedNodeId:s.selectedNodeId===n?null:s.selectedNodeId,isDirty:!0})),setEdges:n=>t({edges:n,isDirty:!0}),onEdgesChange:n=>t(s=>({edges:je(n,s.edges),isDirty:!0})),onConnect:n=>t(s=>({edges:ve({...n,type:"smoothstep",animated:!0},s.edges),isDirty:!0})),selectNode:n=>t({selectedNodeId:n}),onDrop:(n,s,i)=>{const r={id:Ve(),type:s,position:n,data:{label:i,type:s,outputVariable:`output_${s}`}};e().addNode(r),e().selectNode(r.id)},loadFromJson:n=>{try{const s=JSON.parse(n);t({nodes:s.nodes||[],edges:s.edges||[],selectedNodeId:null,isDirty:!1,lastSavedJson:n}),console.info("[CanvasStore] Loaded canvas from JSON")}catch(s){console.error("[CanvasStore] Failed to parse canvas JSON:",s)}},toJson:()=>{const{nodes:n,edges:s}=e();return JSON.stringify({nodes:n,edges:s,version:Me})},markSaved:()=>{const n=e().toJson();t({isDirty:!1,lastSavedJson:n})},markDirty:()=>t({isDirty:!0}),reset:()=>t(G)}));function Le(t={}){var R;const{onSaveSuccess:e,onSaveError:n,onThemeChange:s}=t,i=w(p=>p.isDirty),r=w(p=>p.loadFromJson),l=w(p=>p.toJson),u=w(p=>p.markSaved),d=c.useRef(null),g=c.useRef(!1),f=c.useRef(""),b=c.useRef(""),v=c.useRef(i),E=c.useCallback(p=>{console.info("[useHostBridge] Received INIT from host"),f.current=p.playbookId,b.current=p.playbookName,p.canvasJson&&r(p.canvasJson),g.current=!0},[r]),B=c.useCallback(p=>{console.info("[useHostBridge] Save successful"),u(),e==null||e()},[u,e]),A=c.useCallback(p=>{console.error("[useHostBridge] Save failed:",p.error),n==null||n(p.error)},[n]),y=c.useCallback(p=>{console.info("[useHostBridge] Theme changed:",p.theme),s==null||s(p.theme)},[s]);c.useEffect(()=>{const p=O.getInstance({onInit:E,onSaveSuccess:B,onSaveError:A,onThemeChange:y});return d.current=p,p.initialize(),()=>{}},[E,B,A,y]),c.useEffect(()=>{var p;v.current!==i&&(v.current=i,(p=d.current)==null||p.sendDirtyChange(i))},[i]);const N=c.useCallback(()=>{if(!d.current){console.warn("[useHostBridge] Bridge not initialized");return}const p=l();d.current.sendSaveRequest(p),console.info("[useHostBridge] Save request sent")},[l]),T=((R=d.current)==null?void 0:R.isEmbedded())??!1;return{isReady:g.current,isDirty:i,isEmbedded:T,save:N,playbookId:f.current,playbookName:b.current}}V(t=>({playbook:null,selectedNodeId:null,isDirty:!1,setPlaybook:e=>t({playbook:e,isDirty:!1}),selectNode:e=>t({selectedNodeId:e}),addNode:e=>t(n=>n.playbook?{playbook:{...n.playbook,nodes:[...n.playbook.nodes,e]},isDirty:!0}:n),updateNode:(e,n)=>t(s=>s.playbook?{playbook:{...s.playbook,nodes:s.playbook.nodes.map(i=>i.id===e?{...i,...n}:i)},isDirty:!0}:s),removeNode:e=>t(n=>n.playbook?{playbook:{...n.playbook,nodes:n.playbook.nodes.filter(s=>s.id!==e)},selectedNodeId:n.selectedNodeId===e?null:n.selectedNodeId,isDirty:!0}:n),setDirty:e=>t({isDirty:e})}));const Pe={aiAnalysis:{allowsSkills:!0,allowsKnowledge:!0,allowsTools:!0},aiCompletion:{allowsSkills:!0,allowsKnowledge:!0,allowsTools:!0},condition:{allowsSkills:!1,allowsKnowledge:!1,allowsTools:!1},deliverOutput:{allowsSkills:!1,allowsKnowledge:!0,allowsTools:!0},createTask:{allowsSkills:!1,allowsKnowledge:!1,allowsTools:!1},sendEmail:{allowsSkills:!1,allowsKnowledge:!0,allowsTools:!1},wait:{allowsSkills:!1,allowsKnowledge:!1,allowsTools:!1}},_=[{id:"skill-1",name:"Entity Extraction",description:"Extract named entities from text",category:"extraction"},{id:"skill-2",name:"Key Phrase Extraction",description:"Identify key phrases and topics",category:"extraction"},{id:"skill-3",name:"Sentiment Analysis",description:"Analyze sentiment and tone",category:"analysis"},{id:"skill-4",name:"Document Classification",description:"Classify document type and category",category:"classification"},{id:"skill-5",name:"Text Summarization",description:"Generate concise summaries",category:"generation"},{id:"skill-6",name:"Risk Identification",description:"Identify potential risks and issues",category:"analysis"}],q=[{id:"knowledge-1",name:"Company Policies",description:"Internal policy documents",type:"document"},{id:"knowledge-2",name:"Legal Templates",description:"Standard contract templates",type:"document"},{id:"knowledge-3",name:"Customer Database",description:"CRM customer records",type:"datasource"},{id:"knowledge-4",name:"Product Catalog",description:"Product specifications and pricing",type:"datasource"},{id:"knowledge-5",name:"Instructions",description:"Custom inline instructions",type:"inline"}],U=[{id:"tool-1",name:"Document Analyzer",description:"Azure AI Document Intelligence",handlerType:"DocumentAnalyzer"},{id:"tool-2",name:"Search Index",description:"Azure AI Search integration",handlerType:"SearchIndex"},{id:"tool-3",name:"GPT-4 Completion",description:"Azure OpenAI GPT-4 completion",handlerType:"GptCompletion"},{id:"tool-4",name:"Word Generator",description:"Generate Word documents",handlerType:"WordGenerator"},{id:"tool-5",name:"PDF Generator",description:"Generate PDF documents",handlerType:"PdfGenerator"}],Je=V(()=>({skills:_,knowledge:q,tools:U,isLoadingSkills:!1,isLoadingKnowledge:!1,isLoadingTools:!1,getCapabilities:t=>Pe[t]||{allowsSkills:!1,allowsKnowledge:!1,allowsTools:!1},getSkillsByIds:t=>_.filter(e=>t.includes(e.id)),getKnowledgeByIds:t=>q.filter(e=>t.includes(e.id)),getToolById:t=>U.find(e=>e.id===t)})),$e=C({container:{minWidth:"180px",maxWidth:"220px",...m.borderRadius(a.borderRadiusMedium),backgroundColor:a.colorNeutralBackground1,...m.border("1px","solid",a.colorNeutralStroke1),boxShadow:a.shadow4,...m.overflow("hidden"),transitionProperty:"box-shadow, border-color",transitionDuration:"0.2s",transitionTimingFunction:"ease"},selected:{...m.borderColor(a.colorBrandStroke1),boxShadow:a.shadow16},header:{display:"flex",alignItems:"center",gap:a.spacingHorizontalS,padding:`${a.spacingVerticalS} ${a.spacingHorizontalM}`,borderBottom:`1px solid ${a.colorNeutralStroke2}`},iconWrapper:{display:"flex",alignItems:"center",justifyContent:"center",width:"28px",height:"28px",borderRadius:a.borderRadiusSmall,flexShrink:0},headerText:{flex:1,overflow:"hidden"},label:{display:"block",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},typeLabel:{display:"block",color:a.colorNeutralForeground3},body:{padding:`${a.spacingVerticalS} ${a.spacingHorizontalM}`}}),We={aiAnalysis:{background:"#0078D4",iconColor:"#ffffff"},aiCompletion:{background:"#0078D4",iconColor:"#ffffff"},condition:{background:"#FFB900",iconColor:"#000000"},deliverOutput:{background:"#107C10",iconColor:"#ffffff"},createTask:{background:"#8764B8",iconColor:"#ffffff"},sendEmail:{background:"#8764B8",iconColor:"#ffffff"},wait:{background:"#E3008C",iconColor:"#ffffff"}},j=c.memo(function({data:e,selected:n,icon:s,typeLabel:i,children:r,sourceHandleCount:l=1,targetHandleCount:u=1}){const d=$e(),g=We[e.type];return o.jsxs("div",{className:X(d.container,n&&d.selected),children:[u>0&&o.jsx(I,{type:"target",position:D.Top}),o.jsxs("div",{className:d.header,children:[o.jsx("div",{className:d.iconWrapper,style:{backgroundColor:g.background,color:g.iconColor},children:s}),o.jsxs("div",{className:d.headerText,children:[o.jsx(h,{size:300,weight:"semibold",className:d.label,children:e.label}),o.jsx(h,{size:100,className:d.typeLabel,children:i})]})]}),r&&o.jsx("div",{className:d.body,children:r}),l>0&&o.jsx(I,{type:"source",position:D.Bottom})]})}),Ke=c.memo(function({data:e,selected:n}){return o.jsx(j,{data:e,selected:n,icon:o.jsx(H,{}),typeLabel:"AI Analysis",children:e.outputVariable&&o.jsxs(h,{size:100,style:{color:a.colorNeutralForeground3},children:["Output: ",e.outputVariable]})})}),Ge=c.memo(function({data:e,selected:n}){return o.jsx(j,{data:e,selected:n,icon:o.jsx(H,{}),typeLabel:"AI Completion",children:e.outputVariable&&o.jsxs(h,{size:100,style:{color:a.colorNeutralForeground3},children:["Output: ",e.outputVariable]})})}),_e={aiAnalysis:{background:"#0078D4",iconColor:"#ffffff"},aiCompletion:{background:"#0078D4",iconColor:"#ffffff"},condition:{background:"#FFB900",iconColor:"#000000"},deliverOutput:{background:"#107C10",iconColor:"#ffffff"},createTask:{background:"#8764B8",iconColor:"#ffffff"},sendEmail:{background:"#8764B8",iconColor:"#ffffff"},wait:{background:"#E3008C",iconColor:"#ffffff"}},qe=C({container:{minWidth:"180px",maxWidth:"220px",...m.borderRadius(a.borderRadiusMedium),backgroundColor:a.colorNeutralBackground1,...m.border("1px","solid",a.colorNeutralStroke1),boxShadow:a.shadow4,...m.overflow("hidden"),transitionProperty:"box-shadow, border-color",transitionDuration:"0.2s",transitionTimingFunction:"ease"},selected:{...m.borderColor(a.colorBrandStroke1),boxShadow:a.shadow16},header:{display:"flex",alignItems:"center",gap:a.spacingHorizontalS,padding:`${a.spacingVerticalS} ${a.spacingHorizontalM}`,borderBottom:`1px solid ${a.colorNeutralStroke2}`},iconWrapper:{display:"flex",alignItems:"center",justifyContent:"center",width:"28px",height:"28px",borderRadius:a.borderRadiusSmall,flexShrink:0},headerText:{flex:1,overflow:"hidden"},label:{display:"block",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},typeLabel:{display:"block",color:a.colorNeutralForeground3},branches:{display:"flex",justifyContent:"space-between",padding:`${a.spacingVerticalXS} ${a.spacingHorizontalM}`,borderTop:`1px solid ${a.colorNeutralStroke2}`,position:"relative"},branchLabel:{display:"flex",flexDirection:"column",alignItems:"center",gap:a.spacingVerticalXS,flex:1},trueBranch:{color:a.colorPaletteGreenForeground1},falseBranch:{color:a.colorPaletteRedForeground1}}),Ue=c.memo(function({data:e,selected:n}){const s=qe(),i=_e[e.type];return o.jsxs("div",{className:X(s.container,n&&s.selected),children:[o.jsx(I,{type:"target",position:D.Top}),o.jsxs("div",{className:s.header,children:[o.jsx("div",{className:s.iconWrapper,style:{backgroundColor:i.background,color:i.iconColor},children:o.jsx(Y,{})}),o.jsxs("div",{className:s.headerText,children:[o.jsx(h,{size:300,weight:"semibold",className:s.label,children:e.label}),o.jsx(h,{size:100,className:s.typeLabel,children:"Condition"})]})]}),o.jsxs("div",{className:s.branches,children:[o.jsx("div",{className:s.branchLabel,children:o.jsx(h,{size:100,weight:"semibold",className:s.trueBranch,children:"True"})}),o.jsx("div",{className:s.branchLabel,children:o.jsx(h,{size:100,weight:"semibold",className:s.falseBranch,children:"False"})})]}),o.jsx(I,{type:"source",position:D.Bottom,id:"true",style:{left:"25%"}}),o.jsx(I,{type:"source",position:D.Bottom,id:"false",style:{left:"75%"}})]})}),Xe=c.memo(function({data:e,selected:n}){return o.jsx(j,{data:e,selected:n,icon:o.jsx(Q,{}),typeLabel:"Deliver Output",sourceHandleCount:0,children:e.outputVariable&&o.jsxs(h,{size:100,style:{color:a.colorNeutralForeground3},children:["Variable: ",e.outputVariable]})})}),Ye=c.memo(function({data:e,selected:n}){return o.jsx(j,{data:e,selected:n,icon:o.jsx(Z,{}),typeLabel:"Create Task",children:e.outputVariable&&o.jsxs(h,{size:100,style:{color:a.colorNeutralForeground3},children:["Output: ",e.outputVariable]})})}),Qe=c.memo(function({data:e,selected:n}){return o.jsx(j,{data:e,selected:n,icon:o.jsx(ee,{}),typeLabel:"Send Email",children:e.outputVariable&&o.jsxs(h,{size:100,style:{color:a.colorNeutralForeground3},children:["Output: ",e.outputVariable]})})}),Ze=c.memo(function({data:e,selected:n}){return o.jsx(j,{data:e,selected:n,icon:o.jsx(le,{}),typeLabel:"Wait",children:e.outputVariable&&o.jsxs(h,{size:100,style:{color:a.colorNeutralForeground3},children:["Output: ",e.outputVariable]})})}),eo={aiAnalysis:Ke,aiCompletion:Ge,condition:Ue,deliverOutput:Xe,createTask:Ye,sendEmail:Qe,wait:Ze},oo=C({container:{width:"100%",height:"100%",backgroundColor:a.colorNeutralBackground1}}),no={"--xy-background-color":a.colorNeutralBackground1,"--xy-minimap-background":a.colorNeutralBackground2,"--xy-controls-background":a.colorNeutralBackground2,"--xy-controls-border-color":a.colorNeutralStroke1},to={aiAnalysis:"#0078D4",aiCompletion:"#0078D4",condition:"#FFB900",deliverOutput:"#107C10",createTask:"#8764B8",sendEmail:"#8764B8",wait:"#E3008C"};function so(){const t=oo(),e=c.useRef(null),n=c.useRef(null),{nodes:s,edges:i,onNodesChange:r,onEdgesChange:l,onConnect:u,selectNode:d,onDrop:g}=w(),f=c.useCallback(y=>{n.current=y},[]),b=c.useCallback((y,N)=>{d(N.id)},[d]),v=c.useCallback(()=>{d(null)},[d]),E=c.useCallback(y=>{y.preventDefault(),y.dataTransfer.dropEffect="move"},[]),B=c.useCallback(y=>{if(y.preventDefault(),!e.current||!n.current)return;const N=y.dataTransfer.getData("application/reactflow");if(N)try{const{type:T,label:R}=JSON.parse(N),p=e.current.getBoundingClientRect(),ae=n.current.screenToFlowPosition({x:y.clientX-p.left,y:y.clientY-p.top});g(ae,T,R)}catch(T){console.error("Failed to parse dropped node data:",T)}},[g]),A=c.useCallback(y=>{const N=y.data;return to[N.type]||a.colorNeutralForeground3},[]);return o.jsx("div",{ref:e,className:t.container,children:o.jsxs(Ie,{nodes:s,edges:i,nodeTypes:eo,onNodesChange:r,onEdgesChange:l,onConnect:u,onInit:f,onNodeClick:b,onPaneClick:v,onDragOver:E,onDrop:B,fitView:!0,snapToGrid:!0,snapGrid:[16,16],defaultEdgeOptions:{type:"smoothstep",animated:!0},style:no,proOptions:{hideAttribution:!0},children:[o.jsx(De,{variant:Ee.Dots,gap:16,size:1,color:a.colorNeutralStroke2}),o.jsx(Be,{showZoom:!0,showFitView:!0,showInteractive:!0,position:"bottom-left"}),o.jsx(Ae,{nodeColor:A,nodeStrokeWidth:2,zoomable:!0,pannable:!0,position:"bottom-right"})]})})}const z=C({container:{display:"flex",flexDirection:"column",gap:a.spacingVerticalM},section:{display:"flex",flexDirection:"column",gap:a.spacingVerticalS},sectionHeader:{display:"flex",alignItems:"center",gap:a.spacingHorizontalS,marginBottom:a.spacingVerticalXS},checkboxGroup:{display:"flex",flexDirection:"column",gap:a.spacingVerticalXS,...m.padding(a.spacingVerticalS,0),maxHeight:"180px",overflowY:"auto"},checkboxItem:{display:"flex",flexDirection:"column"},itemDescription:{color:a.colorNeutralForeground3,marginLeft:"28px"},emptyState:{color:a.colorNeutralForeground3,fontStyle:"italic"},disabledMessage:{color:a.colorNeutralForeground4,fontStyle:"italic",...m.padding(a.spacingVerticalS),backgroundColor:a.colorNeutralBackground3,...m.borderRadius(a.borderRadiusMedium)}});function ao({nodeId:t,nodeType:e,skillIds:n,knowledgeIds:s,toolId:i}){const r=z(),l=w(v=>v.updateNode),{skills:u,knowledge:d,tools:g,getCapabilities:f}=Je(),b=c.useMemo(()=>f(e),[f,e]);return!b.allowsSkills&&!b.allowsKnowledge&&!b.allowsTools?o.jsxs("div",{className:r.container,children:[o.jsx(F,{children:"Scope"}),o.jsx(h,{className:r.disabledMessage,children:"This node type does not support scope selections."})]}):o.jsxs("div",{className:r.container,children:[o.jsx(F,{children:"Scope"}),b.allowsSkills&&o.jsx(io,{skills:u,selectedIds:n,nodeId:t,onUpdate:l}),b.allowsKnowledge&&o.jsx(ro,{knowledge:d,selectedIds:s,nodeId:t,onUpdate:l}),b.allowsTools&&o.jsx(lo,{tools:g,selectedId:i,nodeId:t,onUpdate:l})]})}function io({skills:t,selectedIds:e,nodeId:n,onUpdate:s}){const i=z(),r=c.useCallback(l=>(u,d)=>{const g=d.checked?[...e,l]:e.filter(f=>f!==l);s(n,{skillIds:g})},[e,n,s]);return o.jsxs("div",{className:i.section,children:[o.jsxs("div",{className:i.sectionHeader,children:[o.jsx(ce,{}),o.jsx(S,{children:"Skills"})]}),t.length===0?o.jsx(h,{className:i.emptyState,children:"No skills available"}):o.jsx("div",{className:i.checkboxGroup,children:t.map(l=>o.jsxs("div",{className:i.checkboxItem,children:[o.jsx(oe,{checked:e.includes(l.id),onChange:r(l.id),label:l.name}),l.description&&o.jsx(h,{size:100,className:i.itemDescription,children:l.description})]},l.id))})]})}function ro({knowledge:t,selectedIds:e,nodeId:n,onUpdate:s}){const i=z(),r=c.useCallback(l=>(u,d)=>{const g=d.checked?[...e,l]:e.filter(f=>f!==l);s(n,{knowledgeIds:g})},[e,n,s]);return o.jsxs("div",{className:i.section,children:[o.jsxs("div",{className:i.sectionHeader,children:[o.jsx(de,{}),o.jsx(S,{children:"Knowledge"})]}),t.length===0?o.jsx(h,{className:i.emptyState,children:"No knowledge sources available"}):o.jsx("div",{className:i.checkboxGroup,children:t.map(l=>o.jsxs("div",{className:i.checkboxItem,children:[o.jsx(oe,{checked:e.includes(l.id),onChange:r(l.id),label:l.name}),l.description&&o.jsx(h,{size:100,className:i.itemDescription,children:l.description})]},l.id))})]})}function lo({tools:t,selectedId:e,nodeId:n,onUpdate:s}){const i=z(),r=c.useMemo(()=>t.find(u=>u.id===e),[t,e]),l=c.useCallback((u,d)=>{s(n,{toolId:d.optionValue||void 0})},[n,s]);return o.jsxs("div",{className:i.section,children:[o.jsxs("div",{className:i.sectionHeader,children:[o.jsx(ue,{}),o.jsx(S,{htmlFor:"tool-dropdown",children:"Tool"})]}),o.jsxs(pe,{id:"tool-dropdown",placeholder:"Select a tool...",value:(r==null?void 0:r.name)||"",selectedOptions:e?[e]:[],onOptionSelect:l,children:[o.jsx(M,{value:"",children:"(None)"},"none"),t.map(u=>o.jsx(M,{value:u.id,text:u.name,children:o.jsxs("div",{children:[o.jsx(h,{weight:"semibold",children:u.name}),u.description&&o.jsx(h,{size:100,style:{display:"block",color:a.colorNeutralForeground3},children:u.description})]})},u.id))]})]})}const co=C({form:{display:"flex",flexDirection:"column",gap:a.spacingVerticalM},field:{display:"flex",flexDirection:"column",gap:a.spacingVerticalXS},nodeType:{display:"flex",alignItems:"center",gap:a.spacingHorizontalS,marginBottom:a.spacingVerticalS},sectionHeader:{marginTop:a.spacingVerticalM,marginBottom:a.spacingVerticalS},readOnlyField:{backgroundColor:a.colorNeutralBackground3,...m.padding(a.spacingVerticalS,a.spacingHorizontalM),...m.borderRadius(a.borderRadiusMedium)},conditionEditor:{fontFamily:"monospace",fontSize:"12px"}}),uo={aiAnalysis:"AI Analysis",aiCompletion:"AI Completion",condition:"Condition",deliverOutput:"Deliver Output",createTask:"Create Task",sendEmail:"Send Email",wait:"Wait"},po={aiAnalysis:"brand",aiCompletion:"brand",condition:"warning",deliverOutput:"success",createTask:"important",sendEmail:"important",wait:"important"};function ho({node:t}){const e=co(),n=w(d=>d.updateNode),s=t.data.type==="condition",i=c.useCallback((d,g)=>{n(t.id,{[d]:g})},[t.id,n]),r=c.useCallback(d=>g=>{i(d,g.target.value)},[i]),l=c.useCallback(d=>(g,f)=>{f.value!==void 0&&f.value!==null&&i(d,f.value)},[i]),u=c.useMemo(()=>({label:t.data.label||"",outputVariable:t.data.outputVariable||"",timeoutSeconds:t.data.timeoutSeconds??300,retryCount:t.data.retryCount??0,conditionJson:t.data.conditionJson||`{
  "field": "",
  "operator": "equals",
  "value": ""
}`,skillIds:t.data.skillIds||[],knowledgeIds:t.data.knowledgeIds||[],toolId:t.data.toolId}),[t.data]);return o.jsxs("div",{className:e.form,children:[o.jsxs("div",{className:e.nodeType,children:[o.jsx(h,{size:200,weight:"semibold",children:"Type:"}),o.jsx(he,{appearance:"filled",color:po[t.data.type],children:uo[t.data.type]})]}),o.jsxs("div",{className:e.field,children:[o.jsx(S,{htmlFor:"node-label",required:!0,children:"Name"}),o.jsx(L,{id:"node-label",value:u.label,onChange:r("label"),placeholder:"Enter node name"})]}),o.jsxs("div",{className:e.field,children:[o.jsx(S,{htmlFor:"output-variable",children:"Output Variable"}),o.jsx(L,{id:"output-variable",value:u.outputVariable,onChange:r("outputVariable"),placeholder:"e.g., extractedEntities"}),o.jsxs(h,{size:100,style:{color:a.colorNeutralForeground3},children:["Reference in other nodes as ","{{",u.outputVariable||"variableName","}}"]})]}),o.jsx(F,{className:e.sectionHeader,children:"Execution Settings"}),o.jsxs("div",{className:e.field,children:[o.jsx(S,{htmlFor:"timeout-seconds",children:"Timeout (seconds)"}),o.jsx(P,{id:"timeout-seconds",value:u.timeoutSeconds,onChange:l("timeoutSeconds"),min:30,max:3600,step:30}),o.jsx(h,{size:100,style:{color:a.colorNeutralForeground3},children:"Maximum time before timeout (30-3600s)"})]}),o.jsxs("div",{className:e.field,children:[o.jsx(S,{htmlFor:"retry-count",children:"Retry Count"}),o.jsx(P,{id:"retry-count",value:u.retryCount,onChange:l("retryCount"),min:0,max:5,step:1}),o.jsx(h,{size:100,style:{color:a.colorNeutralForeground3},children:"Number of retry attempts on failure (0-5)"})]}),o.jsx(ao,{nodeId:t.id,nodeType:t.data.type,skillIds:u.skillIds,knowledgeIds:u.knowledgeIds,toolId:u.toolId}),s&&o.jsxs(o.Fragment,{children:[o.jsx(F,{className:e.sectionHeader,children:"Condition Expression"}),o.jsxs("div",{className:e.field,children:[o.jsx(S,{htmlFor:"condition-json",children:"Condition JSON"}),o.jsx(ge,{id:"condition-json",className:e.conditionEditor,value:u.conditionJson,onChange:r("conditionJson"),rows:6,resize:"vertical",placeholder:'{"field": "score", "operator": ">=", "value": 0.8}'}),o.jsx(h,{size:100,style:{color:a.colorNeutralForeground3},children:"JSON expression to evaluate. True branch executes if condition passes."})]})]})]})}const go=C({panel:{width:"300px",height:"100%",backgroundColor:a.colorNeutralBackground2,...m.borderLeft("1px","solid",a.colorNeutralStroke1),display:"flex",flexDirection:"column",...m.overflow("hidden")},header:{padding:a.spacingVerticalM,...m.borderBottom("1px","solid",a.colorNeutralStroke2),backgroundColor:a.colorNeutralBackground1},headerTitle:{display:"flex",alignItems:"center",gap:a.spacingHorizontalS},content:{flex:1,...m.overflow("auto"),padding:a.spacingVerticalM},emptyState:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",gap:a.spacingVerticalM,color:a.colorNeutralForeground3,textAlign:"center",padding:a.spacingHorizontalL},emptyIcon:{fontSize:"48px",color:a.colorNeutralForeground4}});function mo(){const t=go(),{selectedNodeId:e,nodes:n}=w(i=>({selectedNodeId:i.selectedNodeId,nodes:i.nodes})),s=e?n.find(i=>i.id===e):null;return o.jsxs("div",{className:t.panel,children:[o.jsx("div",{className:t.header,children:o.jsxs("div",{className:t.headerTitle,children:[o.jsx(J,{}),o.jsx(h,{weight:"semibold",size:400,children:"Properties"})]})}),o.jsx("div",{className:t.content,children:s?o.jsx(ho,{node:s}):o.jsxs("div",{className:t.emptyState,children:[o.jsx(J,{className:t.emptyIcon}),o.jsx(h,{size:300,children:"No node selected"}),o.jsx(h,{size:200,children:"Select a node on the canvas to view and edit its properties"})]})})]})}const fo=C({container:{display:"flex",flexDirection:"column",height:"100%",width:"100%"},header:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:`${a.spacingVerticalM} ${a.spacingHorizontalL}`,borderBottom:`1px solid ${a.colorNeutralStroke1}`,backgroundColor:a.colorNeutralBackground2},content:{display:"flex",flex:1,overflow:"hidden"},sidebar:{width:"250px",borderRight:`1px solid ${a.colorNeutralStroke1}`,backgroundColor:a.colorNeutralBackground2,padding:a.spacingHorizontalM,overflowY:"auto",display:"flex",flexDirection:"column",gap:a.spacingVerticalS},canvas:{flex:1},sectionTitle:{marginBottom:a.spacingVerticalS,color:a.colorNeutralForeground2},paletteItem:{cursor:"grab","&:active":{cursor:"grabbing"}},nodeIcon:{display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",borderRadius:a.borderRadiusMedium,backgroundColor:a.colorBrandBackground,color:a.colorNeutralForegroundOnBrand},nodeIconAi:{backgroundColor:"#0078D4"},nodeIconCondition:{backgroundColor:"#FFB900"},nodeIconDelivery:{backgroundColor:"#107C10"},nodeIconIntegration:{backgroundColor:"#8764B8"}}),yo=[{type:"aiAnalysis",label:"AI Analysis",icon:o.jsx(H,{}),iconStyle:"nodeIconAi"},{type:"aiCompletion",label:"AI Completion",icon:o.jsx(H,{}),iconStyle:"nodeIconAi"},{type:"condition",label:"Condition",icon:o.jsx(Y,{}),iconStyle:"nodeIconCondition"},{type:"deliverOutput",label:"Deliver Output",icon:o.jsx(Q,{}),iconStyle:"nodeIconDelivery"},{type:"createTask",label:"Create Task",icon:o.jsx(Z,{}),iconStyle:"nodeIconIntegration"},{type:"sendEmail",label:"Send Email",icon:o.jsx(ee,{}),iconStyle:"nodeIconIntegration"}];function bo(){const t=fo(),e=c.useCallback((n,s,i)=>{n.dataTransfer.setData("application/reactflow",JSON.stringify({type:s,label:i})),n.dataTransfer.effectAllowed="move"},[]);return o.jsxs("div",{className:t.container,children:[o.jsx("header",{className:t.header,children:o.jsx(me,{children:"Playbook Builder"})}),o.jsxs("div",{className:t.content,children:[o.jsxs("aside",{className:t.sidebar,children:[o.jsx(h,{className:t.sectionTitle,weight:"semibold",children:"Node Palette"}),o.jsx(h,{size:200,style:{color:a.colorNeutralForeground3,marginBottom:a.spacingVerticalM},children:"Drag nodes to canvas"}),yo.map(n=>o.jsx(fe,{className:t.paletteItem,draggable:!0,onDragStart:s=>e(s,n.type,n.label),children:o.jsx(ye,{image:o.jsx("div",{className:`${t.nodeIcon} ${t[n.iconStyle]}`,children:n.icon}),header:o.jsx(h,{weight:"semibold",children:n.label})})},n.type))]}),o.jsx("main",{className:t.canvas,children:o.jsx(so,{})}),o.jsx(mo,{})]})]})}const xo=C({root:{height:"100vh",width:"100vw",overflow:"hidden",backgroundColor:a.colorNeutralBackground1,color:a.colorNeutralForeground1}});function ko(){const t=Re(),e=xo(),[n,s]=c.useState(null),i=c.useCallback(d=>{s(d)},[]),{isEmbedded:r}=Le({onThemeChange:i}),u=(n!==null?n==="dark":t)?xe:ke;return c.useEffect(()=>{console.info("[App] Running in",r?"embedded mode (iframe)":"standalone mode")},[r]),o.jsx(be,{theme:u,className:e.root,children:o.jsx(bo,{})})}const se=document.getElementById("root");if(!se)throw new Error("Failed to find the root element");ne(se).render(o.jsx(c.StrictMode,{children:o.jsx(ko,{})}));
//# sourceMappingURL=index-BWeOj5bW.js.map
