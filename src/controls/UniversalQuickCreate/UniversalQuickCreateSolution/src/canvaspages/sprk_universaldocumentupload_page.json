{
  "$schema": "https://schema.powerapps.com/custompages/v1.0/schema.json",
  "name": "sprk_universaldocumentupload_page",
  "displayName": "Universal Document Upload",
  "description": "Upload multiple documents to SharePoint Embedded - Universal entity support",
  "type": "ModelDrivenApp",
  "customPageType": "Dialog",
  "parameters": [
    {
      "name": "parentEntityName",
      "displayName": "Parent Entity Name",
      "dataType": "String",
      "required": true,
      "description": "Logical name of parent entity (e.g., sprk_matter, account, contact)"
    },
    {
      "name": "parentRecordId",
      "displayName": "Parent Record ID",
      "dataType": "String",
      "required": true,
      "description": "GUID of parent record (without curly braces)"
    },
    {
      "name": "containerId",
      "displayName": "Container ID",
      "dataType": "String",
      "required": true,
      "description": "SharePoint Embedded Container ID for file uploads"
    },
    {
      "name": "parentDisplayName",
      "displayName": "Parent Display Name",
      "dataType": "String",
      "required": false,
      "description": "Display name of parent record (e.g., 'Matter #12345')"
    }
  ],
  "pages": [
    {
      "id": "mainPage",
      "displayName": "Document Upload",
      "layout": {
        "type": "Stack",
        "direction": "Vertical",
        "width": "100%",
        "height": "100%"
      },
      "events": {
        "onVisible": {
          "formula": "If(Not(varInit), Set(varInit, true); Set(_pEntity, Param(\"parentEntityName\")); Set(_pId, Param(\"parentRecordId\")); Set(_pContainer, Param(\"containerId\")); Set(_pDisplayName, Param(\"parentDisplayName\")); Set(_raw, Param(\"data\")); If(Or(IsBlank(_pEntity), IsBlank(_pId), IsBlank(_pContainer)), If(Not(IsBlank(_raw)), Set(_cfg, ParseJSON(_raw)); Set(_pEntity, Coalesce(_pEntity, Text(_cfg.parentEntityName))); Set(_pId, Coalesce(_pId, Text(_cfg.parentRecordId))); Set(_pContainer, Coalesce(_pContainer, Text(_cfg.containerId))); Set(_pDisplayName, Coalesce(_pDisplayName, Text(_cfg.parentDisplayName))))); Set(varParentEntityName, _pEntity); Set(varParentRecordId, _pId); Set(varContainerId, _pContainer); Set(varParentDisplayName, _pDisplayName))"
        }
      },
      "controls": [
        {
          "id": "universalDocumentUploadControl",
          "type": "pcfcontrol",
          "controlName": "Spaarke.Controls.UniversalDocumentUpload",
          "position": {
            "row": 0,
            "column": 0,
            "rowSpan": 1,
            "columnSpan": 1
          },
          "properties": {
            "Visible": {
              "expr": "And(Not(IsBlank(varParentEntityName)), Not(IsBlank(varParentRecordId)), Not(IsBlank(varContainerId)))"
            },
            "parentEntityName": {
              "expr": "varParentEntityName"
            },
            "parentRecordId": {
              "expr": "varParentRecordId"
            },
            "containerId": {
              "expr": "varContainerId"
            },
            "parentDisplayName": {
              "expr": "varParentDisplayName"
            },
            "sdapApiBaseUrl": {
              "value": "spe-api-dev-67e2xz.azurewebsites.net/api"
            }
          }
        }
      ]
    }
  ],
  "style": {
    "backgroundColor": "#FFFFFF",
    "fontFamily": "Segoe UI, sans-serif"
  }
}
